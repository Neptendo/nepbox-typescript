<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>BeepBox</title>
	<meta name="description" content="BeepBox is an online tool for sketching and sharing chiptune melodies." />
	<meta name="keywords" content="chiptune, music, melody, composition, tool, square wave, NES, NSF, BeepBox, beepbox" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="format-detection" content="telephone=no" />
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<style type="text/css">
		body {
			margin: auto;
			background: #3e236b;
			font-family: 'Roboto', sans-serif;
			font-size: large;
			line-height: 1.3;
			color: #ffb7e5;
		}
		h1 {
			font-size: 30px;
			text-align: center;
		}
		.centerDiv {
			margin: 0px auto;
		}
		a {
			color: #00ffee;
		}
		#beepboxEditorContainer {
			min-height: 645px;
		}
		
		/* wide screen */
		@media (min-width: 701px) {
			body {
				width: 700px;
			}
			.column-container {
				display: flex;
				justify-content: space-between;
			}
			/* .instructions-column {
				width: 375px;
			}
			.twitter-column {
				width: 300px;
			} */
		}
		
		/* narrow screen */
		@media (max-width: 700px) {
			body {
				width: 100vw;
			}
			.column-container {
				display: flex;
				flex-direction: column;
				align-items: center;
			}
		}
	</style>
</head>

<body>
	<div id="beepboxEditorContainer" style="width: 700px; height: 645px;"></div>
	
	<h1>
		BeepBox Offline
	</h1>
	<p id="introduction">
		BeepBox is an online (and offline!) tool for sketching and sharing chiptune melodies. 
	</p>
	<p>
		All song data is packaged into the URL at the top of your browser. 
		When you make changes to the song, the URL is updated to reflect your changes. 
		When you are satisfied with your song, just copy and paste the URL to save and share your song! 
	</p>
	
	<div class="column-container">
		<div class="instructions-column">
			<h1>
				Instructions
			</h1>
			<p>
				You can add or remove notes by clicking on the gray rows at the top. 
				BeepBox automatically plays the notes out loud for you. Try it!
			</p>
			<p>
				Notes go into patterns, and you can edit one pattern at a time.
				Those numbered boxes at the bottom of the editor are the different patterns you can edit.
				<span id="bar-editing">
					Click the other boxes to move to a different part of the song, or click the arrows on the currently selected box to swap which pattern is played during that part of the song.
				</span>
			</p>
			<p>
				BeepBox can play several rows of patterns simultaneously, and each row has its own set of patterns. 
				Most rows can play melodies or harmonies, but the bottom row is for drums.
			</p>
			<p>
				The purple loop underneath the numbered boxes controls which part of the song is currently repeating. 
				Move the loop to listen to a different part of the song, or drag the ends to expand the loop to include the whole song. 
			</p>
			<div id="keyboard-instructions">
				<p>
					When BeepBox has focus (click on its interface above), you can use these keyboard shortcuts: <br/>
				</p>
				<ul>
					<li>Spacebar: Pause or Resume</li>
					<li>Z: Undo</li>
					<li>Y or Shift Z: Redo</li>
					<li>C: Copy the current pattern</li>
					<li>V: Paste the current pattern</li>
					<li>[ ]: Move the playhead backward and forward</li>
					<li>Arrow Keys: Change which bar is selected</li>
					<li>1-8: Reassign a pattern to the currently selected bar</li>
					<li>- +: Shift the notes in the pattern up or down</li>
				</ul>
			</div>
			<p>
				In the pattern editor, you can click and drag horizontally on a note to adjust its duration.
				You can also click above or below an existing note to enable a rapid arpeggio/trill effect, oscillating between two or more simultaneous notes. 
			</p>
			<p>
				ADVANCED: Drag vertically from an existing note to bend its pitch, or drag vertically from above or below the note to adjust its volume.
			</p>
			<p>
				BeepBox has many more features. 
				Try playing with the buttons and menus on the right side to find out what it can do!
			</p>
			<h1>
				About
			</h1>
			<p>
				BeepBox is developed by <a href="http://www.johnnesky.com">John Nesky</a>. 
			</p>
			<p>
				BeepBox does not claim ownership over songs created with it, so original songs belong to their authors. 
			</p>
			<p>
				Neither John Nesky nor BeepBox assume responsibility for any copyrighted material played on BeepBox. No songs are ever received, recorded, or distributed by BeepBox's servers. All song data is contained in the URL after the hash (#) mark, and BeepBox running inside your browser converts that data into sound waves.
			</p>
			<p>
				You can download and use <a href="https://bitbucket.org/shaktool/beepbox">the source code</a> under the MIT license.
			</p>
		</div>
	</div>

	<script type="text/javascript">

if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent) ) {
	document.getElementById("introduction").innerHTML = "BeepBox is an online tool for sketching and sharing chiptune melodies. Make sure that your volume is turned up, then press the play button!";
	document.getElementById("keyboard-instructions").style.display = "none";
	document.getElementById("bar-editing").innerHTML = "Tap the other boxes to move to a different part of the song, or tap on the currently selected box to swap which pattern is played during that part of the song.";
}

var __extends=this&&this.a||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function a(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),beepbox;!function(t){function e(t,e){for(var n=0;n<t.length;n++)t[n]*=e}function n(t){return!(!t||t&t-1)}function a(t){if(!n(t))throw new Error("FFT array length must be a power of 2.");return Math.round(Math.log(t)/Math.log(2))}function i(t){var e=t.length,n=a(e);if(n>16)throw new Error("FFT array length must not be greater than 2^16.");for(var i=16-n,s=0;s<e;s++){var r=void 0;if(r=(43690&s)>>1|(21845&s)<<1,r=(52428&r)>>2|(13107&r)<<2,r=(61680&r)>>4|(3855&r)<<4,(r=(r>>8|(255&r)<<8)>>i)>s){var o=t[s];t[s]=t[r],t[r]=o}}}function s(t){var e=t.length,n=a(e);if(e<4)throw new Error("FFT array length must be at least 4.");for(var s=n-1;s>=2;s--)for(var r=1<<s,o=r>>1,h=r<<1,l=2*Math.PI/h,c=Math.cos(l),f=Math.sin(l),u=2*c,p=0;p<e;p+=h){var d=p,m=d+o,g=d+r,b=g+o,v=g+r,C=t[d],y=t[g];t[d]=C+y,t[m]*=2,t[g]=C-y,t[b]*=2;for(var R=c,w=-f,x=1,P=0,N=1;N<o;N++){var L=d+N,k=g-N,A=g+N,M=v-N,E=t[L],S=t[k],B=t[A],I=t[M],F=E-S,D=B+I;t[L]=E+S,t[k]=I-B,t[A]=F*R-D*w,t[M]=D*R+F*w;var T=u*R-x,O=u*w-P;x=R,P=w,R=T,w=O}}for(var N=0;N<e;N+=4){var V=N+1,H=N+2,Y=N+3,E=t[N],S=2*t[V],j=t[H],U=2*t[Y],F=E+j,D=E-j;t[N]=F+S,t[V]=F-S,t[H]=D+U,t[Y]=D-U}i(t)}t.scaleElementsByFactor=e,t.inverseRealFourierTransform=s}(beepbox||(beepbox={}));var beepbox;!function(t){function e(t,e,n){return{interval:t,time:e,volume:n}}function n(t,n,a,i,s){return void 0===s&&(s=!1),{pitches:[t],pins:[e(0,0,i),e(0,a-n,s?0:i)],start:n,end:a}}var a=function(){function e(){}return e.c=function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];for(var a=e/t.length,n=0;n<t.length;n++)t[n]-=a;return new Float64Array(t)},e.getDrumWave=function(n){var a=e.e[n];if(null==a)if(a=new Float32Array(32768),e.e[n]=a,0==n)for(var i=1,s=0;s<32768;s++){a[s]=2*(1&i)-1;var r=i>>1;1==(i+r&1)&&(r+=16384),i=r}else if(1==n)for(var s=0;s<32768;s++)a[s]=2*Math.random()-1;else if(2==n)for(var i=1,s=0;s<32768;s++){a[s]=2*(1&i)-1;var r=i>>1;1==(i+r&1)&&(r+=32768),i=r}else if(3==n)for(var i=1,s=0;s<32767;s++){a[s]=2*(1&i)-1;var r=i>>2;1==(i+r&1)&&(r+=65536),i=r}else if(4==n)for(var i=1,s=0;s<32768;s++){a[s]=2*(1&i)-1;var r=i>>1;1==(i+r&1)&&(r+=40),i=r}else if(5==n)e.drawNoiseSpectrum(a,10,11,1,1,0),e.drawNoiseSpectrum(a,11,14,-2,-2,0),t.inverseRealFourierTransform(a),t.scaleElementsByFactor(a,1/Math.sqrt(a.length));else if(6==n)e.drawNoiseSpectrum(a,1,10,1,1,0),e.drawNoiseSpectrum(a,20,14,-2,-2,0),t.inverseRealFourierTransform(a),t.scaleElementsByFactor(a,1/Math.sqrt(a.length));else if(7==n)for(var i=1,s=0;s<32768;s++){a[s]=4*(1&i)*Math.random();var r=i>>1;1==(i+r&1)&&(r+=60),i=r}else if(8==n)for(var i=1,s=0;s<32768;s++){a[s]=(1&i)/2+.5;var r=i>>1;1==(i+r&1)&&(r-=40),i=r}else{if(9!=n)throw new Error("Unrecognized drum index: "+n);for(var s=0;s<32768;s++)a[s]=2*Math.random()-1}return a},e.drawNoiseSpectrum=function(t,e,n,a,i,s){for(var r=0|Math.pow(2,e),o=0|Math.pow(2,n),h=Math.log(2),l=r;l<o;l++){var c=Math.pow(2,a+(i-a)*(Math.log(l)/h-e)/(n-e));c*=Math.pow(l/2048,s);var f=Math.random()*Math.PI*2;t[l]=Math.cos(f)*c,t[32768-l]=Math.sin(f)*c}},e.generateSineWave=function(){for(var t=new Float64Array(e.sineWaveLength+1),n=0;n<e.sineWaveLength+1;n++)t[n]=Math.sin(n*Math.PI*2/e.sineWaveLength);return t},e.scaleNames=["pent maj","pent min","ryukyu","pelog selisir","blues major","megalovania","major","minor","dbl harm maj","dbl harm min","whole tone","chromatic","monotonic","no dabbing","jacked toad"],e.scaleFlags=[[!0,!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!1],[!0,!1,!1,!0,!1,!0,!1,!0,!1,!1,!0,!1],[!0,!1,!1,!1,!0,!0,!1,!0,!1,!1,!1,!0],[!0,!0,!1,!0,!1,!1,!1,!0,!0,!1,!1,!1],[!0,!1,!0,!0,!0,!1,!1,!0,!1,!0,!1,!1],[!0,!1,!1,!0,!1,!0,!0,!0,!1,!1,!0,!1],[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0],[!0,!1,!0,!0,!1,!0,!1,!0,!0,!1,!0,!1],[!0,!0,!1,!1,!0,!0,!1,!0,!0,!1,!1,!0],[!0,!1,!0,!0,!1,!1,!0,!0,!0,!1,!1,!0],[!0,!1,!0,!1,!0,!1,!0,!1,!0,!1,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!0,!0,!1,!0,!0,!0,!0,!0,!0,!1,!0,!1],[!0,!1,!0,!0,!1,!0,!0,!0,!0,!1,!0,!0]],e.pianoScaleFlags=[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0],e.blackKeyNameParents=[-1,1,-1,1,-1,1,-1,-1,1,-1,1,-1],e.pitchNames=["C",null,"D",null,"E","F",null,"G",null,"A",null,"B"],e.keyNames=["B","A♯","A","G♯","G","F♯","F","E","D♯","D","C♯","C","B-"],e.keyTransposes=[23,22,21,20,19,18,17,16,15,14,13,12,11],e.mixNames=["Type A (B & S)","Type B (M)","Type C"],e.sampleRateNames=["44100kHz","48000kHz","default","×4","×2","÷2","÷4","÷8","÷16"],e.tempoSteps=24,e.reverbRange=5,e.blendRange=4,e.riffRange=11,e.detuneRange=24,e.muffRange=24,e.beatsPerBarMin=1,e.beatsPerBarMax=24,e.barCountMin=1,e.barCountMax=256,e.patternsPerChannelMin=1,e.patternsPerChannelMax=128,e.instrumentsPerChannelMin=1,e.instrumentsPerChannelMax=64,e.partNames=["÷3 (triplets)","÷4 (standard)","÷6","÷8","÷16 (arpfest)","÷12","÷9","÷5","÷50","÷24"],e.partCounts=[3,4,6,8,16,12,9,5,50,24],e.waveNames=["triangle","square","pulse wide","pulse narrow","sawtooth","double saw","double pulse","spiky","plateau","glitch","10% pulse","sunsoft bass","loud pulse","sax","guitar","sine","atari bass","atari pulse","1% pulse","curved sawtooth","viola","brass","acoustic bass","lyre","ramp pulse","piccolo","squaretooth","flatline","pnryshk a (u5)","pnryshk b (riff)","squared saw","megalovania","broken triange","benttooth"],e.waveVolumes=[1,.5,.5,.5,.65,.5,.4,.4,.94,.5,.5,1,.6,.1,.25,1,1,1,1,1,1,1,1,.2,.2,.9,.9,1,.4,.5,1,.2,.2,.5],e.drumNames=["retro","white","periodic","detuned periodic","shine","hollow","deep","cutter","metallic","snare"],e.drumVolumes=[.25,1,.4,.3,.3,1.5,1.5,.25,1,1],e.drumBasePitches=[69,69,69,69,69,96,120,96,96,69],e.drumPitchFilterMult=[100,8,100,100,100,1,100,100,100,100],e.drumWaveIsSoft=[!1,!0,!1,!1,!1,!0,!0,!1,!1,!1],e.e=[null,null,null,null,null,null,null,null,null,null],e.pwmwaveNames=["5%","10%","15%","20%","25%","30%","35%","40%","45%","50%"],e.pwmwaveVolumes=[1,1,1,1,1,1,1,1,1,1],e.filterNames=["none","sustain sharp","sustain medium","sustain soft","decay sharp","decay medium","decay soft","decay drawn","fade sharp","fade medium","fade soft","ring","muffled","submerged","shift","overtone","woosh","undertone"],e.filterBases=[0,2,3.5,5,1,2.5,4,1,5,7.5,10,-1,4,6,0,1,2,5],e.filterDecays=[0,0,0,0,10,7,4,.5,-10,-7,-4,.2,.2,.3,0,0,-6,0],e.filterVolumes=[.2,.4,.7,1,.5,.75,1,.5,.4,.7,1,.5,.75,.4,.4,1,.5,1.75],e.transitionNames=["seamless","sudden","smooth","slide","trill","click","bow","blip"],e.effectNames=["none","vibrato light","vibrato delayed","vibrato heavy","tremolo light","tremolo heavy","alien","stutter","strum"],e.effectVibratos=[0,.15,.3,.45,0,0,1,0,.05],e.effectTremolos=[0,0,0,0,.25,.5,0,1,.025],e.effectVibratoDelays=[0,0,3,0,0,0,0,0],e.chorusNames=["union","shimmer","hum","honky tonk","dissonant","fifths","octaves","spinner","detune","bowed","rising","vibrate","fourths","bass","dirty","stationary","harmonic (legacy)","recurve","voiced","fluctuate"],e.chorusIntervals=[0,.02,.05,.1,.25,3.5,6,.02,0,.02,1,3.5,4,0,0,3.5,0,.005,.25,12],e.chorusOffsets=[0,0,0,0,0,3.5,6,0,.25,0,.7,7,4,-7,.1,0,0,0,3,0],e.chorusVolumes=[.9,.9,1,1,.95,.95,.9,1,1,1,.95,.975,.95,1,.975,.9,1,1,.9,1],e.chorusSigns=[1,1,1,1,1,1,1,1,1,-1,1,1,1,1,1,-1,1,-1,1,1],e.chorusRiffApp=[0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1],e.chorusHarmonizes=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],e.harmDisplay=["arpeggio","duet","chord","seventh","half arpeggio","arp-chord"],e.harmNames=[0,1,2,3,4,5],e.fmChorusDisplay=["none","default","detune","honky tonk","consecutive","alt. major thirds","alt. minor thirds","fifths","octaves"],e.fmChorusNames=[0,1,2,3,4,5,6,7,8],e.imuteNames=["◉","◎"],e.imuteValues=[1,0],e.octoffNames=["none","+2 (2 octaves)","+1 1/2 (octave and fifth)","+1 (octave)","+1/2 (fifth)","-1/2 (fifth)","-1 (octave)","-1 1/2 (octave and fifth)","-2 (2 octaves"],e.octoffValues=[0,24,19,12,7,-7,-12,-19,-24],e.volumeNames=["loudest","loud","medium","quiet","quietest","mute","i","couldnt","be","bothered"],e.volumeValues=[0,.25,.5,.75,1,1.25,1.5,1.75,2,-1],e.volumeMValues=[0,.5,1,1.5,2,-1],e.ipanValues=[-1,-.75,-.5,-.25,0,.25,.5,.75,1],e.operatorCount=4,e.operatorAlgorithmNames=["1←(2 3 4)","1←(2 3←4)","1←2←(3 4)","1←(2 3)←4","1←2←3←4","1←3 2←4","1 2←(3 4)","1 2←3←4","(1 2)←3←4","(1 2)←(3 4)","1 2 3←4","(1 2 3)←4","1 2 3 4"],e.midiAlgorithmNames=["1<(2 3 4)","1<(2 3<4)","1<2<(3 4)","1<(2 3)<4","1<2<3<4","1<3 2<4","1 2<(3 4)","1 2<3<4","(1 2)<3<4","(1 2)<(3 4)","1 2 3<4","(1 2 3)<4","1 2 3 4"],e.operatorModulatedBy=[[[2,3,4],[],[],[]],[[2,3],[],[4],[]],[[2],[3,4],[],[]],[[2,3],[4],[4],[]],[[2],[3],[4],[]],[[3],[4],[],[]],[[],[3,4],[],[]],[[],[3],[4],[]],[[3],[3],[4],[]],[[3,4],[3,4],[],[]],[[],[],[4],[]],[[4],[4],[4],[]],[[],[],[],[]]],e.operatorAssociatedCarrier=[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,2,1,2],[1,2,2,2],[1,2,2,2],[1,2,2,2],[1,2,2,2],[1,2,3,3],[1,2,3,3],[1,2,3,4]],e.operatorCarrierCounts=[1,1,1,1,1,2,2,2,2,2,3,3,4],e.operatorCarrierChorus=[[0,0,0,0],[0,.04,-.073,.091],[.5,.54,.427,.591],[0,.26,-.45,.67],[0,1,2,3],[0,4,7,11],[0,3,7,10],[0,7,14,21],[0,12,24,36]],e.operatorAmplitudeMax=15,e.operatorFrequencyNames=["1×","~1×","2×","~2×","3×","4×","5×","6×","7×","8×","9×","10×","11×","13×","16×","20×"],e.midiFrequencyNames=["1x","~1x","2x","~2x","3x","4x","5x","6x","7x","8x","9x","10x","11x","13x","16x","20x"],e.operatorFrequencies=[1,1,2,2,3,4,5,6,7,8,9,10,11,13,16,20],e.operatorHzOffsets=[0,1.5,0,-1.3,0,0,0,0,0,0,0,0,0,0,0,0],e.operatorAmplitudeSigns=[1,-1,1,-1,1,1,1,1,1,1,1,1,1,1,1,1],e.operatorEnvelopeNames=["custom","steady","punch","flare 1","flare 2","flare 3","pluck 1","pluck 2","pluck 3","swell 1","swell 2","swell 3","tremolo1","tremolo2","tremolo3","custom flare","custom tremolo","flute 1","flute 2","flute 3"],e.operatorEnvelopeType=[0,1,2,3,3,3,4,4,4,4,4,4,5,5,5,3,5,6,6,6],e.operatorSpecialCustomVolume=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0,!1,!1,!1],e.operatorEnvelopeSpeed=[0,0,0,32,8,2,32,8,2,32,8,2,4,2,1,8,0,16,8,4],e.operatorEnvelopeInverted=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!1,!1,!1,!1],e.operatorFeedbackNames=["1⟲","2⟲","3⟲","4⟲","1⟲ 2⟲","3⟲ 4⟲","1⟲ 2⟲ 3⟲ ","2⟲ 3⟲ 4⟲ ","1⟲ 2⟲ 3⟲ 4⟲ ","1→2","1→3","1→4","2→3","2→4","3→4","1→3 2→4","1→4 2→3","1→2→3→4","1🗘2","1🗘3","1🗘4","2🗘3","2🗘4","3🗘4"],e.midiFeedbackNames=["1","2","3","4","1 2","3 4","1 2 3","2 3 4","1 2 3 4","1>2","1>3","1>4","2>3","2>4","3>4","1>3 2>4","1>4 2>3","1>2>3>4","1-2","1-3","1-4","2-3","2-4","3-4"],e.operatorFeedbackIndices=[[[1],[],[],[]],[[],[2],[],[]],[[],[],[3],[]],[[],[],[],[4]],[[1],[2],[],[]],[[],[],[3],[4]],[[1],[2],[3],[]],[[],[2],[3],[4]],[[1],[2],[3],[4]],[[],[1],[],[]],[[],[],[1],[]],[[],[],[],[1]],[[],[],[2],[]],[[],[],[],[2]],[[],[],[],[3]],[[],[],[1],[2]],[[],[],[2],[1]],[[],[1],[2],[3]],[[2],[1],[],[]],[[3],[],[1],[]],[[4],[],[],[1]],[[],[3],[2],[]],[[],[4],[],[2]],[[],[],[4],[3]]],e.pitchChannelTypeNames=["chip","FM (expert)","PWM (beta)"],e.pitchChannelTypeValues=[0,1,3],e.drumChannelTypeNames=["noise"],e.instrumentTypeNames=["chip","FM","noise","PWM"],e.themeNames=["Laffey","Nepbox 1.0","Modbox","ModBox 2.0","Artic","Cinnamon Roll [!]","Ocean","Rainbow [!]","Float [!]","Windows","Grassland","Dessert","Kahootiest","Beam to the Bit [!]","Pretty Egg","Poniryoshka","Gameboy [!]","Woodkid","Midnight","Snedbox","unnamed","Piano [!] [↻]","Halloween","FrozenOver❄️"],e.volumeColorPallet=["#f2b3ff","#00fff5","#777777","#c4ffa3","#42dcff","#ba8418","#090b3a","#ff00cb","#878787","#15a0db","#74bc21","#ff0000","#66bf39","#fefe00","#f01d7a","#ffc100","#8bac0f","#ef3027","#aa5599","#a53a3d","#ffffff","#ff0000","#9e2200","#ed2d2d"],e.sliderOneColorPallet=["#f2b3ff","#00fff5","#9900cc","#00ff00","#ffffff","#ba8418","#5982ff","#ff0000","#ffffff","#2779c2","#a0d168","#ff6254","#ff3355","#fefe00","#6b003a","#4b4b4b","#9bbc0f","#e83c4e","#445566","#a53a3d","#ffffff","#ffffff","#9e2200","#38ef17"],e.sliderOctaveColorPallet=["#852929","#484848","#444444","#00ff00","#a5eeff","#e59900","#4449a3","#43ff00","#ffffff","#295294","#74bc21","#ff5e3a","#eb670f","#0001fc","#ffb1f4","#5f4c99","#9bbc0f","#ef3027","#444444","#444444","#ffffff","#211616","#9e2200","#ffffff"],e.sliderOctaveNotchColorPallet=["#f2b3ff","#9150ff","#886644","#ffffff","#cefffd","#ffff25","#3dffdb","#0400ff","#c9c9c9","#fdd01d","#20330a","#fff570","#ff3355","#fa0103","#b4001b","#ff8291","#8bac0f","#ffedca","#aa5599","#a53a3d","#ffffff","#ff4c4c","#701800","#ed2d2d"],e.buttonColorPallet=["#343c99","#484848","#ffffff","#00ff00","#42dcff","#ffff25","#4449a3","#f6ff00","#000000","#fdd01d","#69c400","#fffc5b","#66bf39","#fefe00","#75093e","#818383","#8bac0f","#ffedca","#000000","#ffffff","#ffffff","#ffffff","#9e2200","#38ef17"],e.noteOne=["#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#9e2200"],e.noteTwo=["#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#9e2200"],e.noteThree=["#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#9e2200"],e.noteFour=["#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#9e2200"],e.noteSix=["#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#9e2200"],e.noteSeven=["#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#9e2200"],e.noteEight=["#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#9e2200"],e.noteFive=["#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#9e2200"],e.noteNine=["#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#9e2200"],e.noteTen=["#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#9e2200"],e.noteEleven=["#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#9e2200"],e.noteTwelve=["#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#7a7a7a","#bfbfbf","#7a7a7a","#bfbfbf","#bfbfbf","#9e2200"],e.baseNoteColorPallet=["#dbbeed","#9150ff","#886644","#c4ffa3","#eafffe","#f5bb00","#090b3a","#ffaaaa","#ffffff","#da4e2a","#20330a","#fffc5b","#45a3e5","#fefe00","#fffafa","#1a2844","#9bbc0f","#fff6fe","#222222","#886644","#ffffa0","#ffffff","#681701","#88bce8"],e.secondNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#ffceaa","#ededed","#444444","#444444","#444444","#444444","#111111","#444444","#444444","#9bbc0f","#41323b","#222222","#444444","#ffffa0","#ffffff","#754a3f","#99c8ef"],e.thirdNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#ffdfaa","#cecece","#444444","#444444","#444444","#444444","#111111","#444444","#444444","#9bbc0f","#41323b","#222222","#444444","#ffffa0","#ffffff","#754a3f","#abd3f4"],e.fourthNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#fff5aa","#bababa","#444444","#444444","#444444","#444444","#111111","#444444","#444444","#8bac0f","#41323b","#222222","#444444","#ffffa0","#ffffff","#754a3f","#b8d7f2"],e.sixthNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#e8ffaa","#afafaf","#444444","#444444","#444444","#444444","#fa0103","#444444","#faf4c3","#8bac0f","#41323b","#222222","#10997e","#ffffa0","#ffffff","#754a3f","#cbe0f2"],e.seventhNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#bfffb2","#a5a5a5","#444444","#444444","#444444","#444444","#111111","#444444","#444444","#8bac0f","#41323b","#222222","#444444","#ffffa0","#ffffff","#754a3f","#e5f0f9"],e.eigthNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#b2ffc8","#999999","#444444","#444444","#444444","#444444","#111111","#444444","#444444","#306230","#41323b","#222222","#444444","#ffffa0","#ffffff","#754a3f","#ffffff"],e.fifthNoteColorPallet=["#6b1313","#990000","#446688","#96fffb","#b7f1ff","#f5bb00","#3f669b","#b2ffe4","#8e8e8e","#5d9511","#74bc21","#ff5e3a","#864cbf","#111111","#ff91ce","#dabbe6","#306230","#fff6fe","#444444","#60389b","#ffffa0","#ffffff","#914300","#e5f0f9"],e.ninthNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#b2f3ff","#828282","#444444","#444444","#444444","#444444","#0001fc","#444444","#444444","#306230","#41323b","#222222","#444444","#ffffa0","#ffffff","#754a3f","#cbe0f2"],e.tenNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#b2b3ff","#777777","#444444","#444444","#444444","#444444","#111111","#444444","#444444","#0f380f","#41323b","#222222","#444444","#ffffa0","#ffffff","#754a3f","#b8d7f2"],e.elevenNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#e0b2ff","#565656","#444444","#444444","#444444","#444444","#111111","#444444","#444444","#0f380f","#41323b","#222222","#444444","#ffffa0","#ffffff","#754a3f","#abd3f4"],e.twelveNoteColorPallet=["#1a2182","#0a2d44","#444444","#444444","#444444","#f5bb00","#444444","#ffafe9","#282828","#444444","#444444","#444444","#444444","#111111","#444444","#444444","#0f380f","#41323b","#222222","#444444","#ffffa0","#ffffff","#754a3f","#99c8ef"],e.channelOneBrightColorPallet="#cacaca",e.channelTwoBrightColorPallet="#3de2ff",e.channelThreeBrightColorPallet="#8567ff",e.channelFourBrightColorPallet="#ffb500",e.channelFiveBrightColorPallet="#ff3e3e",e.channelSixBrightColorPallet="#fdff00",e.channelSevenBrightColorPallet="#23ff1b",e.channelEightBrightColorPallet="#0c79ff",e.channelNineBrightColorPallet="#ffffff",e.channelTenBrightColorPallet="#42ffff",e.channelElevenBrightColorPallet="#970000",e.channelTwelveBrightColorPallet="#759bff",e.channelThirteenBrightColorPallet="#f75dff",e.channelFourteenBrightColorPallet="#ff0000",e.channelFifteenBrightColorPallet="#1792ff",e.channelSixteenBrightColorPallet="#ffbb00",e.channelOneDimColorPallet="#828282",e.channelTwoDimColorPallet="#2f8baf",e.channelThreeDimColorPallet="#6f50b1",e.channelFourDimColorPallet="#d38900",e.channelFiveDimColorPallet="#6c0000",e.channelSixDimColorPallet="#d25a00",e.channelSevenDimColorPallet="#046000",e.channelEightDimColorPallet="#3b2bae",e.channelNineDimColorPallet="#3a3ea4",e.channelTenDimColorPallet="#3a8d58",e.channelElevenDimColorPallet="#0001a2",e.channelTwelveDimColorPallet="#a00000",e.channelThirteenDimColorPallet="#b930a2",e.channelFourteenDimColorPallet="#8c2121",e.channelFifteenDimColorPallet="#005cb3",e.channelSixteenDimColorPallet="#9c4100",e.pitchChannelColorsDim=[e.channelOneDimColorPallet,e.channelTwoDimColorPallet,e.channelThreeDimColorPallet,e.channelFourDimColorPallet,e.channelFiveDimColorPallet,e.channelSixDimColorPallet,e.channelSevenDimColorPallet,e.channelEightDimColorPallet,e.channelNineDimColorPallet,e.channelTenDimColorPallet,e.channelElevenDimColorPallet,e.channelTwelveDimColorPallet],e.pitchChannelColorsBright=[e.channelOneBrightColorPallet,e.channelTwoBrightColorPallet,e.channelThreeBrightColorPallet,e.channelFourBrightColorPallet,e.channelFiveBrightColorPallet,e.channelSixBrightColorPallet,e.channelSevenBrightColorPallet,e.channelEightBrightColorPallet,e.channelNineBrightColorPallet,e.channelTenBrightColorPallet,e.channelElevenBrightColorPallet,e.channelTwelveBrightColorPallet],e.pitchNoteColorsDim=[e.channelOneDimColorPallet,e.channelTwoDimColorPallet,e.channelThreeDimColorPallet,e.channelFourDimColorPallet,e.channelFiveDimColorPallet,e.channelSixDimColorPallet,e.channelSevenDimColorPallet,e.channelEightDimColorPallet,e.channelNineDimColorPallet,e.channelTenDimColorPallet,e.channelElevenDimColorPallet,e.channelTwelveDimColorPallet],e.pitchNoteColorsBright=[e.channelOneBrightColorPallet,e.channelTwoBrightColorPallet,e.channelThreeBrightColorPallet,e.channelFourBrightColorPallet,e.channelFiveBrightColorPallet,e.channelSixBrightColorPallet,e.channelSevenBrightColorPallet,e.channelEightBrightColorPallet,e.channelNineBrightColorPallet,e.channelTenBrightColorPallet,e.channelElevenBrightColorPallet,e.channelTwelveBrightColorPallet],e.drumChannelColorsDim=[e.channelThirteenDimColorPallet,e.channelFourteenDimColorPallet,e.channelFifteenDimColorPallet,e.channelSixteenDimColorPallet],e.drumChannelColorsBright=[e.channelThirteenBrightColorPallet,e.channelFourteenBrightColorPallet,e.channelFifteenBrightColorPallet,e.channelSixteenBrightColorPallet],e.drumNoteColorsDim=[e.channelThirteenDimColorPallet,e.channelFourteenDimColorPallet,e.channelFifteenDimColorPallet,e.channelSixteenDimColorPallet],e.drumNoteColorsBright=[e.channelThirteenBrightColorPallet,e.channelFourteenBrightColorPallet,e.channelFifteenBrightColorPallet,e.channelSixteenBrightColorPallet],e.midiPitchChannelNames=["cyan channel","yellow channel","orange channel","green channel","purple channel","blue channel"],e.midiDrumChannelNames=["gray channel","brown channel","indigo channel"],e.midiSustainInstruments=[71,80,70,68,81,81,81,81,74],e.midiDecayInstruments=[46,46,6,24,25,25,106,106,33],e.drumInterval=6,e.drumCount=12,e.pitchCount=37,e.maxPitch=84,e.pitchChannelCountMin=0,e.pitchChannelCountMax=12,e.drumChannelCountMin=0,e.drumChannelCountMax=4,e.waves=[e.c([1/15,.2,5/15,7/15,.6,11/15,13/15,1,1,13/15,11/15,.6,7/15,5/15,.2,1/15,-1/15,-.2,-5/15,-7/15,-.6,-11/15,-13/15,-1,-1,-13/15,-11/15,-.6,-7/15,-5/15,-.2,-1/15]),e.c([1,-1]),e.c([1,-1,-1,-1]),e.c([1,-1,-1,-1,-1,-1,-1,-1]),e.c([1/31,3/31,5/31,7/31,9/31,11/31,13/31,15/31,17/31,19/31,21/31,23/31,25/31,27/31,29/31,1,-1,-29/31,-27/31,-25/31,-23/31,-21/31,-19/31,-17/31,-15/31,-13/31,-11/31,-9/31,-7/31,-5/31,-3/31,-1/31]),e.c([0,-.2,-.4,-.6,-.8,-1,1,-.8,-.6,-.4,-.2,1,.8,.6,.4,.2]),e.c([1,1,1,1,1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1]),e.c([1,-1,1,-1,1,0]),e.c([0,.2,.4,.5,.6,.7,.8,.85,.9,.95,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,.95,.9,.85,.8,.7,.6,.5,.4,.2,0,-.2,-.4,-.5,-.6,-.7,-.8,-.85,-.9,-.95,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-.95,-.9,-.85,-.8,-.7,-.6,-.5,-.4,-.2]),e.c([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1]),e.c([1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([0,.1875,.3125,.5625,.5,.75,.875,1,1,.6875,.5,.625,.625,.5,.375,.5625,.4375,.5625,.4375,.4375,.3125,.1875,.1875,.375,.5625,.5625,.5625,.5625,.5625,.4375,.25,0]),e.c([1,.7,.1,.1,0,0,0,0,0,.1,.2,.15,.25,.125,.215,.345,4]),e.c([1/15,.2,5/15,9,.06]),e.c([-.5,3.5,3,-.5,-.25,-1]),e.c([0,.05,.125,.2,.25,.3,.425,.475,.525,.625,.675,.725,.775,.8,.825,.875,.9,.925,.95,.975,.98,.99,.995,1,.995,.99,.98,.975,.95,.925,.9,.875,.825,.8,.775,.725,.675,.625,.525,.475,.425,.3,.25,.2,.125,.05,0,-.05,-.125,-.2,-.25,-.3,-.425,-.475,-.525,-.625,-.675,-.725,-.775,-.8,-.825,-.875,-.9,-.925,-.95,-.975,-.98,-.99,-.995,-1,-.995,-.99,-.98,-.975,-.95,-.925,-.9,-.875,-.825,-.8,-.775,-.725,-.675,-.625,-.525,-.475,-.425,-.3,-.25,-.2,-.125,-.05]),e.c([1,1,1,1,0,1,0,1,1,0,0,1,0,0,0]),e.c([0,0,1,1,1,1,1,1,1,1,1,1,1,1,1]),e.c([1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,.5,1/3,.25]),e.c([-.9,-1,-.85,-.775,-.7,-.6,-.5,-.4,-.325,-.225,-.2,-.125,-.1,-.11,-.125,-.15,-.175,-.18,-.2,-.21,-.22,-.21,-.2,-.175,-.15,-.1,-.5,.75,.11,.175,.2,.25,.26,.275,.26,.25,.225,.2,.19,.18,.19,.2,.21,.22,.23,.24,.25,.26,.275,.28,.29,.3,.29,.28,.27,.26,.25,.225,.2,.175,.15,.1,.075,0,-.01,-.025,.025,.075,.2,.3,.475,.6,.75,.85,.85,1,.99,.95,.8,.675,.475,.275,.01,-.15,-.3,-.475,-.5,-.6,-.71,-.81,-.9,-1,-.9]),e.c([-1,-.95,-.975,-.9,-.85,-.8,-.775,-.65,-.6,-.5,-.475,-.35,-.275,-.2,-.125,-.05,0,.075,.125,.15,.2,.21,.225,.25,.225,.21,.2,.19,.175,.125,.1,.075,.06,.05,.04,.025,.04,.05,.1,.15,.225,.325,.425,.575,.7,.85,.95,1,.9,.675,.375,.2,.275,.4,.5,.55,.6,.625,.65,.65,.65,.65,.64,.6,.55,.5,.4,.325,.25,.15,.05,-.05,-.15,-.275,-.35,-.45,-.55,-.65,-.7,-.78,-.825,-.9,-.925,-.95,-.975]),e.c([1,0,.1,-.1,-.2,-.4,-.3,-1]),e.c([1,-1,4,2.15,4.13,5.15,0,-.05,1]),e.c([6.1,-2.9,1.4,-2.9]),e.c([1,4,2,1,-.1,-1,-.12]),e.c([.2,1,2.6,1,0,-2.4]),e.c([1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0,.1,.2,.3,.4,.5,.6,.7,.8,.9]),e.c([1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0]),e.c([1,-.9,.8,-.7,.6,-.5,.4,-.3,.2,-.1,0,-.1,.2,-.3,.4,-.5,.6,-.7,.8,-.9,1]),e.c([1,-1,17/31,19/31,21/31,23/31,25/31,27/31,29/31,1,-1,-29/31,-27/31,-25/31,-23/31,-21/31,-19/31,-17/31,-15/31,-13/31,-11/31,-9/31,-7/31,-5/31,-3/31,-1/31]),e.c([1,1,12,1,1,8,1,7,1,6,1,4,4,1,4,6]),e.c([1,3,5,7,9,11,13,15,15,13,11,9,7,5,3,1,-1,-3,-5,-7,-9,-11,-13,-15,-15,-13,-11,-9,-7,-5,-3,-1]),e.c([22,22,16,6,0,-3,-8,-10,-13,-16,-19,-19,-20,-22,-22,-24,-24,-24,-24,-24,-24,-24,-24,-24,-24,-24,-24,-24,-24,-24,-24,24,24,16,9,6,4,2,0,-1,-3,-4,-4,-6,-6,-6,-6,-5,-5,-4,-2,-2,1,4,6,8,10,12,14,16,18,19,22,24])],e.wavesMixC=[e.c([1/15,.2,5/15,7/15,.6,11/15,13/15,1,1,13/15,11/15,.6,7/15,5/15,.2,1/15,-1/15,-.2,-5/15,-7/15,-.6,-11/15,-13/15,-1,-1,-13/15,-11/15,-.6,-7/15,-5/15,-.2,-1/15]),e.c([1,-1]),e.c([1,-1,-1,-1]),e.c([1,-1,-1,-1,-1,-1,-1,-1]),e.c([1/31,3/31,5/31,7/31,9/31,11/31,13/31,15/31,17/31,19/31,21/31,23/31,25/31,27/31,29/31,1,-1,-29/31,-27/31,-25/31,-23/31,-21/31,-19/31,-17/31,-15/31,-13/31,-11/31,-9/31,-7/31,-5/31,-3/31,-1/31]),e.c([0,-.2,-.4,-.6,-.8,-1,1,-.8,-.6,-.4,-.2,1,.8,.6,.4,.2]),e.c([1,1,1,1,1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1]),e.c([1,-1,1,-1,1,0]),e.c([0,.2,.4,.5,.6,.7,.8,.85,.9,.95,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,.95,.9,.85,.8,.7,.6,.5,.4,.2,0,-.2,-.4,-.5,-.6,-.7,-.8,-.85,-.9,-.95,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-.95,-.9,-.85,-.8,-.7,-.6,-.5,-.4,-.2]),e.c([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1]),e.c([1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([0,.1875,.3125,.5625,.5,.75,.875,1,1,.6875,.5,.625,.625,.5,.375,.5625,.4375,.5625,.4375,.4375,.3125,.1875,.1875,.375,.5625,.5625,.5625,.5625,.5625,.4375,.25,0]),e.c([1,.7,.1,.1,0,0,0,0,0,.1,.2,.15,.25,.125,.215,.345,4]),e.c([1/15,.2,5/15,9,.06]),e.c([-.5,3.5,3,-.5,-.25,-1]),e.c([0,.05,.125,.2,.25,.3,.425,.475,.525,.625,.675,.725,.775,.8,.825,.875,.9,.925,.95,.975,.98,.99,.995,1,.995,.99,.98,.975,.95,.925,.9,.875,.825,.8,.775,.725,.675,.625,.525,.475,.425,.3,.25,.2,.125,.05,0,-.05,-.125,-.2,-.25,-.3,-.425,-.475,-.525,-.625,-.675,-.725,-.775,-.8,-.825,-.875,-.9,-.925,-.95,-.975,-.98,-.99,-.995,-1,-.995,-.99,-.98,-.975,-.95,-.925,-.9,-.875,-.825,-.8,-.775,-.725,-.675,-.625,-.525,-.475,-.425,-.3,-.25,-.2,-.125,-.05]),e.c([1,1,1,1,0,1,0,1,1,0,0,1,0,0,0]),e.c([0,0,1,1,1,1,1,1,1,1,1,1,1,1,1]),e.c([1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,.5,1/3,.25]),e.c([-.9,-1,-.85,-.775,-.7,-.6,-.5,-.4,-.325,-.225,-.2,-.125,-.1,-.11,-.125,-.15,-.175,-.18,-.2,-.21,-.22,-.21,-.2,-.175,-.15,-.1,-.5,.75,.11,.175,.2,.25,.26,.275,.26,.25,.225,.2,.19,.18,.19,.2,.21,.22,.23,.24,.25,.26,.275,.28,.29,.3,.29,.28,.27,.26,.25,.225,.2,.175,.15,.1,.075,0,-.01,-.025,.025,.075,.2,.3,.475,.6,.75,.85,.85,1,.99,.95,.8,.675,.475,.275,.01,-.15,-.3,-.475,-.5,-.6,-.71,-.81,-.9,-1,-.9]),e.c([-1,-.95,-.975,-.9,-.85,-.8,-.775,-.65,-.6,-.5,-.475,-.35,-.275,-.2,-.125,-.05,0,.075,.125,.15,.2,.21,.225,.25,.225,.21,.2,.19,.175,.125,.1,.075,.06,.05,.04,.025,.04,.05,.1,.15,.225,.325,.425,.575,.7,.85,.95,1,.9,.675,.375,.2,.275,.4,.5,.55,.6,.625,.65,.65,.65,.65,.64,.6,.55,.5,.4,.325,.25,.15,.05,-.05,-.15,-.275,-.35,-.45,-.55,-.65,-.7,-.78,-.825,-.9,-.925,-.95,-.975]),e.c([.7,0,.1,-.1,-.2,-.4,-.3,-.7]),e.c([1,-1,4,2.15,4.1,5.05,0,-.05,1]),e.c([4.5,-1.7,1,-1.7]),e.c([.1,.4,.2,.1,-.1,-1,-.12]),e.c([.03,.13,.3,1,0,-.26]),e.c([2,1.75,1.5,1.25,1,.75,.5,.25,0,.25,.5,.75,1,1.25,1.5,1.75]),e.c([1,1.9,1.8,1.7,1.6,1.5,1.4,1.3,1.2,1.1,1]),e.c([-1,-.9,.8,-.7,.6,-.5,.4,-.3,.2,-.1,0,-.1,.2,-.3,.4,-.5,.6,-.7,.8,-.9,-1])],e.pwmwaves=[e.c([1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,1,1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,1,1,1,-1,-1,-1,-1,-1,-1]),e.c([1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e.c([1,1,1,1,1,-1,-1,-1,-1,-1])],e.sineWaveLength=256,e.sineWaveMask=e.sineWaveLength-1,e.sineWave=e.generateSineWave(),e}();t.Config=a;var i=function(){function t(t,e,n,a){this.f=[],this.g=0;for(var i=n;i<a;i++){var s=t[e.charCodeAt(i)];this.f.push(s>>5&1),this.f.push(s>>4&1),this.f.push(s>>3&1),this.f.push(s>>2&1),this.f.push(s>>1&1),this.f.push(1&s)}}return t.prototype.read=function(t){for(var e=0;t>0;)e<<=1,e+=this.f[this.g++],t--;return e},t.prototype.readLongTail=function(t,e){for(var n=t,a=e;this.f[this.g++];)n+=1<<a,a++;for(;a>0;)a--,this.f[this.g++]&&(n+=1<<a);return n},t.prototype.readPartDuration=function(){return this.readLongTail(1,2)},t.prototype.readPinCount=function(){return this.readLongTail(1,0)},t.prototype.readPitchInterval=function(){return this.read(1)?-this.readLongTail(1,3):this.readLongTail(1,3)},t}(),s=function(){function t(){this.f=[]}return t.prototype.write=function(t,e){for(t--;t>=0;)this.f.push(e>>>t&1),t--},t.prototype.writeLongTail=function(t,e,n){if(n<t)throw new Error("value out of bounds");n-=t;for(var a=e;n>=1<<a;)this.f.push(1),n-=1<<a,a++;for(this.f.push(0);a>0;)a--,this.f.push(n>>>a&1)},t.prototype.writePartDuration=function(t){this.writeLongTail(1,2,t)},t.prototype.writePinCount=function(t){this.writeLongTail(1,0,t)},t.prototype.writePitchInterval=function(t){t<0?(this.write(1,1),this.writeLongTail(1,3,-t)):(this.write(1,0),this.writeLongTail(1,3,t))},t.prototype.concat=function(t){this.f=this.f.concat(t.f)},t.prototype.encodeBase64=function(t,e){for(var n=0;n<this.f.length;n+=6){var a=this.f[n]<<5|this.f[n+1]<<4|this.f[n+2]<<3|this.f[n+3]<<2|this.f[n+4]<<1|this.f[n+5];e.push(t[a])}return e},t.prototype.lengthBase64=function(){return Math.ceil(this.f.length/6)},t}();t.makeNotePin=e,t.makeNote=n;var r=function(){function t(){this.notes=[],this.instrument=0}return t.prototype.cloneNotes=function(){for(var t=[],a=0,i=this.notes;a<i.length;a++){var s=i[a],r=n(-1,s.start,s.end,3);r.pitches=s.pitches.concat(),r.pins=[];for(var o=0,h=s.pins;o<h.length;o++){var l=h[o];r.pins.push(e(l.interval,l.time,l.volume))}t.push(r)}return t},t.prototype.reset=function(){this.notes.length=0,this.instrument=0},t}()
;t.Pattern=r;var o=function(){function t(t){this.frequency=0,this.amplitude=0,this.envelope=0,this.reset(t)}return t.prototype.reset=function(t){this.frequency=0,this.amplitude=t<=1?a.operatorAmplitudeMax:0,this.envelope=1},t.prototype.copy=function(t){this.frequency=t.frequency,this.amplitude=t.amplitude,this.envelope=t.envelope},t}();t.Operator=o;var h=function(){function t(){this.type=0,this.wave=1,this.filter=1,this.transition=1,this.effect=0,this.harm=0,this.fmChorus=1,this.imute=0,this.octoff=0,this.chorus=0,this.volume=0,this.ipan=4,this.algorithm=0,this.feedbackType=0,this.feedbackAmplitude=0,this.feedbackEnvelope=1,this.operators=[];for(var t=0;t<a.operatorCount;t++)this.operators.push(new o(t))}return t.prototype.reset=function(){this.type=0,this.wave=1,this.filter=1,this.transition=1,this.effect=0,this.harm=0,this.fmChorus=1,this.imute=0,this.ipan=4,this.octoff=0,this.chorus=0,this.volume=0,this.algorithm=0,this.feedbackType=0,this.feedbackAmplitude=0,this.feedbackEnvelope=1;for(var t=0;t<this.operators.length;t++)this.operators[t].reset(t)},t.prototype.setTypeAndReset=function(t){switch(this.type=t,t){case 0:this.wave=1,this.filter=1,this.transition=1,this.effect=0,this.harm=0,this.imute=0,this.ipan=4,this.octoff=0,this.chorus=0,this.volume=0;break;case 1:this.wave=1,this.transition=1,this.volume=0,this.imute=0,this.ipan=4,this.harm=0,this.octoff=0;break;case 2:this.transition=1,this.octoff=0,this.fmChorus=1,this.ipan=4,this.effect=0,this.algorithm=0,this.feedbackType=0,this.feedbackAmplitude=0,this.feedbackEnvelope=1,this.volume=0;for(var e=0;e<this.operators.length;e++)this.operators[e].reset(e);break;case 3:this.wave=1,this.filter=1,this.transition=1,this.effect=0,this.harm=0,this.imute=0,this.ipan=4,this.octoff=0,this.chorus=0,this.volume=0}},t.prototype.copy=function(t){this.type=t.type,this.wave=t.wave,this.filter=t.filter,this.transition=t.transition,this.effect=t.effect,this.chorus=t.chorus,this.volume=t.volume,this.harm=t.harm,this.fmChorus=t.fmChorus,this.imute=t.imute,this.ipan=t.ipan,this.octoff=t.octoff,this.algorithm=t.algorithm,this.feedbackType=t.feedbackType,this.feedbackAmplitude=t.feedbackAmplitude,this.feedbackEnvelope=t.feedbackEnvelope;for(var e=0;e<this.operators.length;e++)this.operators[e].copy(t.operators[e])},t}();t.Instrument=h;var l=function(){function t(){this.octave=0,this.instruments=[],this.patterns=[],this.bars=[]}return t}();t.Channel=l;var c=function(){function t(t){this.channels=[],this.h=[],void 0!=t?this.fromBase64String(t):this.initToDefault(!0)}return t.prototype.getChannelCount=function(){return this.pitchChannelCount+this.drumChannelCount},t.prototype.getChannelUnusedCount=function(){return a.pitchChannelCountMax+a.drumChannelCountMax-(this.pitchChannelCount+this.drumChannelCount)},t.prototype.getThemeName=function(){return a.themeNames[this.theme]},t.prototype.getTimeSig=function(){return this.beatsPerBar+"/"+this.partsPerBeat+" with "+this.barCount+" bars."},t.prototype.getScaleNKey=function(){return' "'+a.scaleNames[this.scale]+'" and your key is '+a.keyNames[this.key]},t.prototype.getChannelIsDrum=function(t){return t>=this.pitchChannelCount},t.prototype.getChannelColorDim=function(t){return t<this.pitchChannelCount?a.pitchChannelColorsDim[t]:a.drumChannelColorsDim[t-this.pitchChannelCount]},t.prototype.getChannelColorBright=function(t){return t<this.pitchChannelCount?a.pitchChannelColorsBright[t]:a.drumChannelColorsBright[t-this.pitchChannelCount]},t.prototype.getNoteColorDim=function(t){return t<this.pitchChannelCount?a.pitchNoteColorsDim[t]:a.drumNoteColorsDim[t-this.pitchChannelCount]},t.prototype.getNoteColorBright=function(t){return t<this.pitchChannelCount?a.pitchNoteColorsBright[t]:a.drumNoteColorsBright[t-this.pitchChannelCount]},t.prototype.initToDefault=function(t){if(void 0===t&&(t=!0),this.scale=0,this.theme=0,this.key=a.keyNames.length-2,this.mix=1,this.sampleRate=2,this.loopStart=0,this.loopLength=4,this.tempo=7,this.reverb=0,this.blend=0,this.riff=0,this.detune=0,this.muff=0,this.beatsPerBar=8,this.barCount=16,this.patternsPerChannel=8,this.partsPerBeat=4,this.instrumentsPerChannel=1,t){this.pitchChannelCount=4,this.drumChannelCount=1;for(var e=0;e<this.getChannelCount();e++){this.channels.length<=e&&(this.channels[e]=new l);var n=this.channels[e];n.octave=4-e;for(var i=0;i<this.patternsPerChannel;i++)n.patterns.length<=i?n.patterns[i]=new r:n.patterns[i].reset();n.patterns.length=this.patternsPerChannel;for(var s=0;s<this.instrumentsPerChannel;s++)n.instruments.length<=s?n.instruments[s]=new h:n.instruments[s].reset();n.instruments.length=this.instrumentsPerChannel;for(var o=0;o<this.barCount;o++)n.bars[o]=1;n.bars.length=this.barCount}this.channels.length=this.getChannelCount()}},t.prototype.toBase64String=function(){var e,n=[],i=t.i;n.push(i[t.j]),n.push(110,i[this.pitchChannelCount],i[this.drumChannelCount]),n.push(122,i[this.theme]),n.push(115,i[this.scale]),n.push(117,i[this.mix]),n.push(124,i[this.sampleRate]),n.push(107,i[this.key]),n.push(108,i[this.loopStart>>6],i[63&this.loopStart]),n.push(101,i[this.loopLength-1>>6],i[this.loopLength-1&63]),n.push(116,i[this.tempo]),n.push(109,i[this.reverb]),n.push(120,i[this.blend]),n.push(121,i[this.riff]),n.push(72,i[this.detune]),n.push(36,i[this.muff]),n.push(97,i[this.beatsPerBar-1]),n.push(103,i[this.barCount-1>>6],i[this.barCount-1&63]),n.push(106,i[this.patternsPerChannel-1]),n.push(105,i[this.instrumentsPerChannel-1]),n.push(114,i[a.partCounts.indexOf(this.partsPerBeat)]),n.push(111);for(var r=0;r<this.getChannelCount();r++)n.push(i[this.channels[r].octave]);for(var r=0;r<this.getChannelCount();r++)for(var o=0;o<this.instrumentsPerChannel;o++){var h=this.channels[r].instruments[o];if(r<this.pitchChannelCount)if(n.push(84,i[h.type]),0==h.type)n.push(119,i[h.wave]),n.push(102,i[h.filter]),n.push(100,i[h.transition]),n.push(99,i[h.effect]),n.push(113,i[h.harm]),n.push(71,i[h.imute]),n.push(76,i[h.ipan]),n.push(66,i[h.octoff]),n.push(104,i[h.chorus]),n.push(118,i[h.volume]);else if(1==h.type){n.push(100,i[h.transition]),n.push(99,i[h.effect]),n.push(66,i[h.octoff]),n.push(35,i[h.fmChorus]),n.push(71,i[h.imute]),n.push(76,i[h.ipan]),n.push(65,i[h.algorithm]),n.push(70,i[h.feedbackType]),n.push(95,i[h.feedbackAmplitude]),n.push(86,i[h.feedbackEnvelope]),n.push(118,i[h.volume]),n.push(81);for(var l=0;l<a.operatorCount;l++)n.push(i[h.operators[l].frequency]);n.push(80);for(var l=0;l<a.operatorCount;l++)n.push(i[h.operators[l].amplitude]);n.push(69);for(var l=0;l<a.operatorCount;l++)n.push(i[h.operators[l].envelope])}else{if(3!=h.type)throw new Error("Unknown instrument type.");n.push(119,i[h.wave]),n.push(102,i[h.filter]),n.push(100,i[h.transition]),n.push(99,i[h.effect]),n.push(113,i[h.harm]),n.push(71,i[h.imute]),n.push(76,i[h.ipan]),n.push(66,i[h.octoff]),n.push(104,i[h.chorus]),n.push(118,i[h.volume])}else n.push(84,i[2]),n.push(119,i[h.wave]),n.push(100,i[h.transition]),n.push(118,i[h.volume]),n.push(71,i[h.imute]),n.push(113,i[h.harm]),n.push(66,i[h.octoff]),n.push(76,i[h.ipan])}n.push(98),e=new s;for(var c=0;1<<c<this.patternsPerChannel+1;)c++;for(var r=0;r<this.getChannelCount();r++)for(var o=0;o<this.barCount;o++)e.write(c,this.channels[r].bars[o]);e.encodeBase64(i,n),n.push(112),e=new s;for(var f=0;1<<f<this.instrumentsPerChannel;)f++;for(var r=0;r<this.getChannelCount();r++){for(var u=this.getChannelIsDrum(r),p=u?0:12*this.channels[r].octave,d=(u?4:12)+p,m=u?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],g=[],o=0;o<m.length;o++)m[o]+=p;for(var b=0,v=this.channels[r].patterns;b<v.length;b++){var C=v[b];if(e.write(f,C.instrument),C.notes.length>0){e.write(1,1);for(var y=0,R=0,w=C.notes;R<w.length;R++){var x=w[R];x.start>y&&(e.write(2,0),e.writePartDuration(x.start-y));for(var P=new s,o=1;o<x.pitches.length;o++)P.write(1,1);x.pitches.length<4&&P.write(1,0),P.writePinCount(x.pins.length-1),P.write(2,x.pins[0].volume);for(var N=0,L=x.pitches[0],k=L,A=[],o=1;o<x.pins.length;o++){var M=x.pins[o],E=L+M.interval;k!=E?(P.write(1,1),A.push(E),k=E):P.write(1,0),P.writePartDuration(M.time-N),N=M.time,P.write(2,M.volume)}var S=String.fromCharCode.apply(null,P.encodeBase64(i,[])),B=g.indexOf(S);-1==B?(e.write(2,1),e.concat(P)):(e.write(1,1),e.writeLongTail(0,0,B),g.splice(B,1)),g.unshift(S),g.length>10&&g.pop();for(var I=x.pitches.concat(A),o=0;o<I.length;o++){var F=I[o],D=m.indexOf(F);if(-1==D){var T=0,O=d;if(O<F)for(;O!=F;)O++,-1==m.indexOf(O)&&T++;else for(;O!=F;)O--,-1==m.indexOf(O)&&T--;e.write(1,0),e.writePitchInterval(T)}else e.write(1,1),e.write(3,D),m.splice(D,1);m.unshift(F),m.length>8&&m.pop(),d=o==x.pitches.length-1?x.pitches[0]:F}y=x.end}y<this.beatsPerBar*this.partsPerBeat&&(e.write(2,0),e.writePartDuration(this.beatsPerBar*this.partsPerBeat-y))}else e.write(1,0)}}for(var V=e.lengthBase64(),H=[];V>0;)H.unshift(i[63&V]),V>>=6;if(n.push(i[H.length]),Array.prototype.push.apply(n,H),e.encodeBase64(i,n),n.length>=65535)throw new Error("Song hash code too long.");return String.fromCharCode.apply(null,n)},t.prototype.fromBase64String=function(s){if(null==s||""==s)return void this.initToDefault(!0);for(var o=0;s.charCodeAt(o)<=32;)o++;if(35==s.charCodeAt(o)&&o++,123==s.charCodeAt(o))return void this.fromJsonObject(JSON.parse(0==o?s:s.substring(o)));var c=t.k[s.charCodeAt(o++)];if(!(-1==c||c>t.j||c<t.l)){var f=c<3,u=c<4,p=c<5,d=c<6,m=t.k;if(this.initToDefault(d),f){for(var g=0,b=this.channels;g<b.length;g++){var v=b[g];v.instruments[0].transition=0}this.channels[3].instruments[0].wave=0}for(var C=0,y=-1;o<s.length;){var R=s.charCodeAt(o++),v=void 0;if(110==R){this.pitchChannelCount=m[s.charCodeAt(o++)],this.drumChannelCount=m[s.charCodeAt(o++)],this.pitchChannelCount=t.m(a.pitchChannelCountMin,a.pitchChannelCountMax+1,this.pitchChannelCount),this.drumChannelCount=t.m(a.drumChannelCountMin,a.drumChannelCountMax+1,this.drumChannelCount);for(var w=this.channels.length;w<this.getChannelCount();w++)this.channels[w]=new l;this.channels.length=this.getChannelCount()}else if(115==R)this.scale=m[s.charCodeAt(o++)],f&&10==this.scale&&(this.scale=11);else if(117==R)this.mix=m[s.charCodeAt(o++)];else if(107==R)this.key=m[s.charCodeAt(o++)];else if(122==R)this.theme=m[s.charCodeAt(o++)];else if(108==R)this.loopStart=p?m[s.charCodeAt(o++)]:(m[s.charCodeAt(o++)]<<6)+m[s.charCodeAt(o++)];else if(101==R)this.loopLength=p?m[s.charCodeAt(o++)]:(m[s.charCodeAt(o++)]<<6)+m[s.charCodeAt(o++)]+1;else if(116==R)this.tempo=u?[1,4,7,10][m[s.charCodeAt(o++)]]:m[s.charCodeAt(o++)],this.tempo=t.m(0,a.tempoSteps,this.tempo);else if(109==R)this.reverb=m[s.charCodeAt(o++)],this.reverb=t.m(0,a.reverbRange,this.reverb);else if(120==R)this.blend=t.m(0,a.blendRange,m[s.charCodeAt(o++)]);else if(121==R)this.riff=t.m(0,a.riffRange,m[s.charCodeAt(o++)]);else if(124==R)this.sampleRate=m[s.charCodeAt(o++)];else if(72==R)this.detune=t.m(0,a.detuneRange,m[s.charCodeAt(o++)]);else if(36==R)this.muff=t.m(0,a.muffRange,m[s.charCodeAt(o++)]);else if(97==R)this.beatsPerBar=f?[6,7,8,9,10][m[s.charCodeAt(o++)]]:m[s.charCodeAt(o++)]+1,this.beatsPerBar=Math.max(a.beatsPerBarMin,Math.min(a.beatsPerBarMax,this.beatsPerBar));else if(103==R){this.barCount=(m[s.charCodeAt(o++)]<<6)+m[s.charCodeAt(o++)]+1,this.barCount=Math.max(a.barCountMin,Math.min(a.barCountMax,this.barCount));for(var x=0;x<this.getChannelCount();x++){for(var P=this.channels[x].bars.length;P<this.barCount;P++)this.channels[x].bars[P]=0;this.channels[x].bars.length=this.barCount}}else if(106==R){this.patternsPerChannel=m[s.charCodeAt(o++)]+1,this.patternsPerChannel=Math.max(a.patternsPerChannelMin,Math.min(a.patternsPerChannelMax,this.patternsPerChannel));for(var N=0;N<this.getChannelCount();N++){for(var L=this.channels[N].patterns.length;L<this.patternsPerChannel;L++)this.channels[N].patterns[L]=new r;this.channels[N].patterns.length=this.patternsPerChannel}}else if(105==R){this.instrumentsPerChannel=m[s.charCodeAt(o++)]+1,this.instrumentsPerChannel=Math.max(a.instrumentsPerChannelMin,Math.min(a.instrumentsPerChannelMax,this.instrumentsPerChannel));for(var k=0;k<this.getChannelCount();k++){for(var A=this.channels[k].instruments.length;A<this.instrumentsPerChannel;A++)this.channels[k].instruments[A]=new h;this.channels[k].instruments.length=this.instrumentsPerChannel}}else if(114==R)this.partsPerBeat=a.partCounts[m[s.charCodeAt(o++)]];else if(111==R)if(f)v=m[s.charCodeAt(o++)],this.channels[v].octave=t.m(0,5,m[s.charCodeAt(o++)]);else for(v=0;v<this.getChannelCount();v++)this.channels[v].octave=t.m(0,5,m[s.charCodeAt(o++)]);else if(84==R){y++,y>=this.instrumentsPerChannel&&(C++,y=0);var M=C<this.pitchChannelCount,A=this.channels[C].instruments[y],E=t.m(0,4,m[s.charCodeAt(o++)]),S=E;2==S&&M&&(S=3),A.setTypeAndReset(S)}else if(119==R)if(f)v=m[s.charCodeAt(o++)],this.channels[v].instruments[0].wave=t.m(0,a.waveNames.length,m[s.charCodeAt(o++)]);else if(d)for(v=0;v<this.getChannelCount();v++)for(var B=v>=this.pitchChannelCount,I=0;I<this.instrumentsPerChannel;I++)this.channels[v].instruments[I].wave=t.m(0,B?a.drumNames.length:a.waveNames.length,m[s.charCodeAt(o++)]);else{var B=C>=this.pitchChannelCount;this.channels[C].instruments[y].wave=t.m(0,B?a.drumNames.length:a.waveNames.length,m[s.charCodeAt(o++)])}else if(102==R)if(f)v=m[s.charCodeAt(o++)],this.channels[v].instruments[0].filter=[1,3,4,5][t.m(0,a.filterNames.length,m[s.charCodeAt(o++)])];else if(d)for(v=0;v<this.getChannelCount();v++)for(var I=0;I<this.instrumentsPerChannel;I++)this.channels[v].instruments[I].filter=t.m(0,a.filterNames.length,m[s.charCodeAt(o++)]+1);else this.channels[C].instruments[y].filter=t.m(0,a.filterNames.length,m[s.charCodeAt(o++)]);else if(100==R)if(f)v=m[s.charCodeAt(o++)],this.channels[v].instruments[0].transition=t.m(0,a.transitionNames.length,m[s.charCodeAt(o++)]);else if(d)for(v=0;v<this.getChannelCount();v++)for(var I=0;I<this.instrumentsPerChannel;I++)this.channels[v].instruments[I].transition=t.m(0,a.transitionNames.length,m[s.charCodeAt(o++)]);else this.channels[C].instruments[y].transition=t.m(0,a.transitionNames.length,m[s.charCodeAt(o++)]);else if(99==R)if(f){v=m[s.charCodeAt(o++)];var F=t.m(0,a.effectNames.length,m[s.charCodeAt(o++)]);1==F?F=3:3==F&&(F=5),this.channels[v].instruments[0].effect=F}else if(d)for(v=0;v<this.getChannelCount();v++)for(var I=0;I<this.instrumentsPerChannel;I++)this.channels[v].instruments[I].effect=t.m(0,a.effectNames.length,m[s.charCodeAt(o++)]);else this.channels[C].instruments[y].effect=t.m(0,a.effectNames.length,m[s.charCodeAt(o++)]);else if(104==R)if(f)v=m[s.charCodeAt(o++)],this.channels[v].instruments[0].chorus=t.m(0,a.chorusNames.length,m[s.charCodeAt(o++)]);else if(d)for(v=0;v<this.getChannelCount();v++)for(var I=0;I<this.instrumentsPerChannel;I++)this.channels[v].instruments[I].chorus=t.m(0,a.chorusNames.length,m[s.charCodeAt(o++)]);else this.channels[C].instruments[y].chorus=t.m(0,a.chorusNames.length,m[s.charCodeAt(o++)]);else if(113==R)if(d)for(v=0;v<this.getChannelCount();v++)for(var I=0;I<this.instrumentsPerChannel;I++)this.channels[v].instruments[I].harm=t.m(0,a.harmNames.length,m[s.charCodeAt(o++)]);else this.channels[C].instruments[y].harm=t.m(0,a.harmNames.length,m[s.charCodeAt(o++)]);else if(35==R)this.channels[C].instruments[y].fmChorus=t.m(0,a.fmChorusNames.length,m[s.charCodeAt(o++)]);else if(71==R)this.channels[C].instruments[y].imute=t.m(0,a.imuteNames.length,m[s.charCodeAt(o++)]);else if(76==R)this.channels[C].instruments[y].ipan=t.m(0,a.ipanValues.length,m[s.charCodeAt(o++)]);else if(66==R)if(d)for(v=0;v<this.getChannelCount();v++)for(var I=0;I<this.instrumentsPerChannel;I++)this.channels[v].instruments[I].octoff=t.m(0,a.octoffNames.length,m[s.charCodeAt(o++)]);else this.channels[C].instruments[y].octoff=t.m(0,a.octoffNames.length,m[s.charCodeAt(o++)]);else if(118==R)if(f)v=m[s.charCodeAt(o++)],this.channels[v].instruments[0].volume=t.m(0,a.volumeNames.length,m[s.charCodeAt(o++)]);else if(d)for(v=0;v<this.getChannelCount();v++)for(var I=0;I<this.instrumentsPerChannel;I++)this.channels[v].instruments[I].volume=t.m(0,a.volumeNames.length,m[s.charCodeAt(o++)]);else this.channels[C].instruments[y].volume=t.m(0,a.volumeNames.length,m[s.charCodeAt(o++)]);else if(65==R)this.channels[C].instruments[y].algorithm=t.m(0,a.operatorAlgorithmNames.length,m[s.charCodeAt(o++)]);else if(70==R)this.channels[C].instruments[y].feedbackType=t.m(0,a.operatorFeedbackNames.length,m[s.charCodeAt(o++)]);else if(95==R)this.channels[C].instruments[y].feedbackAmplitude=t.m(0,a.operatorAmplitudeMax+1,m[s.charCodeAt(o++)]);else if(86==R)this.channels[C].instruments[y].feedbackEnvelope=t.m(0,a.operatorEnvelopeNames.length,m[s.charCodeAt(o++)]);else if(81==R)for(var D=0;D<a.operatorCount;D++)this.channels[C].instruments[y].operators[D].frequency=t.m(0,a.operatorFrequencyNames.length,m[s.charCodeAt(o++)]);else if(80==R)for(var D=0;D<a.operatorCount;D++)this.channels[C].instruments[y].operators[D].amplitude=t.m(0,a.operatorAmplitudeMax+1,m[s.charCodeAt(o++)]);else if(69==R)for(var D=0;D<a.operatorCount;D++)this.channels[C].instruments[y].operators[D].envelope=t.m(0,a.operatorEnvelopeNames.length,m[s.charCodeAt(o++)]);else if(98==R){var T=void 0;if(f){v=m[s.charCodeAt(o++)];var O=m[s.charCodeAt(o++)];T=Math.ceil(.5*O);for(var V=new i(m,s,o,o+T),I=0;I<O;I++)this.channels[v].bars[I]=V.read(3)+1}else if(p){for(var H=0;1<<H<this.patternsPerChannel;)H++;T=Math.ceil(this.getChannelCount()*this.barCount*H/6);var V=new i(m,s,o,o+T);for(v=0;v<this.getChannelCount();v++)for(var I=0;I<this.barCount;I++)this.channels[v].bars[I]=V.read(H)+1}else{for(var H=0;1<<H<this.patternsPerChannel+1;)H++;T=Math.ceil(this.getChannelCount()*this.barCount*H/6);var V=new i(m,s,o,o+T);for(v=0;v<this.getChannelCount();v++)for(var I=0;I<this.barCount;I++)this.channels[v].bars[I]=V.read(H)}o+=T}else if(112==R){var Y=0;if(f)v=m[s.charCodeAt(o++)],o++,Y=m[s.charCodeAt(o++)],Y<<=6,Y+=m[s.charCodeAt(o++)];else{v=0;for(var j=m[s.charCodeAt(o++)];j>0;)Y<<=6,Y+=m[s.charCodeAt(o++)],j--}var V=new i(m,s,o,o+Y);o+=Y;for(var U=0;1<<U<this.instrumentsPerChannel;)U++;for(;;){for(var W=this.getChannelIsDrum(v),z=W?0:12*this.channels[v].octave,Z=null,G=null,q=(W?4:12)+z,X=W?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],J=[],I=0;I<X.length;I++)X[I]+=z;for(var I=0;I<this.patternsPerChannel;I++){var K=this.channels[v].patterns[I];if(K.reset(),K.instrument=V.read(U),f||0!=V.read(1))for(var _=0,Q=K.notes;_<this.beatsPerBar*this.partsPerBeat;){var $=1==V.read(1),tt=!1,et=0;if($?et=V.readLongTail(0,0):tt=1==V.read(1),$||tt){var nt=void 0,at=void 0,it=void 0;if($)nt=J[et],J.splice(et,1);else{for(nt={},nt.pitchCount=1;nt.pitchCount<4&&1==V.read(1);)nt.pitchCount++;nt.pinCount=V.readPinCount(),nt.initialVolume=V.read(2),nt.pins=[],nt.length=0,nt.bendCount=0;for(var st=0;st<nt.pinCount;st++)at={},at.pitchBend=1==V.read(1),at.pitchBend&&nt.bendCount++,nt.length+=V.readPartDuration(),at.time=nt.length,at.volume=V.read(2),nt.pins.push(at)}J.unshift(nt),J.length>10&&J.pop(),Z=n(0,_,_+nt.length,nt.initialVolume),Z.pitches=[],Z.pins.length=1;for(var rt=[],st=0;st<nt.pitchCount+nt.bendCount;st++){var ot=1==V.read(1);if(ot){var ht=V.read(3);it=X[ht],X.splice(ht,1)}else{var lt=V.readPitchInterval();it=q;for(var ct=lt;ct>0;){for(it++;-1!=X.indexOf(it);)it++;ct--}for(;ct<0;){for(it--;-1!=X.indexOf(it);)it--;ct++}}X.unshift(it),X.length>8&&X.pop(),st<nt.pitchCount?Z.pitches.push(it):rt.push(it),q=st==nt.pitchCount-1?Z.pitches[0]:it}rt.unshift(Z.pitches[0]);for(var ft=0,ut=nt.pins;ft<ut.length;ft++){var pt=ut[ft];pt.pitchBend&&rt.shift(),G=e(rt[0]-Z.pitches[0],pt.time,pt.volume),Z.pins.push(G)}_=Z.end,Q.push(Z)}else{var dt=V.readPartDuration();_+=dt}}}if(f)break;if(++v>=this.getChannelCount())break}}}}},t.prototype.toJsonObject=function(e,n,i){void 0===e&&(e=!0),void 0===n&&(n=1),void 0===i&&(i=!0);for(var s=[],r=0;r<this.getChannelCount();r++){for(var o=[],h=this.getChannelIsDrum(r),l=0;l<this.instrumentsPerChannel;l++){var c=this.channels[r].instruments[l];if(h)o.push({type:a.instrumentTypeNames[2],volume:20*(5-c.volume),imute:a.imuteNames[c.imute],wave:a.drumNames[c.wave],transition:a.transitionNames[c.transition],octoff:a.octoffNames[c.octoff],ipan:a.ipanValues[c.ipan]});else if(0==c.type)o.push({type:a.instrumentTypeNames[c.type],volume:20*(5-c.volume),wave:a.waveNames[c.wave],transition:a.transitionNames[c.transition],filter:a.filterNames[c.filter],chorus:a.chorusNames[c.chorus],effect:a.effectNames[c.effect],harm:a.harmNames[c.harm],imute:a.imuteNames[c.imute],octoff:a.octoffNames[c.octoff],ipan:a.ipanValues[c.ipan]});else if(1==c.type){for(var f=[],u=0,p=c.operators;u<p.length;u++){var d=p[u];f.push({frequency:a.operatorFrequencyNames[d.frequency],amplitude:d.amplitude,envelope:a.operatorEnvelopeNames[d.envelope]})}o.push({type:a.instrumentTypeNames[c.type],volume:20*(5-c.volume),transition:a.transitionNames[c.transition],effect:a.effectNames[c.effect],octoff:a.octoffNames[c.octoff],fmChorus:a.fmChorusNames[c.fmChorus],algorithm:a.operatorAlgorithmNames[c.algorithm],feedbackType:a.operatorFeedbackNames[c.feedbackType],feedbackAmplitude:c.feedbackAmplitude,feedbackEnvelope:a.operatorEnvelopeNames[c.feedbackEnvelope],operators:f,ipan:a.ipanValues[c.ipan],imute:a.imuteNames[c.imute]})}else{if(3!=c.type)throw new Error("Unrecognized instrument type");o.push({type:a.instrumentTypeNames[2],volume:20*(5-c.volume),wave:a.pwmwaveNames[c.wave],transition:a.transitionNames[c.transition],filter:a.filterNames[c.filter],chorus:a.chorusNames[c.chorus],effect:a.effectNames[c.effect],harm:a.harmNames[c.harm],imute:a.imuteNames[c.imute],octoff:a.octoffNames[c.octoff],ipan:a.ipanValues[c.ipan]})}}for(var m=[],g=0,b=this.channels[r].patterns;g<b.length;g++){for(var v=b[g],C=[],y=0,R=v.notes;y<R.length;y++){for(var w=R[y],x=[],P=0,N=w.pins;P<N.length;P++){var L=N[P];x.push({tick:L.time+w.start,pitchBend:L.interval,volume:Math.round(100*L.volume/3)})}C.push({pitches:w.pitches,points:x})}m.push({instrument:v.instrument+1,notes:C})}var k=[];if(e)for(var l=0;l<this.loopStart;l++)k.push(this.channels[r].bars[l]);for(var A=0;A<n;A++)for(var l=this.loopStart;l<this.loopStart+this.loopLength;l++)k.push(this.channels[r].bars[l]);if(i)for(var l=this.loopStart+this.loopLength;l<this.barCount;l++)k.push(this.channels[r].bars[l]);s.push({type:h?"drum":"pitch",octaveScrollBar:this.channels[r].octave,instruments:o,patterns:m,sequence:k})}return{format:t.n,version:t.j,theme:a.themeNames[this.theme],scale:a.scaleNames[this.scale],mix:a.mixNames[this.mix],sampleRate:a.sampleRateNames[this.sampleRate],key:a.keyNames[this.key],introBars:this.loopStart,loopBars:this.loopLength,beatsPerBar:this.beatsPerBar,ticksPerBeat:this.partsPerBeat,beatsPerMinute:this.getBeatsPerMinute(),reverb:this.reverb,blend:this.blend,riff:this.riff,detune:this.detune,muff:this.muff,channels:s}},t.prototype.fromJsonObject=function(i){if(this.initToDefault(!0),i){if(!(i.version>t.n)){if(this.scale=11,void 0!=i.scale){var s={"romani :)":8,"romani :(":9},o=void 0!=s[i.scale]?s[i.scale]:a.scaleNames.indexOf(i.scale);-1!=o&&(this.scale=o)}if(void 0!=i.mix&&(this.mix=a.mixNames.indexOf(i.mix),-1==this.mix&&(this.mix=1)),void 0!=i.sampleRate&&(this.sampleRate=a.sampleRateNames.indexOf(i.sampleRate),-1==this.sampleRate&&(this.sampleRate=2)),void 0!=i.key)if("number"==typeof i.key)this.key=a.keyNames.length-1-(i.key+1200>>>0)%a.keyNames.length;else if("string"==typeof i.key){var c=i.key,f=c.charAt(0).toUpperCase(),u=c.charAt(1).toLowerCase(),p={C:11,D:9,E:7,F:6,G:4,A:2,B:0},d={"#":-1,"♯":-1,b:1,"♭":1},m=p[f],g=d[u];void 0!=m&&(void 0!=g&&(m+=g),m<0&&(m+=12),m%=12,this.key=m)}if(void 0!=i.beatsPerMinute){var b=0|i.beatsPerMinute;this.tempo=Math.round(4+9*Math.log(b/120)/Math.LN2),this.tempo=t.m(0,a.tempoSteps,this.tempo)}void 0!=i.reverb&&(this.reverb=t.m(0,a.reverbRange,0|i.reverb)),void 0!=i.blend&&(this.blend=t.m(0,a.blendRange,0|i.blend)),void 0!=i.riff&&(this.riff=t.m(0,a.riffRange,0|i.riff)),void 0!=i.detune&&(this.detune=t.m(0,a.detuneRange,0|i.detune)),void 0!=i.muff&&(this.muff=t.m(0,a.muffRange,0|i.muff)),void 0!=i.beatsPerBar&&(this.beatsPerBar=Math.max(a.beatsPerBarMin,Math.min(a.beatsPerBarMax,0|i.beatsPerBar))),void 0!=i.ticksPerBeat&&(this.partsPerBeat=0|i.ticksPerBeat,-1==a.partCounts.indexOf(this.partsPerBeat)&&(this.partsPerBeat=a.partCounts[a.partCounts.length-1]));var v=1,C=1,y=1;if(i.channels)for(var R=0,w=i.channels;R<w.length;R++){var x=w[R];x.instruments&&(v=Math.max(v,0|x.instruments.length)),x.patterns&&(C=Math.max(C,0|x.patterns.length)),x.sequence&&(y=Math.max(y,0|x.sequence.length))}this.instrumentsPerChannel=v,this.patternsPerChannel=C,this.barCount=y,void 0!=i.introBars&&(this.loopStart=t.m(0,this.barCount,0|i.introBars)),void 0!=i.loopBars&&(this.loopLength=t.m(1,this.barCount-this.loopStart+1,0|i.loopBars));var P=0,N=0;if(i.channels)for(var L=0;L<i.channels.length;L++){var x=i.channels[L];this.channels.length<=L&&(this.channels[L]=new l),void 0!=x.octaveScrollBar&&(this.channels[L].octave=t.m(0,5,0|x.octaveScrollBar));for(var k=this.channels[L].instruments.length;k<this.instrumentsPerChannel;k++)this.channels[L].instruments[k]=new h;this.channels[L].instruments.length=this.instrumentsPerChannel;for(var k=this.channels[L].patterns.length;k<this.patternsPerChannel;k++)this.channels[L].patterns[k]=new r;this.channels[L].patterns.length=this.patternsPerChannel;for(var k=0;k<this.barCount;k++)this.channels[L].bars[k]=1;this.channels[L].bars.length=this.barCount;var A=!1;A=x.type?"drum"==x.type:L>=3,A?N++:P++;for(var k=0;k<this.instrumentsPerChannel;k++){var M=this.channels[L].instruments[k],E=void 0;x.instruments&&(E=x.instruments[k]),void 0==E&&(E={});var S={binary:0},B=E.transition||E.envelope;if(M.transition=void 0!=S[B]?S[B]:a.transitionNames.indexOf(B),-1==M.transition&&(M.transition=1),A)void 0!=E.volume?M.volume=t.m(0,a.volumeNames.length,Math.round(5-(0|E.volume)/20)):M.volume=0,M.wave=a.drumNames.indexOf(E.wave),-1==M.wave&&(M.wave=1),M.imute=a.imuteNames.indexOf(E.imute),-1==M.imute&&(M.imute=0),M.ipan=a.ipanValues.indexOf(E.ipan),-1==M.ipan&&(M.ipan=4);else if(M.type=a.instrumentTypeNames.indexOf(E.type),-1==M.type&&(M.type=0),0==M.type){void 0!=E.volume?M.volume=t.m(0,a.volumeNames.length,Math.round(5-(0|E.volume)/20)):M.volume=0,M.wave=a.waveNames.indexOf(E.wave),-1==M.wave&&(M.wave=1);var I={"sustain sharp":1,"sustain medium":2,"sustain soft":3,"decay sharp":4};M.filter=void 0!=I[E.filter]?I[E.filter]:a.filterNames.indexOf(E.filter),-1==M.filter&&(M.filter=0),M.chorus=a.chorusNames.indexOf(E.chorus),-1==M.chorus&&(M.chorus=0),M.effect=a.effectNames.indexOf(E.effect),-1==M.effect&&(M.effect=0),M.harm=a.harmNames.indexOf(E.harm),-1==M.harm&&(M.harm=0),M.octoff=a.octoffNames.indexOf(E.octoff),-1==M.octoff&&(M.octoff=0),M.imute=a.imuteNames.indexOf(E.imute),-1==M.imute&&(M.imute=0),M.ipan=a.ipanValues.indexOf(E.ipan),-1==M.ipan&&(M.ipan=4)}else if(3==M.type||2==M.type){2==M.type&&(M.type=3),void 0!=E.volume?M.volume=t.m(0,a.volumeNames.length,Math.round(5-(0|E.volume)/20)):M.volume=0,M.wave=a.pwmwaveNames.indexOf(E.wave),-1==M.wave&&(M.wave=1);var I={"sustain sharp":1,"sustain medium":2,"sustain soft":3,"decay sharp":4};M.filter=void 0!=I[E.filter]?I[E.filter]:a.filterNames.indexOf(E.filter),-1==M.filter&&(M.filter=0),M.chorus=a.chorusNames.indexOf(E.chorus),-1==M.chorus&&(M.chorus=0),M.effect=a.effectNames.indexOf(E.effect),-1==M.effect&&(M.effect=0),M.harm=a.harmNames.indexOf(E.harm),-1==M.harm&&(M.harm=0),M.octoff=a.octoffNames.indexOf(E.octoff),-1==M.octoff&&(M.octoff=0),M.imute=a.imuteNames.indexOf(E.imute),-1==M.imute&&(M.imute=0),M.ipan=a.ipanValues.indexOf(E.ipan),-1==M.ipan&&(M.ipan=4)}else{if(1!=M.type)throw new Error("Unrecognized instrument type.");M.effect=a.effectNames.indexOf(E.effect),-1==M.effect&&(M.effect=0),M.octoff=a.octoffNames.indexOf(E.octoff),-1==M.octoff&&(M.octoff=0),M.fmChorus=a.fmChorusNames.indexOf(E.fmChorus),-1==M.fmChorus&&(M.fmChorus=0),M.algorithm=a.operatorAlgorithmNames.indexOf(E.algorithm),-1==M.algorithm&&(M.algorithm=0),M.feedbackType=a.operatorFeedbackNames.indexOf(E.feedbackType),-1==M.feedbackType&&(M.feedbackType=0),void 0!=E.feedbackAmplitude?M.feedbackAmplitude=t.m(0,a.operatorAmplitudeMax+1,0|E.feedbackAmplitude):M.feedbackAmplitude=0,M.feedbackEnvelope=a.operatorEnvelopeNames.indexOf(E.feedbackEnvelope),-1==M.feedbackEnvelope&&(M.feedbackEnvelope=0);for(var F=0;F<a.operatorCount;F++){var D=M.operators[F],T=void 0;E.operators&&(T=E.operators[F]),void 0==T&&(T={}),D.frequency=a.operatorFrequencyNames.indexOf(T.frequency),-1==D.frequency&&(D.frequency=0),void 0!=T.amplitude?D.amplitude=t.m(0,a.operatorAmplitudeMax+1,0|T.amplitude):D.amplitude=0,D.envelope=a.operatorEnvelopeNames.indexOf(T.envelope),-1==D.envelope&&(D.envelope=0)}M.ipan=a.ipanValues.indexOf(E.ipan),-1==M.ipan&&(M.ipan=4),M.imute=a.imuteNames.indexOf(E.imute),-1==M.imute&&(M.imute=0)}}for(var k=0;k<this.patternsPerChannel;k++){var O=this.channels[L].patterns[k],V=void 0;if(x.patterns&&(V=x.patterns[k]),void 0!=V&&(O.instrument=t.m(0,this.instrumentsPerChannel,(0|V.instrument)-1),V.notes&&V.notes.length>0))for(var H=Math.min(this.beatsPerBar*this.partsPerBeat,V.notes.length>>>0),Y=0,F=0;F<V.notes.length&&!(F>=H);F++){var j=V.notes[F];if(j&&j.pitches&&j.pitches.length>=1&&j.points&&j.points.length>=2){var U=n(0,0,0,0);U.pitches=[],U.pins=[];for(var W=0;W<j.pitches.length;W++){var z=0|j.pitches[W];if(-1==U.pitches.indexOf(z)&&(U.pitches.push(z),U.pitches.length>=4))break}if(!(U.pitches.length<1)){for(var Z=Y,G=0,W=0;W<j.points.length;W++){var q=j.points[W];if(void 0!=q&&void 0!=q.tick){var X=void 0==q.pitchBend?0:0|q.pitchBend,J=0|q.tick,K=void 0==q.volume?3:Math.max(0,Math.min(3,Math.round(3*(0|q.volume)/100)));if(!(J>this.beatsPerBar*this.partsPerBeat)){if(0==U.pins.length){if(J<Z)continue;U.start=J,G=X}else if(J<=Z)continue;Z=J,U.pins.push(e(X-G,J-U.start,K))}}}if(!(U.pins.length<2)){U.end=U.pins[U.pins.length-1].time+U.start;for(var _=A?a.drumCount-1:a.maxPitch,Q=_,$=0,W=0;W<U.pitches.length;W++)U.pitches[W]+=G,(U.pitches[W]<0||U.pitches[W]>_)&&(U.pitches.splice(W,1),W--),U.pitches[W]<Q&&(Q=U.pitches[W]),U.pitches[W]>$&&($=U.pitches[W]);if(!(U.pitches.length<1)){for(var W=0;W<U.pins.length;W++){var tt=U.pins[W];tt.interval+Q<0&&(tt.interval=-Q),tt.interval+$>_&&(tt.interval=_-$),W>=2&&tt.interval==U.pins[W-1].interval&&tt.interval==U.pins[W-2].interval&&tt.volume==U.pins[W-1].volume&&tt.volume==U.pins[W-2].volume&&(U.pins.splice(W-1,1),W--)}O.notes.push(U),Y=U.end}}}}}}for(var k=0;k<this.barCount;k++)this.channels[L].bars[k]=x.sequence?Math.min(this.patternsPerChannel,x.sequence[k]>>>0):0}this.pitchChannelCount=P,this.drumChannelCount=N,this.channels.length=this.getChannelCount()}}},t.m=function(t,e,n){return e-=1,n<=e?n>=t?n:t:e},t.prototype.getPattern=function(t,e){var n=this.channels[t].bars[e];return 0==n?null:this.channels[t].patterns[n-1]},t.prototype.getPatternInstrument=function(t,e){var n=this.getPattern(t,e);return null==n?0:n.instrument},t.prototype.getPatternInstrumentMute=function(t,e){var n=this.getPattern(t,e),a=this.getPatternInstrument(t,e),i=this.channels[t].instruments[a];return null==n?0:i.imute},t.prototype.getPatternInstrumentVolume=function(t,e){var n=this.getPattern(t,e),a=this.getPatternInstrument(t,e),i=this.channels[t].instruments[a];return null==n?0:i.volume},t.prototype.getBeatsPerMinute=function(){return Math.round(120*Math.pow(2,(-4+this.tempo)/9))},t.prototype.getChannelFingerprint=function(t){for(var e=this.getChannelCount(),n=0,a=0;a<e;a++)if(a<this.pitchChannelCount){var i=this.getPatternInstrument(a,t),s=this.channels[a].instruments[i];if(0==s.type)this.h[n++]="c";else if(1==s.type)this.h[n++]="f",this.h[n++]=s.algorithm,this.h[n++]=s.feedbackType;else{if(3!=s.type)throw new Error("Unknown instrument type.");this.h[n++]="p"}}else this.h[n++]="d";return this.h.length=n,this.h.join("")},t.n="BeepBox",t.l=2,t.j=6,
t.k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,62,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,0,0,0,0,63,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,0,0,0,0,0],t.i=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,45,95],t}();t.Song=c;var f=function(){function t(){this.sampleLeft=0,this.sampleRight=0,this.phases=[],this.phaseDeltas=[],this.volumeStarts=[],this.volumeDeltas=[],this.volumeLeft=[],this.volumeRight=[],this.phaseDeltaScale=0,this.filter=0,this.filterScale=0,this.vibratoScale=0,this.harmonyMult=0,this.harmonyVolumeMult=1,this.feedbackOutputs=[],this.feedbackMult=0,this.feedbackDelta=0,this.reset()}return t.prototype.reset=function(){for(var t=0;t<a.operatorCount;t++)this.phases[t]=0,this.feedbackOutputs[t]=0;this.sampleLeft=0,this.sampleRight=0},t}(),u=function(){function t(t){void 0===t&&(t=null);var e=this;this.samplesPerSecond=44100,this.effectDuration=.14,this.effectAngle=2*Math.PI/(this.effectDuration*this.samplesPerSecond),this.effectYMult=2*Math.cos(this.effectAngle),this.limitDecay=1/(2*this.samplesPerSecond),this.song=null,this.pianoPressed=!1,this.pianoPitch=[0],this.pianoChannel=0,this.enableIntro=!0,this.enableOutro=!1,this.loopCount=-1,this.volume=1,this.playheadInternal=0,this.bar=0,this.beat=0,this.part=0,this.arpeggio=0,this.arpeggioSampleCountdown=0,this.paused=!0,this.channels=[],this.stillGoing=!1,this.effectPhase=0,this.limit=0,this.delayLineLeft=new Float32Array(16384),this.delayLineRight=new Float32Array(16384),this.delayPosLeft=0,this.delayPosRight=0,this.delayFeedback0Left=0,this.delayFeedback0Right=0,this.delayFeedback1Left=0,this.delayFeedback1Right=0,this.delayFeedback2Left=0,this.delayFeedback2Right=0,this.delayFeedback3Left=0,this.delayFeedback3Right=0,this.audioProcessCallback=function(t){var n=t.outputBuffer,a=n.getChannelData(0),i=n.getChannelData(1);e.synthesize(a,i,n.length)},null!=t&&this.setSong(t)}return t.warmUpSynthesizer=function(e){if(null!=e){for(var n=0;n<e.instrumentsPerChannel;n++)for(var i=e.pitchChannelCount;i<e.pitchChannelCount+e.drumChannelCount;i++)a.getDrumWave(e.channels[i].instruments[n].wave);for(var n=0;n<e.barCount;n++)t.getGeneratedSynthesizer(e,n)}},t.operatorAmplitudeCurve=function(t){return(Math.pow(16,t/15)-1)/15},Object.defineProperty(t.prototype,"playing",{get:function(){return!this.paused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playhead",{get:function(){return this.playheadInternal},set:function(t){if(null!=this.song){this.playheadInternal=Math.max(0,Math.min(this.song.barCount,t));var e=this.playheadInternal;this.bar=Math.floor(e),e=this.song.beatsPerBar*(e-this.bar),this.beat=Math.floor(e),e=this.song.partsPerBeat*(e-this.beat),this.part=Math.floor(e),e=4*(e-this.part),this.arpeggio=Math.floor(e);var n=this.getSamplesPerArpeggio();e=n*(e-this.arpeggio),this.arpeggioSampleCountdown=Math.floor(n-e),this.bar<this.song.loopStart&&(this.enableIntro=!0),this.bar>this.song.loopStart+this.song.loopLength&&(this.enableOutro=!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalSamples",{get:function(){if(null==this.song)return 0;var t=4*this.getSamplesPerArpeggio()*this.song.partsPerBeat*this.song.beatsPerBar,e=this.loopCount;e<0&&(e=1);var n=this.song.loopLength*e;return this.enableIntro&&(n+=this.song.loopStart),this.enableOutro&&(n+=this.song.barCount-(this.song.loopStart+this.song.loopLength)),n*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalSeconds",{get:function(){return Math.round(this.totalSamples/this.samplesPerSecond)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalBars",{get:function(){return null==this.song?0:this.song.barCount},enumerable:!0,configurable:!0}),t.prototype.setSong=function(t){"string"==typeof t?this.song=new c(t):t instanceof c&&(this.song=t)},t.prototype.spsCalc=function(){return t.warmUpSynthesizer(this.song),0==this.song.sampleRate?44100:1==this.song.sampleRate?48e3:2==this.song.sampleRate?this.audioCtx.sampleRate:3==this.song.sampleRate?4*this.audioCtx.sampleRate:4==this.song.sampleRate?2*this.audioCtx.sampleRate:5==this.song.sampleRate?this.audioCtx.sampleRate/2:6==this.song.sampleRate?this.audioCtx.sampleRate/4:7==this.song.sampleRate?this.audioCtx.sampleRate/8:8==this.song.sampleRate?this.audioCtx.sampleRate/16:this.audioCtx.sampleRate},t.prototype.play=function(){if(this.paused){this.paused=!1,t.warmUpSynthesizer(this.song);var e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;this.audioCtx=this.audioCtx||new e,this.scriptNode=this.audioCtx.createScriptProcessor?this.audioCtx.createScriptProcessor(2048,0,2):this.audioCtx.createJavaScriptNode(2048,0,2),this.scriptNode.onaudioprocess=this.audioProcessCallback,this.scriptNode.connect(this.audioCtx.destination),this.scriptNode.channelCountMode="explicit",this.scriptNode.channelInterpretation="speakers",this.samplesPerSecond=this.spsCalc(),this.effectAngle=2*Math.PI/(this.effectDuration*this.samplesPerSecond),this.effectYMult=2*Math.cos(this.effectAngle),this.limitDecay=1/(2*this.samplesPerSecond)}},t.prototype.pause=function(){this.paused||(this.paused=!0,this.audioCtx.close&&(this.audioCtx.close(),this.audioCtx=null),this.scriptNode=null)},t.prototype.snapToStart=function(){this.bar=0,this.enableIntro=!0,this.snapToBar()},t.prototype.snapToBar=function(t){void 0!==t&&(this.bar=t),this.playheadInternal=this.bar,this.beat=0,this.part=0,this.arpeggio=0,this.arpeggioSampleCountdown=0,this.effectPhase=0;for(var e=0,n=this.channels;e<n.length;e++){n[e].reset()}this.delayPosLeft=0,this.delayPosRight=0,this.delayFeedback0Left=0,this.delayFeedback0Right=0,this.delayFeedback1Left=0,this.delayFeedback1Right=0,this.delayFeedback2Left=0,this.delayFeedback2Right=0,this.delayFeedback3Left=0,this.delayFeedback3Right=0;for(var a=0;a<this.delayLineLeft.length;a++)this.delayLineLeft[a]=0;for(var a=0;a<this.delayLineRight.length;a++)this.delayLineRight[a]=0},t.prototype.nextBar=function(){if(this.song){var t=this.bar;this.bar++,this.enableOutro?this.bar>=this.song.barCount&&(this.bar=this.enableIntro?0:this.song.loopStart):(this.bar>=this.song.loopStart+this.song.loopLength||this.bar>=this.song.barCount)&&(this.bar=this.song.loopStart),this.playheadInternal+=this.bar-t}},t.prototype.prevBar=function(){if(this.song){var t=this.bar;this.bar--,this.bar<0&&(this.bar=this.song.loopStart+this.song.loopLength-1),this.bar>=this.song.barCount&&(this.bar=this.song.barCount-1),this.bar<this.song.loopStart&&(this.enableIntro=!0),!this.enableOutro&&this.bar>=this.song.loopStart+this.song.loopLength&&(this.bar=this.song.loopStart+this.song.loopLength-1),this.playheadInternal+=this.bar-t}},t.prototype.synthesize=function(e,n,a){if(null!=this.song){for(var i=this.song.getChannelCount(),s=this.channels.length;s<i;s++)this.channels[s]=new f;this.channels.length=i;var r=this.getSamplesPerArpeggio(),o=0,h=!1;for((0==this.arpeggioSampleCountdown||this.arpeggioSampleCountdown>r)&&(this.arpeggioSampleCountdown=r),this.part>=this.song.partsPerBeat&&(this.beat++,this.part=0,this.arpeggio=0,this.arpeggioSampleCountdown=r),this.beat>=this.song.beatsPerBar&&(this.bar++,this.beat=0,this.part=0,this.arpeggio=0,this.arpeggioSampleCountdown=r,-1==this.loopCount&&(this.bar<this.song.loopStart&&!this.enableIntro&&(this.bar=this.song.loopStart),this.bar>=this.song.loopStart+this.song.loopLength&&!this.enableOutro&&(this.bar=this.song.loopStart))),this.bar>=this.song.barCount&&(this.enableOutro?(this.bar=0,this.enableIntro=!0,h=!0,this.pause()):this.bar=this.song.loopStart),this.bar>=this.song.loopStart&&(this.enableIntro=!1);;){if(h){for(;o<a;)e[o]=0,n[o]=0,o++;break}o=t.getGeneratedSynthesizer(this.song,this.bar)(this,this.song,e,n,a,o,r);if(-1==o)break;this.beat=0,this.effectPhase=0,this.bar++,this.bar<this.song.loopStart?this.enableIntro||(this.bar=this.song.loopStart):this.enableIntro=!1,this.bar>=this.song.loopStart+this.song.loopLength&&(this.loopCount>0&&this.loopCount--,(this.loopCount>0||!this.enableOutro)&&(this.bar=this.song.loopStart)),this.bar>=this.song.barCount&&(this.bar=0,this.enableIntro=!0,h=!0,this.pause())}this.playheadInternal=(((this.arpeggio+1-this.arpeggioSampleCountdown/r)/4+this.part)/this.song.partsPerBeat+this.beat)/this.song.beatsPerBar+this.bar}else for(var s=0;s<a;s++)e[s]=0,n[s]=0},t.computeOperatorEnvelope=function(t,e,n,i){switch(a.operatorEnvelopeType[t]){case 0:return i;case 1:return 1;case 4:var s=1/(1+e*a.operatorEnvelopeSpeed[t]);return a.operatorEnvelopeInverted[t]?1-s:s;case 5:return a.operatorSpecialCustomVolume[t]?.5-.5*Math.cos(2*n*Math.PI*(4*i)):.5-.5*Math.cos(2*n*Math.PI*a.operatorEnvelopeSpeed[t]);case 2:return Math.max(1,2-10*e);case 3:if(a.operatorSpecialCustomVolume[t]){var r=.25/Math.sqrt(i);return e<r?e/r:1/(1+16*i*(e-r))}var o=a.operatorEnvelopeSpeed[t],r=.25/Math.sqrt(o);return e<r?e/r:1/(1+(e-r)*o);case 6:return Math.max(-1-e,-2+e);default:throw new Error("Unrecognized operator envelope type.")}},t.computeChannelInstrument=function(e,n,i,s,r,o,h){var l=n.getChannelIsDrum(i),c=e.channels[i],f=n.getPattern(i,e.bar),u=n.channels[i].instruments[null==f?0:f.instrument],p=e.pianoPressed&&i==e.pianoChannel,d=l?a.drumBasePitches[u.wave]:a.keyTransposes[n.key],m=l?a.drumInterval:1,g=l?a.drumWaveIsSoft[u.wave]?24:60:48,b=4*o/e.samplesPerSecond,v=1/n.partsPerBeat;c.phaseDeltaScale=0,c.filter=1,c.filterScale=1,c.vibratoScale=0,c.harmonyMult=1,c.harmonyVolumeMult=1;for(var C=0,y=e.arpeggio,R=e.arpeggioSampleCountdown,w=null,x=!0,P=0,N=0,L=1,k=1,A=0,M=0,E=0,S=0,B=0,I=0,F=0;F<a.operatorCount;F++)c.phaseDeltas[F]=0,c.volumeStarts[F]=0,c.volumeDeltas[F]=0,c.volumeLeft[0]=0,c.volumeRight[0]=0;if(p)w=e.pianoPitch,L=k=1,A=M=1,x=!1;else if(null!=f){for(var D=null,T=null,O=null,F=0;F<f.notes.length;F++)if(f.notes[F].end<=s)T=f.notes[F];else if(f.notes[F].start<=s&&f.notes[F].end>s)D=f.notes[F];else if(f.notes[F].start>s){O=f.notes[F];break}if(null!=D&&null!=T&&T.end!=D.start&&(T=null),null!=D&&null!=O&&O.start!=D.end&&(O=null),null!=D){w=D.pitches,C=s-D.start;var V=void 0;for(V=1;V<D.pins.length-1&&!(D.pins[V].time+D.start>s);V++);var H=D.pins[V-1],Y=D.pins[V],j=4*D.start,U=4*D.end,W=4*(D.start+H.time),z=4*(D.start+Y.time),Z=4*s+y,G=4*s+y+1,q=(Z-W)/(z-W),X=(G-W)/(z-W),J=H.volume+(Y.volume-H.volume)*q,K=H.volume+(Y.volume-H.volume)*X,_=1,Q=1,$=H.interval+(Y.interval-H.interval)*q,tt=H.interval+(Y.interval-H.interval)*X,et=H.time+(Y.time-H.time)*q,nt=H.time+(Y.time-H.time)*X,at=et,it=nt,st=1-(R+h)/o,rt=1-R/o;x=Z+st-j==0;var ot=u.transition;Z==j&&(0==ot?x=!1:2==ot?_=0:3==ot?null==T?_=0:0==T.pins[T.pins.length-1].volume||0==D.pins[0].volume?_=0:($=.5*(T.pitches[0]+T.pins[T.pins.length-1].interval-D.pitches[0]),at=.5*T.pins[T.pins.length-1].time,x=!1):4==ot?Q=0:5==ot?$=100:6==ot?$=-1:7==ot&&(_=6)),G==U&&(0==ot?null==O&&D.start+Y.time!=n.partsPerBeat*n.beatsPerBar&&(Q=0):1==ot||2==ot?Q=0:3==ot&&(null==O?Q=0:0==D.pins[D.pins.length-1].volume||0==O.pins[0].volume?Q=0:(tt=.5*(O.pitches[0]-D.pitches[0]+D.pins[D.pins.length-1].interval),it*=.5))),P=$+(tt-$)*st,N=$+(tt-$)*rt,A=e.volumeConversion(J+(K-J)*st),M=e.volumeConversion(J+(K-J)*rt),L=_+(Q-_)*st,k=_+(Q-_)*rt,E=D.start+et+(nt-et)*st,S=D.start+et+(nt-et)*rt,B=at+(it-at)*st,I=at+(it-at)*rt}}if(null!=w){if(l||1!=u.type){var ht=w[0];if(l)0==a.harmNames[u.harm]?1==w.length?ht=w[0]+a.octoffValues[u.octoff]:2==w.length?ht=w[y>>1]+a.octoffValues[u.octoff]:3==w.length?ht=w[3==y?1:y]+a.octoffValues[u.octoff]:4==w.length&&(ht=w[y]+a.octoffValues[u.octoff]):1==a.harmNames[u.harm]?1==w.length?ht=w[0]+a.octoffValues[u.octoff]:2==w.length?ht=(w[1]+w[0])/2+a.octoffValues[u.octoff]:3==w.length?ht=(w[1+(y>>1)]+w[0])/2+a.octoffValues[u.octoff]:4==w.length&&(ht=(w[(3==y?1:y)+1]+w[0])/2+a.octoffValues[u.octoff]):2==a.harmNames[u.harm]?1==w.length?ht=w[0]+a.octoffValues[u.octoff]:2==w.length?ht=(w[1]+w[0])/2+a.octoffValues[u.octoff]:3==w.length?ht=(w[2]+w[0])/2+a.octoffValues[u.octoff]:4==w.length&&(ht=(w[(3==y?2:y)+1]+w[0])/2+a.octoffValues[u.octoff]):3==a.harmNames[u.harm]?1==w.length?ht=w[0]+a.octoffValues[u.octoff]:2==w.length?ht=(w[1]+w[0])/2+a.octoffValues[u.octoff]:3==w.length?ht=(w[2]+w[0])/2+a.octoffValues[u.octoff]:4==w.length&&(ht=(w[3]+w[0])/2+a.octoffValues[u.octoff]):4==a.harmNames[u.harm]&&(1==w.length?ht=w[0]+a.octoffValues[u.octoff]:2==w.length?ht=(w[1]+w[0])/2+a.octoffValues[u.octoff]:3==w.length?ht=(w[1+(y>>1)]+w[0])/2+a.octoffValues[u.octoff]:4==w.length&&(ht=w[2+(y>>1)]+w[0]+a.octoffValues[u.octoff]));else if(1==a.harmNames[u.harm]){var lt=0;2==w.length?lt=w[1]-w[0]:3==w.length?lt=w[1+(y>>1)]-w[0]:4==w.length&&(lt=w[(3==y?1:y)+1]-w[0]),c.harmonyMult=Math.pow(2,lt/12),c.harmonyVolumeMult=Math.pow(2,-lt/g)}else if(2==a.harmNames[u.harm]){var lt=0;2==w.length?lt=w[1]-w[0]:3==w.length?lt=w[2]-w[0]:4==w.length&&(lt=w[(3==y?2:y)+1]-w[0]),c.harmonyMult=Math.pow(2,lt/12),c.harmonyVolumeMult=Math.pow(2,-lt/g)}else if(3==a.harmNames[u.harm]){var lt=0;2==w.length?lt=w[1]-w[0]:3==w.length?lt=w[2]-w[0]:4==w.length&&(lt=w[3]-w[0]),c.harmonyMult=Math.pow(2,lt/12),c.harmonyVolumeMult=Math.pow(2,-lt/g)}else if(4==a.harmNames[u.harm]){var lt=0;2==w.length?lt=w[1]-w[0]:3==w.length?lt=w[1+(y>>1)]-w[0]:4==w.length&&(lt=w[2+(y>>1)]-w[0]),c.harmonyMult=Math.pow(2,lt/12),c.harmonyVolumeMult=Math.pow(2,-lt/g)}else if(5==a.harmNames[u.harm]){var lt=0;2==w.length?lt=w[1]-w[0]:3==w.length?lt=w[2]-w[0]:4==w.length&&(lt=w[3==y?2:y]-w[0]),c.harmonyMult=Math.pow(2,lt/12),c.harmonyVolumeMult=Math.pow(2,-lt/g)}else 0==a.harmNames[u.harm]&&(2==w.length?ht=w[y>>1]:3==w.length?ht=w[3==y?1:y]:4==w.length&&(ht=w[y]));var ct=(ht+P)*m,ft=(ht+N)*m,ut=e.frequencyFromPitch(d+ct),pt=Math.pow(2,-ct/g),dt=Math.pow(2,-ft/g);l&&a.drumWaveIsSoft[u.wave]&&(c.filter=Math.min(1,ut*r*a.drumPitchFilterMult[u.wave]));var mt=void 0;if(l)mt=0==n.mix?.19*a.drumVolumes[u.wave]:3==n.mix?.12*a.drumVolumes[u.wave]:.09*a.drumVolumes[u.wave];else{var gt=a.filterDecays[u.filter];c.filter=Math.pow(2,-gt*b*B);var bt=Math.pow(2,-gt*b*I);c.filterScale=Math.pow(bt/c.filter,1/h),mt=.135*a.waveVolumes[u.wave]*a.filterVolumes[u.filter]*a.chorusVolumes[u.chorus]}x&&!l&&c.reset(),c.phaseDeltas[0]=ut*r;var vt=0;vt=2==n.mix?9==u.volume?0:Math.pow(3,-a.volumeValues[u.volume])*a.imuteValues[u.imute]:1==n.mix?u.volume>=5?0:Math.pow(3,-a.volumeMValues[u.volume])*a.imuteValues[u.imute]:u.volume>=5?0:Math.pow(2,-a.volumeMValues[u.volume])*a.imuteValues[u.imute],c.volumeStarts[0]=L*A*pt*mt*vt;var Ct=k*M*dt*mt*vt;c.volumeDeltas[0]=(Ct-c.volumeStarts[0])/h,c.volumeLeft[0]=Math.min(1,1+a.ipanValues[u.ipan]),c.volumeRight[0]=Math.min(1,1-a.ipanValues[u.ipan])}else{for(var yt=1,Rt=0,wt=a.operatorCarrierCounts[u.algorithm],F=0;F<a.operatorCount;F++){var xt=F<a.operatorCarrierCounts[u.algorithm],Pt=a.operatorAssociatedCarrier[u.algorithm][F]-1,ht=w[F<w.length?F:Pt<w.length?Pt:0]+a.octoffValues[u.octoff]+n.detune/24,Nt=a.operatorFrequencies[u.operators[F].frequency],Lt=a.operatorCarrierChorus[a.fmChorusNames[u.fmChorus]][Pt],ct=(ht+P)*m+Lt,ut=Nt*e.frequencyFromPitch(d+ct)+a.operatorHzOffsets[u.operators[F].frequency];c.phaseDeltas[F]=ut*r*a.sineWaveLength,x&&c.reset();var kt=t.operatorAmplitudeCurve(u.operators[F].amplitude),At=0;-1!=a.volumeValues[u.volume]&&2==n.mix||-1!=a.volumeMValues[u.volume]&&2!=n.mix?At=2==n.mix?xt?kt*a.operatorAmplitudeSigns[u.operators[F].frequency]*(1-a.volumeValues[u.volume]/2.3):kt*a.operatorAmplitudeSigns[u.operators[F].frequency]:kt*a.operatorAmplitudeSigns[u.operators[F].frequency]*(1-a.volumeMValues[u.volume]/2.3):-1!=a.volumeValues[u.volume]?At=0:-1!=a.volumeMValues[u.volume]&&(At=0);var Mt=At*a.imuteValues[u.imute],Ct=At*a.imuteValues[u.imute];if(c.volumeLeft[0]=Math.min(1,1+a.ipanValues[u.ipan]),c.volumeRight[0]=Math.min(1,1-a.ipanValues[u.ipan]),F<wt){var ft=(ht+N)*m,pt=0,dt=0;3==n.mix?(pt=Math.pow(5,-ct/g),dt=Math.pow(5,-ft/g)):(pt=Math.pow(2,-ct/g),dt=Math.pow(2,-ft/g)),Mt*=.03*pt*L,Ct*=.03*dt*k,Rt+=kt}else Mt*=1.5*a.sineWaveLength,Ct*=1.5*a.sineWaveLength,yt*=1-Math.min(1,u.operators[F].amplitude/15);var Et=u.operators[F].envelope;Mt*=t.computeOperatorEnvelope(Et,b*B,v*E,A),Ct*=t.computeOperatorEnvelope(Et,b*I,v*S,M),c.volumeStarts[F]=Mt,c.volumeDeltas[F]=(Ct-Mt)/h}var St=.3*a.sineWaveLength*u.feedbackAmplitude/15,Bt=St*t.computeOperatorEnvelope(u.feedbackEnvelope,b*B,v*E,A),It=St*t.computeOperatorEnvelope(u.feedbackEnvelope,b*I,v*S,M);c.feedbackMult=Bt,c.feedbackDelta=(It-c.feedbackMult)/h,yt*=1-u.feedbackAmplitude/15,yt*=1-Math.min(1,Math.max(0,Rt-1)/2);for(var F=0;F<wt;F++)c.volumeStarts[F]*=1+3*yt,c.volumeDeltas[F]*=1+3*yt}c.phaseDeltaScale=Math.pow(2,(N-P)*m/12/h),c.vibratoScale=C<a.effectVibratoDelays[u.effect]?0:Math.pow(2,a.effectVibratos[u.effect]/12)-1}else{c.reset();for(var F=0;F<a.operatorCount;F++)c.phaseDeltas[0]=0,c.volumeStarts[0]=0,c.volumeDeltas[0]=0,c.volumeLeft[0]=0,c.volumeRight[0]=0}},t.getGeneratedSynthesizer=function(e,n){var i=e.getChannelFingerprint(n);if(void 0==t.generatedSynthesizers[i]){for(var s=[],r=[],o=0;o<e.pitchChannelCount;o++)r[o]=e.channels[o].instruments[e.getPatternInstrument(o,n)];for(var h=0,l=t.synthSourceTemplate;h<l.length;h++){var c=l[h];if(-1!=c.indexOf("#"))if(-1!=c.indexOf("// PITCH"))for(var o=0;o<e.pitchChannelCount;o++)s.push(c.replace(/#/g,o+""));else if(-1!=c.indexOf("// JCHIP"))for(var o=0;o<e.pitchChannelCount;o++)0==r[o].type&&s.push(c.replace(/#/g,o+""));else if(-1!=c.indexOf("// CHIP"))for(var o=0;o<e.pitchChannelCount;o++)0==r[o].type?s.push(c.replace(/#/g,o+"")):3==r[o].type&&s.push(c.replace(/#/g,o+""));else if(-1!=c.indexOf("// FM")){for(var o=0;o<e.pitchChannelCount;o++)if(1==r[o].type)if(-1!=c.indexOf("$"))for(var f=0;f<a.operatorCount;f++)s.push(c.replace(/#/g,o+"").replace(/\$/g,f+""));else s.push(c.replace(/#/g,o+""))}else if(-1!=c.indexOf("// PWM"))for(var o=0;o<e.pitchChannelCount;o++)3==r[o].type&&s.push(c.replace(/#/g,o+""));else if(-1!=c.indexOf("// CARRIER OUTPUTS")){for(var o=0;o<e.pitchChannelCount;o++)if(1==r[o].type){for(var u=[],f=0;f<a.operatorCarrierCounts[r[o].algorithm];f++)u.push("channel"+o+"Operator"+f+"Scaled");s.push(c.replace(/#/g,o+"").replace("/*channel"+o+"Operator$Scaled*/",u.join(" + ")))}}else if(-1!=c.indexOf("// NOISE"))for(var o=e.pitchChannelCount;o<e.pitchChannelCount+e.drumChannelCount;o++)s.push(c.replace(/#/g,o+""));else{if(-1==c.indexOf("// ALL"))throw new Error("Missing channel type annotation for line: "+c);for(var o=0;o<e.pitchChannelCount+e.drumChannelCount;o++)s.push(c.replace(/#/g,o+""))}else if(-1!=c.indexOf("// INSERT OPERATOR COMPUTATION HERE")){for(var f=a.operatorCount-1;f>=0;f--)for(var p=0,d=t.operatorSourceTemplate;p<d.length;p++)for(var m=d[p],o=0;o<e.pitchChannelCount;o++)if(1==r[o].type)if(-1!=m.indexOf("/* + channel#Operator@Scaled*/")){for(var g="",b=0,v=a.operatorModulatedBy[r[o].algorithm][f];b<v.length;b++){var C=v[b];g+=" + channel"+o+"Operator"+(C-1)+"Scaled"}var y=a.operatorFeedbackIndices[r[o].feedbackType][f];if(y.length>0){g+=" + channel"+o+"FeedbackMult * (";for(var R=[],w=0,x=y;w<x.length;w++){var C=x[w];R.push("channel"+o+"Operator"+(C-1)+"Output")}g+=R.join(" + ")+")"}s.push(m.replace(/#/g,o+"").replace(/\$/g,f+"").replace("/* + channel"+o+"Operator@Scaled*/",g))}else s.push(m.replace(/#/g,o+"").replace(/\$/g,f+""))}else s.push(c)}t.generatedSynthesizers[i]=new Function("synth","song","dataLeft","dataRight","bufferLength","bufferIndex","samplesPerArpeggio",s.join("\n"))}return t.generatedSynthesizers[i]},t.prototype.frequencyFromPitch=function(t){return 440*Math.pow(2,(t-69)/12)},t.prototype.volumeConversion=function(t){return Math.pow(t/3,1.5)},t.prototype.getSamplesPerArpeggio=function(){if(null==this.song)return 0;var t=this.song.getBeatsPerMinute(),e=t/60,n=e*this.song.partsPerBeat,a=4*n;return Math.floor(this.samplesPerSecond/a)},t.negativePhaseGuard=1e3,t.generatedSynthesizers={},
t.synthSourceTemplate=("\n\t\t\tvar sampleTime = 1.0 / synth.samplesPerSecond;\n\t\t\tvar effectYMult = +synth.effectYMult;\n\t\t\tvar limitDecay = +synth.limitDecay;\n\t\t\tvar volume = +synth.volume;\n\t\t\tvar delayLineLeft = synth.delayLineLeft;\n\t\t\tvar delayLineRight = synth.delayLineRight;\n\t\t\tvar reverb = Math.pow(song.reverb / beepbox.Config.reverbRange, 0.667) * 0.425;\n\t\t\tvar blend = Math.pow(song.blend / beepbox.Config.blendRange, 0.667) * 0.425;\n\t\t\tvar mix = song.mix;\n\t\t\tvar muff = Math.pow(song.muff / beepbox.Config.muffRange, 0.667) * 0.425;\n\t\t\tvar detune = song.detune;\n\t\t\tvar riff = Math.pow(song.riff / beepbox.Config.riffRange, 0.667) * 0.425; \n\t\t\tvar sineWave = beepbox.Config.sineWave;\n\t\t\t\n\t\t\t// Initialize instruments based on current pattern.\n\t\t\tvar instrumentChannel# = song.getPatternInstrument(#, synth.bar); // ALL\n\t\t\tvar instrument# = song.channels[#].instruments[instrumentChannel#]; // ALL\n\t\t\tvar channel#Wave = (mix <= 1) ? beepbox.Config.waves[instrument#.wave] : beepbox.Config.wavesMixC[instrument#.wave]; // CHIP\n\t\t\tvar channel#Wave = beepbox.Config.getDrumWave(instrument#.wave); // NOISE\n\t\t\tvar channel#WaveLength = channel#Wave.length; // CHIP\n\t\t\tvar channel#Wave = beepbox.Config.pwmwaves[instrument#.wave]; // PWM\n\t\t\tvar channel#WaveLength = channel#Wave.length; // PWM\n\t\t\tvar channel#FilterBase = (song.mix == 2) ? Math.pow(2 - (blend * 2) + (muff * 2), -beepbox.Config.filterBases[instrument#.filter]) : Math.pow(2, -beepbox.Config.filterBases[instrument#.filter] + (blend * 4) - (muff * 4)); // CHIP\n\t\t\tvar channel#TremoloScale = beepbox.Config.effectTremolos[instrument#.effect]; // PITCH\n\t\t\t\n\t\t\twhile (bufferIndex < bufferLength) {\n\t\t\t\t\n\t\t\t\tvar samples;\n\t\t\t\tvar samplesLeftInBuffer = bufferLength - bufferIndex;\n\t\t\t\tif (synth.arpeggioSampleCountdown <= samplesLeftInBuffer) {\n\t\t\t\t\tsamples = synth.arpeggioSampleCountdown;\n\t\t\t\t} else {\n\t\t\t\t\tsamples = samplesLeftInBuffer;\n\t\t\t\t}\n\t\t\t\tsynth.arpeggioSampleCountdown -= samples;\n\t\t\t\t\n\t\t\t\tvar time = synth.part + synth.beat * song.partsPerBeat;\n\t\t\t\t\n\t\t\t\tbeepbox.Synth.computeChannelInstrument(synth, song, #, time, sampleTime, samplesPerArpeggio, samples); // ALL\n\t\t\t\tvar synthChannel# = synth.channels[#]; // ALL\n\t\t\t\t\n\t\t\t\tvar channel#ChorusA = Math.pow(2.0, (beepbox.Config.chorusOffsets[instrument#.chorus] + beepbox.Config.chorusIntervals[instrument#.chorus] + beepbox.Config.octoffValues[instrument#.octoff] + (detune / 24) * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1)) / 12.0); // CHIP\n\t\t\t\tvar channel#ChorusB = Math.pow(2.0, (beepbox.Config.chorusOffsets[instrument#.chorus] - beepbox.Config.chorusIntervals[instrument#.chorus] + beepbox.Config.octoffValues[instrument#.octoff] + (detune / 24) * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1)) / 12.0); // CHIP\n\t\t\t\tvar channel#ChorusSign = synthChannel#.harmonyVolumeMult * (beepbox.Config.chorusSigns[instrument#.chorus]); // CHIP\n\t\t\t\tchannel#ChorusB *= synthChannel#.harmonyMult; // CHIP\n\t\t\t\tvar channel#ChorusDeltaRatio = channel#ChorusB / channel#ChorusA * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1); // CHIP\n\t\t\t\t\n\t\t\t\tvar channel#PhaseDelta = synthChannel#.phaseDeltas[0] * channel#ChorusA * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1); // CHIP\n\t\t\t\tvar channel#PhaseDelta = synthChannel#.phaseDeltas[0] / 32768.0; // NOISE\n\t\t\t\tvar channel#PhaseDeltaScale = synthChannel#.phaseDeltaScale; // ALL\n\t\t\t\tvar channel#Volume = synthChannel#.volumeStarts[0]; // CHIP\n\t\t\t\tvar channel#Volume = synthChannel#.volumeStarts[0]; // NOISE\n\t\t\t\tvar channel#VolumeLeft = synthChannel#.volumeLeft[0]; // ALL\n\t\t\t\tvar channel#VolumeRight = synthChannel#.volumeRight[0]; // ALL\n\t\t\t\tvar channel#VolumeDelta = synthChannel#.volumeDeltas[0]; // CHIP\n\t\t\t\tvar channel#VolumeDelta = synthChannel#.volumeDeltas[0]; // NOISE\n\t\t\t\tvar channel#Filter = synthChannel#.filter * channel#FilterBase; // CHIP\n\t\t\t\tvar channel#Filter = synthChannel#.filter; // NOISE\n\t\t\t\tvar channel#FilterScale = synthChannel#.filterScale; // CHIP\n\t\t\t\tvar channel#VibratoScale = synthChannel#.vibratoScale; // PITCH\n\t\t\t\t\n\t\t\t\tvar effectY     = Math.sin(synth.effectPhase);\n\t\t\t\tvar prevEffectY = Math.sin(synth.effectPhase - synth.effectAngle);\n\t\t\t\t\n\t\t\t\tvar channel#PhaseA = synth.channels[#].phases[0] % 1; // CHIP\n\t\t\t\tvar channel#PhaseB = synth.channels[#].phases[1] % 1; // CHIP\n\t\t\t\tvar channel#Phase  = synth.channels[#].phases[0] % 1; // NOISE\n\t\t\t\t\n\t\t\t\tvar channel#Operator$Phase       = ((synth.channels[#].phases[$] % 1) + "+t.negativePhaseGuard+") * "+a.sineWaveLength+"; // FM\n\t\t\t\tvar channel#Operator$PhaseDelta  = synthChannel#.phaseDeltas[$]; // FM\n\t\t\t\tvar channel#Operator$OutputMult  = synthChannel#.volumeStarts[$]; // FM\n\t\t\t\tvar channel#Operator$OutputDelta = synthChannel#.volumeDeltas[$]; // FM\n\t\t\t\tvar channel#Operator$Output      = synthChannel#.feedbackOutputs[$]; // FM\n\t\t\t\tvar channel#FeedbackMult         = synthChannel#.feedbackMult; // FM\n\t\t\t\tvar channel#FeedbackDelta        = synthChannel#.feedbackDelta; // FM\n\t\t\t\t\n\t\t\t\tvar channel#SampleLeft = +synth.channels[#].sampleLeft; // ALL\n\t\t\t\tvar channel#SampleRight = +synth.channels[#].sampleRight; // ALL\n\t\t\t\t\n\t\t\t\tvar delayPosLeft = 0|synth.delayPosLeft;\n\t\t\t\tvar delayFeedback0Left = +synth.delayFeedback0Left;\n\t\t\t\tvar delayFeedback1Left = +synth.delayFeedback1Left;\n\t\t\t\tvar delayFeedback2Left = +synth.delayFeedback2Left;\n\t\t\t\tvar delayFeedback3Left = +synth.delayFeedback3Left;\n\t\t\t\tvar delayPosRight = 0|synth.delayPosRight;\n\t\t\t\tvar delayFeedback0Right = +synth.delayFeedback0Right;\n\t\t\t\tvar delayFeedback1Right = +synth.delayFeedback1Right;\n\t\t\t\tvar delayFeedback2Right = +synth.delayFeedback2Right;\n\t\t\t\tvar delayFeedback3Right = +synth.delayFeedback3Right;\n\t\t\t\tvar limit = +synth.limit;\n\t\t\t\t\n\t\t\t\twhile (samples) {\n\t\t\t\t\tvar channel#Vibrato = 1.0 + channel#VibratoScale * effectY; // PITCH\n\t\t\t\t\tvar channel#Tremolo = 1.0 + channel#TremoloScale * (effectY - 1.0); // PITCH\n\t\t\t\t\tvar temp = effectY;\n\t\t\t\t\teffectY = effectYMult * effectY - prevEffectY;\n\t\t\t\t\tprevEffectY = temp;\n\t\t\t\t\t\n\t\t\t\t\tchannel#SampleLeft += ((channel#Wave[0|(channel#PhaseA * channel#WaveLength)] + channel#Wave[0|(channel#PhaseB * channel#WaveLength)] * channel#ChorusSign) * channel#Volume * channel#Tremolo - channel#SampleLeft) * channel#Filter * channel#VolumeLeft; // CHIP \n\t\t\t\t\tchannel#SampleLeft += (channel#Wave[0|(channel#Phase * 32768.0)] * channel#Volume - channel#SampleLeft) * channel#Filter * channel#VolumeLeft; // NOISE\n\t\t\t\t\tchannel#SampleRight += ((channel#Wave[0|(channel#PhaseA * channel#WaveLength)] + channel#Wave[0|(channel#PhaseB * channel#WaveLength)] * channel#ChorusSign) * channel#Volume * channel#Tremolo - channel#SampleRight) * channel#Filter * channel#VolumeRight; // CHIP \n\t\t\t\t\tchannel#SampleRight += (channel#Wave[0|(channel#Phase * 32768.0)] * channel#Volume - channel#SampleRight) * channel#Filter * channel#VolumeRight; // NOISE\n\t\t\t\t\tchannel#Volume += channel#VolumeDelta; // CHIP\n\t\t\t\t\tchannel#Volume += channel#VolumeDelta; // NOISE\n\t\t\t\t\tchannel#PhaseA += channel#PhaseDelta * channel#Vibrato; // CHIP\n\t\t\t\t\tchannel#PhaseB += channel#PhaseDelta * channel#Vibrato * channel#ChorusDeltaRatio; // CHIP\n\t\t\t\t\tchannel#Phase += channel#PhaseDelta; // NOISE\n\t\t\t\t\tchannel#Filter *= channel#FilterScale; // CHIP\n\t\t\t\t\tchannel#PhaseA -= 0|channel#PhaseA; // CHIP\n\t\t\t\t\tchannel#PhaseB -= 0|channel#PhaseB; // CHIP\n\t\t\t\t\tchannel#Phase -= 0|channel#Phase; // NOISE\n\t\t\t\t\tchannel#PhaseDelta *= channel#PhaseDeltaScale; // CHIP\n\t\t\t\t\tchannel#PhaseDelta *= channel#PhaseDeltaScale; // NOISE\n\t\t\t\t\t\n\t\t\t\t\t// INSERT OPERATOR COMPUTATION HERE\n\t\t\t\t\tchannel#SampleLeft = channel#Tremolo * (/*channel#Operator$Scaled*/) * channel#VolumeLeft; // CARRIER OUTPUTS\n\t\t\t\t\tchannel#SampleRight = channel#Tremolo * (/*channel#Operator$Scaled*/) * channel#VolumeRight; // CARRIER OUTPUTS\n\t\t\t\t\tchannel#FeedbackMult += channel#FeedbackDelta; // FM\n\t\t\t\t\tchannel#Operator$OutputMult += channel#Operator$OutputDelta; // FM\n\t\t\t\t\tchannel#Operator$Phase += channel#Operator$PhaseDelta * channel#Vibrato; // FM\n\t\t\t\t\tchannel#Operator$PhaseDelta *= channel#PhaseDeltaScale; // FM\n\t\t\t\t\t\n\t\t\t\t\t// Reverb, implemented using a feedback delay network with a Hadamard matrix and lowpass filters.\n\t\t\t\t\t// good ratios:    0.555235 + 0.618033 + 0.818 +   1.0 = 2.991268\n\t\t\t\t\t// Delay lengths:  3041     + 3385     + 4481  +  5477 = 16384 = 2^14\n\t\t\t\t\t// Buffer offsets: 3041    -> 6426   -> 10907 -> 16384\n\t\t\t\t\tvar delayPos1Left = (delayPosLeft +  3041) & 0x3FFF;\n\t\t\t\t\tvar delayPos2Left = (delayPosLeft +  6426) & 0x3FFF;\n\t\t\t\t\tvar delayPos3Left = (delayPosLeft + 10907) & 0x3FFF;\n\t\t\t\t\tvar delaySampleLeft0 = (delayLineLeft[delayPosLeft]\n\t\t\t\t\t\t+ channel#SampleLeft // PITCH\n\t\t\t\t\t);\n\t\t\t\t\tvar delayPos1Right = (delayPosRight +  3041) & 0x3FFF;\n\t\t\t\t\tvar delayPos2Right = (delayPosRight +  6426) & 0x3FFF;\n\t\t\t\t\tvar delayPos3Right = (delayPosRight + 10907) & 0x3FFF;\n\t\t\t\t\tvar delaySampleRight0 = (delayLineRight[delayPosRight]\n\t\t\t\t\t\t+ channel#SampleRight // PITCH\n\t\t\t\t\t);\n\t\t\t\t\tvar delaySampleLeft1 = delayLineLeft[delayPos1Left];\n\t\t\t\t\tvar delaySampleLeft2 = delayLineLeft[delayPos2Left];\n\t\t\t\t\tvar delaySampleLeft3 = delayLineLeft[delayPos3Left];\n\t\t\t\t\tvar delayTemp0Left = -delaySampleLeft0 + delaySampleLeft1;\n\t\t\t\t\tvar delayTemp1Left = -delaySampleLeft0 - delaySampleLeft1;\n\t\t\t\t\tvar delayTemp2Left = -delaySampleLeft2 + delaySampleLeft3;\n\t\t\t\t\tvar delayTemp3Left = -delaySampleLeft2 - delaySampleLeft3;\n\t\t\t\t\tdelayFeedback0Left += ((delayTemp0Left + delayTemp2Left) * reverb - delayFeedback0Left) * 0.5;\n\t\t\t\t\tdelayFeedback1Left += ((delayTemp1Left + delayTemp3Left) * reverb - delayFeedback1Left) * 0.5;\n\t\t\t\t\tdelayFeedback2Left += ((delayTemp0Left - delayTemp2Left) * reverb - delayFeedback2Left) * 0.5;\n\t\t\t\t\tdelayFeedback3Left += ((delayTemp1Left - delayTemp3Left) * reverb - delayFeedback3Left) * 0.5;\n\t\t\t\t\tdelayLineLeft[delayPos1Left] = delayFeedback0Left;\n\t\t\t\t\tdelayLineLeft[delayPos2Left] = delayFeedback1Left;\n\t\t\t\t\tdelayLineLeft[delayPos3Left] = delayFeedback2Left;\n\t\t\t\t\tdelayLineLeft[delayPosLeft ] = delayFeedback3Left;\n\t\t\t\t\tdelayPosLeft = (delayPosLeft + 1) & 0x3FFF;\n\t\t\t\t\t\n\t\t\t\t\tvar delaySampleRight1 = delayLineRight[delayPos1Right];\n\t\t\t\t\tvar delaySampleRight2 = delayLineRight[delayPos2Right];\n\t\t\t\t\tvar delaySampleRight3 = delayLineRight[delayPos3Right];\n\t\t\t\t\tvar delayTemp0Right = -delaySampleRight0 + delaySampleRight1;\n\t\t\t\t\tvar delayTemp1Right = -delaySampleRight0 - delaySampleRight1;\n\t\t\t\t\tvar delayTemp2Right = -delaySampleRight2 + delaySampleRight3;\n\t\t\t\t\tvar delayTemp3Right = -delaySampleRight2 - delaySampleRight3;\n\t\t\t\t\tdelayFeedback0Right += ((delayTemp0Right + delayTemp2Right) * reverb - delayFeedback0Right) * 0.5;\n\t\t\t\t\tdelayFeedback1Right += ((delayTemp1Right + delayTemp3Right) * reverb - delayFeedback1Right) * 0.5;\n\t\t\t\t\tdelayFeedback2Right += ((delayTemp0Right - delayTemp2Right) * reverb - delayFeedback2Right) * 0.5;\n\t\t\t\t\tdelayFeedback3Right += ((delayTemp1Right - delayTemp3Right) * reverb - delayFeedback3Right) * 0.5;\n\t\t\t\t\tdelayLineRight[delayPos1Right] = delayFeedback0Right;\n\t\t\t\t\tdelayLineRight[delayPos2Right] = delayFeedback1Right;\n\t\t\t\t\tdelayLineRight[delayPos3Right] = delayFeedback2Right;\n\t\t\t\t\tdelayLineRight[delayPosRight ] = delayFeedback3Right;\n\t\t\t\t\tdelayPosRight = (delayPosRight + 1) & 0x3FFF;\n\t\t\t\t\t\n\t\t\t\t\tvar sampleLeft = delaySampleLeft0 + delaySampleLeft1 + delaySampleLeft2 + delaySampleLeft3\n\t\t\t\t\t\t+ channel#SampleLeft // NOISE\n\t\t\t\t\t;\n\t\t\t\t\t\n\t\t\t\t\tvar sampleRight = delaySampleRight0 + delaySampleRight1 + delaySampleRight2 + delaySampleRight3\n\t\t\t\t\t\t+ channel#SampleRight // NOISE\n\t\t\t\t\t;\n\t\t\t\t\t\n\t\t\t\t\tvar abs = sampleLeft < 0.0 ? -sampleLeft : sampleLeft;\n\t\t\t\t\tlimit -= limitDecay;\n\t\t\t\t\tif (limit < abs) limit = abs;\n\t\t\t\t\tsampleLeft /= limit * 0.75 + 0.25;\n\t\t\t\t\tsampleLeft *= volume;\n\t\t\t\t\tsampleLeft = sampleLeft;\n\t\t\t\t\tdataLeft[bufferIndex] = sampleLeft;\n\t\t\t\t\tsampleRight /= limit * 0.75 + 0.25;\n\t\t\t\t\tsampleRight *= volume;\n\t\t\t\t\tsampleRight = sampleRight;\n\t\t\t\t\tdataRight[bufferIndex] = sampleRight;\n\t\t\t\t\tbufferIndex++;\n\t\t\t\t\tsamples--;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tsynthChannel#.phases[0] = channel#PhaseA; // CHIP\n\t\t\t\tsynthChannel#.phases[1] = channel#PhaseB; // CHIP\n\t\t\t\tsynthChannel#.phases[0] = channel#Phase; // NOISE\n\t\t\t\tsynthChannel#.phases[$] = channel#Operator$Phase / "+a.sineWaveLength+"; // FM\n\t\t\t\tsynthChannel#.feedbackOutputs[$] = channel#Operator$Output; // FM\n\t\t\t\tsynthChannel#.sampleLeft = channel#SampleLeft; // ALL\n\t\t\t\tsynthChannel#.sampleRight = channel#SampleRight; // ALL\n\t\t\t\t\n\t\t\t\tsynth.delayPosLeft = delayPosLeft;\n\t\t\t\tsynth.delayFeedback0Left = delayFeedback0Left;\n\t\t\t\tsynth.delayFeedback1Left = delayFeedback1Left;\n\t\t\t\tsynth.delayFeedback2Left = delayFeedback2Left;\n\t\t\t\tsynth.delayFeedback3Left = delayFeedback3Left;\n\t\t\t\tsynth.delayPosRight = delayPosRight;\n\t\t\t\tsynth.delayFeedback0Right = delayFeedback0Right;\n\t\t\t\tsynth.delayFeedback1Right = delayFeedback1Right;\n\t\t\t\tsynth.delayFeedback2Right = delayFeedback2Right;\n\t\t\t\tsynth.delayFeedback3Right = delayFeedback3Right;\n\t\t\t\tsynth.limit = limit;\n\t\t\t\t\n\t\t\t\tif (effectYMult * effectY - prevEffectY > prevEffectY) {\n\t\t\t\t\tsynth.effectPhase = Math.asin(effectY);\n\t\t\t\t} else {\n\t\t\t\t\tsynth.effectPhase = Math.PI - Math.asin(effectY);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (synth.arpeggioSampleCountdown == 0) {\n\t\t\t\t\tsynth.arpeggio++;\n\t\t\t\t\tsynth.arpeggioSampleCountdown = samplesPerArpeggio;\n\t\t\t\t\tif (synth.arpeggio == 4) {\n\t\t\t\t\t\tsynth.arpeggio = 0;\n\t\t\t\t\t\tsynth.part++;\n\t\t\t\t\t\tif (synth.part == song.partsPerBeat) {\n\t\t\t\t\t\t\tsynth.part = 0;\n\t\t\t\t\t\t\tsynth.beat++;\n\t\t\t\t\t\t\tif (synth.beat == song.beatsPerBar) {\n\t\t\t\t\t\t\t\t// The bar ended, may need to regenerate synthesizer.\n\t\t\t\t\t\t\t\treturn bufferIndex;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Indicate that the buffer is finished generating.\n\t\t\treturn -1;\n\t\t").split("\n"),t.operatorSourceTemplate=("\n\t\t\t\t\t\tvar channel#Operator$PhaseMix = channel#Operator$Phase/* + channel#Operator@Scaled*/;\n\t\t\t\t\t\tvar channel#Operator$PhaseInt = channel#Operator$PhaseMix|0;\n\t\t\t\t\t\tvar channel#Operator$Index    = channel#Operator$PhaseInt & "+a.sineWaveMask+";\n\t\t\t\t\t\tvar channel#Operator$Sample   = sineWave[channel#Operator$Index];\n\t\t\t\t\t\tchannel#Operator$Output       = channel#Operator$Sample + (sineWave[channel#Operator$Index + 1] - channel#Operator$Sample) * (channel#Operator$PhaseMix - channel#Operator$PhaseInt);\n\t\t\t\t\t\tvar channel#Operator$Scaled   = channel#Operator$OutputMult * channel#Operator$Output;\n\t\t").split("\n"),t}();t.Synth=u}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function t(){this.o=[],this.p=!1}return t.prototype.watch=function(t){-1==this.o.indexOf(t)&&this.o.push(t)},t.prototype.unwatch=function(t){var e=this.o.indexOf(t);-1!=e&&this.o.splice(e,1)},t.prototype.changed=function(){this.p=!0},t.prototype.notifyWatchers=function(){if(this.p){this.p=!1;for(var t=0,e=this.o.concat();t<e.length;t++){(0,e[t])()}}},t}();t.ChangeNotifier=e}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function e(e){var n=this;this.notifier=new t.ChangeNotifier,this.channel=0,this.bar=0,this.volume=75,this.trackVisibleBars=16,this.barScrollPos=0,this.prompt=null,this.q=null,this.r=0,this.s=0,this.t=0,this.u=!1,this.v=!1,this.w=function(){var e=window.history.state;e&&e.sequenceNumber==n.r||(null==e?(n.r++,e={canUndo:!0,sequenceNumber:n.r,bar:n.bar,channel:n.channel,prompt:n.prompt},new t.ChangeSong(n,location.hash),window.history.replaceState(e,"","#"+n.song.toBase64String())):(e.sequenceNumber==n.r-1?(n.bar=n.s,n.channel=n.t):e.sequenceNumber!=n.r&&(n.bar=e.bar,n.channel=e.channel),n.r=e.sequenceNumber,n.prompt=e.prompt,new t.ChangeSong(n,location.hash)),n.s=e.bar,n.t=e.channel,n.forgetLastChange(),n.notifier.notifyWatchers())},this.z=function(){n.notifier.notifyWatchers()},this.H=function(){n.v=!1;var t,e="#"+n.song.toBase64String();n.u?(n.r++,t={canUndo:!0,sequenceNumber:n.r,bar:n.bar,channel:n.channel,prompt:n.prompt},window.history.pushState(t,"",e)):(t={canUndo:!0,sequenceNumber:n.r,bar:n.bar,channel:n.channel,prompt:n.prompt},window.history.replaceState(t,"",e)),n.s=t.bar,n.t=t.channel,n.u=!1},this.song=new t.Song(e),this.synth=new t.Synth(this.song),this.autoPlay="true"==localStorage.getItem("autoPlay"),this.autoFollow="true"==localStorage.getItem("autoFollow"),this.showFifth="true"==localStorage.getItem("showFifth"),this.showMore="true"==localStorage.getItem("showMore"),this.showLetters="true"==localStorage.getItem("showLetters"),this.showChannels="true"==localStorage.getItem("showChannels"),this.showScrollBar="true"==localStorage.getItem("showScrollBar"),this.showVolumeBar="true"==localStorage.getItem("showVolumeBar"),this.advancedSettings="false"!=localStorage.getItem("advancedSettings"),null!=localStorage.getItem("volume")&&(this.volume=Number(localStorage.getItem("volume"))),this.synth.volume=this.I();var a=window.history.state;null==a&&(a={canUndo:!1,sequenceNumber:0,bar:0,channel:0,prompt:null},window.history.replaceState(a,"","#"+this.song.toBase64String())),window.addEventListener("hashchange",this.w),window.addEventListener("popstate",this.w),this.bar=a.bar,this.channel=a.channel,this.s=a.bar,this.t=a.channel,this.barScrollPos=Math.max(0,this.bar-(this.trackVisibleBars-6)),this.prompt=a.prompt;for(var i=0,s=["input","change","click","keyup","keydown","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"];i<s.length;i++){var r=s[i];window.addEventListener(r,this.z)}}return e.prototype.record=function(t,e){void 0===e&&(e=!1),t.isNoop()?(this.q=null,e&&window.history.back()):(this.q=t,e||(this.u=!0),this.v||(window.requestAnimationFrame(this.H),this.v=!0))},e.prototype.openPrompt=function(t){this.prompt=t;var e="#"+this.song.toBase64String();this.r++;var n={canUndo:!0,sequenceNumber:this.r,bar:this.bar,channel:this.channel,prompt:this.prompt};window.history.pushState(n,"",e)},e.prototype.undo=function(){window.history.state.canUndo&&window.history.back()},e.prototype.redo=function(){window.history.forward()},e.prototype.setProspectiveChange=function(t){this.q=t},e.prototype.forgetLastChange=function(){this.q=null},e.prototype.lastChangeWas=function(t){return null!=t&&t==this.q},e.prototype.savePreferences=function(){localStorage.setItem("autoPlay",this.autoPlay?"true":"false"),localStorage.setItem("autoFollow",this.autoFollow?"true":"false"),localStorage.setItem("showFifth",this.showFifth?"true":"false"),localStorage.setItem("showMore",this.showMore?"true":"false"),localStorage.setItem("showLetters",this.showLetters?"true":"false"),localStorage.setItem("showChannels",this.showChannels?"true":"false"),localStorage.setItem("showScrollBar",this.showScrollBar?"true":"false"),localStorage.setItem("showVolumeBar",this.showVolumeBar?"true":"false"),localStorage.setItem("advancedSettings",this.advancedSettings?"true":"false"),localStorage.setItem("volume",String(this.volume))},e.prototype.setVolume=function(t){this.volume=t,this.savePreferences(),this.synth.volume=this.I()},e.prototype.I=function(){return Math.min(1,Math.pow(this.volume/50,.5))*Math.pow(2,(this.volume-75)/25)},e.prototype.getCurrentPattern=function(){return this.song.getPattern(this.channel,this.bar)},e.prototype.getCurrentInstrument=function(){var t=this.getCurrentPattern();return null==t?0:t.instrument},e.j=2,e}();t.SongDocument=e}(beepbox||(beepbox={}));var beepbox;!function(t){function e(t,e,a){var i=document.createElementNS(n,t);if(e)for(var s=0,r=Object.keys(e);s<r.length;s++){var o=r[s];i.setAttribute(o,e[o])}if(a)for(var h=0,l=a;h<l.length;h++){var c=l[h];i.appendChild(c)}return i}!function(t){function e(t,e,n){var a=document.createElement(t);if(e)for(var i=0,s=Object.keys(e);i<s.length;i++){var r=s[i];"style"==r?a.setAttribute(r,e[r]):a[r]=e[r]}if(n)for(var o=0,h=n;o<h.length;o++){var l=h[o];a.appendChild(l)}return a}function n(t,n){return e("button",t,n)}function a(t,n){return e("div",t,n)}function i(t,n){return e("span",t,n)}function s(t,n){return e("select",t,n)}function r(t,e,n,a){void 0===n&&(n=!1),void 0===a&&(a=!1);var i=document.createElement("option");return i.value=t,i.selected=n,i.disabled=a,i.appendChild(c(e)),i}function o(t){return e("canvas",t)}function h(t){return e("input",t)}function l(){return e("br")}function c(t){return document.createTextNode(t)}t.element=e,t.button=n,t.div=a,t.span=i,t.select=s,t.option=r,t.canvas=o,t.input=h,t.br=l,t.text=c}(t.html||(t.html={}));var n="http://www.w3.org/2000/svg";t.svgElement=e}(beepbox||(beepbox={}));var beepbox;!function(t){var e=document.createElement("style");e.type="text/css",
e.appendChild(document.createTextNode('\n.beepboxEditor {\n\tdisplay: flex;\n\t-webkit-touch-callout: none;\n\t-webkit-user-select: none;\n\t-khtml-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n\tposition: relative;\n\ttouch-action: manipulation;\n\tcursor: default;\n\tfont-size: small;\n\toverflow: hidden;\n}\n\n.beepboxEditor div {\n\tmargin: 0;\n\tpadding: 0;\n}\n\n.beepboxEditor .promptContainer {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: rgba(0,0,0,0.5);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.beepboxEditor .prompt {\n\tmargin: auto;\n\ttext-align: center;\n\tbackground: #000;\n\tborder-radius: 15px;\n\tborder: 4px solid #444;\n\tcolor: #fff;\n\tpadding: 20px;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .prompt > *:not(:first-child) {\n\tmargin-top: 1.5em;\n}\n\n/* Use psuedo-elements to add cross-browser up & down arrows to select elements: */\n.beepboxEditor .selectContainer {\n\tposition: relative;\n}\n.beepboxEditor .selectContainer:not(.menu)::before {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.3em;\n\ttop: 0.4em;\n\tborder-bottom: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor .selectContainer:not(.menu)::after {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.3em;\n\tbottom: 0.4em;\n\tborder-top: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor .selectContainer.menu::after {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.7em;\n\tmargin: auto;\n\ttop: 0;\n\tbottom: 0;\n\theight: 0;\n\tborder-top: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor select {\n\tmargin: 0;\n\tpadding: 0 0.3em;\n\tdisplay: block;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: #363636;\n\tcolor: inherit;\n\tfont-size: inherit;\n\tcursor: pointer;\n\tfont-family: inherit;\n\n\t-webkit-appearance:none;\n\t-moz-appearance: none;\n\tappearance: none;\n}\n.beepboxEditor .menu select {\n\tpadding: 0 2em;\n}\n.beepboxEditor select:focus {\n\tbackground: #565656;\n\toutline: none;\n}\n.beepboxEditor .menu select {\n\ttext-align: center;\n\ttext-align-last: center;\n}\n\n/* This makes it look better in firefox on my computer... What about others?\n@-moz-document url-prefix() {\n\t.beepboxEditor select { padding: 0 2px; }\n}\n*/\n.beepboxEditor button {\n\tmargin: 0;\n\tposition: relative;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: #363636;\n\tcolor: inherit;\n\tfont-size: inherit;\n\tfont-family: inherit;\n\tcursor: pointer;\n}\n.beepboxEditor button:focus {\n\tbackground: #565656;\n\toutline: none;\n}\n.beepboxEditor button.playButton, .beepboxEditor button.pauseButton {\n\tpadding-left: 2em;\n}\n.beepboxEditor button.playButton::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 0.7em;\n\ttop: 50%;\n\tmargin-top: -0.65em;\n\tborder-left: 1em solid currentColor;\n\tborder-top: 0.65em solid transparent;\n\tborder-bottom: 0.65em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor button.pauseButton::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 0.7em;\n\ttop: 50%;\n\tmargin-top: -0.65em;\n\twidth: 0.3em;\n\theight: 1.3em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n.beepboxEditor button.pauseButton::after {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 1.4em;\n\ttop: 50%;\n\tmargin-top: -0.65em;\n\twidth: 0.3em;\n\theight: 1.3em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n\n.beepboxEditor button.prevBarButton::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -0.5em;\n\tmargin-top: -0.5em;\n\twidth: 0.2em;\n\theight: 1em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n.beepboxEditor button.prevBarButton::after {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -0.3em;\n\tmargin-top: -0.5em;\n\tborder-right: 0.8em solid currentColor;\n\tborder-top: 0.5em solid transparent;\n\tborder-bottom: 0.5em solid transparent;\n\tpointer-events: none;\n}\n\n.beepboxEditor button.nextBarButton::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -0.5em;\n\tmargin-top: -0.5em;\n\tborder-left: 0.8em solid currentColor;\n\tborder-top: 0.5em solid transparent;\n\tborder-bottom: 0.5em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor button.nextBarButton::after {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: 0.3em;\n\tmargin-top: -0.5em;\n\twidth: 0.2em;\n\theight: 1em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n\n.beepboxEditor canvas {\n\toverflow: hidden;\n\tposition: absolute;\n\tdisplay: block;\n}\n\n.beepboxEditor .trackContainer {\n\toverflow-x: hidden;\n}\n\n.beepboxEditor .selectRow {\n\tmargin: 0;\n\theight: 2.5em;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n.beepboxEditor .selectRow > span {\n\tcolor: #999;\n}\n\n.beepboxEditor .operatorRow {\n\tmargin: 0;\n\theight: 2.5em;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n}\n\n.beepboxEditor .operatorRow > * {\n\tflex-grow: 1;\n\tflex-shrink: 1;\n}\n\n.beepboxEditor .editor-widget-column {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-widgets {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-menus {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-song-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-instrument-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n.beepboxEditor .editor-right-widget-column {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-menus {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-song-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-instrument-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-side-top > *, .beepboxEditor .editor-right-side-bottom > * {\n\tflex-shrink: 0;\n}\n\n.beepboxEditor input[type=text], .beepboxEditor input[type=number] {\n\tfont-size: inherit;\n\tbackground: transparent;\n\tborder: 1px solid #777;\n\tcolor: white;\n}\n\n.beepboxEditor input[type=checkbox] {\n  transform: scale(1.5);\n}\n\n.beepboxEditor input[type=range] {\n\t-webkit-appearance: none;\n\tcolor: inherit;\n\twidth: 100%;\n\theight: 2em;\n\tfont-size: inherit;\n\tmargin: 0;\n\tcursor: pointer;\n\tbackground-color: #1a0a24;\n\ttouch-action: pan-y;\n}\n.beepboxEditor input[type=range]:focus {\n\toutline: none;\n}\n.beepboxEditor input[type=range]::-webkit-slider-runnable-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: #363636;\n}\n.beepboxEditor input[type=range]::-webkit-slider-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tbackground: currentColor;\n\tcursor: pointer;\n\t-webkit-appearance: none;\n\tmargin-top: -0.75em;\n}\n.beepboxEditor input[type=range]:focus::-webkit-slider-runnable-track {\n\tbackground: #565656;\n}\n.beepboxEditor input[type=range]::-moz-range-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: #363636;\n}\n.beepboxEditor input[type=range]:focus::-moz-range-track {\n\tbackground: #565656;\n}\n.beepboxEditor input[type=range]::-moz-range-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tborder: none;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n.beepboxEditor input[type=range]::-ms-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: #363636;\n\tborder-color: transparent;\n}\n.beepboxEditor input[type=range]:focus::-ms-track {\n\tbackground: #565656;\n}\n.beepboxEditor input[type=range]::-ms-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n.beepboxEditor .hintButton {\n\tborder: 1px solid currentColor;\n\tborder-radius: 50%;\n\ttext-decoration: none;\n\twidth: 1em;\n\theight: 1em;\n\ttext-align: center;\n\tmargin-left: auto;\n\tmargin-right: .4em;\n\tcursor: pointer;\n}\n\n/* wide screen */\n@media (min-width: 501px) {\n\t#beepboxEditorContainer {\n\t\tdisplay: table;\n\t}\n\t.beepboxEditor {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: 3px solid #555;\n\t}\n\t.beepboxEditor .trackContainer {\n\t\twidth: 512px;\n\t}\n\t.beepboxEditor .trackSelectBox {\n\t\tdisplay: none;\n\t}\n\t.beepboxEditor .playback-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: .2em 0;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: .2em 0;\n\t\talign-items: center;\n\t}\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\n\t\tflex-grow: 1;\n\t\tmargin-left: 10px;\n\t}\n\t.beepboxEditor .editor-widget-column {\n\t\tmargin-left: 6px;\n\t\twidth: 14em;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .editor-right-widget-column {\n\t\tmargin-left: 6px;\n\t\twidth: 14em;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .editor-widgets {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .editor-right-widgets {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .editor-settings input, .beepboxEditor .editor-settings select {\n\t\twidth: 8.6em;\n\t}\n\t.beepboxEditor .editor-right-settings input, .beepboxEditor .editor-right-settings select {\n\t\twidth: 8.6em;\n\t}\n\t.beepboxEditor .editor-menus > * {\n\t\tflex-grow: 1;\n\t\tmargin: .2em 0;\n\t}\n\t.beepboxEditor .editor-right-menus > * {\n\t\tflex-grow: 1;\n\t\tmargin: .2em 0;\n\t}\n\t.beepboxEditor .editor-menus > button {\n\t\tpadding: 0 2em;\n\t\twhite-space: nowrap;\n\t}\n\t.beepboxEditor .editor-right-menus > button {\n\t\tpadding: 0 2em;\n\t\twhite-space: nowrap;\n\t}\n}\n\n/* narrow screen */\n@media (max-width: 500px) {\n\t.beepboxEditor {\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: none;\n\t}\n\t.beepboxEditor .editorBox {\n\t\tmax-height: 75vh;\n\t}\n\t.beepboxEditor .editor-menus {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor .editor-right-menus {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor .editor-menus > * {\n\t\tflex-grow: 1;\n\t\tmargin: .10em;\n\t}\n\t.beepboxEditor .editor-right-menus > * {\n\t\tflex-grow: 1;\n\t\tmargin: .2em;\n\t}\n\t.beepboxEditor .editor-menus > button {\n\t\tpadding-left: 2em;\n\t\twhite-space: nowrap;\n\t}\n\t.beepboxEditor .editor-right-menus > button {\n\t\tpadding-left: 2em;\n\t\twhite-space: nowrap;\n\t}\n\t.beepboxEditor .trackContainer {\n\t\toverflow-x: auto;\n\t}\n\t.beepboxEditor .barScrollBar {\n\t\tdisplay: none;\n\t}\n\t.beepboxEditor .playback-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: .2em 0;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tflex-grow: 1;\n\t\tmargin: 0 .2em;\n\t}\n\t.beepboxEditor .editor-widget-column {\n\t\tflex-direction: column-reverse;\n\t}\n\t.beepboxEditor .editor-settings {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor .editor-right-widget-column {\n\t\tflex-direction: column-reverse;\n\t}\n\t.beepboxEditor .editor-right-settings {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton,\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\n\t\tflex-grow: 1;\n\t\tmargin: 0 .2em;\n\t}\n\t.beepboxEditor .editor-song-settings, .beepboxEditor .editor-instrument-settings {\n\t\tflex-grow: 1;\n\t\tmargin: 0 .2em;\n\t}\n\t.beepboxEditor .editor-right-song-settings, .beepboxEditor .editor-right-instrument-settings {\n\t\tflex-grow: 1;\n\t\tmargin: 0 .2em;\n\t}\n\t.beepboxEditor .editor-settings input, .beepboxEditor .editor-settings .selectContainer {\n\t\twidth: 60%;\n\t}\n\t.beepboxEditor .editor-right-settings input, .beepboxEditor .editor-right-settings .selectContainer {\n\t\twidth: 60%;\n\t}\n\t.beepboxEditor .editor-settings select {\n\t\twidth: 100%;\n\t}\n\t.beepboxEditor .editor-right-settings select {\n\t\twidth: 100%;\n\t}\n\t.fullWidthOnly {\n\t\tdisplay: none;\n\t}\n\tp {\n\t\tmargin: 1em 0.5em;\n\t}\n}\n')),document.head.appendChild(e)}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function t(){this.J=!0}return t.prototype.K=function(){this.J=!1},t.prototype.isNoop=function(){return this.J},t}();t.Change=e;var n=function(t){function e(e){var n=t.call(this)||this;return n.L=e,n.M=!e,n}return __extends(e,t),e.prototype.undo=function(){this.L?(this.N(),this.M=!0):(this.O(),this.M=!1)},e.prototype.redo=function(){this.L?(this.O(),this.M=!1):(this.N(),this.M=!0)},e.prototype.P=function(){return this.M},e.prototype.N=function(){throw new Error("Change.doForwards(): Override me.")},e.prototype.O=function(){throw new Error("Change.doBackwards(): Override me.")},e}(e);t.UndoableChange=n;var a=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.append=function(t){t.isNoop()||this.K()},e}(e);t.ChangeGroup=a;var i=function(t){function e(e){var n=t.call(this,!1)||this;return n.Q=void 0==e?[]:e.concat(),n}return __extends(e,t),e.prototype.append=function(t){t.isNoop()||(this.Q[this.Q.length]=t,this.K())},e.prototype.N=function(){for(var t=0;t<this.Q.length;t++)this.Q[t].redo()},e.prototype.O=function(){for(var t=this.Q.length-1;t>=0;t--)this.Q[t].undo()},e}(n);t.ChangeSequence=i}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(t){function e(e,n){var a=t.call(this,!1)||this;return a.R=e,a.S=n,a.T=a.S.start,a.U=a.S.end,a.V=a.S.start,a.W=a.S.end,a.X=a.S.pins,a.Y=[],a.Z=a.S.pitches,a.$=[],a}return __extends(e,t),e.prototype._=function(){for(var t=0;t<this.Y.length-1;)this.Y[t].time>=this.Y[t+1].time?this.Y.splice(t,1):t++;for(var t=1;t<this.Y.length-1;)this.Y[t-1].interval==this.Y[t].interval&&this.Y[t].interval==this.Y[t+1].interval&&this.Y[t-1].volume==this.Y[t].volume&&this.Y[t].volume==this.Y[t+1].volume?this.Y.splice(t,1):t++;for(var e=this.Y[0].interval,n=this.Y[0].time,t=0;t<this.Z.length;t++)this.$[t]=this.Z[t]+e;for(var t=0;t<this.Y.length;t++)this.Y[t].interval-=e,this.Y[t].time-=n;this.V=this.T+n,this.W=this.V+this.Y[this.Y.length-1].time,this.N(),this.K()},e.prototype.N=function(){this.S.pins=this.Y,this.S.pitches=this.$,this.S.start=this.V,this.S.end=this.W,this.R.notifier.changed()},e.prototype.O=function(){this.S.pins=this.X,this.S.pitches=this.Z,this.S.start=this.T,this.S.end=this.U,this.R.notifier.changed()},e}(t.UndoableChange);t.ChangePins=e;var n=function(e){function n(n,a){var i=e.call(this)||this;if(n.song.channels[n.channel].instruments[n.getCurrentInstrument()].type!=a){if(n.song.channels[n.channel].instruments[n.getCurrentInstrument()].type=a,0==a){var s=n.song.channels[n.channel].instruments[n.getCurrentInstrument()];s.wave=Math.max(0,Math.min(t.Config.waves.length-1,s.wave))}else if(3==a){var s=n.song.channels[n.channel].instruments[n.getCurrentInstrument()];s.wave=Math.max(0,Math.min(t.Config.pwmwaves.length-1,s.wave))}n.notifier.changed(),i.K()}return i}return __extends(n,e),n}(t.Change);t.ChangeInstrumentType=n;var a=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].transition!=n&&(a.K(),e.song.channels[e.channel].instruments[e.getCurrentInstrument()].transition=n,e.notifier.changed()),a}return __extends(e,t),e}(t.Change);t.ChangeTransition=a;var i=function(t){function e(e,n,a){var i=t.call(this)||this;if(i.oldValue=n,a>e.song.patternsPerChannel)throw new Error("invalid pattern");return e.song.channels[e.channel].bars[e.bar]=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangePattern=i;var s=function(t){function e(e,n){var a=t.call(this)||this;if(e.song.barCount!=n){for(var i=0;i<e.song.getChannelCount();i++){for(var s=e.song.barCount;s<n;s++)e.song.channels[i].bars[s]=1;e.song.channels[i].bars.length=n}var r=e.bar,o=e.barScrollPos,h=e.song.loopStart,l=e.song.loopLength;e.song.barCount>n&&(r=Math.min(r,n-1),o=Math.max(0,Math.min(n-e.trackVisibleBars,o)),l=Math.min(n,l),h=Math.min(n-l,h)),e.bar=r,e.barScrollPos=o,e.song.loopStart=h,e.song.loopLength=l,e.song.barCount=n,e.notifier.changed(),a.K()}return a}return __extends(e,t),e}(t.Change);t.ChangeBarCount=s;var r=function(e){function n(n,a,i){var s=e.call(this)||this;if(n.song.pitchChannelCount!=a||n.song.drumChannelCount!=i){for(var r=[],o=0;o<a;o++){var h=o,l=o;if(o<n.song.pitchChannelCount)r[h]=n.song.channels[l];else{r[h]=new t.Channel,r[h].octave=2;for(var c=0;c<n.song.instrumentsPerChannel;c++)r[h].instruments[c]=new t.Instrument;for(var c=0;c<n.song.patternsPerChannel;c++)r[h].patterns[c]=new t.Pattern;for(var c=0;c<n.song.barCount;c++)r[h].bars[c]=1}}for(var o=0;o<i;o++){var h=o+a,l=o+n.song.pitchChannelCount;if(o<n.song.drumChannelCount)r[h]=n.song.channels[l];else{r[h]=new t.Channel,r[h].octave=0;for(var c=0;c<n.song.instrumentsPerChannel;c++)r[h].instruments[c]=new t.Instrument;for(var c=0;c<n.song.patternsPerChannel;c++)r[h].patterns[c]=new t.Pattern;for(var c=0;c<n.song.barCount;c++)r[h].bars[c]=1}}n.song.pitchChannelCount=a,n.song.drumChannelCount=i;for(var h=0;h<n.song.getChannelCount();h++)n.song.channels[h]=r[h];n.song.channels.length=n.song.getChannelCount(),n.channel=Math.min(n.channel,a+i-1),n.notifier.changed(),s.K()}return s}return __extends(n,e),n}(t.Change);t.ChangeChannelCount=r;var o=function(e){function n(n,a){var i=e.call(this)||this;if(n.song.beatsPerBar!=a){if(n.song.beatsPerBar>a)for(var s=new t.ChangeSequence,r=0;r<n.song.getChannelCount();r++)for(var o=0;o<n.song.channels[r].patterns.length;o++)s.append(new _(n,n.song.channels[r].patterns[o],a*n.song.partsPerBeat,n.song.beatsPerBar*n.song.partsPerBeat));n.song.beatsPerBar=a,n.notifier.changed(),i.K()}return i}return __extends(n,e),n}(t.Change);t.ChangeBeatsPerBar=o;var h=function(t){function e(e,n,a){var i=t.call(this)||this,s=e.channel,r=e.bar;return e.channel=n,e.bar=a,e.barScrollPos=Math.min(e.bar,Math.max(e.bar-(e.trackVisibleBars-1),e.barScrollPos)),e.notifier.changed(),s==n&&r==a||i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeChannelBar=h;var l=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].chorus!=n&&(a.K(),e.song.channels[e.channel].instruments[e.getCurrentInstrument()].chorus=n,e.notifier.changed()),a}return __extends(e,t),e}(t.Change);t.ChangeChorus=l;var c=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].effect!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].effect=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeEffect=c;var f=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].harm!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].harm=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeHarm=f;var u=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].fmChorus!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].fmChorus=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeFMChorus=u;var p=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].octoff!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].octoff=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeOctoff=p;var d=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].imute!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].imute=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeImute=d;var m=function(t){function e(e,n,a,i){var s=t.call(this)||this;return(e.song.channels[n].instruments[a].imute=i)!=i&&(e.song.channels[n].instruments[a].imute=i,e.notifier.changed(),s.K()),s}return __extends(e,t),e}(t.Change);t.ChangeOtherImute=m;var g=function(t){function e(e,n,a){var i=t.call(this)||this;return n!=a&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].ipan=a,e.notifier.changed(),i.K()),i}return __extends(e,t),e}(t.Change);t.ChangeIpan=g;var b=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].filter!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].filter=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeFilter=b;var v=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].algorithm!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].algorithm=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeAlgorithm=v;var C=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].feedbackType!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].feedbackType=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeFeedbackType=C;var y=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].feedbackEnvelope!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].feedbackEnvelope=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeFeedbackEnvelope=y;var R=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].operators[n].envelope!=a&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].operators[n].envelope=a,e.notifier.changed(),i.K()),i}return __extends(e,t),e}(t.Change);t.ChangeOperatorEnvelope=R;var w=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].operators[n].frequency!=a&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].operators[n].frequency=a,e.notifier.changed(),i.K()),i}return __extends(e,t),e}(t.Change);t.ChangeOperatorFrequency=w;var x=function(t){function e(e,n,a,i){var s=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].operators[n].amplitude=i,e.notifier.changed(),a!=i&&s.K(),s}return __extends(e,t),e}(t.Change);t.ChangeOperatorAmplitude=x;var P=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].feedbackAmplitude=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeFeedbackAmplitude=P;var N=function(e){function n(n,a){var i=e.call(this)||this;if(n.song.instrumentsPerChannel!=a){for(var s=0;s<n.song.getChannelCount();s++){for(var r=n.song.channels[s].instruments[n.song.instrumentsPerChannel-1],o=n.song.instrumentsPerChannel;o<a;o++){var h=new t.Instrument;h.copy(r),n.song.channels[s].instruments[o]=h}n.song.channels[s].instruments.length=a;for(var o=0;o<n.song.patternsPerChannel;o++)n.song.channels[s].patterns[o].instrument>=a&&(n.song.channels[s].patterns[o].instrument=0)}n.song.instrumentsPerChannel=a,n.notifier.changed(),i.K()}return i}return __extends(n,e),n}(t.Change);t.ChangeInstrumentsPerChannel=N;var L=function(t){function e(e,n){var a=t.call(this)||this;return e.song.key!=n&&(e.song.key=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeKey=L;var k=function(t){function e(e,n){var a=t.call(this)||this;return e.song.theme!=n&&(e.song.theme=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeTheme=k;var A=function(t){function e(e,n,a,i,s){var r=t.call(this)||this;return r.R=e,r.oldStart=n,r.oldLength=a,r.newStart=i,r.newLength=s,r.R.song.loopStart=r.newStart,r.R.song.loopLength=r.newLength,r.R.notifier.changed(),r.oldStart==r.newStart&&r.oldLength==r.newLength||r.K(),r}return __extends(e,t),e}(t.Change);t.ChangeLoop=A;var M=function(t){function e(e,n,a,i,s){void 0===s&&(s=!1);var r=t.call(this,s)||this;return r.R=e,r.S=n,r.aa=a,r.ba=i,r.K(),r.redo(),r}return __extends(e,t),e.prototype.N=function(){this.S.pitches.splice(this.ba,0,this.aa),this.R.notifier.changed()},e.prototype.O=function(){this.S.pitches.splice(this.ba,1),this.R.notifier.changed()},e}(t.UndoableChange);t.ChangePitchAdded=M;var E=function(t){function e(e,n,a){var i=t.call(this)||this;return i.oldValue=n,e.song.channels[e.channel].octave=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeOctave=E;var S=function(t){function e(e,n){var a=t.call(this)||this;if(e.song.partsPerBeat!=n){for(var i=0;i<e.song.getChannelCount();i++)for(var s=0;s<e.song.channels[i].patterns.length;s++)a.append(new O(e,e.song.channels[i].patterns[s],e.song.partsPerBeat,n));e.song.partsPerBeat=n,e.notifier.changed(),a.K()}return a}return __extends(e,t),e}(t.ChangeGroup);t.ChangePartsPerBeat=S;var B=function(t){function e(e,n,a,i,s){var r=t.call(this)||this;return n.notes=a,e.song.partsPerBeat!=s&&r.append(new O(e,n,s,e.song.partsPerBeat)),e.song.beatsPerBar!=i&&r.append(new _(e,n,e.song.beatsPerBar*e.song.partsPerBeat,i*e.song.partsPerBeat)),e.notifier.changed(),r.K(),r}return __extends(e,t),e}(t.ChangeGroup);t.ChangePaste=B;var I=function(t){function e(e,n,a){var i=t.call(this)||this;return a.instrument!=n&&(a.instrument=n,e.notifier.changed(),i.K()),i}return __extends(e,t),e}(t.Change);t.ChangePatternInstrument=I;var F=function(e){function n(n,a){var i=e.call(this)||this;if(n.song.patternsPerChannel!=a){for(var s=0;s<n.song.getChannelCount();s++){for(var r=n.song.channels[s].bars,o=n.song.channels[s].patterns,h=0;h<r.length;h++)r[h]>a&&(r[h]=0);for(var h=o.length;h<a;h++)o[h]=new t.Pattern;o.length=a}n.song.patternsPerChannel=a,n.notifier.changed(),i.K()}return i}return __extends(n,e),n}(t.Change);t.ChangePatternsPerChannel=F;var D=function(e){function n(n,a,i,s){var r=e.call(this,n,a)||this;s-=r.T;for(var o=r.X[i].time,h=Math.min(o,s),l=Math.max(o,s),c=!1,f=0;f<r.X.length;f++){var u=a.pins[f],p=u.time;p<h?r.Y.push(t.makeNotePin(u.interval,p,u.volume)):p>l&&(c||(r.Y.push(t.makeNotePin(r.X[i].interval,s,r.X[i].volume)),c=!0),r.Y.push(t.makeNotePin(u.interval,p,u.volume)))}return c||r.Y.push(t.makeNotePin(r.X[i].interval,s,r.X[i].volume)),r._(),r}return __extends(n,e),n}(e);t.ChangePinTime=D;var T=function(e){function n(n,a,i,s,r,o){var h=e.call(this,n,a)||this;i-=h.T,s-=h.T,r-=a.pitches[o];var l,c,f,u,p=!1,d=!1,m=0,g=3,b=!0;for(s>i?(l=0,c=1,f=a.pins.length,u=function(t){h.Y.push(t)}):(l=a.pins.length-1,c=-1,f=-1,u=function(t){h.Y.unshift(t)});l!=f;l+=c)for(var v=a.pins[l],C=v.time;;)if(p){if(d){if(C*c==s*c)break;v.interval!=m&&(b=!1),u(t.makeNotePin(b?r:v.interval,C,v.volume));break}if(C*c<=s*c&&(m=v.interval,g=v.volume),C*c<s*c)break;u(t.makeNotePin(r,s,g)),d=!0}else{if(C*c<=i*c&&(m=v.interval,g=v.volume),C*c<i*c){u(t.makeNotePin(v.interval,C,v.volume));break}u(t.makeNotePin(m,i,g)),p=!0}return d||u(t.makeNotePin(r,s,g)),h._(),h}return __extends(n,e),n}(e);t.ChangePitchBend=T;var O=function(t){function e(e,n,a,i){var s,r=t.call(this)||this;if(a>i)s=function(t){return Math.ceil(t*i/a)};else{if(!(a<i))throw new Error("ChangeRhythm couldn't handle rhythm change from "+a+" to "+i+".");s=function(t){return Math.floor(t*i/a)}}for(var o=0;o<n.notes.length;){var h=n.notes[o];s(h.start)>=s(h.end)?r.append(new J(e,n,h,o,!0)):(r.append(new V(e,h,s)),o++)}return r}return __extends(e,t),e}(t.ChangeSequence);t.ChangeRhythm=O;var V=function(e){function n(n,a,i){for(var s=e.call(this,n,a)||this,r=0,o=s.X;r<o.length;r++){var h=o[r];s.Y.push(t.makeNotePin(h.interval,i(h.time+s.T)-s.T,h.volume))}return s._(),s}return __extends(n,e),n}(e);t.ChangeRhythmNote=V;var H=function(t){function e(e,n){var a=t.call(this)||this;return e.song.scale!=n&&(e.song.scale=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeScale=H;var Y=function(t){function e(e,n){var a=t.call(this)||this;return e.song.mix!=n&&(e.song.mix=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeMix=Y;var j=function(t){function e(e,n){var a=t.call(this)||this;return e.song.sampleRate!=n&&(e.song.sampleRate=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeSampleRate=j;var U=function(t){function e(e,n){var a=t.call(this)||this;return e.song.fromBase64String(n),e.channel=Math.min(e.channel,e.song.getChannelCount()-1),e.bar=Math.max(0,Math.min(e.song.barCount-1,e.bar)),e.barScrollPos=Math.max(0,Math.min(e.song.barCount-e.trackVisibleBars,e.barScrollPos)),e.barScrollPos=Math.min(e.bar,Math.max(e.bar-(e.trackVisibleBars-1),e.barScrollPos)),e.notifier.changed(),a.K(),a}return __extends(e,t),e}(t.Change);t.ChangeSong=U;var W=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.tempo=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeTempo=W;var z=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.reverb=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeReverb=z;var Z=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.blend=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeBlend=Z;var G=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.riff=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeRiff=G;var q=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.detune=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeDetune=q;var X=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.muff=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeMuff=X;var J=function(t){function e(e,n,a,i,s){void 0===s&&(s=!1);var r=t.call(this,s)||this;return r.R=e,r.ca=n,r.S=a,r.ba=i,r.K(),r.redo(),r}return __extends(e,t),e.prototype.N=function(){this.ca.notes.splice(this.ba,0,this.S),this.R.notifier.changed()},e.prototype.O=function(){this.ca.notes.splice(this.ba,1),this.R.notifier.changed()},e}(t.UndoableChange);t.ChangeNoteAdded=J;var K=function(e){function n(n,a,i,s){var r=e.call(this,n,a)||this;i-=r.T,s-=r.T;var o,h=!1,l=r.X[0].volume,c=r.X[0].interval,f=!0;for(o=0;o<r.X.length;o++){var u=r.X[o];if(u.time<i)l=u.volume,c=u.interval;else{if(!(u.time<=s))break;if(u.time>i&&!h&&r.Y.push(t.makeNotePin(c,i,l)),r.Y.push(t.makeNotePin(u.interval,u.time,u.volume)),h=!0,u.time==s){f=!1;break}}}return f&&r.Y.push(t.makeNotePin(r.X[o].interval,s,r.X[o].volume)),r._(),r}return __extends(n,e),n}(e);t.ChangeNoteLength=K;var _=function(t){function e(e,n,a,i,s){for(var r=t.call(this)||this,o=0;o<n.notes.length;){var h=n.notes[o];if(h==s&&void 0!=s)o++;else if(h.end<=a)o++;else{if(h.start>=i)break;h.start<a?(r.append(new K(e,h,h.start,a)),o++):h.end>i?(r.append(new K(e,h,i,h.end)),o++):r.append(new J(e,n,h,o,!0))}}return r}
return __extends(e,t),e}(t.ChangeSequence);t.ChangeNoteTruncate=_;var Q=function(e){function n(n,a,i){var s=e.call(this,!1)||this;s.R=n,s.S=a,s.X=a.pins,s.Y=[],s.Z=a.pitches,s.$=[];for(var r=n.song.getChannelIsDrum(n.channel)?t.Config.drumCount-1:t.Config.maxPitch,o=0;o<s.Z.length;o++){var h=s.Z[o];if(i){for(var l=h+1;l<=r;l++)if(n.song.getChannelIsDrum(n.channel)||t.Config.scaleFlags[n.song.scale][l%12]){h=l;break}}else for(var l=h-1;l>=0;l--)if(n.song.getChannelIsDrum(n.channel)||t.Config.scaleFlags[n.song.scale][l%12]){h=l;break}for(var c=!1,l=0;l<s.$.length;l++)if(s.$[l]==h){c=!0;break}c||s.$.push(h)}for(var f=0,u=r,o=1;o<s.$.length;o++){var p=s.$[0]-s.$[o];f<p&&(f=p),u>p+r&&(u=p+r)}for(var d=0,m=s.X;d<m.length;d++){var g=m[d],b=g.interval+s.Z[0];if(b<f&&(b=f),b>u&&(b=u),i){for(var o=b+1;o<=u;o++)if(n.song.getChannelIsDrum(n.channel)||t.Config.scaleFlags[n.song.scale][o%12]){b=o;break}}else for(var o=b-1;o>=f;o--)if(n.song.getChannelIsDrum(n.channel)||t.Config.scaleFlags[n.song.scale][o%12]){b=o;break}b-=s.$[0],s.Y.push(t.makeNotePin(b,g.time,g.volume))}if(0!=s.Y[0].interval)throw new Error("wrong pin start interval");for(var o=1;o<s.Y.length-1;)s.Y[o-1].interval==s.Y[o].interval&&s.Y[o].interval==s.Y[o+1].interval&&s.Y[o-1].volume==s.Y[o].volume&&s.Y[o].volume==s.Y[o+1].volume?s.Y.splice(o,1):o++;return s.N(),s.K(),s}return __extends(n,e),n.prototype.N=function(){this.S.pins=this.Y,this.S.pitches=this.$,this.R.notifier.changed()},n.prototype.O=function(){this.S.pins=this.X,this.S.pitches=this.Z,this.R.notifier.changed()},n}(t.UndoableChange);t.ChangeTransposeNote=Q;var $=function(t){function e(e,n,a){for(var i=t.call(this)||this,s=0;s<n.notes.length;s++)i.append(new Q(e,n.notes[s],a));return i}return __extends(e,t),e}(t.ChangeSequence);t.ChangeTranspose=$;var tt=function(t){function e(e,n,a){var i=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].volume=a,e.notifier.changed(),n!=a&&i.K(),i}return __extends(e,t),e}(t.Change);t.ChangeVolume=tt;var et=function(e){function n(n,a,i,s,r){var o=e.call(this,!1)||this;o.R=n,o.S=a,o.X=a.pins,o.Y=[];for(var h=!1,l=0,c=a.pins;l<c.length;l++){var f=c[l];f.time<i?o.Y.push(f):f.time==i?(o.Y.push(t.makeNotePin(r,i,s)),h=!0):(h||(o.Y.push(t.makeNotePin(r,i,s)),h=!0),o.Y.push(f))}for(var u=1;u<o.Y.length-1;)o.Y[u-1].interval==o.Y[u].interval&&o.Y[u].interval==o.Y[u+1].interval&&o.Y[u-1].volume==o.Y[u].volume&&o.Y[u].volume==o.Y[u+1].volume?o.Y.splice(u,1):u++;return o.N(),o.K(),o}return __extends(n,e),n.prototype.N=function(){this.S.pins=this.Y,this.R.notifier.changed()},n.prototype.O=function(){this.S.pins=this.X,this.R.notifier.changed()},n}(t.UndoableChange);t.ChangeVolumeBend=et;var nt=function(t){function e(e,n){var a=t.call(this)||this;return e.song.channels[e.channel].instruments[e.getCurrentInstrument()].wave!=n&&(e.song.channels[e.channel].instruments[e.getCurrentInstrument()].wave=n,e.notifier.changed(),a.K()),a}return __extends(e,t),e}(t.Change);t.ChangeWave=nt}(beepbox||(beepbox={}));var beepbox;!function(t){function e(t){return t.toFixed(2).replace(/\.?0*$/,"")}function n(t){var e=t.cloneNode(!1);return t.parentNode.replaceChild(e,t),e}var a=function(){function t(){this.valid=!1,this.prevNote=null,this.curNote=null,this.nextNote=null,this.pitch=0,this.pitchIndex=-1,this.curIndex=0,this.start=0,this.end=0,this.part=0,this.notePart=0,this.nearPinIndex=0,this.pins=[]}return t}(),i=function(){function i(i){var s=this;this.R=i,this.da=t.svgElement("pattern",{id:"patternEditorNoteBackground",x:"0",y:"0",width:"64",height:"156",patternUnits:"userSpaceOnUse"}),this.ea=t.svgElement("pattern",{id:"patternEditorDrumBackground",x:"0",y:"0",width:"64",height:"40",patternUnits:"userSpaceOnUse"}),this.fa=t.svgElement("rect",{x:"0",y:"0",width:"512",height:"481","pointer-events":"none",fill:"url(#patternEditorNoteBackground)"}),this.ga=t.svgElement("svg"),this.ha=t.svgElement("rect",{id:"",x:"0",y:"0",width:"4",height:"481",fill:"#00f2ff","pointer-events":"none"}),this.ia=t.svgElement("path",{fill:"none",stroke:"white","stroke-width":"2","pointer-events":"none"}),this.ja=t.svgElement("svg",{style:"background-color: #000000; touch-action: none; position: absolute;",width:"100%",height:"100%",viewBox:"0 0 512 481",preserveAspectRatio:"none"},[t.svgElement("defs",void 0,[this.da,this.ea]),this.fa,this.ga,this.ia,this.ha]),this.container=t.html.div({style:"height: 100%; overflow:hidden; position: relative; flex-grow: 1;"},[this.ja]),this.ka=13,this.la=40,this.ma=[],this.na=t.svgElement("rect"),this.oa=[[t.makeNotePin(0,0,3),t.makeNotePin(0,2,3)],[t.makeNotePin(0,0,3),t.makeNotePin(0,2,3)],[t.makeNotePin(0,0,3),t.makeNotePin(0,2,3)],[t.makeNotePin(0,0,3),t.makeNotePin(0,2,0)]],this.pa=481,this.qa=0,this.ra=0,this.sa=!1,this.ta=!1,this.ua=!1,this.va=!1,this.wa=!1,this.xa=[],this.ya=0,this.za=0,this.Aa=0,this.Ba=0,this.Ca=0,this.Da=0,this.Ea=0,this.Fa=!1,this.Ga=null,this.Ha=new a,this.ca=null,this.Ia=0,this.Ja=0,this.Ka=-1,this.La=-1,this.Ma=!1,this.Na=!1,this.Oa=!1,this.Pa=-1,this.Qa=-1,this.Ra=-1,this.Sa=-1,this.resetCopiedPins=function(){var e=s.Ta();s.xa.length=s.R.song.getChannelCount();for(var n=0;n<s.R.song.pitchChannelCount;n++)s.xa[n]=[t.makeNotePin(0,0,3),t.makeNotePin(0,e,3)];for(var n=s.R.song.pitchChannelCount;n<s.R.song.getChannelCount();n++)s.xa[n]=[t.makeNotePin(0,0,3),t.makeNotePin(0,e,0)]},this.Ua=function(n){var a=Math.floor(s.R.synth.playhead);if(s.R.synth.playing&&null!=s.ca&&s.R.song.getPattern(s.R.channel,Math.floor(s.R.synth.playhead))==s.ca){s.ha.setAttribute("visibility","visible");var i=s.R.synth.playhead-a;Math.abs(i-s.Ia)>.1?s.Ia=i:s.Ia+=.2*(i-s.Ia),s.ha.setAttribute("x",""+e(s.Ia*s.Va-2))}else s.ha.setAttribute("visibility","hidden");s.R.synth.playing&&s.R.autoFollow&&s.Sa!=a&&(new t.ChangeChannelBar(s.R,s.R.channel,a),s.R.notifier.notifyWatchers()),s.Sa=a,window.requestAnimationFrame(s.Ua)},this.Wa=function(t){s.ta||(s.ta=!0,s.wa=!1)},this.Xa=function(t){s.ta&&(s.ta=!1)},this.Ya=function(t){if(t.preventDefault(),null!=s.ca){var e=s.ja.getBoundingClientRect();s.qa=((t.clientX||t.pageX)-e.left)*s.Va/(e.right-e.left),s.ra=((t.clientY||t.pageY)-e.top)*s.pa/(e.bottom-e.top),isNaN(s.qa)&&(s.qa=0),isNaN(s.ra)&&(s.ra=0),s.wa=!1,s.Za()}},this.$a=function(t){if(t.preventDefault(),null!=s.ca){var e=s.ja.getBoundingClientRect();s.qa=(t.touches[0].clientX-e.left)*s.Va/(e.right-e.left),s.ra=(t.touches[0].clientY-e.top)*s.pa/(e.bottom-e.top),isNaN(s.qa)&&(s.qa=0),isNaN(s.ra)&&(s.ra=0),s.wa=!0,s.Za()}},this._a=function(t){var e=s.ja.getBoundingClientRect();s.qa=((t.clientX||t.pageX)-e.left)*s.Va/(e.right-e.left),s.ra=((t.clientY||t.pageY)-e.top)*s.pa/(e.bottom-e.top),isNaN(s.qa)&&(s.qa=0),isNaN(s.ra)&&(s.ra=0),s.wa=!1,s.ab()},this.bb=function(t){if(s.sa){t.preventDefault();var e=s.ja.getBoundingClientRect();s.qa=(t.touches[0].clientX-e.left)*s.Va/(e.right-e.left),s.ra=(t.touches[0].clientY-e.top)*s.pa/(e.bottom-e.top),isNaN(s.qa)&&(s.qa=0),isNaN(s.ra)&&(s.ra=0),s.ab()}},this.cb=function(e){if(s.Ha.valid&&null!=s.ca){var n=s.R.lastChangeWas(s.Ga);if(s.ua&&n)null!=s.Ga&&(s.R.record(s.Ga),s.Ga=null);else if(s.sa&&n)if(null==s.Ha.curNote){var a=t.makeNote(s.Ha.pitch,s.Ha.start,s.Ha.end,3,s.R.song.getChannelIsDrum(s.R.channel));a.pins=[];for(var i=0,r=s.Ha.pins;i<r.length;i++){var o=r[i];a.pins.push(t.makeNotePin(0,o.time,o.volume))}s.R.record(new t.ChangeNoteAdded(s.R,s.ca,a,s.Ha.curIndex))}else if(-1==s.Ha.pitchIndex){var h=new t.ChangeSequence;4==s.Ha.curNote.pitches.length&&h.append(new t.ChangePitchAdded(s.R,s.Ha.curNote,s.Ha.curNote.pitches[0],0,!0)),h.append(new t.ChangePitchAdded(s.R,s.Ha.curNote,s.Ha.pitch,s.Ha.curNote.pitches.length)),s.R.record(h),s.db(s.Ha.curNote)}else 1==s.Ha.curNote.pitches.length?s.R.record(new t.ChangeNoteAdded(s.R,s.ca,s.Ha.curNote,s.Ha.curIndex,!0)):s.R.record(new t.ChangePitchAdded(s.R,s.Ha.curNote,s.Ha.pitch,s.Ha.curNote.pitches.indexOf(s.Ha.pitch),!0));s.sa=!1,s.ua=!1,s.eb(),s.fb()}},this.gb=function(){s.Va=s.R.showLetters?s.R.showScrollBar?460:480:s.R.showScrollBar?492:512,s.ca=s.R.getCurrentPattern(),s.hb=s.Va/(s.R.song.beatsPerBar*s.R.song.partsPerBeat),s.ib=s.R.song.getChannelIsDrum(s.R.channel)?s.la:s.ka,s.jb=s.R.song.getChannelIsDrum(s.R.channel)?t.Config.drumCount:t.Config.pitchCount,s.Ja=12*s.R.song.channels[s.R.channel].octave,s.Pa==s.R.song.partsPerBeat&&s.Qa==s.R.song.pitchChannelCount&&s.Ra==s.R.song.drumChannelCount||(s.Pa=s.R.song.partsPerBeat,s.Qa=s.R.song.pitchChannelCount,s.Ra=s.R.song.drumChannelCount,s.resetCopiedPins()),s.kb=s.xa[s.R.channel],s.Ka!=s.Va&&(s.Ka=s.Va,s.ja.setAttribute("viewBox","0 0 "+s.Va+" 481"),s.fa.setAttribute("width",""+s.Va));var a=s.Va/s.R.song.beatsPerBar;if(s.La!=a){s.La=a,s.da.setAttribute("width",""+a),s.ea.setAttribute("width",""+a),s.na.setAttribute("width",""+(a-2));for(var i=0;i<12;i++)s.ma[i].setAttribute("width",""+(a-2))}s.sa||s.eb(),s.ga=n(s.ga),s.fb(),s.Ma!=s.R.showFifth&&(s.Ma=s.R.showFifth,19!=s.R.song.theme?s.ma[7].setAttribute("fill",s.R.showFifth?t.Config.fifthNoteColorPallet[s.R.song.theme]:"#444444"):s.ma[7].setAttribute("fill",s.R.showFifth?t.Config.noteFive[s.R.song.key]:"#444444")),s.Na!=s.R.showMore&&(19!=s.R.song.theme?(s.Na=s.R.showMore,s.ma[1].setAttribute("fill",s.R.showMore?t.Config.secondNoteColorPallet[s.R.song.theme]:"#444444"),s.ma[2].setAttribute("fill",s.R.showMore?t.Config.thirdNoteColorPallet[s.R.song.theme]:"#444444"),s.ma[3].setAttribute("fill",s.R.showMore?t.Config.fourthNoteColorPallet[s.R.song.theme]:"#444444"),s.ma[4].setAttribute("fill",s.R.showMore?t.Config.sixthNoteColorPallet[s.R.song.theme]:"#444444"),s.ma[5].setAttribute("fill",s.R.showMore?t.Config.seventhNoteColorPallet[s.R.song.theme]:"#444444"),s.ma[6].setAttribute("fill",s.R.showMore?t.Config.eigthNoteColorPallet[s.R.song.theme]:"#444444"),s.ma[8].setAttribute("fill",s.R.showMore?t.Config.ninthNoteColorPallet[s.R.song.theme]:"#444444"),s.ma[9].setAttribute("fill",s.R.showMore?t.Config.tenNoteColorPallet[s.R.song.theme]:"#444444"),s.ma[10].setAttribute("fill",s.R.showMore?t.Config.elevenNoteColorPallet[s.R.song.theme]:"#444444"),s.ma[11].setAttribute("fill",s.R.showMore?t.Config.twelveNoteColorPallet[s.R.song.theme]:"#444444")):(s.Na=s.R.showMore,s.ma[1].setAttribute("fill",s.R.showMore?t.Config.noteTwo[s.R.song.key]:"#444444"),s.ma[2].setAttribute("fill",s.R.showMore?t.Config.noteThree[s.R.song.key]:"#444444"),s.ma[3].setAttribute("fill",s.R.showMore?t.Config.noteFour[s.R.song.key]:"#444444"),s.ma[4].setAttribute("fill",s.R.showMore?t.Config.noteSix[s.R.song.key]:"#444444"),s.ma[5].setAttribute("fill",s.R.showMore?t.Config.noteSeven[s.R.song.key]:"#444444"),s.ma[6].setAttribute("fill",s.R.showMore?t.Config.noteEight[s.R.song.key]:"#444444"),s.ma[8].setAttribute("fill",s.R.showMore?t.Config.noteNine[s.R.song.key]:"#444444"),s.ma[9].setAttribute("fill",s.R.showMore?t.Config.noteTen[s.R.song.key]:"#444444"),s.ma[10].setAttribute("fill",s.R.showMore?t.Config.noteEleven[s.R.song.key]:"#444444"),s.ma[11].setAttribute("fill",s.R.showMore?t.Config.noteTwelve[s.R.song.key]:"#444444")));for(var i=0;i<12;i++)s.ma[i].style.visibility=t.Config.scaleFlags[s.R.song.scale][i]?"visible":"hidden";if(s.R.song.getChannelIsDrum(s.R.channel)?s.Oa||(s.Oa=!0,s.fa.setAttribute("fill","url(#patternEditorDrumBackground)"),s.fa.setAttribute("height",""+s.la*t.Config.drumCount)):s.Oa&&(s.Oa=!1,s.fa.setAttribute("fill","url(#patternEditorNoteBackground)"),s.fa.setAttribute("height",""+s.pa)),s.R.showChannels)for(var r=s.R.song.getChannelCount()-1;r>=0;r--)if(r!=s.R.channel&&s.R.song.getChannelIsDrum(r)==s.R.song.getChannelIsDrum(s.R.channel)){var o=s.R.song.getPattern(r,s.R.bar);if(null!=o)for(var h=0,l=o.notes;h<l.length;h++)for(var c=l[h],f=0,u=c.pitches;f<u.length;f++){var p=u[f],d=t.svgElement("path");d.setAttribute("fill",s.R.song.getNoteColorDim(r)),d.setAttribute("pointer-events","none"),s.lb(d,p,c.start,c.pins,.19*s.ib,!1,12*s.R.song.channels[r].octave),s.ga.appendChild(d)}}if(null!=s.ca){for(var m=0,g=s.ca.notes;m<g.length;m++)for(var c=g[m],b=0;b<c.pitches.length;b++){var p=c.pitches[b],d=t.svgElement("path");if(d.setAttribute("fill",s.R.song.getNoteColorDim(s.R.channel)),d.setAttribute("pointer-events","none"),s.lb(d,p,c.start,c.pins,s.ib/2+1,!1,s.Ja),s.ga.appendChild(d),d=t.svgElement("path"),d.setAttribute("fill",s.R.song.getNoteColorBright(s.R.channel)),d.setAttribute("pointer-events","none"),s.lb(d,p,c.start,c.pins,s.ib/2+1,!0,s.Ja),s.ga.appendChild(d),c.pitches.length>1){var v=t.svgElement("text");v.setAttribute("x",""+e(s.hb*c.start+2)),v.setAttribute("y",""+e(s.mb(p-s.Ja))),v.setAttribute("width","30"),v.setAttribute("fill","black"),v.setAttribute("text-anchor","start"),v.setAttribute("dominant-baseline","central"),v.setAttribute("pointer-events","none"),v.textContent=""+(b+1),s.ga.appendChild(v)}}s.fa.style.visibility="visible"}else s.fa.style.visibility="hidden"};for(var r=0;r<12;r++){var o=(12-r)%12,h=t.svgElement("rect");h.setAttribute("x","1"),h.setAttribute("y",""+(o*this.ka+1)),h.setAttribute("height",""+(this.ka-2)),h.setAttribute("fill",0==r?t.Config.baseNoteColorPallet[this.R.song.theme]:"#444444"),this.da.appendChild(h),this.ma[r]=h}this.na.setAttribute("x","1"),this.na.setAttribute("y","1"),this.na.setAttribute("height",""+(this.la-2)),this.na.setAttribute("fill","#444444"),this.ea.appendChild(this.na),this.R.notifier.watch(this.gb),this.gb(),this.eb(),this.fb(),window.requestAnimationFrame(this.Ua),this.ja.addEventListener("mousedown",this.Ya),document.addEventListener("mousemove",this._a),document.addEventListener("mouseup",this.cb),this.ja.addEventListener("mouseover",this.Wa),this.ja.addEventListener("mouseout",this.Xa),this.ja.addEventListener("touchstart",this.$a),this.ja.addEventListener("touchmove",this.bb),this.ja.addEventListener("touchend",this.cb),this.ja.addEventListener("touchcancel",this.cb),this.resetCopiedPins()}return i.prototype.Ta=function(){return this.R.song.partsPerBeat%3==0?this.R.song.partsPerBeat/3:this.R.song.partsPerBeat%2==0?this.R.song.partsPerBeat/2:this.R.song.partsPerBeat},i.prototype.eb=function(){if(null!=this.ca&&(this.Ha=new a,!(this.qa<0||this.qa>this.Va||this.ra<0||this.ra>this.pa))){this.Ha.part=Math.floor(Math.max(0,Math.min(this.R.song.beatsPerBar*this.R.song.partsPerBeat-1,this.qa/this.hb)));for(var e=0,n=this.ca.notes;e<n.length;e++){var i=n[e];if(i.end<=this.Ha.part)this.Ha.prevNote=i,this.Ha.curIndex++;else if(i.start<=this.Ha.part&&i.end>this.Ha.part)this.Ha.curNote=i;else if(i.start>this.Ha.part){this.Ha.nextNote=i;break}}var s=this.nb(this.ra);if(null!=this.Ha.curNote){this.Ha.start=this.Ha.curNote.start,this.Ha.end=this.Ha.curNote.end,this.Ha.pins=this.Ha.curNote.pins;for(var r=0,o=0,h=void 0,l=this.Ha.curNote.pins[0],c=1;c<this.Ha.curNote.pins.length;c++){h=l,l=this.Ha.curNote.pins[c];var f=this.hb*(this.Ha.curNote.start+h.time),u=this.hb*(this.Ha.curNote.start+l.time);if(!(this.qa>u)){if(this.qa<f)throw new Error;var p=(this.qa-f)/(u-f),d=Math.sqrt(1/Math.sqrt(4)-Math.pow(p-.5,2))-.5,m=Math.abs(l.interval-h.interval);r=h.interval*(1-p)+l.interval*p,o=d*m+1;break}}for(var g=Number.MAX_VALUE,b=-Number.MAX_VALUE,v=Number.MAX_VALUE,C=0,y=this.Ha.curNote.pins;C<y.length;C++){var R=y[C];g>R.interval&&(g=R.interval),b<R.interval&&(b=R.interval);var w=Math.abs(this.Ha.curNote.start+R.time-this.qa/this.hb);v>w&&(v=w,this.Ha.nearPinIndex=this.Ha.curNote.pins.indexOf(R))}if(s-=r,this.Ha.pitch=this.ob(s,-g,(this.R.song.getChannelIsDrum(this.R.channel)?t.Config.drumCount-1:t.Config.maxPitch)-b),3!=this.R.channel)for(var x=o,P=0;P<this.Ha.curNote.pitches.length;P++){var N=Math.abs(this.Ha.curNote.pitches[P]-s+.5);N>x||(x=N,this.Ha.pitch=this.Ha.curNote.pitches[P])}for(var P=0;P<this.Ha.curNote.pitches.length;P++)if(this.Ha.curNote.pitches[P]==this.Ha.pitch){this.Ha.pitchIndex=P;break}}else{this.Ha.pitch=this.ob(s,0,t.Config.maxPitch);var L=this.kb[this.kb.length-1].time,k=Math.floor(this.Ha.part/this.R.song.partsPerBeat),A=this.Ta(),M=this.Ha.part%this.R.song.partsPerBeat;if(1==L)this.Ha.start=this.Ha.part;else if(L>this.R.song.partsPerBeat)this.Ha.start=k*this.R.song.partsPerBeat;else if(L==this.R.song.partsPerBeat)this.Ha.start=k*this.R.song.partsPerBeat,A<this.R.song.partsPerBeat&&M>A&&(this.Ha.start+=Math.floor(M/A)*A);else{this.Ha.start=k*this.R.song.partsPerBeat;for(var E=this.R.song.partsPerBeat%L==0?L:Math.min(L,A);E<A&&this.R.song.partsPerBeat%E!=0;)E++;this.Ha.start+=Math.floor(M/E)*E}this.Ha.end=this.Ha.start+L;var S=0,B=this.R.song.beatsPerBar*this.R.song.partsPerBeat;if(null!=this.Ha.prevNote&&(S=this.Ha.prevNote.end),null!=this.Ha.nextNote&&(B=this.Ha.nextNote.start),this.Ha.start<S?(this.Ha.start=S,this.Ha.end=this.Ha.start+L,this.Ha.end>B&&(this.Ha.end=B)):this.Ha.end>B&&(this.Ha.end=B,this.Ha.start=this.Ha.end-L,this.Ha.start<S&&(this.Ha.start=S)),this.Ha.end-this.Ha.start==L)this.Ha.pins=this.kb;else{this.Ha.pins=[];for(var I=0,F=this.kb;I<F.length;I++){var D=F[I];if(!(D.time<=this.Ha.end-this.Ha.start)){this.Ha.pins.push(t.makeNotePin(0,this.Ha.end-this.Ha.start,D.volume));break}if(this.Ha.pins.push(t.makeNotePin(0,D.time,D.volume)),D.time==this.Ha.end-this.Ha.start)break}}}this.Ha.valid=!0}},i.prototype.nb=function(t){return Math.max(0,Math.min(this.jb-1,this.jb-t/this.ib))+this.Ja},i.prototype.ob=function(e,n,a){e<n&&(e=n),e>a&&(e=a);var i=t.Config.scaleFlags[this.R.song.scale];if(i[Math.floor(e)%12]||this.R.song.getChannelIsDrum(this.R.channel))return Math.floor(e);for(var s=Math.floor(e)+1,r=Math.floor(e)-1;!i[s%12];)s++;for(;!i[r%12];)r--;if(s>a)return r<n?n:r;if(r<n)return s;var o=s,h=r+1;return s%12!=0&&s%12!=7||(o-=.5),r%12!=0&&r%12!=7||(h+=.5),e-h>o-e?s:r},i.prototype.db=function(e){this.kb=[];for(var n=0,a=e.pins;n<a.length;n++){var i=a[n];this.kb.push(t.makeNotePin(0,i.time,i.volume))}for(var s=1;s<this.kb.length-1;)this.kb[s-1].volume==this.kb[s].volume&&this.kb[s].volume==this.kb[s+1].volume?this.kb.splice(s,1):s++;this.xa[this.R.channel]=this.kb},i.prototype.Za=function(){this.sa=!0,this.ya=this.qa,this.za=this.ra,this.Aa=this.qa,this.Ba=this.ra,this.eb(),this.fb(),this.Ga=new t.ChangeSequence,this.R.setProspectiveChange(this.Ga)},i.prototype.ab=function(){var e,n;if(null!=this.ca){var a=this.R.lastChangeWas(this.Ga);if(this.sa&&this.Ha.valid&&a){if(!this.ua){var i=this.qa-this.ya,s=this.ra-this.za;Math.sqrt(i*i+s*s)>5&&(this.ua=!0,this.va=Math.abs(i)>=Math.abs(s))}if(this.ua){null!=this.Ga&&this.Ga.undo();var r=Math.floor(this.qa/this.hb),o=new t.ChangeSequence;if(this.Ga=o,this.R.setProspectiveChange(this.Ga),null==this.Ha.curNote){var h=void 0,l=void 0;r<this.Ha.start?(h=!0,l=this.Ha.start-r):(h=!1,l=r-this.Ha.start+1);for(var c=1,f=0;f<=this.R.song.beatsPerBar*this.R.song.partsPerBeat;f++)if(!(f>=5&&f%this.R.song.partsPerBeat!=0&&f!=3*this.R.song.partsPerBeat/2&&f!=4*this.R.song.partsPerBeat/3&&f!=5*this.R.song.partsPerBeat/3)){var u=f;if(u==l){c=u;break}if(u<l&&(c=u),u>l){c<l-1&&(c=u);break}}h?(n=this.Ha.start,e=n-c):(e=this.Ha.start,n=e+c),e<0&&(e=0),n>this.R.song.beatsPerBar*this.R.song.partsPerBeat&&(n=this.R.song.beatsPerBar*this.R.song.partsPerBeat),o.append(new t.ChangeNoteTruncate(this.R,this.ca,e,n));var p=void 0;for(p=0;p<this.ca.notes.length&&!(this.ca.notes[p].start>=n);p++);var d=t.makeNote(this.Ha.pitch,e,n,3,this.R.song.getChannelIsDrum(this.R.channel));o.append(new t.ChangeNoteAdded(this.R,this.ca,d,p)),this.db(d),this.Ca=h?e:n,this.Da=this.Ha.pitch,this.Ea=d.pins[h?0:1].volume,this.Fa=!0}else if(this.va){var m=Math.round((this.qa-this.ya)/this.hb),g=this.Ha.curNote.pins[this.Ha.nearPinIndex],b=this.Ha.curNote.start+g.time+m;b<0&&(b=0),b>this.R.song.beatsPerBar*this.R.song.partsPerBeat&&(b=this.R.song.beatsPerBar*this.R.song.partsPerBeat),b<=this.Ha.curNote.start&&this.Ha.nearPinIndex==this.Ha.curNote.pins.length-1||b>=this.Ha.curNote.end&&0==this.Ha.nearPinIndex?(o.append(new t.ChangeNoteAdded(this.R,this.ca,this.Ha.curNote,this.Ha.curIndex,!0)),this.Fa=!1):(e=Math.min(this.Ha.curNote.start,b),n=Math.max(this.Ha.curNote.end,b),this.Ca=b,this.Da=this.Ha.curNote.pitches[-1==this.Ha.pitchIndex?0:this.Ha.pitchIndex]+this.Ha.curNote.pins[this.Ha.nearPinIndex].interval,this.Ea=this.Ha.curNote.pins[this.Ha.nearPinIndex].volume,this.Fa=!0,o.append(new t.ChangeNoteTruncate(this.R,this.ca,e,n,this.Ha.curNote)),o.append(new t.ChangePinTime(this.R,this.Ha.curNote,this.Ha.nearPinIndex,b)),this.db(this.Ha.curNote))}else if(-1==this.Ha.pitchIndex){for(var v=Math.round(Math.max(this.Ha.curNote.start,Math.min(this.Ha.curNote.end,this.qa/this.hb)))-this.Ha.curNote.start,C=void 0,y=this.Ha.curNote.pins[0],R=0,w=0,p=1;p<this.Ha.curNote.pins.length;p++)if(C=y,y=this.Ha.curNote.pins[p],!(v>y.time)){if(v<C.time)throw new Error;var x=(v-C.time)/(y.time-C.time);R=Math.round(C.volume*(1-x)+y.volume*x+(this.za-this.ra)/20),R<0&&(R=0),R>3&&(R=3),w=this.ob(C.interval*(1-x)+y.interval*x+this.Ha.curNote.pitches[0],0,t.Config.maxPitch)-this.Ha.curNote.pitches[0];break}this.Ca=this.Ha.curNote.start+v,this.Da=this.Ha.curNote.pitches[-1==this.Ha.pitchIndex?0:this.Ha.pitchIndex]+w,this.Ea=R,this.Fa=!0,o.append(new t.ChangeVolumeBend(this.R,this.Ha.curNote,v,R,w)),this.db(this.Ha.curNote)}else{this.Ea=this.Ha.curNote.pins[this.Ha.nearPinIndex].volume;var P=void 0,N=void 0;this.qa>=this.ya?(P=this.Ha.part,N=r+1):(P=this.Ha.part+1,N=r),N<0&&(N=0),N>this.R.song.beatsPerBar*this.R.song.partsPerBeat&&(N=this.R.song.beatsPerBar*this.R.song.partsPerBeat),N>this.Ha.curNote.end&&o.append(new t.ChangeNoteTruncate(this.R,this.ca,this.Ha.curNote.start,N,this.Ha.curNote)),N<this.Ha.curNote.start&&o.append(new t.ChangeNoteTruncate(this.R,this.ca,N,this.Ha.curNote.end,this.Ha.curNote));for(var L=Number.MAX_VALUE,k=-Number.MAX_VALUE,A=0,M=this.Ha.curNote.pitches;A<M.length;A++){var E=M[A];L>E&&(L=E),k<E&&(k=E)}L-=this.Ha.curNote.pitches[this.Ha.pitchIndex],k-=this.Ha.curNote.pitches[this.Ha.pitchIndex];var S=this.ob(this.nb(this.ra),-L,(this.R.song.getChannelIsDrum(this.R.channel)?t.Config.drumCount-1:t.Config.maxPitch)-k);o.append(new t.ChangePitchBend(this.R,this.Ha.curNote,P,N,S,this.Ha.pitchIndex)),this.db(this.Ha.curNote),this.Ca=N,this.Da=S,this.Fa=!0}}this.Aa=this.qa,this.Ba=this.ra}else this.eb(),this.fb()}},i.prototype.fb=function(){if(this.wa)if(this.sa&&this.Ha.valid&&this.ua&&this.Fa&&null!=this.ca){this.ia.setAttribute("visibility","visible");var t=this.hb*this.Ca,n=this.mb(this.Da-this.Ja),a=this.ib/2,i="";i+="M "+e(t)+" "+e(n-a*(this.Ea/3))+" ",i+="L "+e(t)+" "+e(n-a*(this.Ea/3)-60)+" ",i+="M "+e(t)+" "+e(n+a*(this.Ea/3))+" ",i+="L "+e(t)+" "+e(n+a*(this.Ea/3)+60)+" ",i+="M "+e(t)+" "+e(n-a*(this.Ea/3))+" ",i+="L "+e(t+80)+" "+e(n-a*(this.Ea/3))+" ",i+="M "+e(t)+" "+e(n+a*(this.Ea/3))+" ",i+="L "+e(t+80)+" "+e(n+a*(this.Ea/3))+" ",i+="M "+e(t)+" "+e(n-a*(this.Ea/3))+" ",i+="L "+e(t-80)+" "+e(n-a*(this.Ea/3))+" ",i+="M "+e(t)+" "+e(n+a*(this.Ea/3))+" ",i+="L "+e(t-80)+" "+e(n+a*(this.Ea/3))+" ",this.ia.setAttribute("d",i)}else this.ia.setAttribute("visibility","hidden");else this.ta&&!this.sa&&this.Ha.valid&&null!=this.ca?(this.ia.setAttribute("visibility","visible"),this.lb(this.ia,this.Ha.pitch,this.Ha.start,this.Ha.pins,this.ib/2+1,!0,this.Ja)):this.ia.setAttribute("visibility","hidden")},i.prototype.lb=function(t,n,a,i,s,r,o){for(var h=i[0],l="M "+e(this.hb*(a+h.time)+1)+" "+e(this.mb(n-o)+s*(r?h.volume/3:1))+" ",c=1;c<i.length;c++){var f=h;h=i[c];var u=this.hb*(a+f.time)+(1==c?1:0),p=this.hb*(a+h.time)-(c==i.length-1?1:0),d=this.mb(n+f.interval-o),m=this.mb(n+h.interval-o),g=r?f.volume/3:1,b=r?h.volume/3:1;l+="L "+e(u)+" "+e(d-s*g)+" ",f.interval>h.interval&&(l+="L "+e(u+1)+" "+e(d-s*g)+" "),f.interval<h.interval&&(l+="L "+e(p-1)+" "+e(m-s*b)+" "),l+="L "+e(p)+" "+e(m-s*b)+" "}for(var c=i.length-2;c>=0;c--){var f=h;h=i[c];var u=this.hb*(a+f.time)-(c==i.length-2?1:0),p=this.hb*(a+h.time)+(0==c?1:0),d=this.mb(n+f.interval-o),m=this.mb(n+h.interval-o),g=r?f.volume/3:1,b=r?h.volume/3:1;l+="L "+e(u)+" "+e(d+s*g)+" ",f.interval<h.interval&&(l+="L "+e(u-1)+" "+e(d+s*g)+" "),f.interval>h.interval&&(l+="L "+e(p+1)+" "+e(m+s*b)+" "),l+="L "+e(p)+" "+e(m+s*b)+" "}l+="z",t.setAttribute("d",l)},i.prototype.mb=function(t){return this.ib*(this.jb-t-.5)},i}();t.PatternEditor=i}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function e(e,n,a,i,s){this.pb=t.html.text("1"),this.qb=t.svgElement("text",{x:16,y:23,"font-family":"sans-serif","font-size":20,"text-anchor":"middle","font-weight":"bold",fill:"red"},[this.pb]),this.rb=t.svgElement("rect",{width:30,height:27,x:1,y:1}),this.sb=t.svgElement("rect",{width:6,height:3,x:24,y:5}),this.tb=t.svgElement("rect",{width:6,height:18,x:24,y:5}),this.container=t.svgElement("svg",void 0,[this.rb,this.tb,this.sb,this.qb]),this.ub=1,this.vb=!0,this.wb=!0,this.xb=!1,this.yb="",this.container.setAttribute("x",""+32*n),this.container.setAttribute("y",""+32*a),this.rb.setAttribute("fill","#444444"),this.sb.setAttribute("fill","#444444"),this.tb.setAttribute("fill","#444444"),this.qb.setAttribute("fill",i)}return e.prototype.setSquashed=function(t,e){t?(this.container.setAttribute("y",""+27*e),this.rb.setAttribute("height","25"),this.sb.setAttribute("height","2.7"),this.tb.setAttribute("height","18"),this.qb.setAttribute("y","21")):(this.container.setAttribute("y",""+32*e),this.rb.setAttribute("height","30"),this.sb.setAttribute("height","3"),this.tb.setAttribute("height","18"),this.qb.setAttribute("y","23"))},e.prototype.setIndex=function(t,e,n,a,i,s,r,o,h){2==h?(this.sb.setAttribute("height",""+(18-2*s)),this.sb.setAttribute("y",""+(5+2*s))):(this.sb.setAttribute("height",""+(18-3.6*s)),this.sb.setAttribute("y",""+(5+3.6*s))),this.ub!=t&&(this.xb||0==t==(0==this.ub)||(this.rb.setAttribute("fill",0==t?"#000000":"#444444"),this.sb.setAttribute("fill",0==t?"#000000":"#444444"),this.tb.setAttribute("fill",0==t?"#000000":"#444444")),this.ub=t,this.pb.data=""+t),this.vb==e&&this.yb==i||(this.vb=e,n?this.qb.setAttribute("fill","#000000"):this.qb.setAttribute("fill",i)),this.xb==n&&this.yb==i||(this.xb=n,n?(this.rb.setAttribute("fill",i),this.sb.setAttribute("fill",i),this.tb.setAttribute("fill",i),this.qb.setAttribute("fill","#000000")):(this.rb.setAttribute("fill",0==this.ub?"#000000":"#444444"),this.sb.setAttribute("fill",0==this.ub?"#000000":i),this.tb.setAttribute("fill",0==this.ub?"#000000":r),this.qb.setAttribute("fill",i))),o?(this.qb.setAttribute("x","12"),this.sb.style.visibility="visible",this.tb.style.visibility="visible"):(this.qb.setAttribute("x","16"),this.sb.style.visibility="hidden",this.tb.style.visibility="hidden"),this.yb=i},e}(),n=function(){function n(e,n){var a=this;this.R=e,this.zb=n,this.Ab=32,this.ja=t.svgElement("svg",{style:"background-color: #000000; position: absolute;",height:128}),this.Bb=t.html.select({className:"trackSelectBox",style:"width: 32px; height: 32px; background: none; border: none; appearance: none; color: transparent; position: absolute;"}),this.container=t.html.div({style:"height: 128px; position: relative; overflow:hidden;"},[this.ja,this.Bb]),this.Cb=t.svgElement("g"),this.Db=t.svgElement("rect",{fill:"#00f2ff",x:0,y:0,width:4,height:128}),this.Eb=t.svgElement("rect",{fill:"none",stroke:"white","stroke-width":2,"pointer-events":"none",x:1,y:1,width:30,height:30}),this.Fb=t.svgElement("path",{fill:"black",stroke:"black","stroke-width":1,"pointer-events":"none"}),this.Gb=t.svgElement("path",{fill:"black",stroke:"black","stroke-width":1,"pointer-events":"none"}),this.Hb=[],this.qa=0,this.ra=0,this.ca=null,this.ta=!1,this.Ib="",this.pa=128,this.Jb=32,this.Kb=0,this.Lb=0,this.Mb=0,this.Nb=-1,this.Ob=!1,this.Pb=null,this.Qb=function(){a.Rb(a.Bb.selectedIndex)},this.Ua=function(t){var e=a.Ab*a.R.synth.playhead-2;a.Nb!=e&&(a.Nb=e,a.Db.setAttribute("x",""+e)),window.requestAnimationFrame(a.Ua)},this.Wa=function(t){a.ta||(a.ta=!0)},this.Xa=function(t){a.ta&&(a.ta=!1)},this.Ya=function(t){t.preventDefault();var e=a.ja.getBoundingClientRect();a.qa=(t.clientX||t.pageX)-e.left,a.ra=(t.clientY||t.pageY)-e.top;var n=Math.floor(Math.min(a.R.song.getChannelCount()-1,Math.max(0,a.ra/a.Jb))),i=Math.floor(Math.min(a.R.song.barCount-1,Math.max(0,a.qa/a.Ab)));if(a.R.channel==n&&a.R.bar==i){var s=a.ra%a.Jb<a.Jb/2,r=a.R.song.patternsPerChannel;a.Rb((a.R.song.channels[n].bars[i]+(s?1:r))%(r+1))}else a.Sb(n,i)},this._a=function(t){var e=a.ja.getBoundingClientRect();a.qa=(t.clientX||t.pageX)-e.left,a.ra=(t.clientY||t.pageY)-e.top,a.fb()},this.Tb=function(t){},this.ja.appendChild(this.Cb),this.ja.appendChild(this.Eb),this.ja.appendChild(this.Fb),this.ja.appendChild(this.Gb),this.ja.appendChild(this.Db),window.requestAnimationFrame(this.Ua),this.ja.addEventListener("mousedown",this.Ya),document.addEventListener("mousemove",this._a),document.addEventListener("mouseup",this.Tb),this.ja.addEventListener("mouseover",this.Wa),this.ja.addEventListener("mouseout",this.Xa),this.Bb.addEventListener("change",this.Qb)}return n.prototype.Sb=function(e,n){new t.ChangeChannelBar(this.R,e,n),this.Ib="",this.R.forgetLastChange()},n.prototype.Rb=function(e){var n=this.R.song.channels[this.R.channel].bars[this.R.bar],a=this.R.lastChangeWas(this.Pb),i=a?this.Pb.oldValue:n;e!=n&&(this.Pb=new t.ChangePattern(this.R,i,e),this.R.record(this.Pb,a))},n.prototype.onKeyPressed=function(t){switch(t.keyCode){case 38:this.Sb((this.R.channel-1+this.R.song.getChannelCount())%this.R.song.getChannelCount(),this.R.bar),t.preventDefault();break;case 40:this.Sb((this.R.channel+1)%this.R.song.getChannelCount(),this.R.bar),t.preventDefault();break;case 37:this.Sb(this.R.channel,(this.R.bar+this.R.song.barCount-1)%this.R.song.barCount),t.preventDefault();break;case 39:this.Sb(this.R.channel,(this.R.bar+1)%this.R.song.barCount),t.preventDefault();break;case 48:this.Ub("0"),t.preventDefault();break;case 49:this.Ub("1"),t.preventDefault();break;case 50:this.Ub("2"),t.preventDefault();break;case 51:this.Ub("3"),t.preventDefault();break;case 52:this.Ub("4"),t.preventDefault();break;case 53:this.Ub("5"),t.preventDefault();break;case 54:this.Ub("6"),t.preventDefault();break;case 55:this.Ub("7"),t.preventDefault();break;case 56:this.Ub("8"),t.preventDefault();break;case 57:this.Ub("9"),t.preventDefault();break;default:this.Ib=""}},n.prototype.Ub=function(t){this.Ib+=t;var e=parseInt(this.Ib);return e<=this.R.song.patternsPerChannel?void this.Rb(e):(this.Ib=t,(e=parseInt(this.Ib))<=this.R.song.patternsPerChannel?void this.Rb(e):void(this.Ib=""))},n.prototype.fb=function(){var e=Math.floor(Math.min(this.R.song.getChannelCount()-1,Math.max(0,this.ra/this.Jb))),n=Math.floor(Math.min(this.R.song.barCount-1,Math.max(0,this.qa/this.Ab))),a=window.innerWidth>700;a||(n=this.R.bar,e=this.R.channel);var i=n==this.R.bar&&e==this.R.channel;if(this.ta&&!i?(this.Eb.setAttribute("x",""+(1+this.Ab*n)),this.Eb.setAttribute("y",""+(1+this.Jb*e)),this.Eb.setAttribute("height",""+(this.Jb-2)),this.Eb.style.visibility="visible"):this.Eb.style.visibility="hidden",!this.ta&&a||!i)this.Fb.style.visibility="hidden",this.Gb.style.visibility="hidden";else{var s=this.ra%this.Jb<this.Jb/2,r=this.Ab*(n+.8),o=this.Jb*(e+.5),h=.1*this.Jb,l=.4*this.Jb,c=.175*this.Jb;this.Fb.setAttribute("fill",s&&a?"#fff":"#000"),this.Gb.setAttribute("fill",!s&&a?"#fff":"#000"),this.Fb.setAttribute("d","M "+r+" "+(o-l)+" L "+(r+c)+" "+(o-h)+" L "+(r-c)+" "+(o-h)+" z"),this.Gb.setAttribute("d","M "+r+" "+(o+l)+" L "+(r+c)+" "+(o+h)+" L "+(r-c)+" "+(o+h)+" z"),this.Fb.style.visibility="visible",this.Gb.style.visibility="visible"}this.Bb.style.left=this.Ab*this.R.bar+"px",this.Bb.style.top=this.Jb*this.R.channel+"px",this.Bb.style.height=this.Jb+"px";for(var f=this.R.song.patternsPerChannel,u=this.Mb;u<f;u++)this.Bb.appendChild(t.html.option(u,u,!1,!1));for(var u=f;u<this.Mb;u++)this.Bb.removeChild(this.Bb.lastChild);this.Mb=f;var p=this.R.song.channels[this.R.channel].bars[this.R.bar];this.Bb.selectedIndex!=p&&(this.Bb.selectedIndex=p)},n.prototype.render=function(){this.ca=this.R.getCurrentPattern()
;var t=window.innerWidth>700,n=!t||this.R.song.getChannelCount()>5||this.R.song.barCount>this.R.trackVisibleBars&&this.R.song.getChannelCount()>3;if(this.Jb=n?27:32,this.Kb!=this.R.song.getChannelCount()){for(var a=this.Kb;a<this.R.song.getChannelCount();a++){this.Hb[a]=[];for(var i=0;i<this.Lb;i++){var s=new e(a,i,a,this.R.song.getChannelColorDim(a),this.R.showVolumeBar);s.setSquashed(n,a),this.Cb.appendChild(s.container),this.Hb[a][i]=s}}for(var a=this.R.song.getChannelCount();a<this.Kb;a++)for(var i=0;i<this.Lb;i++)this.Cb.removeChild(this.Hb[a][i].container);this.Hb.length=this.R.song.getChannelCount()}if(this.Lb!=this.R.song.barCount){for(var a=0;a<this.R.song.getChannelCount();a++){for(var i=this.Lb;i<this.R.song.barCount;i++){var s=new e(a,i,a,this.R.song.getChannelColorDim(a),this.R.showVolumeBar);s.setSquashed(n,a),this.Cb.appendChild(s.container),this.Hb[a][i]=s}for(var i=this.R.song.barCount;i<this.Lb;i++)this.Cb.removeChild(this.Hb[a][i].container);this.Hb[a].length=this.R.song.barCount}this.Lb=this.R.song.barCount;var r=32*this.R.song.barCount;this.container.style.width=r+"px",this.ja.setAttribute("width",r+"")}if(this.Ob!=n)for(var a=0;a<this.R.song.getChannelCount();a++)for(var i=0;i<this.Lb;i++)this.Hb[a][i].setSquashed(n,a);this.Ob==n&&this.Kb==this.R.song.getChannelCount()||(this.Ob=n,this.Kb=this.R.song.getChannelCount(),this.pa=this.R.song.getChannelCount()*this.Jb,this.ja.setAttribute("height",""+this.pa),this.Db.setAttribute("height",""+this.pa),this.container.style.height=this.pa+"px");for(var o=0;o<this.R.song.getChannelCount();o++)for(var h=0;h<this.Lb;h++){var l=this.R.song.getPattern(o,h),c=this.R.song.getPatternInstrumentMute(o,h),f=this.R.song.getPatternInstrumentVolume(o,h),u=h==this.R.bar&&o==this.R.channel,p=null==l||0==l.notes.length,d=1==c,m=f,s=this.Hb[o][h];h<this.R.song.barCount?(s.setIndex(this.R.song.channels[o].bars[h],p,u,o,!p||u||d?d&&!u?"#161616":this.R.song.getChannelColorBright(o):this.R.song.getChannelColorDim(o),m,(!p||u||d)&&d&&!u?"#9b9b9b":this.R.song.getChannelColorDim(o),this.R.showVolumeBar,this.R.song.mix),s.container.style.visibility="visible"):s.container.style.visibility="hidden"}this.fb()},n}();t.TrackEditor=n}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function e(e){var n=this;this.R=e,this.Ab=32,this.pa=20,this.Vb=0,this.Wb=1,this.Xb=2,this.Yb=t.svgElement("path",{fill:"none",stroke:t.Config.sliderOneColorPallet[this.R.song.theme],"stroke-width":4}),this.Zb=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.ja=t.svgElement("svg",{style:"background-color: #000000; touch-action: pan-y; position: absolute;",height:this.pa},[this.Yb,this.Zb]),this.container=t.html.div({style:"height: 20px; position: relative; margin: 5px 0;"},[this.ja]),this.$b=null,this.Ha={startBar:-1,mode:-1},this.qa=0,this.ra=0,this._b=0,this.ac=0,this.bc=!1,this.cc=!1,this.sa=!1,this.ta=!1,this.dc=-1,this.ec=-1,this.Lb=0,this.Wa=function(t){n.ta||(n.ta=!0,n.fb())},this.Xa=function(t){n.ta&&(n.ta=!1,n.fb())},this.Ya=function(t){t.preventDefault(),n.sa=!0;var e=n.ja.getBoundingClientRect();n.qa=(t.clientX||t.pageX)-e.left,n.ra=(t.clientY||t.pageY)-e.top,n.eb(),n.fb(),n._a(t)},this.$a=function(t){n.sa=!0;var e=n.ja.getBoundingClientRect();n.qa=t.touches[0].clientX-e.left,n.ra=t.touches[0].clientY-e.top,n.eb(),n.fb(),n._b=t.touches[0].clientX,n.ac=t.touches[0].clientY,n.cc=!1,n.bc=!1},this._a=function(t){var e=n.ja.getBoundingClientRect();n.qa=(t.clientX||t.pageX)-e.left,n.ra=(t.clientY||t.pageY)-e.top,n.ab()},this.bb=function(t){if(n.sa){var e=n.ja.getBoundingClientRect();n.qa=t.touches[0].clientX-e.left,n.ra=t.touches[0].clientY-e.top,n.cc||n.bc||(Math.abs(t.touches[0].clientY-n.ac)>10?n.bc=!0:Math.abs(t.touches[0].clientX-n._b)>10&&(n.cc=!0)),n.cc&&(n.ab(),t.preventDefault())}},this.fc=function(t){t.preventDefault(),n.bc||(n.ab(),n.ta=!1,n.cb(t),n.fb())},this.cb=function(t){null!=n.$b&&n.R.record(n.$b),n.$b=null,n.sa=!1,n.eb(),n.gc()},this.gb=function(){n.gc()},this.eb(),this.gc(),this.R.notifier.watch(this.gb),this.container.addEventListener("mousedown",this.Ya),document.addEventListener("mousemove",this._a),document.addEventListener("mouseup",this.cb),this.container.addEventListener("mouseover",this.Wa),this.container.addEventListener("mouseout",this.Xa),this.container.addEventListener("touchstart",this.$a),this.container.addEventListener("touchmove",this.bb),this.container.addEventListener("touchend",this.fc),this.container.addEventListener("touchcancel",this.fc)}return e.prototype.eb=function(){var t=this.qa/this.Ab;this.Ha.startBar=t,t>this.R.song.loopStart-.25&&t<this.R.song.loopStart+this.R.song.loopLength+.25?t-this.R.song.loopStart<.5*this.R.song.loopLength?this.Ha.mode=this.Vb:this.Ha.mode=this.Wb:this.Ha.mode=this.Xb},e.prototype.hc=function(t){var e=Math.round(t-this.R.song.loopLength/2),n=e+this.R.song.loopLength;return e<0&&(n-=e,e=0),n>this.R.song.barCount&&(e-=n-this.R.song.barCount,n=this.R.song.barCount),{start:e,length:n-e}},e.prototype.ab=function(){if(this.sa){var e=this.R.song.loopStart,n=this.R.song.loopStart+this.R.song.loopLength;null!=this.$b&&this.R.lastChangeWas(this.$b)&&(e=this.$b.oldStart,n=e+this.$b.oldLength);var a=this.qa/this.Ab,i=void 0,s=void 0,r=void 0;if(this.Ha.mode==this.Vb)i=e+Math.round(a-this.Ha.startBar),s=n,i<0&&(i=0),i>=this.R.song.barCount&&(i=this.R.song.barCount),i==s?i=s-1:i>s&&(r=i,i=s,s=r),this.$b=new t.ChangeLoop(this.R,e,n-e,i,s-i);else if(this.Ha.mode==this.Wb)i=e,s=n+Math.round(a-this.Ha.startBar),s<0&&(s=0),s>=this.R.song.barCount&&(s=this.R.song.barCount),s==i?s=i+1:s<i&&(r=i,i=s,s=r),this.$b=new t.ChangeLoop(this.R,e,n-e,i,s-i);else if(this.Ha.mode==this.Xb){var o=this.hc(a);this.$b=new t.ChangeLoop(this.R,e,n-e,o.start,o.length)}this.R.setProspectiveChange(this.$b)}else this.eb(),this.fb()},e.prototype.fb=function(){var t=this.ta&&!this.sa;if(this.Zb.style.visibility=t?"visible":"hidden",t){var e=this.pa/2,n=this.R.song.loopStart*this.Ab,a=(this.R.song.loopStart+this.R.song.loopLength)*this.Ab;if(this.Ha.mode==this.Vb)a=this.R.song.loopStart*this.Ab+2*e;else if(this.Ha.mode==this.Wb)n=(this.R.song.loopStart+this.R.song.loopLength)*this.Ab-2*e;else{var i=this.hc(this.Ha.startBar);n=i.start*this.Ab,a=(i.start+i.length)*this.Ab}this.Zb.setAttribute("d","M "+(n+e)+" 4 L "+(a-e)+" 4 A "+(e-4)+" "+(e-4)+" 0 0 1 "+(a-e)+" "+(this.pa-4)+" L "+(n+e)+" "+(this.pa-4)+" A "+(e-4)+" "+(e-4)+" 0 0 1 "+(n+e)+" 4 z")}},e.prototype.gc=function(){var t=this.pa/2,e=this.R.song.loopStart*this.Ab,n=(this.R.song.loopStart+this.R.song.loopLength)*this.Ab;if(this.Lb!=this.R.song.barCount){this.Lb=this.R.song.barCount;var a=32*this.R.song.barCount;this.container.style.width=a+"px",this.ja.setAttribute("width",a+"")}this.dc==e&&this.ec==n||(this.dc=e,this.ec=n,this.Yb.setAttribute("d","M "+(e+t)+" 2 L "+(n-t)+" 2 A "+(t-2)+" "+(t-2)+" 0 0 1 "+(n-t)+" "+(this.pa-2)+" L "+(e+t)+" "+(this.pa-2)+" A "+(t-2)+" "+(t-2)+" 0 0 1 "+(e+t)+" 2 z")),this.fb()},e}();t.LoopEditor=e}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function e(e,n){var a=this;this.R=e,this.ic=n,this.Va=512,this.pa=20,this.jc=t.svgElement("svg",{"pointer-events":"none"}),this.kc=t.svgElement("rect",{fill:"#444444",x:0,y:2,width:10,height:this.pa-4}),this.lc=t.svgElement("rect",{fill:"none",stroke:"white","stroke-width":2,"pointer-events":"none",x:0,y:1,width:10,height:this.pa-2}),this.mc=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.nc=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.ja=t.svgElement("svg",{style:"background-color: #000000; touch-action: pan-y; position: absolute;",width:this.Va,height:this.pa},[this.jc,this.kc,this.lc,this.mc,this.nc]),this.container=t.html.div({className:"barScrollBar",style:"width: 512px; height: 20px; overflow: hidden; position: relative;"},[this.ja]),this.qa=0,this.ra=0,this.sa=!1,this.ta=!1,this.oc=!1,this.pc=-1,this.qc=-1,this.rc=function(t){a.R.barScrollPos=a.ic.scrollLeft/32},this.Wa=function(t){a.ta||(a.ta=!0,a.fb())},this.Xa=function(t){a.ta&&(a.ta=!1,a.fb())},this.Ya=function(t){t.preventDefault(),a.sa=!0;var e=a.ja.getBoundingClientRect();a.qa=(t.clientX||t.pageX)-e.left,a.ra=(t.clientY||t.pageY)-e.top,a.fb(),a.qa>=a.R.barScrollPos*a.Ab&&a.qa<=(a.R.barScrollPos+a.R.trackVisibleBars)*a.Ab&&(a.oc=!0,a.sc=a.qa)},this.$a=function(t){t.preventDefault(),a.sa=!0;var e=a.ja.getBoundingClientRect();a.qa=t.touches[0].clientX-e.left,a.ra=t.touches[0].clientY-e.top,a.fb(),a.qa>=a.R.barScrollPos*a.Ab&&a.qa<=(a.R.barScrollPos+a.R.trackVisibleBars)*a.Ab&&(a.oc=!0,a.sc=a.qa)},this._a=function(t){var e=a.ja.getBoundingClientRect();a.qa=(t.clientX||t.pageX)-e.left,a.ra=(t.clientY||t.pageY)-e.top,a.ab()},this.bb=function(t){if(a.sa){t.preventDefault();var e=a.ja.getBoundingClientRect();a.qa=t.touches[0].clientX-e.left,a.ra=t.touches[0].clientY-e.top,a.ab()}},this.cb=function(t){!a.oc&&a.sa&&(a.qa<(a.R.barScrollPos+8)*a.Ab?(a.R.barScrollPos>0&&a.R.barScrollPos--,a.R.notifier.changed()):(a.R.barScrollPos<a.R.song.barCount-a.R.trackVisibleBars&&a.R.barScrollPos++,a.R.notifier.changed())),a.sa=!1,a.oc=!1,a.fb()};var i=.5*this.pa;this.mc.setAttribute("d","M 9 "+i+" L 20 "+(i+6)+" L 20 "+(i-6)+" z"),this.nc.setAttribute("d","M "+(this.Va-9)+" "+i+" L "+(this.Va-20)+" "+(i+6)+" L "+(this.Va-20)+" "+(i-6)+" z"),this.container.addEventListener("mousedown",this.Ya),document.addEventListener("mousemove",this._a),document.addEventListener("mouseup",this.cb),this.container.addEventListener("mouseover",this.Wa),this.container.addEventListener("mouseout",this.Xa),this.container.addEventListener("touchstart",this.$a),this.container.addEventListener("touchmove",this.bb),this.container.addEventListener("touchend",this.cb),this.container.addEventListener("touchcancel",this.cb),this.ic.addEventListener("scroll",this.rc,{capture:!1,passive:!0})}return e.prototype.ab=function(){if(this.oc){for(;this.qa-this.sc<.5*-this.Ab&&this.R.barScrollPos>0;)this.R.barScrollPos--,this.sc-=this.Ab,this.R.notifier.changed();for(;this.qa-this.sc>.5*this.Ab&&this.R.barScrollPos<this.R.song.barCount-this.R.trackVisibleBars;)this.R.barScrollPos++,this.sc+=this.Ab,this.R.notifier.changed()}this.ta&&this.fb()},e.prototype.fb=function(){var t=this.ta&&!this.sa,e=!1,n=!1,a=!1;t&&(this.qa<this.R.barScrollPos*this.Ab?e=!0:this.qa>(this.R.barScrollPos+this.R.trackVisibleBars)*this.Ab?n=!0:a=!0),this.mc.style.visibility=e?"visible":"hidden",this.nc.style.visibility=n?"visible":"hidden",this.lc.style.visibility=a?"visible":"hidden"},e.prototype.render=function(){this.Ab=(this.Va-1)/Math.max(this.R.trackVisibleBars,this.R.song.barCount);var e=this.pc!=this.R.song.barCount;if(e){for(this.pc=this.R.song.barCount;this.jc.firstChild;)this.jc.removeChild(this.jc.firstChild);for(var n=0;n<=this.R.song.barCount;n++){var a=n%16==0?0:n%4==0?this.pa/8:this.pa/3;this.jc.appendChild(t.svgElement("rect",{fill:"#444444",x:n*this.Ab-1,y:a,width:2,height:this.pa-2*a}))}}(e||this.qc!=this.R.barScrollPos)&&(this.qc=this.R.barScrollPos,this.kc.setAttribute("x",""+this.Ab*this.R.barScrollPos),this.kc.setAttribute("width",""+this.Ab*this.R.trackVisibleBars),this.lc.setAttribute("x",""+this.Ab*this.R.barScrollPos),this.lc.setAttribute("width",""+this.Ab*this.R.trackVisibleBars)),this.fb(),this.ic.scrollLeft=32*this.R.barScrollPos},e}();t.BarScrollBar=e}(beepbox||(beepbox={}));var beepbox;!function(t){var e=function(){function e(e){var n=this;this.R=e,this.Va=20,this.pa=481,this.tc=4,this.uc=7,this.vc=(this.pa-this.tc)/this.uc,this.wc=3*this.vc+this.tc,this.kc=t.svgElement("rect",{fill:t.Config.sliderOctaveColorPallet[this.R.song.theme],x:2,y:0,width:this.Va-4,height:this.wc}),this.lc=t.svgElement("rect",{fill:"none",stroke:"white","stroke-width":2,"pointer-events":"none",x:1,y:0,width:this.Va-2,height:this.wc}),this.Fb=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.Gb=t.svgElement("path",{fill:"white","pointer-events":"none"}),this.ja=t.svgElement("svg",{style:"background-color: #000000; touch-action: pan-x; position: absolute;",width:this.Va,height:"100%",viewBox:"0 0 20 481",preserveAspectRatio:"none"}),this.container=t.html.div({id:"octaveScrollBarContainer",style:"width: 20px; height: 100%; overflow: hidden; position: relative; flex-shrink: 0;"},[this.ja]),this.qa=0,this.ra=0,this.sa=!1,this.ta=!1,this.oc=!1,this.xc=-1,this.$b=null,this.Wa=function(t){n.ta||(n.ta=!0,n.fb())},this.Xa=function(t){n.ta&&(n.ta=!1,n.fb())},this.Ya=function(t){t.preventDefault(),n.sa=!0;var e=n.ja.getBoundingClientRect();n.qa=(t.clientX||t.pageX)-e.left,n.ra=((t.clientY||t.pageY)-e.top)*n.pa/(e.bottom-e.top),isNaN(n.ra)&&(n.ra=0),n.R.song.getChannelIsDrum(n.R.channel)||(n.fb(),n.ra>=n.yc-n.wc&&n.ra<=n.yc&&(n.oc=!0,n.$b=null,n.sc=n.ra))},this.$a=function(t){t.preventDefault(),n.sa=!0;var e=n.ja.getBoundingClientRect();n.qa=t.touches[0].clientX-e.left,n.ra=(t.touches[0].clientY-e.top)*n.pa/(e.bottom-e.top),isNaN(n.ra)&&(n.ra=0),n.R.song.getChannelIsDrum(n.R.channel)||(n.fb(),n.ra>=n.yc-n.wc&&n.ra<=n.yc&&(n.oc=!0,n.$b=null,n.sc=n.ra))},this._a=function(t){var e=n.ja.getBoundingClientRect();n.qa=(t.clientX||t.pageX)-e.left,n.ra=((t.clientY||t.pageY)-e.top)*n.pa/(e.bottom-e.top),isNaN(n.ra)&&(n.ra=0),n.ab()},this.bb=function(t){if(n.sa){t.preventDefault();var e=n.ja.getBoundingClientRect();n.qa=t.touches[0].clientX-e.left,n.ra=(t.touches[0].clientY-e.top)*n.pa/(e.bottom-e.top),isNaN(n.ra)&&(n.ra=0),n.ab()}},this.cb=function(e){if(!n.R.song.getChannelIsDrum(n.R.channel)&&n.sa)if(n.oc)null!=n.$b&&n.R.record(n.$b);else{var a=n.R.lastChangeWas(n.$b),i=a?n.$b.oldValue:n.R.song.channels[n.R.channel].octave,s=n.R.song.channels[n.R.channel].octave;n.ra<n.yc-.5*n.wc?s<4&&(n.$b=new t.ChangeOctave(n.R,i,s+1),n.R.record(n.$b,a)):s>0&&(n.$b=new t.ChangeOctave(n.R,i,s-1),n.R.record(n.$b,a))}n.sa=!1,n.oc=!1,n.fb()},this.gb=function(){n.yc=n.pa-n.vc*n.R.song.channels[n.R.channel].octave,n.gc()},this.R.notifier.watch(this.gb),this.gb(),this.ja.appendChild(this.kc);for(var a=0;a<=this.uc;a++)this.ja.appendChild(t.svgElement("rect",{fill:t.Config.sliderOctaveNotchColorPallet[this.R.song.theme],x:0,y:a*this.vc,width:this.Va,height:this.tc}));this.ja.appendChild(this.lc),this.ja.appendChild(this.Fb),this.ja.appendChild(this.Gb);var i=.5*this.Va;this.Fb.setAttribute("d","M "+i+" 9 L "+(i+6)+" 20 L "+(i-6)+" 20 z"),this.Gb.setAttribute("d","M "+i+" "+(this.pa-9)+" L "+(i+6)+" "+(this.pa-20)+" L "+(i-6)+" "+(this.pa-20)+" z"),this.container.addEventListener("mousedown",this.Ya),document.addEventListener("mousemove",this._a),document.addEventListener("mouseup",this.cb),this.container.addEventListener("mouseover",this.Wa),this.container.addEventListener("mouseout",this.Xa),this.container.addEventListener("touchstart",this.$a),this.container.addEventListener("touchmove",this.bb),this.container.addEventListener("touchend",this.cb),this.container.addEventListener("touchcancel",this.cb)}return e.prototype.ab=function(){if(!this.R.song.getChannelIsDrum(this.R.channel)){if(this.oc){for(var e=this.R.song.channels[this.R.channel].octave,n=this.R.lastChangeWas(this.$b),a=n?this.$b.oldValue:e,i=e;this.ra-this.sc<.5*-this.vc&&i<4;)i++,this.sc-=this.vc;for(;this.ra-this.sc>.5*this.vc&&i>0;)i--,this.sc+=this.vc;this.$b=new t.ChangeOctave(this.R,a,i),this.R.setProspectiveChange(this.$b)}this.ta&&this.fb()}},e.prototype.fb=function(){var t=this.ta&&!this.sa,e=!1,n=!1,a=!1;t&&(this.ra<this.yc-this.wc?e=!0:this.ra>this.yc?n=!0:a=!0),this.Fb.style.visibility=e?"inherit":"hidden",this.Gb.style.visibility=n?"inherit":"hidden",this.lc.style.visibility=a?"inherit":"hidden"},e.prototype.gc=function(){this.ja.style.visibility=this.R.song.getChannelIsDrum(this.R.channel)?"hidden":"visible",this.xc!=this.yc&&(this.xc=this.yc,this.kc.setAttribute("y",""+(this.yc-this.wc)),this.lc.setAttribute("y",""+(this.yc-this.wc))),this.fb()},e}();t.OctaveScrollBar=e}(beepbox||(beepbox={}));var beepbox;!function(t){function e(){n++,a=!0}var n=0,a=!1,i=document.createElement("img");i.onload=e,i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzM2MTdFNzc0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzM2MTdFNzg0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3NTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3NjQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgBmMXoAAACTSURBVHja7JQ7CgMhGIT3920M2Hko7+RJPYWViE0myi5sEXAhKQL7FcP8PmawkWKMjx2llNb60MNIKY0xnPPphRDbMsJ7/xw458wAodZa6PRQ5GIF0RjlYCU655xSEqWU3ntrrdb63RcgHcq2H3MX3AV/UEAhBL7DBkTEzmAFuzSY44UC/BDHtU+8z539esFLgAEAkZ4XCDjZXPEAAAAASUVORK5CYII=";var s=document.createElement("img");s.onload=e,s.src="";var r=document.createElement("img");r.onload=e,r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NEU3RTM2RTg0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NEU3RTM2RTk0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3RDQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3RTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PomGIaQAAABgSURBVHjaYpSWlmZhYWFmZgaSTExMQAYTGGAyIICRkRFIMhANWISFhdlggAUHANrBysoKNBfuCGKMvnjx4r59+xhp5wOg6UCSBM+SB0YtGLVgCFgAzDeMeOSGgAUAAQYAGgwJrOg8pdQAAAAASUVORK5CYII=";var o=document.createElement("img");o.onload=e,o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NEU3RTM2RUM0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NEU3RTM2RUQ0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0RTdFMzZFQTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo0RTdFMzZFQjQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhURscAAAAB1SURBVHja7NPBCoAgDAZgnaMX8Oj7P2KKldXPhiR4CwwCv4PInPvxoA0hMLNzDisRYUPCCiMucVallJzzJnaBih5pp2mw936puKEZ2qQ3MeUQmLiKGGNKCZ1IQr2fDnb0C8gMNgNmwA8Cnt/0Tv91vw64BRgALUuP70jrlrwAAAAASUVORK5CYII=";var h=document.createElement("img");h.onload=e,h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAArCAIAAACW3x1gAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOUJCOEEzOUJCMkI3MTdFNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5NzVEOTA1QzQ5MjMxMUUxOTM3RDhDNEI4QkIxQkFCNSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5NzVEOTA1QjQ5MjMxMUUxOTM3RDhDNEI4QkIxQkFCNSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAxODAxMTc0MDcyMDY4MTE5QkI4QTM5QkIyQjcxN0U0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAxODAxMTc0MDcyMDY4MTE5QkI4QTM5QkIyQjcxN0U0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+dtFK5QAACbRJREFUeNrcV0lsG9cZnnmzcJdIcRHFRZtly5IVSVYSOcriNY7jqHHTBE2bJkCRNijQQ9re2kOBAj30kByKAm1PvQVF0RYIkLRpkiZuLMqyLVm7bGvlIpKiuHOGyww52+ubIbXYCYLk2P4ccobz3nzf+9f3D4b9rwv+5cOXL5x48crDT54b8Pr6jOZWQJoxKIi13WJ+Oziz+Z/r6x9N3AvMhb42gcWkf/P1Mz/40fkWz2iuAAsFrljkOK5crVYwTNTrcaMRNDURNhtl1Slrn9x55x+zf/5ooVIVvhLBq1ce+eXPLpt6RnZ22EIBmk1Oi8VuMFoMBgNF6RUMF2tcrVqscPlSKcGV4zaC85qNd25u/PHdm/+8tf5lBBRJ/Oan49/98cVEDmcYg9PZ09LSrjcYSRzHcAAxDGBQQfMgJiuyAiFUFMSUT23mtu9YxYxVgX/6YPa3796QZGUfk9i/Mhvo3//8W99443wwKtB0T1fXqM3m0en0iJUgSIIkKYoiKBL9A4QqAEcCSFJnbnI3uboqIpHP7D7T73WYDbfW4+IexwHB22+OX3zpsfAu5nI96vUM0gY9wqN0JEJG2AAATFs7hlABrhKgk3qJQwwCgrY4/ZiuaSceO+VvslkM11Yi9xG8+dLj33/tdDgLPB1POB09JE0RAOESFEEiVOWQaIZBPxCtX2MBUKVRMAXTWZyk2RaPRp440lIV5PngboPgZE/br16/kBJwR9dTTtdxQkejBzUOoHxO4P2CCAgcV+8iDSHUWWyA0ieDa4N++1J4N8VUVMVfvTCEm/S0vc/Z1g9IoKIjU6PHkCBvyrJ63hMJffZ+tQkyDnDVPThR18beM6zvHmky0i8/OYDAwTGvfXz0WKoCXL5BFVv1p0qgmULRMJTD0HVKWdqj1EZVS2meV+MNU1zHTmZE6tLJ7qOeFvLMQ504TRkt3SarC00j1aOBrhmksUxFu4PuNxytAqHAhZj2Bw2h6Kprgym40d5m9PXqmbXTA53gzIA/V+KaXZ3aTBSCuKrpniDMOo+yv/bGr3qCyv46VE8jDVCmIBT0t7mtK1fkn+rzgpPdrWy5arS2qloCXHMWdp8flYatZGVPm7rd7nc6psUV0BgQgsnhYbnacGcr8DltXE3UGZsxFNA4JAgcUzU/RHDoWsOFh2Pp8ES0OnX9anWAtNnK1wSf00paTIZG0UAhV19+4/uAHNCqc2Hj3n2CDCxDWRvU1FCLJuB43qijahyLiFG2wEZ5wr+gLOKac7USUX/+gVlQ1pahsdZKjEFHcxwPWIZpNus5JgUhPICqY+1B4XvAQItHrUjsDR6aiRRT9gAq2USzUccyLNhNpe0WI5uOYFrEoAPDDqHvoSJMcJ8Q+7f3J6rxIGP1hbKJsN1iQOAgtJNutZu5bKjEpmU1HNXQeABcKzsNIfeKqVbv8H0OLbCgamQIuXySS6y7rOZQIgO2M2WsxrealHRsSdEiW5Kkfez6uV47Dyg0+ANzgUbqIAfXDZBZn3eSoiJUorkyoMzW9bW1Tk+LkFtNJ1YQPApESZFAAxqAQ9jEYZK6aKPItJJaPdRPdmupGlnocDWvra4hcHCi7/jdxXtihe3yWFKx2+lsUJZESVKLxAH2F1A0wNEAsrooC5Ko5ggb38wsBbps+mqZXVxZHeg7Dvq7vYlo+c78vN9t7fSARPxmMrmuCKIgSfUqRnwxeEOQZQRBRnpDWcxur6QWPm3XcT67eX5uLrHD93V5SSOsWk2ttwMLNp9rePwiyZbC0Vs8X/R5T+gNFog41F2SOEjdevRrXhVFUS2sklTjSsmt21xw7ogZ8za3XEcyvdzS3KOXeeInlx9iC3IikqkKCZ2ROjr6kKXJVCjsRqMx9CRBGpHBkWXrW1g9nRG0pNpRRGav8Gw6thy995mhuHW81eSxmK4HpiYnrzNFU9+xXp/XQLz8aIel2RqeTZZrNVHYJYDi7u7s6OqkaaJQSEajYYbJ8xwvSgJaLDI3YuW5EsNkc7lIYmchEbtJC9tHHFS/z6GUuclrE4GJwG6BBpJ1bKy3WGXJ5WDs+WfOOX0t+UgmaqieOM1uXP2Xb/iUv+Nhv7+DYYRstlIoZLYj259rvMg2D+mwuq2ohjL81vTC8tQ0hyk7eRpyTd52W09P6/uBKXLmXuSlK7D3VM+tSAZugv7Lb3349otCOe3OxW3+oWb7gNXqwDAdhqHdX0I1BsNQ+8ZjWBXDOHQh88XY3EpoZml1ZjGdLP/ivX9cffcVtKcPDXdStHJ7bZtcjGS2Ntb7xwbDs2F2K4UX37rzMcOOQoN5RSpuNbnnjPYjlMkP6DaIm1AfpDZdQqlWSVVyMSYeTm5sJtZCHMOHd2q7O2T449+hXdPvd5wc7tpYX12OZslIEd6YWe4a7h+8PHT9D5/GVxhXEiTey2eC1aOnnINnUUuUx2vLtIGUqlKVq/FlgWf5ClstM1yF4Zk0F4zUIiGhkiLNgNxeLaDUfvzxXkAIgfmV7TJGcBJGSJUeFz36wllBlP/+6+suknQSlCGthGfyK7PpWKhcydckUYtRHBN5KZ/m4qHS+jK7OFNYmC6mNyRzlTIRSDlseT537uzApUvDk4HAX29s3C2olsUWk9K/r06jPBj94WmlJu68v4RuNpGEkzLCNJbbza98mL4qiowsj35vOLZVWL8VpnFcDwA6/AQt62FVwQSo7iVjj/WOP/fwzVs3PpicvVuAjcarJKhrawM5i8My+NoFqSxVtlKEApE1DQA4KKqd1nXrdb1Gw/jf/jL2/KPyO5+00bSVotCoorkexS9OkWPnB158eWxpbnYiEPgsrmyyh1rHGCOhztkF07SJOHrlrMnTVo3nFKaCdmgSRxs56kXU3a79lZ3NTz/JLORFXkG4yGwSVNFt7Y6nvzM2dubo7NTUxLVrEzH5Zgo+2PyGswJqarwUq0gV92ivf/wSbbFIGRayZVSP1WqM47pHbKH5TC3MCRW5TmBpt498e/TZN85RRHn6s4mF2flAVJ5Mavb6/K6K2pZvPuZ45ZK364jTfXzE2j5EQn95LsyvbJXWQ+VofDIci4vC00d9lMdlOuZ2DHndI242EgqjPJheiCdLE1vVqYSswC99wznVZ33hvOfKxQ5Ts6HJ3X0oD8xaHlQVoVCrJCq5OLMTSm5sJO4FObY6tVqcCnJrWfkrvaPpaXBxzP3sOd9zT3fYXSa9kab0lFhFVRPlAepAahUWJUEV5UE2XZ5azE6vl+YivCDDr/2WOdzfcmqkdWTINXDC4XXpzTqiWq7F42wwyKxuFO5sMneDxc0Ej/0/y38FGACBHjS0mkQ17AAAAABJRU5ErkJggg==";var l=function(){function e(e){var n=this;this.R=e,this.zc=t.html.canvas({width:"32",height:"481",style:"width: 100%; height: 100%;"}),this.Ac=t.html.canvas({width:"32",height:"40"}),this.container=t.html.div({style:"width: 32px; height: 100%; overflow:hidden; position: relative; flex-shrink: 0; touch-action: none;"},[this.zc,this.Ac]),this.Bc=this.zc.getContext("2d"),this.Cc=this.Ac.getContext("2d"),this.Va=32,this.pa=481,this.qa=0,this.ra=0,this.sa=!1,this.ta=!1,this.Dc=-1,this.Oa=!1,this.Ec=-1,this.Wa=function(t){n.ta||(n.ta=!0,n.fb())},this.Xa=function(t){n.ta&&(n.ta=!1,n.fb())},this.Ya=function(t){t.preventDefault(),n.sa=!0;var e=n.zc.getBoundingClientRect();n.qa=(t.clientX||t.pageX)-e.left,n.ra=((t.clientY||t.pageY)-e.top)*n.pa/(e.bottom-e.top),isNaN(n.ra)&&(n.ra=0),n.R.synth.pianoPressed=!0,n.fb()},this._a=function(t){var e=n.zc.getBoundingClientRect();n.qa=(t.clientX||t.pageX)-e.left,n.ra=((t.clientY||t.pageY)-e.top)*n.pa/(e.bottom-e.top),isNaN(n.ra)&&(n.ra=0),n.Fc(),n.R.synth.pianoPitch[0]=n.Gc+12*n.R.song.channels[n.R.channel].octave,n.fb()},this.Tb=function(t){n.sa=!1,n.R.synth.pianoPressed=!1,n.fb()},this.$a=function(t){t.preventDefault(),n.sa=!0;var e=n.zc.getBoundingClientRect();n.qa=t.touches[0].clientX-e.left,n.ra=(t.touches[0].clientY-e.top)*n.pa/(e.bottom-e.top),isNaN(n.ra)&&(n.ra=0),n.Fc(),n.R.synth.pianoPressed=!0,n.R.synth.pianoPitch[0]=n.Gc+12*n.R.song.channels[n.R.channel].octave},this.bb=function(t){t.preventDefault();var e=n.zc.getBoundingClientRect();n.qa=t.touches[0].clientX-e.left,n.ra=(t.touches[0].clientY-e.top)*n.pa/(e.bottom-e.top),isNaN(n.ra)&&(n.ra=0),n.Fc(),n.R.synth.pianoPitch[0]=n.Gc+12*n.R.song.channels[n.R.channel].octave},this.fc=function(t){t.preventDefault(),n.R.synth.pianoPressed=!1},this.gb=function(){var e=n.R.song.getChannelIsDrum(n.R.channel);n.ib=e?40:13,n.jb=e?t.Config.drumCount:t.Config.pitchCount,n.Fc(),n.R.synth.pianoPitch[0]=n.Gc+12*n.R.song.channels[n.R.channel].octave,n.R.synth.pianoChannel=n.R.channel,n.gc()},this.gc=function(){if(!a)return void window.requestAnimationFrame(n.gc);if(n.R.showLetters){var e=n.R.song.getChannelIsDrum(n.R.channel);if(n.Dc!=n.R.song.scale||n.Ec!=n.R.song.key||n.Oa!=e){n.Dc=n.R.song.scale,n.Ec=n.R.song.key,n.Oa=e,n.Bc.clearRect(0,0,n.Va,n.pa);for(var l,c=0;c<n.jb;c++){var f=(c+t.Config.keyTransposes[n.R.song.key])%12;if(e){l=h;var u=1-c/n.jb*.35,p=.5*(1-u),d=l.width*p,m=l.height*p+n.ib*(n.jb-c-1),g=l.width*u,b=l.height*u;n.Bc.drawImage(l,d,m,g,b);for(var v=1+(c-n.jb/2)/n.jb*.5,C=n.Bc.getImageData(d,m,g,b),y=C.data,R=0;R<y.length;R+=4)y[R+0]*=v,y[R+1]*=v,y[R+2]*=v;n.Bc.putImageData(C,d,m)}else if(t.Config.scaleFlags[n.R.song.scale][c%12]){var w=t.Config.pitchNames[f];if(null==w){var x=t.Config.blackKeyNameParents[c%12];w=t.Config.pitchNames[(f+12+x)%12],1==x?w+="♭":-1==x&&(w+="♯")}var P=t.Config.pianoScaleFlags[f]?"#dea8ff":t.Config.buttonColorPallet[n.R.song.theme];l=t.Config.pianoScaleFlags[f]?r:i,n.Bc.drawImage(l,0,n.ib*(n.jb-c-1)),n.Bc.font="bold 11px sans-serif",n.Bc.fillStyle=P,n.Bc.fillText(w,15,n.ib*(n.jb-c)-3)}else l=t.Config.pianoScaleFlags[f]?o:s,n.Bc.drawImage(l,0,n.ib*(n.jb-c-1))}n.fb()}}},this.R.notifier.watch(this.gb),this.gb(),this.container.addEventListener("mousedown",this.Ya),document.addEventListener("mousemove",this._a),document.addEventListener("mouseup",this.Tb),this.container.addEventListener("mouseover",this.Wa),this.container.addEventListener("mouseout",this.Xa),this.container.addEventListener("touchstart",this.$a),this.container.addEventListener("touchmove",this.bb),this.container.addEventListener("touchend",this.fc),this.container.addEventListener("touchcancel",this.fc)}return e.prototype.Fc=function(){var e=t.Config.scaleFlags[this.R.song.scale],n=Math.max(0,Math.min(this.jb-1,this.jb-this.ra/this.ib));if(e[Math.floor(n)%12]||this.R.song.getChannelIsDrum(this.R.channel))this.Gc=Math.floor(n);else{for(var a=Math.floor(n)+1,i=Math.floor(n)-1;!e[a%12];)a++;for(;!e[i%12];)i--;var s=a,r=i+1;a%12!=0&&a%12!=7||(s-=.5),i%12!=0&&i%12!=7||(r+=.5),this.Gc=n-r>s-n?a:i}},e.prototype.fb=function(){this.Ac.style.visibility=!this.ta||this.sa?"hidden":"visible",this.ta&&!this.sa&&(this.Cc.clearRect(0,0,32,40),this.Ac.style.left="0px",this.Ac.style.top=this.ib*(this.jb-this.Gc-1)+"px",this.Cc.lineWidth=2,this.Cc.strokeStyle="#ff7200",this.Cc.strokeRect(1,1,this.Va-2,this.ib-2))},e}();t.Piano=l}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,a=t.html.span,i=t.html.input,s=t.html.br,r=t.html.text,o=function(){function o(h,l){var c=this;this.R=h,this.zb=l,this.Hc=i({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Ic=i({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Jc=i({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Kc=i({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Lc=i({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Mc=i({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Nc=e({style:"width:45%;"},[r("Okay")]),this.Oc=e({style:"width:45%;"},[r("Cancel")]),this.container=n({className:"prompt",style:"width: 250px;"},[n({style:"font-size: 2em"},[r("Custom Song Size")]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[n({style:"text-align: right;"},[r("Beats per bar:"),s(),a({style:"font-size: smaller; color: #888888;"},[r("(Multiples of 3 or 4 are recommended)")])]),this.Hc]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[n({style:"display: inline-block; text-align: right;"},[r("Bars per song:"),s(),a({style:"font-size: smaller; color: #888888;"},[r("(Multiples of 2 or 4 are recommended)")])]),this.Ic]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[r("Patterns per channel:"),this.Jc]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[r("Instruments per channel:"),this.Kc]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[r("Number of pitch channels:"),this.Lc]),n({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},[r("Number of drum channels:"),this.Mc]),n({style:"display: flex; flex-direction: row; justify-content: space-between;"},[this.Nc,this.Oc])]),this.Pc=function(){c.R.undo()},this.cleanUp=function(){c.Nc.removeEventListener("click",c.Qc),c.Oc.removeEventListener("click",c.Pc),c.Hc.removeEventListener("keypress",o.Rc),c.Ic.removeEventListener("keypress",o.Rc),c.Jc.removeEventListener("keypress",o.Rc),c.Kc.removeEventListener("keypress",o.Rc),c.Lc.removeEventListener("keypress",o.Rc),c.Mc.removeEventListener("keypress",o.Rc),c.Hc.removeEventListener("blur",o.Sc),c.Ic.removeEventListener("blur",o.Sc),
c.Jc.removeEventListener("blur",o.Sc),c.Kc.removeEventListener("blur",o.Sc),c.Lc.removeEventListener("blur",o.Sc),c.Mc.removeEventListener("blur",o.Sc)},this.Qc=function(){var e=new t.ChangeGroup;e.append(new t.ChangeBeatsPerBar(c.R,o.Tc(c.Hc))),e.append(new t.ChangeBarCount(c.R,o.Tc(c.Ic))),e.append(new t.ChangePatternsPerChannel(c.R,o.Tc(c.Jc))),e.append(new t.ChangeInstrumentsPerChannel(c.R,o.Tc(c.Kc))),e.append(new t.ChangeChannelCount(c.R,o.Tc(c.Lc),o.Tc(c.Mc))),c.R.prompt=null,c.R.record(e,!0)},this.Hc.value=this.R.song.beatsPerBar+"",this.Hc.min=t.Config.beatsPerBarMin+"",this.Hc.max=t.Config.beatsPerBarMax+"",this.Ic.value=this.R.song.barCount+"",this.Ic.min=t.Config.barCountMin+"",this.Ic.max=t.Config.barCountMax+"",this.Jc.value=this.R.song.patternsPerChannel+"",this.Jc.min=t.Config.patternsPerChannelMin+"",this.Jc.max=t.Config.patternsPerChannelMax+"",this.Kc.value=this.R.song.instrumentsPerChannel+"",this.Kc.min=t.Config.instrumentsPerChannelMin+"",this.Kc.max=t.Config.instrumentsPerChannelMax+"",this.Lc.value=this.R.song.pitchChannelCount+"",this.Lc.min=t.Config.pitchChannelCountMin+"",this.Lc.max=t.Config.pitchChannelCountMax+"",this.Mc.value=this.R.song.drumChannelCount+"",this.Mc.min=t.Config.drumChannelCountMin+"",this.Mc.max=t.Config.drumChannelCountMax+"",this.Nc.addEventListener("click",this.Qc),this.Oc.addEventListener("click",this.Pc),this.Hc.addEventListener("keypress",o.Rc),this.Ic.addEventListener("keypress",o.Rc),this.Jc.addEventListener("keypress",o.Rc),this.Kc.addEventListener("keypress",o.Rc),this.Lc.addEventListener("keypress",o.Rc),this.Mc.addEventListener("keypress",o.Rc),this.Hc.addEventListener("blur",o.Sc),this.Ic.addEventListener("blur",o.Sc),this.Jc.addEventListener("blur",o.Sc),this.Kc.addEventListener("blur",o.Sc),this.Lc.addEventListener("blur",o.Sc),this.Mc.addEventListener("blur",o.Sc)}return o.Rc=function(t){var e=t.which?t.which:t.keyCode;return 46!=e&&e>31&&(e<48||e>57)&&(t.preventDefault(),!0)},o.Sc=function(t){var e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""},o.Tc=function(t){return Math.floor(Number(t.value))},o}();t.SongDurationPrompt=o}(beepbox||(beepbox={}));var beepbox;!function(t){function e(t,e,n){return t+n*(e-t)}function n(t,e){if(navigator.msSaveOrOpenBlob)return void navigator.msSaveOrOpenBlob(t,e);var n=document.createElement("a");if(void 0!=n.download){var a=URL.createObjectURL(t);setTimeout(function(){URL.revokeObjectURL(a)},6e4),n.href=a,n.download=e,setTimeout(function(){n.dispatchEvent(new MouseEvent("click"))},0)}else if(navigator.vendor.indexOf("Apple")>-1){var i=new FileReader;i.onloadend=function(){console.log(i.result);var t=i.result.replace(/^data:[^;]*;/,"data:attachment/file;");window.open(t,"_blank")||(window.location.href=t)},i.readAsDataURL(t)}else{var s=URL.createObjectURL(t);setTimeout(function(){URL.revokeObjectURL(s)},6e4),window.open(s,"_blank")||(window.location.href=s)}}var a=t.html.button,i=t.html.div,s=t.html.input,r=t.html.text;ArrayBuffer.transfer||(ArrayBuffer.transfer=function(t,e){var n=new ArrayBuffer(e);if(!(t instanceof ArrayBuffer&&n instanceof ArrayBuffer))throw new TypeError("Source and destination must be ArrayBuffer instances");for(var a=0,i=Math.min(t.byteLength,n.byteLength),s=[8,4,2,1],r=0,o=s;r<o.length;r++){var h=o[r];if(i>=h){var l=function(t,e,n,a,i){var s=Uint8Array;switch(t){case 8:s=Float64Array;break;case 4:s=Float32Array;break;case 2:s=Uint16Array;break;case 1:default:s=Uint8Array}for(var r=new s(e,a,i/t|0),o=new s(n,a,i/t|0),h=0;h<o.length;h++)o[h]=r[h];return{nextOffset:r.byteOffset+r.byteLength,leftBytes:i-o.length*t}}(h,t,n,a,i);a=l.nextOffset,i=l.leftBytes}}return n});var o=function(){function o(h,l){var c=this;this.R=h,this.zb=l,this.Uc=s({type:"text",style:"width: 10em;",value:"Modbox-Song",maxlength:250}),this.Vc=s({type:"checkbox"}),this.Wc=s({style:"width: 2em;",type:"number",min:"1",max:"4",step:"1"}),this.Xc=s({type:"checkbox"}),this.Yc=a({},[r("Export to .wav file")]),this.Zc=a({},[r("Export to .midi file")]),this.$c=a({},[r("Export to .json file")]),this.Oc=a({},[r("Cancel")]),this.container=i({className:"prompt",style:"width: 200px;"},[i({style:"font-size: 2em"},[r("Export Options")]),i({style:"display: flex; flex-direction: row; align-items: center; justify-content: space-between;"},[r("File name:"),this.Uc]),i({style:"display: table; width: 100%;"},[i({style:"display: table-row;"},[i({style:"display: table-cell;"},[r("Intro:")]),i({style:"display: table-cell;"},[r("Loop Count:")]),i({style:"display: table-cell;"},[r("Outro:")])]),i({style:"display: table-row;"},[i({style:"display: table-cell; vertical-align: middle;"},[this.Vc]),i({style:"display: table-cell; vertical-align: middle;"},[this.Wc]),i({style:"display: table-cell; vertical-align: middle;"},[this.Xc])])]),this.Yc,this.Zc,this.$c,this.Oc]),this.Pc=function(){c.R.undo()},this.cleanUp=function(){c.Uc.removeEventListener("input",o._c),c.Wc.removeEventListener("blur",o.Sc),c.Yc.removeEventListener("click",c.ad),c.Zc.removeEventListener("click",c.bd),c.$c.removeEventListener("click",c.cd),c.Oc.removeEventListener("click",c.Pc)},this.ad=function(){var e=new t.Synth(c.R.song);if(e.enableIntro=c.Vc.checked,e.enableOutro=c.Xc.checked,e.loopCount=Number(c.Wc.value),!e.enableIntro)for(var a=0;a<c.R.song.loopStart;a++)e.nextBar();var i=e.totalSamples,s=new Float32Array(i),r=new Float32Array(i);e.synthesize(s,r,i);var o=e.samplesPerSecond,h=2*i,l=44+2*h,f=0,u=new ArrayBuffer(l),p=new DataView(u);p.setUint32(f,1380533830,!1),f+=4,p.setUint32(f,36+2*h,!0),f+=4,p.setUint32(f,1463899717,!1),f+=4,p.setUint32(f,1718449184,!1),f+=4,p.setUint32(f,16,!0),f+=4,p.setUint16(f,1,!0),f+=2,p.setUint16(f,2,!0),f+=2,p.setUint32(f,o,!0),f+=4,p.setUint32(f,2*o*2,!0),f+=4,p.setUint16(f,2,!0),f+=2,p.setUint16(f,16,!0),f+=2,p.setUint32(f,1684108385,!1),f+=4,p.setUint32(f,2*h,!0),f+=4;var d,m;d=1,m=1;for(var g,b,v,C,v=0;v<i;v++){g=Math.floor(32767*s[v*d]),b=Math.floor(32767*r[v*d]);for(var C=0;C<m;C++)p.setInt16(f,g,!0),f+=2,p.setInt16(f,b,!0),f+=2}n(new Blob([u],{type:"audio/wav"}),c.Uc.value.trim()+".wav"),c.Pc()},this.bd=function(){function a(t){(p+=t)>d.byteLength&&(d=ArrayBuffer.transfer(d,Math.max(2*d.byteLength,p)),m=new DataView(d))}function i(t){t>>>=0,a(4),m.setUint32(u,t,!1),u=p}function s(t){t>>>=0,a(3),m.setUint8(u,t>>16&255),m.setUint8(u+1,t>>8&255),m.setUint8(u+2,255&t),u=p}function r(t){t>>>=0,a(2),m.setUint16(u,t,!1),u=p}function o(t){t>>>=0,a(1),m.setUint8(u,t),u=p}function h(t,e){e=e>>>0&127|(1&t)<<7,a(1),m.setUint8(u,e),u=p}function l(t){if((t>>>=0)>268435455)throw new Error("writeVariableLength value too big.");for(var e=!1,n=0;n<4;n++){var a=21-7*n,i=t>>>a&127;0==i&&3!=n||(e=!0),e&&h(3==n?0:1,i)}}function f(t){l(t.length);for(var e=0;e<t.length;e++){var n=t.charCodeAt(e);if(n>127)throw new Error("Trying to write unicode character as ascii.");o(n)}}var u=0,p=0,d=new ArrayBuffer(1024),m=new DataView(d),g=c.R.song,b=96/g.partsPerBeat,v=b/4,C=g.getBeatsPerMinute(),y=Math.round(6e7/C),R=60/(96*C),w=96*g.beatsPerBar,x=[];if(c.Vc.checked)for(var P=0;P<g.loopStart;P++)x.push(P);for(var N=0;N<Number(c.Wc.value);N++)for(var P=g.loopStart;P<g.loopStart+g.loopLength;P++)x.push(P);if(c.Xc.checked)for(var P=g.loopStart+g.loopLength;P<g.barCount;P++)x.push(P);for(var L=[{isMeta:!0,channel:-1,midiChannel:-1,isChorus:!1,isDrums:!1}],k=0,A=0;A<c.R.song.getChannelCount();A++)c.R.song.getChannelIsDrum(A)?(L.push({isMeta:!1,channel:A,midiChannel:k++,isChorus:!1,isDrums:!0}),9==k&&k++):(L.push({isMeta:!1,channel:A,midiChannel:k++,isChorus:!1,isDrums:!1}),9==k&&k++,L.push({isMeta:!1,channel:A,midiChannel:k++,isChorus:!0,isDrums:!1}),9==k&&k++);i(1297377380),i(6),r(1),r(L.length),r(96);for(var M=0,E=L;M<E.length;M++){var S=E[M];!function(n){i(1297379947);var a=n.isMeta,d=n.channel,C=n.midiChannel,P=n.isChorus,N=n.isDrums,L=u;p+=4,u=p;var k=0,A=0,M=function(t){if(t<k)throw new Error("Midi event time cannot go backwards.");l(t-k),k=t};if(a){M(0),r(65281),f("http://www.beepbox.co/#"+g.toBase64String()),M(0),s(16732419),s(y),M(0),s(16734212),o(g.beatsPerBar),o(2),o(24),o(8);var E=g.scale<10&&1==(1&g.scale),S=11-g.key,B=S;for(1==(1&S)&&(B+=6),E&&(B+=9);B>6;)B-=12;M(0),s(16734466),o(B),o(E?1:0),c.Vc.checked&&(A+=w*g.loopStart),M(A),r(65286),f("Loop Start");for(var I=0;I<Number(c.Wc.value);I++)A+=w*g.loopLength,M(A),r(65286),f(I<Number(c.Wc.value)-1?"Loop Repeat":"Loop End");if(c.Xc.checked&&(A+=w*(g.barCount-g.loopStart-g.loopLength)),A!=w*x.length)throw new Error("Miscalculated number of bars.")}else{var F=g.getChannelIsDrum(d)?t.Config.midiDrumChannelNames[d-g.pitchChannelCount]:t.Config.midiPitchChannelNames[d];P&&(F+=" chorus"),M(0),r(65283),f(F),M(A),o(176|C),h(0,126),h(0,1),M(A),o(176|C),h(0,68),h(0,127);for(var D=-1,T=-1,O=-1,V=N?33:t.Config.keyTransposes[g.key],H=N?t.Config.drumInterval:1,Y=0,j=x;Y<j.length;Y++){var U=j[Y],W=g.getPattern(d,U);if(null!=W){var z=W.instrument,Z=g.channels[d].instruments[z];if(P&&(N||1==Z.type||0==Z.chorus)){A+=w;continue}if(D!=z){D=z;var G="",q=81;if(N)G+="type: "+t.Config.instrumentTypeNames[2],G+=", noise: "+t.Config.drumNames[Z.wave],G+=", volume: "+t.Config.volumeNames[Z.volume],G+=", transition: "+t.Config.transitionNames[Z.transition],G+=", harm: "+t.Config.harmNames[Z.harm],G+=", octoff: "+t.Config.octoffNames[Z.octoff],q=126;else if(G+="type: "+t.Config.instrumentTypeNames[Z.type],0==Z.type){G+=", wave: "+t.Config.waveNames[Z.wave],G+=", volume: "+t.Config.volumeNames[Z.volume],G+=", transition: "+t.Config.transitionNames[Z.transition],G+=", filter: "+t.Config.filterNames[Z.filter],G+=", chorus: "+t.Config.chorusNames[Z.chorus],G+=", effect: "+t.Config.effectNames[Z.effect],G+=", harm: "+t.Config.harmNames[Z.harm],G+=", imute: "+Z.imute,G+=", ipan: "+t.Config.ipanValues[Z.ipan],G+=", octoff: "+t.Config.octoffNames[Z.octoff];var X=0==t.Config.filterDecays[Z.filter]?t.Config.midiSustainInstruments:t.Config.midiDecayInstruments;q=X[Z.wave]}else if(1==Z.type){G+=", transition: "+t.Config.transitionNames[Z.transition],G+=", effect: "+t.Config.effectNames[Z.effect],G+=", octoff: "+t.Config.octoffNames[Z.octoff],G+=", fmChorus: "+t.Config.fmChorusNames[Z.fmChorus],G+=", algorithm: "+t.Config.midiAlgorithmNames[Z.algorithm],G+=", feedbackType: "+t.Config.midiFeedbackNames[Z.feedbackType],G+=", feedbackAmplitude: "+Z.feedbackAmplitude,G+=", feedbackEnvelope: "+t.Config.operatorEnvelopeNames[Z.feedbackEnvelope],G+=", volume: "+t.Config.volumeNames[Z.volume];for(var J=0;J<t.Config.operatorCount;J++){var K=Z.operators[J];G+=", operator"+(J+1)+": {",G+="frequency: "+t.Config.midiFrequencyNames[K.frequency],G+=", amplitude: "+K.amplitude,G+=", envelope: "+t.Config.operatorEnvelopeNames[K.envelope],G+="}"}}else{if(3!=Z.type)throw new Error("Unrecognized instrument type.");G+=", wave: "+t.Config.waveNames[Z.wave],G+=", volume: "+t.Config.volumeNames[Z.volume],G+=", transition: "+t.Config.transitionNames[Z.transition],G+=", filter: "+t.Config.filterNames[Z.filter],G+=", chorus: "+t.Config.chorusNames[Z.chorus],G+=", effect: "+t.Config.effectNames[Z.effect],G+=", harm: "+t.Config.harmNames[Z.harm],G+=", imute: "+Z.imute,G+=", ipan: "+t.Config.ipanValues[Z.ipan],G+=", octoff: "+t.Config.octoffNames[Z.octoff];var X=0==t.Config.filterDecays[Z.filter]?t.Config.midiSustainInstruments:t.Config.midiDecayInstruments;q=X[Z.wave]}M(A),r(65284),f(G),M(A),o(192|C),h(0,q);var _=(5-Z.volume)/5;N||1!=Z.type||(_=1),M(A),o(176|C),h(0,7),h(0,Math.round(127*_))}var Q=Z.effect,$=t.Config.effectVibratos[Q],tt=t.Config.effectTremolos[Q],et=0,nt=!1,at=!0;if(!N)if(0==Z.type||3==Z.type)et=t.Config.chorusIntervals[Z.chorus],P||(et*=-1),et+=t.Config.chorusOffsets[Z.chorus],nt=t.Config.chorusHarmonizes[Z.chorus];else{if(1!=Z.type)throw new Error("Unrecognized instrument type.");at=!1}for(var it=0;it<W.notes.length;it++){for(var st=W.notes[it],rt=A+st.start*b,ot=rt,ht=st.pins[0].volume,lt=st.pins[0].interval,ct=V+st.pitches[0]*H,ft=1;ft<st.pins.length;ft++){for(var ut=rt+st.pins[ft].time*b,pt=st.pins[ft].volume,dt=st.pins[ft].interval,mt=ut-ot,gt=0;gt<mt;gt++){var bt=ot+gt,vt=e(ht,pt,gt/mt),Ct=e(lt,dt,gt/mt),yt=Math.floor(gt/v)%4,Rt=st.pitches[0];at&&(nt?P&&(2==st.pitches.length?Rt=st.pitches[1]:3==st.pitches.length?Rt=st.pitches[1+(yt>>1)]:4==st.pitches.length&&(Rt=st.pitches[(3==yt?1:yt)+1])):2==st.pitches.length?Rt=st.pitches[yt>>1]:3==st.pitches.length?Rt=st.pitches[3==yt?1:yt]:4==st.pitches.length&&(Rt=st.pitches[yt]));var wt=Ct*H+et,xt=Math.round(wt),Pt=wt-xt,Nt=Pt,Lt=Math.sin(2*Math.PI*(bt-A)*R/.14);(2!=Q||bt-rt>=3*b)&&(Nt+=$*Lt);var kt=Math.max(0,Math.min(16383,Math.round(8192+4096*Nt))),At=vt/3,Mt=1+tt*(Lt-1),Et=Math.round(127*At*Mt);kt!=T&&(M(bt),o(224|C),h(0,127&kt),h(0,kt>>7&127)),Et!=O&&(M(bt),o(176|C),h(0,11),h(0,Et)),Rt=V+Rt*H+xt,bt==rt?(M(bt),o(144|C),h(0,Rt),h(0,64)):Rt!=ct&&(M(bt),o(144|C),h(0,Rt),h(0,64),M(bt),o(128|C),h(0,ct),h(0,64)),T=kt,O=Et,ct=Rt}ot=ut,ht=pt,lt=dt}M(A+st.end*b),o(128|C),h(0,ct),h(0,64)}}A+=w}}M(A),s(16723712),m.setUint32(L,u-L-4,!1)}(S)}d=ArrayBuffer.transfer(d,p),n(new Blob([d],{type:"audio/mid"}),c.Uc.value.trim()+".midi"),c.Pc()},this.cd=function(){var t=c.R.song.toJsonObject(c.Vc.checked,Number(c.Wc.value),c.Xc.checked),e=JSON.stringify(t,null,"\t");n(new Blob([e],{type:"application/json"}),c.Uc.value.trim()+".json"),c.Pc()},this.Wc.value="1",0==this.R.song.loopStart?(this.Vc.checked=!1,this.Vc.disabled=!0):(this.Vc.checked=!0,this.Vc.disabled=!1),this.R.song.loopStart+this.R.song.loopLength==this.R.song.barCount?(this.Xc.checked=!1,this.Xc.disabled=!0):(this.Xc.checked=!0,this.Xc.disabled=!1),this.Uc.addEventListener("input",o._c),this.Wc.addEventListener("blur",o.Sc),this.Yc.addEventListener("click",this.ad),this.Zc.addEventListener("click",this.bd),this.$c.addEventListener("click",this.cd),this.Oc.addEventListener("click",this.Pc)}return o._c=function(t){var e=t.target,n=/[\+\*\$\?\|\{\}\\\/<>#%!`&'"=:@]/gi;if(n.test(e.value)){var a=e.selectionStart;e.value=e.value.replace(n,""),a--,e.setSelectionRange(a,a)}},o.Sc=function(t){var e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""},o}();t.ExportPrompt=o}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,a=t.html.input,i=t.html.text,s=function(){function s(s,r){var o=this;this.R=s,this.zb=r,this.dd=a({type:"file",accept:".json,application/json"}),this.Oc=e({},[i("Cancel")]),this.container=n({className:"prompt",style:"width: 200px;"},[n({style:"font-size: 2em"},[i("Import")]),n({style:"text-align: left;"},[i("BeepBox songs can be exported and re-imported as .json files. You could also use other means to make .json files for BeepBox as long as they follow the same structure.")]),this.dd,this.Oc]),this.Pc=function(){o.R.undo()},this.cleanUp=function(){o.dd.removeEventListener("change",o.ed),o.Oc.removeEventListener("click",o.Pc)},this.ed=function(){var e=o.dd.files[0];if(e){var n=new FileReader;n.addEventListener("load",function(e){o.R.prompt=null,o.R.record(new t.ChangeSong(o.R,n.result),!0)}),n.readAsText(e)}},this.dd.addEventListener("change",this.ed),this.Oc.addEventListener("click",this.Pc)}return s}();t.ImportPrompt=s}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,a=t.html.text,i=function(){function i(i,s){var r=this;this.R=i,this.zb=s,this.Oc=e({},[a("Close")]),this.container=n({className:"prompt",style:"width: 300px;"},[n({style:"font-size: 2em"},[a("FM Synthesis")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("Popularized by the Sega Genesis and Yamaha keyboards, FM Synthesis is a mysterious but powerful technique for crafting sounds. It may seem confusing, but just play around with the options until you get a feel for it, check out some examples in "),t.html.element("a",{target:"_blank",href:"#6n10s0kbl00e07t5m0a7g07j7i7r1o2T1d2c0A0F1B0V1Q0200Pff00E0411T1d1c0A0F0B0V1Q2800Pf700E0711T1d2c0A0F1B4VaQ0200Pfb00E0911T1d1c2A0F9B3V1Q1000Pfbc0E0191T1d2c0AcF8B5V1Q0259PffffE0000T1d3c1AcF4B5V4Q2600Pff00E0011T1d1c0AbF0B0V1Q2580PfffaE2226T1d1c0A1F0B0V1Q520dPff4dEd41eb4zhmu0p21h5dfxd7ij7XrjfiAjPudUTtUSRsTzudTudJvdUTztTzrpPudUTtUSSYTzudTudJTdUTztTzrvPudUTtUSQ"},[a("this demo")]),a(", or find some instruments to use in the Beepbox Discord's FM sheet "),t.html.element("a",{target:"_blank",href:"https://docs.google.com/spreadsheets/d/1ddbXnrP7yvv5X4oUur9boi3AxcI-Xxz1XIHIAo-wi0s/edit#gid=230623845"},[a("right here")]),a(".")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("This FM instrument uses up to four waves, numbered 1, 2, 3, and 4. Each wave may have its own frequency, volume, and volume envelope to control its effect over time. ")]),n({style:"text-align: left; margin: 0.5em 0;"},[a('There are two kinds of waves: "carrier" waves play a tone out loud, but "modulator" waves distort other waves instead. Wave 1 is always a carrier and plays a tone, but other waves may distort it. The "Algorithm" setting determines which waves are modulators, and which other waves those modulators distort. ')]),n({style:"text-align: left; margin: 0.5em 0;"},[a('Modulators distort in one direction (like 1←2), but you can also use "Feedback" to make any wave distort in the opposite direction (1→2), in both directions (1🗘2), or even itself (1⟲). ')]),n({style:"text-align: left; margin: 0.5em 0;"},[a("You can set the pitch of each wave independently by adding simultaneous notes, one above another. This often sounds harsh or dissonant, but can make cool sound effects! ")]),this.Oc]),this.Pc=function(){r.R.undo()},this.cleanUp=function(){r.Oc.removeEventListener("click",r.Pc)},this.Oc.addEventListener("click",this.Pc)}return i}();t.InstrumentTypePrompt=i}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,a=t.html.text,i=function(){function t(t,i){var s=this;this.R=t,this.zb=i,this.Oc=e({},[a("Close")]),this.container=n({className:"prompt",style:"width: 250px;"},[n({style:"font-size: 2em"},[a("Custom Harmony")]),n({style:"text-align: left;"},[a('BeepBox "chip" instruments play two waves at once, each with their own pitch.')]),n({style:"text-align: left;"},[a('By placing two notes one above another it will play two indivdual sounds. This replaces the "arpeggio/trill" effect, and gives you greater control over your harmony. ')]),n({style:"text-align: left;"},[a("In older versions of Modbox, union would not allow notes to harmonize properly and needed a special harmonic chorus in order to work. This has been patched in Modbox 3.1.0. ")]),this.Oc]),this.Pc=function(){s.R.undo()},this.cleanUp=function(){s.Oc.removeEventListener("click",s.Pc)},this.Oc.addEventListener("click",this.Pc)}return t}();t.ChorusPrompt=i}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,a=t.html.text,i=function(){function t(t,i){var s=this;this.R=t,this.zb=i,this.Oc=e({},[a("Close")]),this.container=n({className:"prompt",style:"width: 300px;"},[n({style:"font-size: 2em"},[a("Mixing Styles")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("Mixing styles are a way how changing how loud or soft different sounds are and can change the way different sounds blend and mix together. Using different mixing styles can drastically change your song.")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("Type A Mixing is akin to mixing in vanilla Beepbox, Sandbox, and most other beepbox mods. In this mixing type, the drums are about twice as loud as in Type B mixing and the sound is generally a bit sharper and blends together differently.")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("Type B Mixing is regular Modbox mixing.")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("Type C Mixing is like Type B, save for a few upgrades. There are more volume options in Type C mixing, certain waves (acoustic bass, lyre, ramp pulse, and piccolo) are a bit quieter, the flatline wave is a bit louder, and blending works slightly differently.")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("Type D Mixing includes slightly quieter drums from Type B, but also includes sharper sounds for regular notes in pitch channels.")]),this.Oc]),this.Pc=function(){s.R.undo()},this.cleanUp=function(){s.Oc.removeEventListener("click",s.Pc)},this.Oc.addEventListener("click",this.Pc)}return t}();t.MixPrompt=i}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,a=t.html.text,i=function(){function t(t,i){var s=this;this.R=t,this.zb=i,this.Oc=e({},[a("Close")]),this.container=n({className:"prompt",style:"width: 250px;"},[n({style:"font-size: 2em"},[a("Song Data")]),n({style:"text-align: left;"},[a("You are on update Nepbox 2.0")]),n({style:"text-align: left;"},[a("Your song is "+this.R.synth.totalSeconds+" seconds long.")]),n({style:"text-align: left;"},[a("Your song runs at "+this.R.song.getBeatsPerMinute()+" beats per minute.")]),n({style:"text-align: left;"},[a("There are currently "+this.R.song.getChannelUnusedCount()+" unused channels in your song out of 16.")]),n({style:"text-align: left;"},[a("Your are using the "+this.R.song.getThemeName()+" theme.")]),n({style:"text-align: left;"},[a("Your time signuature is "+this.R.song.getTimeSig())]),n({style:"text-align: left;"},[a("Your scale is "+this.R.song.getScaleNKey()+".")]),this.Oc]),this.Pc=function(){s.R.undo()},this.cleanUp=function(){s.Oc.removeEventListener("click",s.Pc)},this.Oc.addEventListener("click",this.Pc)}return t}();t.SongDataPrompt=i}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,a=t.html.text,i=function(){function i(i,s,r){var o=this;this.R=i,this.zb=s,this.fd=r,this.Oc=e({},[a("Close")]),this.gd=e({},[a("Refresh")]),this.container=n({className:"prompt",style:"width: 200px;"},[n({style:"font-size: 1em"},[a("Refresh?")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("In order for the theme to change the song must refresh. If you refresh on your own after canceling your theme will not update.")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("If you use a browser that does not support automatic refreshing, like Microsoft Edge, you will have to refresh manually.")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("Would you like to refresh now?")]),this.gd,this.Oc]),this.Qc=function(){o.R.prompt=null,o.R.record(new t.ChangeTheme(o.R,o.fd),!0)},this.hd=function(){o.Qc(),o.zb.refreshNow()},this.cleanUp=function(){o.Oc.removeEventListener("click",o.Qc),o.gd.removeEventListener("click",o.hd)},this.Oc.addEventListener("click",this.Qc),this.gd.addEventListener("click",this.hd)}return i}();t.RefreshPrompt=i}(beepbox||(beepbox={}));var beepbox;!function(t){var e=t.html.button,n=t.html.div,a=t.html.text,i=function(){function i(i,s,r){var o=this;this.R=i,this.zb=s,this.jd=r,this.gd=e({},[a("Refresh")]),this.container=n({className:"prompt",style:"width: 200px;"},[n({style:"font-size: 1em"},[a("Refresh")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("Due to you using the Piano theme, you will need to refresh to display the change in key colors.")]),n({style:"text-align: left; margin: 0.5em 0;"},[a("You must refresh to continue.")]),this.gd]),this.hd=function(){o.R.prompt=null,o.R.record(new t.ChangeKey(o.R,o.jd)),o.zb.refreshNow()},this.cleanUp=function(){o.gd.addEventListener("click",o.hd)},this.gd.addEventListener("click",this.hd)}return i}();t.RefreshKeyPrompt=i}(beepbox||(beepbox={}));var beepbox;!function(t){function e(t,e){for(var n=0,a=e;n<a.length;n++){var i=a[n];t.appendChild(l(i,i,!1,!1))}return t}function n(t,e,n){if(e.length!=n.length)throw new Error("items and values don't have the same length");for(var a=0;a<e.length;a++){var i=e[a],s=n[a];t.appendChild(l(s,i,!1,!1))}return t}function a(t,e){t.selectedIndex!=e&&(t.selectedIndex=e)}function i(){document.hidden||(m.synth.play(),g.updatePlayButton(),window.removeEventListener("visibilitychange",i))}var s=t.html.button,r=t.html.div,o=t.html.span,h=t.html.select,l=t.html.option,c=t.html.input,f=t.html.text,u=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent),p=function(){function t(t,e,n){var a=this;this.input=t,this.R=e,this.kd=n,this.$b=null,this.ld=0,this.md=0,this.nd=function(){a.R.lastChangeWas(a.$b)||(a.md=a.ld),a.$b=a.kd(a.md,parseInt(a.input.value)),a.R.setProspectiveChange(a.$b)},this.od=function(){a.R.record(a.$b),a.$b=null},t.addEventListener("input",this.nd),t.addEventListener("change",this.od)}return t.prototype.updateValue=function(t){this.ld=t,this.input.value=String(t)},t}(),d=function(){function i(i){var d=this;this.R=i,this.prompt=null,this.pd=new t.PatternEditor(this.R),this.qd=new t.TrackEditor(this.R,this),this.rd=new t.LoopEditor(this.R),this.ic=r({className:"trackContainer"},[this.qd.container,this.rd.container]),this.sd=new t.BarScrollBar(this.R,this.ic),this.td=new t.OctaveScrollBar(this.R),this.ud=new t.Piano(this.R),this.vd=r({},[r({className:"editorBox",style:"height: 481px; display: flex; flex-direction: row; margin-bottom: 6px;"},[this.ud.container,this.pd.container,this.td.container]),this.ic,this.sd.container]),this.wd=s({style:"width: 80px;",type:"button"}),this.xd=s({className:"prevBarButton",style:"width: 45%; margin: 0px; margin-top: -2px;",type:"button",title:"Prev Bar (left bracket)"}),this.yd=s({className:"nextBarButton",style:"width: 45%; margin: 0px; margin-top: -2px;",type:"button",title:"Next Bar (right bracket)"}),this.zd=c({title:"main volume",style:"width: 5em; flex-grow: 1; margin: 0px;",type:"range",min:"0",max:"100",value:"50",step:"1"}),this.Ad=h({style:"width: 100%;"},[l("","Edit Menu",!0,!0),l("undo","Undo (Z)",!1,!1),l("redo","Redo (Y)",!1,!1),l("copy","Copy Pattern (C)",!1,!1),l("cut","Cut Pattern (X)",!1,!1),l("paste","Paste Pattern (V)",!1,!1),l("transposeUp","Shift Notes Up (+)",!1,!1),l("transposeDown","Shift Notes Down (-)",!1,!1),l("duration","Custom Song Size (Q)",!1,!1),l("import","Import JSON",!1,!1),l("cleanS","Clean Slate",!1,!1)]),this.Bd=h({style:"width: 100%;"},[l("","Preferences Menu",!0,!0),l("autoPlay","Auto Play On Load",!1,!1),l("autoFollow","Auto Follow Playhead",!1,!1),l("showLetters","Show Piano",!1,!1),l("showFifth","Highlight 'Fifth' Notes",!1,!1),l("showMore","Theme Colors+",!1,!1),l("showChannels","Show All Channels",!1,!1),l("showScrollBar","Octave Scroll Bar",!1,!1),l("showVolumeBar","Show Channel Volume",!1,!1),l("advancedSettings","Enable Advanced Settings",!1,!1)]),this.Cd=s({type:"button"},[f("New"),o({className:"fullWidthOnly"},[f(" Song")]),t.svgElement("svg",{style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-5 -21 26 26"},[t.svgElement("path",{d:"M 2 0 L 2 -16 L 10 -16 L 14 -12 L 14 0 z M 3 -1 L 13 -1 L 13 -11 L 9 -11 L 9 -15 L 3 -15 z",fill:"currentColor"})])]),this.Dd=s({type:"button"},[f("Song Data"),t.svgElement("svg",{style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-5 -21 26 26"},[t.svgElement("path",{d:"M 0 0 L 16 0 L 16 -13 L 10 -13 L 8 -16 L 0 -16 L 0 -13 z",fill:"currentColor"})])]),this.Ed=s({type:"button"},[o({className:"center"},[f("Custom Song Size")]),t.svgElement("svg",{style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-13 -13 26 26"},[t.svgElement("path",{d:"M -8 2 L -2 2 L -2 8 L 2 8 L 2 2 L 8 2 L 8 -2 L 2 -2 L 2 -8 L -2 -8 L -2 -2 L -8 -2 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z M -8 -8 L 8 -8 L 8 -9 L -8 -9 L -8 -8 z",fill:"currentColor"})])]),this.Fd=s({type:"button",style:"width: 45%; margin: 0px; margin-top: -2px;"},[f("Undo")]),this.Gd=s({type:"button",style:"width: 45%; margin: 0px; margin-top: -2px;"},[f("Redo")]),this.Hd=s({type:"button"},[f("Export"),t.svgElement("svg",{style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-13 -13 26 26"},[t.svgElement("path",{d:"M -8 3 L -8 8 L 8 8 L 8 3 L 6 3 L 6 6 L -6 6 L -6 3 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z",fill:"currentColor"})])]),this.Id=e(h({}),t.Config.scaleNames),this.Jd=e(h({}),t.Config.mixNames),this.Kd=e(h({}),t.Config.sampleRateNames),this.Ld=t.html.element("a",{className:"hintButton"},[f("?")]),this.Md=r({className:"selectRow"},[this.Ld,this.Jd]),this.Nd=t.html.element("a",{className:"hintButton"},[f("?")]),this.Od=e(h({}),t.Config.keyNames),this.Pd=e(h({}),t.Config.themeNames),this.Qd=new p(c({style:"margin: 0px;",type:"range",min:"0",max:t.Config.tempoSteps-1,value:"7",step:"1"}),this.R,function(e,n){return new t.ChangeTempo(d.R,e,n)}),this.Rd=new p(c({style:"margin: 0px;",type:"range",min:"0",max:t.Config.reverbRange-1,value:"0",step:"1"}),this.R,function(e,n){return new t.ChangeReverb(d.R,e,n)}),this.Sd=new p(c({style:"width: 9em; margin: 0px;",type:"range",min:"0",max:t.Config.blendRange-1,value:"0",step:"1"}),this.R,function(e,n){return new t.ChangeBlend(d.R,e,n)}),this.Td=new p(c({style:"width: 9em; margin: 0px;",type:"range",min:"0",max:t.Config.riffRange-1,value:"0",step:"1"}),this.R,function(e,n){return new t.ChangeRiff(d.R,e,n)}),this.Ud=new p(c({style:"width: 9em; margin: 0px;",type:"range",min:"0",max:t.Config.detuneRange-1,value:"0",step:"1"}),this.R,function(e,n){return new t.ChangeDetune(d.R,e,n)}),this.Vd=new p(c({style:"width: 9em; margin: 0px;",type:"range",min:"0",max:t.Config.muffRange-1,value:"0",step:"1"}),this.R,function(e,n){return new t.ChangeMuff(d.R,e,n)}),this.Wd=s({style:"width: 27px;",type:"button"}),this.Xd=s({style:"width: 27px;",type:"button"}),this.Yd=e(h({}),t.Config.partNames),this.Zd=n(h({}),t.Config.pitchChannelTypeNames,t.Config.pitchChannelTypeValues),this.$d=r({className:"selectRow"},[o({},[f("Type: ")]),this.Nd,r({className:"selectContainer"},[this.Zd])]),this._d=e(h({}),t.Config.operatorAlgorithmNames),this.ae=r({className:"selectRow"},[o({},[f("Algorithm: ")]),r({className:"selectContainer"},[this._d])]),this.be=h({}),this.ce=r({className:"selectRow",style:"display: none;"},[o({},[f("Instrument: ")]),r({className:"selectContainer"},[this.be])]),this.de=new p(c({style:"margin: 8px; width: 60px;",type:"range",min:"-9",max:"0",value:"0",step:"1"}),this.R,function(e,n){return new t.ChangeVolume(d.R,e,-n)}),this.ee=new p(c({style:"margin: 8px; width: 60px;",type:"range",min:"-5",max:"0",value:"0",step:"1"}),this.R,function(e,n){return new t.ChangeVolume(d.R,e,-n)}),this.fe=r({className:"selectRow"},[o({},[f("Volume: ")]),this.de.input,this.Wd]),this.ge=r({className:"selectRow"},[o({},[f("Volume: ")]),this.ee.input,this.Xd]),this.he=r({style:"margin: 3px 0; text-align: center;"},[f("Instrument Settings")]),this.ie=r({style:"margin: 3px 0; text-align: center;"},[f("Advanced Instrument Settings")]),this.je=e(h({}),t.Config.waveNames),this.ke=e(h({}),t.Config.drumNames),this.le=e(h({}),t.Config.pwmwaveNames),this.me=r({className:"selectRow"},[o({},[f("Wave: ")]),r({className:"selectContainer"},[this.je,this.le,this.ke])]),this.ne=e(h({}),t.Config.transitionNames),this.oe=e(h({}),t.Config.filterNames),this.pe=r({className:"selectRow"},[o({},[f("Filter: ")]),r({className:"selectContainer"},[this.oe])]),this.qe=e(h({}),t.Config.chorusNames),this.re=t.html.element("a",{className:"hintButton"},[f("?")]),this.se=r({className:"selectRow"},[o({},[f("Chorus: ")]),r({className:"selectContainer"},[this.qe])]),this.te=e(h({}),t.Config.effectNames),this.ue=r({className:"selectRow"},[o({},[f("Effect: ")]),r({className:"selectContainer"},[this.te])]),this.ve=e(h({}),t.Config.harmDisplay),this.we=r({className:"selectRow"},[o({},[f("Chord: ")]),this.re,r({className:"selectContainer"},[this.ve])]),this.xe=e(h({}),t.Config.octoffNames),this.ye=r({className:"selectRow"},[o({},[f("Octave Offset: ")]),r({className:"selectContainer"},[this.xe])]),this.ze=e(h({}),t.Config.fmChorusDisplay),this.Ae=r({className:"selectRow"},[o({},[f("FM Chorus: ")]),r({className:"selectContainer"
},[this.ze])]),this.Be=new p(c({style:"margin: 8px; width: 100px;",type:"range",min:"-8",max:"0",value:"0",step:"1"}),this.R,function(e,n){return new t.ChangeIpan(d.R,e,-n)}),this.Ce=r({className:"selectRow"},[o({},[f("Panning: ")]),o({},[f("L")]),this.Be.input,o({},[f("R")])]),this.De=r({style:"display: flex; flex-direction: column; display: none;"},[]),this.Ee=e(h({}),t.Config.operatorFeedbackNames),this.Fe=r({className:"selectRow"},[o({},[f("Feedback:")]),r({className:"selectContainer"},[this.Ee])]),this.Ge=new p(c({style:"margin: 0px; width: 4em;",type:"range",min:"0",max:t.Config.operatorAmplitudeMax,value:"0",step:"1",title:"Feedback Amplitude"}),this.R,function(e,n){return new t.ChangeFeedbackAmplitude(d.R,e,n)}),this.He=e(h({style:"width: 100%;",title:"Feedback Envelope"}),t.Config.operatorEnvelopeNames),this.Ie=r({className:"operatorRow"},[r({style:"margin-right: .1em; visibility: hidden;"},[f("1.")]),r({style:"width: 3em; margin-right: .3em;"}),this.Ge.input,r({className:"selectContainer",style:"width: 5em; margin-left: .3em;"},[this.He])]),this.Je=r({},[this.he,this.ce,this.$d,this.ge,this.fe,this.me,r({className:"selectRow"},[o({},[f("Transitions: ")]),r({className:"selectContainer"},[this.ne])]),this.pe,this.se,this.ue,this.ae,this.De,this.Fe,this.Ie]),this.Ke=r({},[this.ie,this.Ce,this.we,this.ye,this.Ae]),this.Le=r({className:"promptContainer",style:"display: none;"}),this.Me=r({className:"editor-song-settings",style:"margin: 0px 5px;"},[r({style:"margin: 3px 0; text-align: center;"},[f("Advanced Song Settings")]),r({className:"selectRow"},[o({},[f("Mix: ")]),r({className:"selectContainer"},[this.Md])]),r({className:"selectRow"},[o({},[f("Sample Rate: ")]),r({className:"selectContainer"},[this.Kd])]),r({className:"selectRow"},[o({},[f("Blending: ")]),this.Sd.input]),r({className:"selectRow"},[o({},[f("Riff: ")]),this.Td.input]),r({className:"selectRow"},[o({},[f("Detune: ")]),this.Ud.input]),r({className:"selectRow"},[o({},[f("Muff: ")]),this.Vd.input])]),this.Ne=r({className:"editor-right-widget-column",style:"margin: 0px 5px;"},[r({className:"editor-widgets"},[r({style:"text-align: center;"},[f("Advanced Settings")]),r({style:"margin: 2px 0; display: flex; flex-direction: row; align-items: center;"},[]),r({className:"editor-menus"},[this.Cd,this.Ed,this.Dd,r({style:"margin: 5px 0; display: flex; flex-direction: row; justify-content: space-between;"},[this.xd,this.Fd,this.Gd,this.yd])]),r({className:"editor-settings"},[this.Me,r({className:"editor-instrument-settings"},[this.Ke])])])]),this.mainLayer=r({className:"beepboxEditor",tabIndex:"0"},[this.vd,r({className:"editor-widget-column"},[r({style:"text-align: center; align-items: center;"},[f("Nepbox 2.0")]),r({style:"margin: 5px 0; display: flex; flex-direction: row; align-items: center;"},[this.wd,r({style:"width: 1px; height: 10px;"}),t.svgElement("svg",{width:"2em",height:"2em",viewBox:"0 0 26 26"},[t.svgElement("path",{d:"M 4 17 L 4 9 L 8 9 L 12 5 L 12 21 L 8 17 z",fill:t.Config.volumeColorPallet[this.R.song.theme]}),t.svgElement("path",{d:"M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z",fill:t.Config.volumeColorPallet[this.R.song.theme]}),t.svgElement("path",{d:"M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z",fill:t.Config.volumeColorPallet[this.R.song.theme]})]),r({style:"width: 1px; height: 10px;"}),this.zd]),r({className:"editor-widgets"},[r({className:"editor-menus"},[r({className:"selectContainer menu"},[this.Ad,t.svgElement("svg",{style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-5 -21 26 26"},[t.svgElement("path",{d:"M 0 0 L 1 -4 L 4 -1 z M 2 -5 L 10 -13 L 13 -10 L 5 -2 zM 11 -14 L 13 -16 L 14 -16 L 16 -14 L 16 -13 L 14 -11 z",fill:"currentColor"})])]),r({className:"selectContainer menu"},[this.Bd,t.svgElement("svg",{style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-13 -13 26 26"},[t.svgElement("path",{d:"M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z",fill:"currentColor"})])]),this.Hd]),r({className:"editor-settings"},[r({className:"editor-song-settings"},[r({style:"margin: 3px 0; text-align: center; color: #999;"},[f("Song Settings")]),r({className:"selectRow"},[o({},[f("Theme: ")]),r({className:"selectContainer",style:"margin: 3px 0; text-align: center; color: #ccc;"},[this.Pd])]),r({className:"selectRow"},[o({},[f("Scale: ")]),r({className:"selectContainer",style:"margin: 3px 0; text-align: center; color: #ccc;"},[this.Id])]),r({className:"selectRow"},[o({},[f("Key: ")]),r({className:"selectContainer",style:"margin: 3px 0; text-align: center; color: #ccc;"},[this.Od])]),r({className:"selectRow"},[o({},[f("Tempo: ")]),this.Qd.input]),r({className:"selectRow"},[o({},[f("Reverb: ")]),this.Rd.input]),r({className:"selectRow"},[o({},[f("Rhythm: ")]),r({className:"selectContainer",style:"margin: 3px 0; text-align: center; color: #ccc;"},[this.Yd])])]),r({className:"editor-instrument-settings"},[this.Je])])])]),this.Ne,this.Le]),this.Oe=null,this.Pe=[],this.Qe=[],this.Re=[],this.Se=[],this.Te=function(){d.mainLayer.focus()},this.whenUpdated=function(){var n=d.ic.getBoundingClientRect();d.R.trackVisibleBars=Math.floor((n.right-n.left)/32),d.sd.render(),d.qd.render();for(var i=[(d.R.autoPlay?"✓ ":"✗ ")+"Auto Play On Load",(d.R.autoFollow?"✓ ":"✗ ")+"Auto Follow Track",(d.R.showLetters?"✓ ":"✗ ")+"Show Piano",(d.R.showFifth?"✓ ":"✗ ")+"Highlight 'Fifth' Notes",(d.R.showMore?"✓ ":"✗ ")+"Advanced Color Scheme",(d.R.showChannels?"✓ ":"✗ ")+"Show All Channels",(d.R.showScrollBar?"✓ ":"✗ ")+"Octave Scroll Bar",(d.R.showVolumeBar?"✓ ":"✗ ")+"Show Channel Volume",(d.R.advancedSettings?"✓ ":"✗ ")+"Enable Advanced Settings"],s=0;s<i.length;s++){var r=d.Bd.children[s+1];r.innerText!=i[s]&&(r.innerText=i[s])}var o=d.R.song.channels[d.R.channel],h=d.R.getCurrentPattern(),l=d.R.getCurrentInstrument(),c=o.instruments[l],f=d.mainLayer.contains(document.activeElement),u=document.activeElement;if(a(d.Pd,d.R.song.theme),a(d.Id,d.R.song.scale),a(d.Jd,d.R.song.mix),a(d.Kd,d.R.song.sampleRate),a(d.Od,d.R.song.key),d.Qd.updateValue(d.R.song.tempo),d.Qd.input.title=d.R.song.getBeatsPerMinute()+" beats per minute",d.Rd.updateValue(d.R.song.reverb),d.Ne.style.display=d.R.advancedSettings?"":"none",d.Sd.updateValue(d.R.song.blend),d.Td.updateValue(d.R.song.riff),d.Ud.updateValue(d.R.song.detune),d.Vd.updateValue(d.R.song.muff),a(d.Yd,t.Config.partCounts.indexOf(d.R.song.partsPerBeat)),d.R.song.getChannelIsDrum(d.R.channel)?(2==d.R.song.mix?(d.fe.style.display="",d.ge.style.display="none"):(d.fe.style.display="none",d.ge.style.display=""),d.ke.style.display="",d.me.style.display="",d.$d.style.display="none",d.Zd.style.display="none",d.ae.style.display="none",d.De.style.display="none",d.Fe.style.display="none",d.Ie.style.display="none",d.je.style.display="none",d.le.style.display="none",d.pe.style.display="none",d.se.style.display="none",d.ue.style.display="none",d.Ce.style.display="",d.we.style.display="",d.ye.style.display="",d.Ae.style.display="none"):(d.$d.style.display="",d.Zd.style.display="",d.ue.style.display="",2==d.R.song.mix?(d.fe.style.display="",d.ge.style.display="none"):(d.fe.style.display="none",d.ge.style.display=""),d.ke.style.display="none",0==c.type?(d.je.style.display="",d.le.style.display="none",d.me.style.display="",d.pe.style.display="",d.se.style.display="",d.we.style.display="",d.ae.style.display="none",d.De.style.display="none",d.Fe.style.display="none",d.Ie.style.display="none",d.Ce.style.display="",d.ye.style.display="",d.Ae.style.display="none"):3==c.type?(d.je.style.display="none",d.le.style.display="",d.me.style.display="",d.pe.style.display="none",d.se.style.display="none",d.we.style.display="none",d.ae.style.display="none",d.De.style.display="none",d.Fe.style.display="none",d.Ie.style.display="none",d.Ce.style.display="",d.ye.style.display="",d.Ae.style.display="none"):(d.ae.style.display="",d.De.style.display="",d.Fe.style.display="",d.Ie.style.display="",d.we.style.display="none",d.me.style.display="none",d.pe.style.display="none",d.se.style.display="none",d.Ce.style.display="",d.ye.style.display="",d.Ae.style.display="")),d.Zd.value=c.type+"",a(d._d,c.algorithm),d.ce.style.display=d.R.song.instrumentsPerChannel>1?"":"none",d.ce.style.visibility=null==h?"hidden":"",d.be.children.length!=d.R.song.instrumentsPerChannel){for(;d.be.firstChild;)d.be.removeChild(d.be.firstChild);for(var p=[],s=0;s<d.R.song.instrumentsPerChannel;s++)p.push(s+1);e(d.be,p)}0==c.imute?(d.Je.style.color=d.R.song.getNoteColorBright(d.R.channel),d.Ke.style.color=d.R.song.getNoteColorDim(d.R.channel),d.Me.style.color="#aaaaaa",d.Wd.innerText="◉",d.Xd.innerText="◉"):(d.Je.style.color="#cccccc",d.Ke.style.color="#aaaaaa",d.Me.style.color="#aaaaaa",d.Wd.innerText="◎",d.Xd.innerText="◎"),a(d.je,c.wave),a(d.ke,c.wave),a(d.le,c.wave),a(d.oe,c.filter),a(d.ne,c.transition),a(d.te,c.effect),a(d.qe,c.chorus),a(d.ve,c.harm),a(d.xe,c.octoff),a(d.ze,c.fmChorus),a(d.Ee,c.feedbackType),d.Ge.updateValue(c.feedbackAmplitude),a(d.He,c.feedbackEnvelope),d.He.parentElement.style.color=c.feedbackAmplitude>0?"":"#999",d.de.updateValue(-c.volume),d.ee.updateValue(-c.volume),d.Be.updateValue(-c.ipan),a(d.be,l);for(var s=0;s<t.Config.operatorCount;s++){var m=s<t.Config.operatorCarrierCounts[c.algorithm];d.Pe[s].style.color=m?"white":"",a(d.Se[s],c.operators[s].frequency),d.Qe[s].updateValue(c.operators[s].amplitude),a(d.Re[s],c.operators[s].envelope);var g=(m?"Voice ":"Modulator ")+(s+1);d.Se[s].title=g+" Frequency",d.Qe[s].input.title=g+(m?" Volume":" Amplitude"),d.Re[s].title=g+" Envelope",d.Re[s].parentElement.style.color=c.operators[s].amplitude>0?"":"#999"}d.ud.container.style.display=d.R.showLetters?"":"none",d.td.container.style.display=d.R.showScrollBar?"":"none",d.sd.container.style.display=d.R.song.barCount>d.R.trackVisibleBars?"":"none",d.Nd.style.display=1==c.type?"":"none",d.Ld.style.display=1!=d.R.song.mix?"":"none",d.re.style.display=t.Config.harmNames[c.harm]?"":"none";var b=512;d.R.showLetters&&(b-=32),d.R.showScrollBar&&(b-=20),d.pd.container.style.width=String(b)+"px",d.zd.value=String(d.R.volume),f&&0==u.clientWidth&&d.Te(),d.Ue(d.R.prompt),d.R.autoFollow&&!d.R.synth.playing&&d.R.synth.snapToBar(d.R.bar)},this.Ve=function(){var e=d.R.song.channels[d.R.channel],n=d.R.getCurrentInstrument(),a=e.instruments[n],i=a.imute,s=1==i,r=s?0:1;d.R.record(new t.ChangeImute(d.R,r)),0==a.imute?(d.Je.style.color=d.R.song.getNoteColorBright(d.R.channel),d.Ke.style.color=d.R.song.getNoteColorDim(d.R.channel),d.Me.style.color="#aaaaaa",d.Wd.innerText="◉",d.Xd.innerText="◉"):(d.Je.style.color="#cccccc",d.Ke.style.color="#aaaaaa",d.Me.style.color="#aaaaaa",d.Wd.innerText="◎",d.Xd.innerText="◎"),d.whenUpdated()},this.We=function(e){var n=!0;t:for(var a=0;a<d.R.song.getChannelCount();a++)for(var i=a!=e,s=d.R.song.channels[a],r=0;r<s.instruments.length;r++){var o=1==s.instruments[r].imute;if(o!=i){n=!1;break t}}for(var a=0;a<d.R.song.getChannelCount();a++)for(var s=d.R.song.channels[a],r=0;r<s.instruments.length;r++){s.instruments[r];d.R.record(new t.ChangeOtherImute(d.R,a,r,n?0:a!=e?1:0))}d.R.song.channels[d.R.channel].instruments[d.R.getCurrentInstrument()];d.Je.style.color="#cccccc",d.Ke.style.color="#aaaaaa",d.Me.style.color="#aaaaaa",d.Wd.innerText="◎",d.Xd.innerText="◎",d.whenUpdated()},this.Xe=function(e){if(d.prompt)return void(27==e.keyCode&&window.history.back());switch(d.qd.onKeyPressed(e),e.keyCode){case 83:d.We(d.R.channel),e.preventDefault();break;case 77:d.Ve(),e.preventDefault();break;case 32:d.Ye(),e.preventDefault();break;case 90:e.shiftKey?d.R.redo():d.R.undo(),e.preventDefault();break;case 89:d.R.redo(),e.preventDefault();break;case 88:d.Ze(),e.preventDefault();break;case 67:d.$e(),e.preventDefault();break;case 86:d._e(),e.preventDefault();break;case 219:d.R.synth.prevBar(),d.R.autoFollow&&new t.ChangeChannelBar(d.R,d.R.channel,Math.floor(d.R.synth.playhead)),e.preventDefault();break;case 221:d.R.synth.nextBar(),d.R.autoFollow&&new t.ChangeChannelBar(d.R,d.R.channel,Math.floor(d.R.synth.playhead)),e.preventDefault();break;case 189:case 173:d.af(!1),e.preventDefault();break;case 187:case 61:d.af(!0),e.preventDefault();break;case 81:d.bf("duration"),e.preventDefault()}},this.cf=function(){d.R.synth.prevBar()},this.df=function(){d.R.synth.nextBar()},this.Ye=function(){d.R.synth.playing?d.ef():d.ff()},this.gf=function(){d.R.setVolume(Number(d.zd.value))},this.hf=function(){d.R.record(new t.ChangeSong(d.R,"")),d.pd.resetCopiedPins()},this.if=function(){d.bf("duration")},this.jf=function(){d.R.undo()},this.kf=function(){d.R.redo()},this.lf=function(){d.bf("export")},this.mf=function(){d.bf("songdata")},this.nf=function(){d.bf("instrumentType")},this.pf=function(){d.bf("mix")},this.qf=function(){d.bf("chorus")},this.refreshNow=function(){setTimeout(function(){location.reload()},500)},this.rf=function(){d.bf("refresh")},this.sf=function(){d.R.record(new t.ChangeScale(d.R,d.Id.selectedIndex))},this.tf=function(){d.R.record(new t.ChangeMix(d.R,d.Jd.selectedIndex))},this.uf=function(){d.R.record(new t.ChangeSampleRate(d.R,d.Kd.selectedIndex))},this.vf=function(){19==d.R.song.theme?d.bf("refresh key"):d.R.record(new t.ChangeKey(d.R,d.Od.selectedIndex))},this.wf=function(){d.R.record(new t.ChangePartsPerBeat(d.R,t.Config.partCounts[d.Yd.selectedIndex]))},this.xf=function(){d.R.record(new t.ChangeInstrumentType(d.R,+d.Zd.value))},this.yf=function(){d.R.record(new t.ChangeFeedbackType(d.R,d.Ee.selectedIndex))},this.zf=function(){d.R.record(new t.ChangeFeedbackEnvelope(d.R,d.He.selectedIndex))},this.Af=function(){d.R.record(new t.ChangeAlgorithm(d.R,d._d.selectedIndex))},this.Bf=function(){var e=d.R.getCurrentPattern();null!=e&&d.R.record(new t.ChangePatternInstrument(d.R,d.be.selectedIndex,e))},this.Cf=function(){d.R.record(new t.ChangeWave(d.R,d.je.selectedIndex))},this.Df=function(){d.R.record(new t.ChangeWave(d.R,d.ke.selectedIndex))},this.Ef=function(){d.R.record(new t.ChangeWave(d.R,d.le.selectedIndex))},this.Ff=function(){d.R.record(new t.ChangeFilter(d.R,d.oe.selectedIndex))},this.Gf=function(){d.R.record(new t.ChangeTransition(d.R,d.ne.selectedIndex))},this.Hf=function(){d.R.record(new t.ChangeEffect(d.R,d.te.selectedIndex))},this.If=function(){d.R.record(new t.ChangeHarm(d.R,d.ve.selectedIndex))},this.Jf=function(){d.R.record(new t.ChangeFMChorus(d.R,d.ze.selectedIndex))},this.Kf=function(){d.R.record(new t.ChangeOctoff(d.R,d.xe.selectedIndex))},this.Lf=function(){d.R.record(new t.ChangeChorus(d.R,d.qe.selectedIndex))},this.Mf=function(t){switch(d.Ad.value){case"undo":d.R.undo();break;case"redo":d.R.redo();break;case"cut":d.Ze();break;case"copy":d.$e();break;case"paste":d._e();break;case"transposeUp":d.af(!0);break;case"transposeDown":d.af(!1);break;case"import":d.bf("import");break;case"cleanS":d.hf();break;case"duration":d.bf("duration")}d.Ad.selectedIndex=0},this.Nf=function(t){switch(d.Bd.value){case"autoPlay":d.R.autoPlay=!d.R.autoPlay;break;case"autoFollow":d.R.autoFollow=!d.R.autoFollow;break;case"showLetters":d.R.showLetters=!d.R.showLetters;break;case"showFifth":d.R.showFifth=!d.R.showFifth;break;case"showMore":d.R.showMore=!d.R.showMore;break;case"showChannels":d.R.showChannels=!d.R.showChannels;break;case"showScrollBar":d.R.showScrollBar=!d.R.showScrollBar;break;case"showVolumeBar":d.R.showVolumeBar=!d.R.showVolumeBar;break;case"advancedSettings":d.R.advancedSettings=!d.R.advancedSettings}d.Bd.selectedIndex=0,d.R.notifier.changed(),d.R.savePreferences()},this.R.notifier.watch(this.whenUpdated),this.De.appendChild(r({className:"operatorRow",style:"height: 1em; margin-top: 0.5em;"},[r({style:"margin-right: .1em; visibility: hidden;"},[f("1.")]),r({style:"width: 3em; margin-right: .3em;"},[f("Freq:")]),r({style:"width: 4em; margin: 0;"},[f("Volume:")]),r({style:"width: 5em; margin-left: .3em;"},[f("Envelope:")])]));for(var m=this,g=0;g<t.Config.operatorCount;g++)!function(n){var a=n,i=r({style:"margin-right: .1em; color: #999;"},[f(n+1+".")]),s=e(h({style:"width: 100%;",title:"Frequency"}),t.Config.operatorFrequencyNames),o=new p(c({style:"margin: 0; width: 4em;",type:"range",min:"0",max:t.Config.operatorAmplitudeMax,value:"0",step:"1",title:"Volume"}),m.R,function(e,n){return new t.ChangeOperatorAmplitude(d.R,a,e,n)}),l=e(h({style:"width: 100%;",title:"Envelope"}),t.Config.operatorEnvelopeNames),u=r({className:"operatorRow"},[i,r({className:"selectContainer",style:"width: 3em; margin-right: .3em;"},[s]),o.input,r({className:"selectContainer",style:"width: 5em; margin-left: .3em;"},[l])]);m.De.appendChild(u),m.Pe[n]=u,m.Qe[n]=o,m.Re[n]=l,m.Se[n]=s,l.addEventListener("change",function(){d.R.record(new t.ChangeOperatorEnvelope(d.R,a,l.selectedIndex))}),s.addEventListener("change",function(){d.R.record(new t.ChangeOperatorFrequency(d.R,a,s.selectedIndex))})}(g);this.Ad.addEventListener("change",this.Mf),this.Bd.addEventListener("change",this.Nf),this.Pd.addEventListener("change",this.rf),this.Id.addEventListener("change",this.sf),this.Jd.addEventListener("change",this.tf),this.Kd.addEventListener("change",this.uf),this.Od.addEventListener("change",this.vf),this.Yd.addEventListener("change",this.wf),this.Zd.addEventListener("change",this.xf),this._d.addEventListener("change",this.Af),this.be.addEventListener("change",this.Bf),this.Ee.addEventListener("change",this.yf),this.He.addEventListener("change",this.zf),this.je.addEventListener("change",this.Cf),this.ke.addEventListener("change",this.Df),this.le.addEventListener("change",this.Ef),this.ne.addEventListener("change",this.Gf),this.oe.addEventListener("change",this.Ff),this.qe.addEventListener("change",this.Lf),this.te.addEventListener("change",this.Hf),this.ve.addEventListener("change",this.If),this.xe.addEventListener("change",this.Kf),this.ze.addEventListener("change",this.Jf),this.Wd.addEventListener("click",this.Ve),this.Xd.addEventListener("click",this.Ve),this.wd.addEventListener("click",this.Ye),this.xd.addEventListener("click",this.cf),this.yd.addEventListener("click",this.df),this.Cd.addEventListener("click",this.hf),this.Dd.addEventListener("click",this.mf),this.Ed.addEventListener("click",this.if),this.Fd.addEventListener("click",this.jf),this.Gd.addEventListener("click",this.kf),this.Hd.addEventListener("click",this.lf),this.zd.addEventListener("input",this.gf),this.Nd.addEventListener("click",this.nf),this.Ld.addEventListener("click",this.pf),this.re.addEventListener("click",this.qf),this.vd.addEventListener("mousedown",this.Te),this.mainLayer.addEventListener("keydown",this.Xe),u&&(this.Bd.children[1].disabled=!0)}return i.prototype.bf=function(t){this.R.openPrompt(t),this.Ue(t)},i.prototype.Ue=function(e){if(this.prompt&&(this.Of&&this.ff(),this.Of=!1,this.Le.style.display="none",this.Le.removeChild(this.prompt.container),this.prompt.cleanUp(),this.prompt=null,this.mainLayer.focus()),e){switch(e){case"export":this.prompt=new t.ExportPrompt(this.R,this);break;case"import":this.prompt=new t.ImportPrompt(this.R,this);break;case"duration":this.prompt=new t.SongDurationPrompt(this.R,this);break;case"instrumentType":this.prompt=new t.InstrumentTypePrompt(this.R,this);break;case"mix":this.prompt=new t.MixPrompt(this.R,this);break;case"chorus":this.prompt=new t.ChorusPrompt(this.R,this);break;case"songdata":this.prompt=new t.SongDataPrompt(this.R,this);break;case"refresh":this.prompt=new t.RefreshPrompt(this.R,this,this.Pd.selectedIndex);break;case"refresh key":this.prompt=new t.RefreshKeyPrompt(this.R,this,this.Od.selectedIndex);break;default:throw new Error("Unrecognized prompt type.")}this.prompt&&(this.Of=this.R.synth.playing,this.ef(),this.Le.style.display=null,this.Le.appendChild(this.prompt.container))}},i.prototype.updatePlayButton=function(){this.R.synth.playing?(this.wd.classList.remove("playButton"),this.wd.classList.add("pauseButton"),this.wd.title="Pause (Space)",this.wd.innerText="Pause"):(this.wd.classList.remove("pauseButton"),this.wd.classList.add("playButton"),this.wd.title="Play (Space)",this.wd.innerText="Play")},i.prototype.ff=function(){this.R.synth.play(),this.updatePlayButton()},i.prototype.ef=function(){this.R.synth.pause(),this.R.autoFollow?this.R.synth.snapToBar(this.R.bar):this.R.synth.snapToBar(),this.updatePlayButton()},i.prototype.Ze=function(){var e=this.R.getCurrentPattern();null!=e&&(window.localStorage.setItem("patternCopy",JSON.stringify({notes:e.notes,beatsPerBar:this.R.song.beatsPerBar,partsPerBeat:this.R.song.partsPerBeat,drums:this.R.song.getChannelIsDrum(this.R.channel)})),this.R.record(new t.ChangePaste(this.R,e,[],this.R.song.beatsPerBar,this.R.song.partsPerBeat)))},i.prototype.$e=function(){var t=this.R.getCurrentPattern();if(null!=t){var e={notes:t.notes,beatsPerBar:this.R.song.beatsPerBar,partsPerBeat:this.R.song.partsPerBeat,drums:this.R.song.getChannelIsDrum(this.R.channel)};window.localStorage.setItem("patternCopy",JSON.stringify(e))}},i.prototype._e=function(){var e=this.R.getCurrentPattern();if(null!=e){var n=JSON.parse(String(window.localStorage.getItem("patternCopy")));null!=n&&n.drums==this.R.song.getChannelIsDrum(this.R.channel)&&this.R.record(new t.ChangePaste(this.R,e,n.notes,n.beatsPerBar,n.partsPerBeat))}},i.prototype.af=function(e){var n=this.R.getCurrentPattern();if(null!=n){var a=this.R.lastChangeWas(this.Oe);this.Oe=new t.ChangeTranspose(this.R,n,e),this.R.record(this.Oe,a)}},i}();t.SongEditor=d;var m=new t.SongDocument(location.hash),g=new d(m);document.getElementById("beepboxEditorContainer").appendChild(g.mainLayer),g.whenUpdated(),g.mainLayer.focus(),!u&&m.autoPlay&&(document.hidden?window.addEventListener("visibilitychange",i):i()),"scrollRestoration"in history&&(history.scrollRestoration="manual"),g.updatePlayButton()}(beepbox||(beepbox={}));
	</script>
</body></html>
