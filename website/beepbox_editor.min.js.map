{"version":3,"names":["scaleElementsByFactor","array","factor","i","length","countBits","n","isPowerOf2","Error","Math","round","log","inverseRealFourierTransform","fullArrayLength","totalPasses","pass","subStride","midSubStride","stride","radiansIncrement","PI","cosIncrement","cos","sinIncrement","sin","oscillatorMultiplier","startIndex","startIndexA","midIndexA","startIndexB","midIndexB","stopIndex","realStartA","imagStartB","c","s","cPrev","sPrev","index","indexA0","indexA1","indexB0","indexB1","real0","real1","imag0","imag1","tempA","tempB","cTemp","sTemp","index1","index2","index3","imag2","imag3","bitCount","finalShift","j","temp","reverseIndexBits","Config","_centerWave","wave","sum","average","Float64Array","getDrumWave","_drumWaves","Float32Array","drumBuffer","newBuffer","random","drawNoiseSpectrum","sqrt","lowOctave","highOctave","lowPower","highPower","overalSlope","lowIndex","pow","highIndex","log2","amplitude","radians","generateSineWave","sineWaveLength","toNameMap","dictionary","value","name","result","scaleNames","scaleFlags","pianoScaleFlags","blackKeyNameParents","pitchNames","keyNames","keyTransposes","mixNames","sampleRateNames","tempoSteps","reverbRange","blendRange","riffRange","detuneRange","muffRange","beatsPerBarMin","beatsPerBarMax","barCountMin","barCountMax","patternsPerChannelMin","patternsPerChannelMax","instrumentsPerChannelMin","instrumentsPerChannelMax","partNames","partCounts","waveNames","waveVolumes","drumNames","drumVolumes","drumBasePitches","drumPitchFilterMult","drumWaveIsSoft","pwmwaveNames","pwmwaveVolumes","filterNames","filterBases","filterDecays","filterVolumes","transitionNames","effectNames","effectVibratos","effectTremolos","effectVibratoDelays","chorusNames","chorusIntervals","chorusOffsets","chorusVolumes","chorusSigns","chorusRiffApp","chorusHarmonizes","harmDisplay","harmNames","fmChorusDisplay","fmChorusNames","imuteNames","imuteValues","octoffNames","octoffValues","volumeNames","volumeValues","volumeMValues","ipanValues","operatorCount","operatorAlgorithmNames","midiAlgorithmNames","operatorModulatedBy","operatorAssociatedCarrier","operatorCarrierCounts","operatorCarrierChorus","operatorAmplitudeMax","operatorFrequencyNames","midiFrequencyNames","operatorFrequencies","operatorHzOffsets","operatorAmplitudeSigns","operatorEnvelopeNames","operatorEnvelopeType","operatorSpecialCustomVolume","operatorEnvelopeSpeed","operatorEnvelopeInverted","operatorFeedbackNames","midiFeedbackNames","operatorFeedbackIndices","pitchChannelTypeNames","pitchChannelTypeValues","drumChannelTypeNames","instrumentTypeNames","themeNames","volumeColorPallet","sliderOneColorPallet","sliderOctaveColorPallet","sliderOctaveNotchColorPallet","buttonColorPallet","noteOne","noteTwo","noteThree","noteFour","noteSix","noteSeven","noteEight","noteFive","noteNine","noteTen","noteEleven","noteTwelve","baseNoteColorPallet","secondNoteColorPallet","thirdNoteColorPallet","fourthNoteColorPallet","sixthNoteColorPallet","seventhNoteColorPallet","eigthNoteColorPallet","fifthNoteColorPallet","ninthNoteColorPallet","tenNoteColorPallet","elevenNoteColorPallet","twelveNoteColorPallet","channelOneBrightColorPallet","channelTwoBrightColorPallet","channelThreeBrightColorPallet","channelFourBrightColorPallet","channelFiveBrightColorPallet","channelSixBrightColorPallet","channelSevenBrightColorPallet","channelEightBrightColorPallet","channelNineBrightColorPallet","channelTenBrightColorPallet","channelElevenBrightColorPallet","channelTwelveBrightColorPallet","channelThirteenBrightColorPallet","channelFourteenBrightColorPallet","channelFifteenBrightColorPallet","channelSixteenBrightColorPallet","channelOneDimColorPallet","channelTwoDimColorPallet","channelThreeDimColorPallet","channelFourDimColorPallet","channelFiveDimColorPallet","channelSixDimColorPallet","channelSevenDimColorPallet","channelEightDimColorPallet","channelNineDimColorPallet","channelTenDimColorPallet","channelElevenDimColorPallet","channelTwelveDimColorPallet","channelThirteenDimColorPallet","channelFourteenDimColorPallet","channelFifteenDimColorPallet","channelSixteenDimColorPallet","pitchChannelColorsDim","pitchChannelColorsBright","pitchNoteColorsDim","pitchNoteColorsBright","drumChannelColorsDim","drumChannelColorsBright","drumNoteColorsDim","drumNoteColorsBright","midiPitchChannelNames","midiDrumChannelNames","midiSustainInstruments","midiDecayInstruments","drumInterval","drumCount","pitchCount","maxPitch","pitchChannelCountMin","pitchChannelCountMax","drumChannelCountMin","drumChannelCountMax","waves","wavesMixC","pwmwaves","sineWaveMask","sineWave","applyElementArgs","element","args","args_1","__values","args_1_1","next","done","arg","Node","appendChild","document","createTextNode","Array","isArray","Symbol","iterator","__spread","constructor","Object","Element","_d","e_2","keys","_e","key","setAttribute","join","console","warn","tagName","_f","e_3","_g","styleKey","style","setProperty","removeAttribute","svgNS","HTML","_i","arguments","createRange","createContextualFragment","SVG","fragment","createDocumentFragment","svgParser","DOMParser","parseFromString","documentElement","firstChild","importNode","name_1","createElement","_c","split","name_2","createElementNS","test","snakeCaseName","replace","BitFieldReader","base64CharCodeToInt","source","this","_bits","_readIndex","charCodeAt","push","read","readLongTail","minValue","minBits","numBits","readPartDuration","readPinCount","readPitchInterval","BitFieldWriter","write","writeLongTail","writePartDuration","writePinCount","writePitchInterval","concat","other","encodeBase64","base64IntToCharCode","buffer","lengthBase64","ceil","makeNotePin","interval","time","volume","makeNote","pitch","start","end","fadeout","pitches","pins","Pattern","notes","instrument","cloneNotes","oldNote","newNote","oldPin","reset","Operator","frequency","envelope","copy","Instrument","type","filter","transition","effect","harm","fmChorus","imute","octoff","chorus","ipan","algorithm","feedbackType","feedbackAmplitude","feedbackEnvelope","operators","setTypeAndReset","Channel","octave","instruments","patterns","bars","Song","string","channels","_fingerprint","undefined","fromBase64String","initToDefault","getChannelCount","pitchChannelCount","drumChannelCount","getChannelUnusedCount","getThemeName","theme","getTimeSig","beatsPerBar","partsPerBeat","barCount","getScaleNKey","scale","getChannelIsDrum","channel","getChannelColorDim","getChannelColorBright","getNoteColorDim","getNoteColorBright","andResetChannels","mix","sampleRate","loopStart","loopLength","tempo","reverb","blend","riff","detune","muff","patternsPerChannel","instrumentsPerChannel","channelIndex","pattern","bar","toBase64String","bits","_base64IntToCharCode","_latestVersion","indexOf","o","neededBits","neededInstrumentBits","isDrum","octaveOffset","lastPitch","recentPitches","recentShapes","p","curPart","t","shapeBits","shapePart","startPitch","currentPitch","pitchBends","pin","nextPitch","shapeString","String","fromCharCode","apply","shapeIndex","splice","unshift","pop","allPitches","pitchIndex","pitchIter","stringLength","digits","prototype","compressed","charIndex","fromJsonObject","JSON","parse","substring","version","_base64CharCodeToInt","_oldestVersion","beforeThree","beforeFour","beforeFive","beforeSix","instrumentChannelIterator","instrumentIndexIterator","command","_clip","max","min","isPitchChannel","instrumentType","isDrums","subStringLength","bitStringLength","bitStringLengthLength","note","newPattern","newNotes","useOldShape","shape","pinObj","pinCount","initialVolume","bendCount","pitchBend","intervalIter","shift","toJsonObject","enableIntro","loopCount","enableOutro","channelArray","instrumentArray","operatorArray","operator","patternArray","noteArray","pointArray","tick","points","sequenceArray","l","octaveScrollBar","sequence","format","_format","introBars","loopBars","ticksPerBeat","beatsPerMinute","getBeatsPerMinute","jsonObject","oldScaleNames","letter","charAt","toUpperCase","symbol","toLowerCase","C","D","E","F","G","A","B","offset","b","bpm","LN2","maxInstruments","maxPatterns","maxBars","channelObject","instrumentObject","oldTransitionNames","binary","transitionObject","oldFilterNames","operatorObject","patternObject","maxNoteCount","tickClock","noteObject","k","noteClock","startInterval","pointObject","lowestPitch","highestPitch","val","getPattern","patternIndex","getPatternInstrument","getPatternInstrumentMute","instrumentIndex","getPatternInstrumentVolume","getChannelFingerprint","channelCount","charCount","SynthChannel","sampleLeft","sampleRight","phases","phaseDeltas","volumeStarts","volumeDeltas","volumeLeft","volumeRight","phaseDeltaScale","filterScale","vibratoScale","harmonyMult","harmonyVolumeMult","feedbackOutputs","feedbackMult","feedbackDelta","Synth","warmUpSynthesizer","song","getGeneratedSynthesizer","operatorAmplitudeCurve","playing","paused","playhead","playheadInternal","remainder","floor","beat","part","arpeggio","samplesPerArpeggio","getSamplesPerArpeggio","arpeggioSampleCountdown","totalSamples","samplesPerBar","loopMinCount","totalSeconds","samplesPerSecond","totalBars","effectDuration","effectAngle","effectYMult","limitDecay","pianoPressed","pianoPitch","pianoChannel","stillGoing","effectPhase","limit","delayLineLeft","delayLineRight","delayPosLeft","delayPosRight","delayFeedback0Left","delayFeedback0Right","delayFeedback1Left","delayFeedback1Right","delayFeedback2Left","delayFeedback2Right","delayFeedback3Left","delayFeedback3Right","audioProcessCallback","audioProcessingEvent","outputBuffer","outputDataLeft","getChannelData","outputDataRight","synthesize","setSong","spsCalc","audioCtx","play","contextClass","window","scriptNode","createScriptProcessor","createJavaScriptNode","onaudioprocess","connect","destination","channelCountMode","channelInterpretation","pause","close","snapToStart","snapToBar","nextBar","oldBar","prevBar","dataLeft","dataRight","bufferLength","bufferIndex","ended","generatedSynthesizer","computeOperatorEnvelope","beats","customVolume","curve","attack","speed","computeChannelInstrument","synth","sampleTime","samples","synthChannel","pianoMode","basePitch","intervalScale","pitchDamping","secondsPerPart","beatsPerPart","partsSinceStart","resetPhases","intervalStart","intervalEnd","transitionVolumeStart","transitionVolumeEnd","envelopeVolumeStart","envelopeVolumeEnd","partTimeStart","partTimeEnd","decayTimeStart","decayTimeEnd","prevNote","nextNote","endPinIndex","startPin","endPin","noteStart","noteEnd","pinStart","pinEnd","tickTimeStart","tickTimeEnd","pinRatioStart","pinRatioEnd","envelopeVolumeTickStart","envelopeVolumeTickEnd","transitionVolumeTickStart","transitionVolumeTickEnd","intervalTickStart","intervalTickEnd","partTimeTickStart","partTimeTickEnd","decayTimeTickStart","decayTimeTickEnd","startRatio","endRatio","volumeConversion","harmonyOffset","endPitch","startFreq","frequencyFromPitch","pitchVolumeStart","pitchVolumeEnd","settingsVolumeMult","filterScaleRate","endFilter","instrumentVolumeMult","volumeEnd","sineVolumeBoost","totalCarrierVolume","carrierCount","isCarrier","associatedCarrierIndex","freqMult","amplitudeCurve","amplitudeMult","volumeStart","volumeMult","feedbackStart","feedbackEnd","fingerprint","generatedSynthesizers","synthSource","line","synthSourceTemplate","outputs","operatorLine","operatorSourceTemplate","modulators","modulatorNumber","feedbackIndices","feedbacks","Function","noteVolume","arpeggioPerSecond","negativePhaseGuard","Change","_noop","_didSomething","isNoop","UndoableChange","reversed","super","_reversed","_doneForwards","undo","_doForwards","_doBackwards","redo","_isDoneForwards","ChangeGroup","append","change","ChangeSequence","changes","_changes","ChangePins","_doc","_note","_oldStart","_oldEnd","_newStart","_newEnd","_oldPins","_newPins","_oldPitches","_newPitches","_finishSetup","firstInterval","firstTime","notifier","changed","ChangeInstrumentType","doc","newValue","getCurrentInstrument","ChangeTransition","ChangePattern","oldValue","ChangeBarCount","newBar","newBarScrollPos","barScrollPos","newLoopStart","newLoopLength","trackVisibleBars","ChangeInsertBars","count","newLength","ChangeDeleteBars","ChangeChannelCount","newPitchChannelCount","newDrumChannelCount","newChannels","oldChannel","ChangeBeatsPerBar","ChangeNoteTruncate","ChangeChannelOrder","selectionMin","selectionMax","ChangeAddChannel","isNoise","newNoiseChannelCount","addedChannelIndex","ChangeRemoveChannel","minIndex","maxIndex","ChangeChannelBar","newChannel","ChangeChorus","ChangeEffect","ChangeHarm","ChangeFMChorus","ChangeOctoff","ChangeImute","ChangeIpan","ChangeFilter","ChangeAlgorithm","ChangeFeedbackType","ChangeFeedbackEnvelope","ChangeOperatorEnvelope","operatorIndex","ChangeOperatorFrequency","ChangeOperatorAmplitude","ChangeFeedbackAmplitude","ChangeInstrumentsPerChannel","newInstrumentsPerChannel","sampleInstrument","newInstrument","ChangeKey","ChangeTheme","ChangeLoop","oldStart","oldLength","newStart","ChangePitchAdded","deletion","_pitch","_index","ChangeOctave","ChangePartsPerBeat","ChangeRhythm","ChangePaste","newBeatsPerBar","newPartsPerBeat","ChangePatternInstrument","ChangePatternsPerChannel","channelBars","channelPatterns","ChangeEnsurePatternExists","_patternOldNotes","_bar","_channel","_oldPatternCount","_newPatternCount","firstEmptyUnusedIndex","firstUnusedIndex","used","barIndex","_patternIndex","ChangePinTime","pinIndex","shiftedTime","originalTime","skipStart","skipEnd","setPin","ChangePitchBend","bendStart","bendEnd","bendTo","direction","stop","setStart","setEnd","prevInterval","prevVolume","persist","item","oldPartsPerBeat","changeRhythm","oldTime","ChangeNoteAdded","ChangeRhythmNote","ChangeScale","ChangeMix","ChangeSampleRate","ChangeSong","newHash","ChangeTempo","ChangeReverb","ChangeBlend","ChangeRiff","ChangeDetune","ChangeMuff","_pattern","ChangeNoteLength","truncStart","truncEnd","pushLastPin","skipNote","ChangeTransposeNote","upward","foundMatch","diff","ChangeTranspose","ChangeVolume","ChangeVolumeBend","bendPart","bendVolume","bendInterval","inserted","ChangeWave","ColorConfig","getChannelColor","pitchChannels","noiseChannels","setTheme","_styleElement","textContent","_themeMap","usesPianoScheme","getComputedStyle","getPropertyValue","trim","colorLookup","Map","default","nepbox","modbox2","artic","Ocean","rainbow","float","windows","grassland","dessert","kahootiest","beambit","egg","Poniryoshka","gameboy","woodkid","midnight","snedbox","unnamed","piano","halloween","frozen","pageMargin","editorBackground","hoverPreview","primaryText","secondaryText","invertedText","textSelection","boxSelectionFill","loopAccent","linkAccent","uiWidgetBackground","uiWidgetFocus","pitchBackground","tonic","fifthNote","pitch1Background","pitch2Background","pitch3Background","pitch4Background","pitch5Background","pitch6Background","pitch8Background","pitch9Background","pitch10Background","pitch11Background","volumeIcon","octaveScrollbar","scrollbarOctave","channelBox","blackPianoKey","whitePianoKey","secondaryChannel","primaryChannel","secondaryNote","primaryNote","head","div","prettyNumber","toFixed","PatternCursor","valid","curNote","curIndex","notePart","nearPinIndex","PatternEditor","_svgNoteBackground","id","x","y","width","height","patternUnits","_svgDrumBackground","_svgBackground","rect","fill","_svgNoteContainer","svg","_svgPlayhead","_svgPreview","path","stroke","_svg","viewBox","preserveAspectRatio","defs","container","_defaultPitchHeight","_defaultDrumHeight","_backgroundPitchRows","_backgroundDrumRow","_defaultPinChannels","_editorHeight","_mouseX","_mouseY","_mouseDown","_mouseOver","_mouseDragging","_mouseHorizontal","_usingTouch","_copiedPinChannels","_mouseXStart","_mouseYStart","_mouseXPrev","_mouseYPrev","_dragTime","_dragPitch","_dragVolume","_dragVisible","_dragChange","_cursor","_playheadX","_octaveOffset","_renderedWidth","_renderedBeatWidth","_renderedFifths","_renderedACS","_renderedPiano","_renderedDrums","_setKey","_renderedPartsPerBeat","_renderedPitchChannelCount","_renderedDrumChannelCount","_followPlayheadBar","resetCopiedPins","maxDivision","_getMaxDivision","_animatePlayhead","timestamp","playheadBar","modPlayhead","abs","_editorWidth","autoFollow","notifyWatchers","requestAnimationFrame","_whenMouseOver","event","_whenMouseOut","_whenMousePressed","preventDefault","boundingRect","getBoundingClientRect","clientX","pageX","left","right","clientY","pageY","top","bottom","isNaN","_whenCursorPressed","_whenTouchPressed","touches","_whenMouseMoved","_whenCursorMoved","_whenTouchMoved","_whenCursorReleased","continuousState","lastChangeWas","record","getCurrentPattern","_copyPins","_updateCursorStatus","_updatePreview","_documentChanged","showLetters","showScrollBar","_partWidth","_pitchHeight","_pitchCount","_copiedPins","beatWidth","node","clone","cloneNode","parentNode","replaceChild","makeEmptyReplacementElement","visibility","showChannels","pattern2","notePath","_drawNote","oscillatorLabel","text","_pitchToPixelHeight","rectangle","backgroundColor","watch","addEventListener","mousePitch","_findMousePitch","prevPin","error","nextPin","leftSide","rightSide","intervalRatio","arc","bendHeight","minInterval","Number","MAX_VALUE","maxInterval","bestDistance","pinDistance","_snapToPitch","nearest","distance","defaultLength","fullBeats","modMouse","division","forceStart","forceEnd","pixelY","guess","topPitch","bottomPitch","topRange","bottomRange","setProspectiveChange","dx","dy","currentPart","backwards","directLength","blessedLength","theNote","shiftedPin","volumeRatio","minPitch","radius","pathString","render","showFifth","showMore","svgElement","showVolume","prevSide","nextSide","prevHeight","nextHeight","nextVolume","select","option","Box","color","_label","_rect","_vol1","_volb","_renderedIndex","_renderedDim","_renderedSelected","_renderedColor","setSquashed","squashed","setIndex","dim","selected","colorB","innerHTML","TrackEditor","_barWidth","_select","class","_boxContainer","g","_playhead","_boxHighlight","_upHighlight","_downHighlight","_grid","_digits","_channelHeight","_renderedChannelCount","_renderedBarCount","_renderedPatternCount","_renderedPlayhead","_renderedSquashed","_changePattern","_whenSelectChanged","_setPattern","selectedIndex","up","patternCount","_setChannelBar","_whenMouseReleased","forgetLastChange","currentValue","canReplaceLastChange","_nextDigit","digit","parsed","parseInt","wideScreen","innerWidth","center","middle","base","tip","removeChild","lastChild","selectedPattern","box","showVolumeBar","editorWidth","patternMute","patternVolume","mute","LoopEditor","_startMode","_endMode","_bothMode","_loop","_highlight","_change","startBar","mode","_clientStartX","_clientStartY","_startedScrolling","_draggingHorizontally","_renderedLoopStart","_renderedLoopStop","_whenTouchReleased","_render","_findEndPoints","oldEnd","endPoints","showHighlight","highlightStart","highlightStop","loopStop","BarScrollBar","_trackContainer","_notches","_handle","_handleHighlight","_leftHighlight","_rightHighlight","_dragging","_renderedNotchCount","_renderedBarPos","_onScroll","scrollLeft","_dragStart","capture","passive","showleftHighlight","showRightHighlight","showHandleHighlight","resized","lineHeight","OctaveScrollBar","_notchHeight","_octaveCount","_octaveHeight","_barHeight","_renderedBarBottom","_barBottom","currentOctave","showUpHighlight","showDownHighlight","canvas","finishedLoadingImages","onLoaded","BlackKey","onload","src","BlackKeyDisabled","WhiteKey","WhiteKeyDisabled","Drum","Piano","_canvas","_preview","_graphics","getContext","_previewGraphics","_renderedScale","_renderedKey","_updateCursorPitch","_cursorPitch","clearRect","pitchNameIndex","w","h","drawImage","brightness","imageData","getImageData","data","putImageData","shiftDir","textColor","font","fillStyle","fillText","lineWidth","strokeStyle","strokeRect","button","MixPrompt","_cancelButton","_close","cleanUp","removeEventListener","ChorusPrompt","input","save","blob","navigator","msSaveOrOpenBlob","anchor","download","url","URL","createObjectURL","setTimeout","revokeObjectURL","href","dispatchEvent","MouseEvent","open","location","ExportPrompt","_fileName","maxlength","_enableIntro","_loopDropDown","step","_enableOutro","_exportWavButton","_exportJsonButton","_validateFileName","_validateNumber","_whenExportToWav","_whenExportToJson","checked","introIter","sampleFrames","recordedSamplesLeft","recordedSamplesRight","sampleCount","arrayBuffer","ArrayBuffer","DataView","repeat","valLeft","valRight","setUint32","setUint16","setInt16","Blob","jsonString","stringify","disabled","target","deleteChars","cursorPos","selectionStart","setSelectionRange","ImportPrompt","_fileInput","accept","_whenFileSelected","file","files","reader","FileReader","prompt","readAsText","a","ArchivePrompt","RefreshPrompt","_songEditor","_newThemeValue","_refreshButton","_saveChanges","_saveChangesAndRefresh","refreshNow","SongDataPrompt","RefreshKeyPrompt","_newKeyValue","span","SongDurationPrompt","_beatsStepper","_barsStepper","_patternsStepper","_instrumentsStepper","_pitchChannelStepper","_drumChannelStepper","_okayButton","_validateKey","group","_validate","charCode","which","keyCode","InstrumentTypePrompt","ManualPrompt","_nextButton","_backButton","page","introContainer","instructionsContainer","aboutContainer","_backPage","_changePage","_nextPage","display","form","label","ThemePrompt","hasChanged","_closeButton","_previewButton","_previewText","previewExit","_form","title","themeContainer","localStorage","getItem","setItem","elements","_themeChange","_previewTheme","opacity","pointerEvents","_exitPreview","isMobile","userAgent","buildOptions","menu","items","setSelectedIndex","Slider","_getChange","_value","_oldValue","_whenInput","_whenChange","updateValue","SongEditor","_patternEditor","_trackEditor","_loopEditor","_barScrollBar","_octaveScrollBar","_piano","_editorBox","_playButton","_prevBarButton","_nextBarButton","_volumeSlider","_fileMenu","hidden","_editMenu","_optionsMenu","_newSongButton","d","_songDataButton","_customizeButton","_archiveButton","_undoButton","_redoButton","_exportButton","_scaleSelect","_mixSelect","_sampleRateSelect","_mixHint","_archiveHint","_mixSelectRow","_instrumentTypeHint","_keySelect","_themeSelect","_tempoSlider","_reverbSlider","_blendSlider","_riffSlider","_detuneSlider","_muffSlider","_imuteButton","_iMmuteButton","_partSelect","_instrumentTypeSelect","values","buildOptionsWithSpecificValues","_instrumentTypeSelectRow","_algorithmSelect","_algorithmSelectRow","_instrumentSelect","_instrumentSelectRow","_instrumentVolumeSlider","_instrumentMVolumeSlider","_instrumentVolumeSliderRow","_instrumentMVolumeSliderRow","_instrumentSettingsLabel","_advancedInstrumentSettingsLabel","_waveSelect","_drumSelect","_pwmwaveSelect","_waveSelectRow","_transitionSelect","_filterSelect","_filterSelectRow","_chorusSelect","_chorusHint","_chorusSelectRow","_effectSelect","_effectSelectRow","_harmSelect","_harmSelectRow","_octoffSelect","_octoffSelectRow","_fmChorusSelect","_fmChorusSelectRow","_ipanSlider","_ipanSliderRow","_phaseModGroup","_feedbackTypeSelect","_feedbackRow1","_feedbackAmplitudeSlider","_feedbackEnvelopeSelect","_feedbackRow2","_instrumentSettingsGroup","_advancedInstrumentSettingsGroup","_promptContainer","_advancedSongSettings","_advancedSettingsContainer","mainLayer","tabIndex","_changeTranspose","_operatorRows","_operatorAmplitudeSliders","_operatorEnvelopeSelects","_operatorFrequencySelects","_refocusStage","focus","whenUpdated","trackBounds","optionCommands","autoPlay","advancedSettings","children","innerText","wasActive","contains","activeElement","instrumentList","parentElement","operatorName","patternWidth","clientWidth","_setPrompt","_muteInstrument","_whenKeyPressed","history","back","ctrlKey","_togglePlay","shiftKey","_cut","_copy","_paste","_transpose","_openPrompt","_whenPrevBarPressed","_whenNextBarPressed","_pause","_play","_setVolumeSlider","setVolume","_whenNewSongPressed","_whenCustomizePressed","_advancedUndo","_advancedRedo","_openExportPrompt","_openSongDataPrompt","_openInstrumentTypePrompt","_openMixPrompt","_openChorusPrompt","_openArchivePrompt","reload","_whenSetTheme","_whenSetScale","_whenSetMix","_whenSetSampleRate","_whenSetKey","_whenSetPartsPerBeat","_whenSetInstrumentType","_whenSetFeedbackType","_whenSetFeedbackEnvelope","_whenSetAlgorithm","_whenSetInstrument","_whenSetWave","_whenSetDrum","_whenSetPWMWave","_whenSetFilter","_whenSetTransition","_whenSetEffect","_whenSetHarm","_whenSetFMChorus","_whenSetOctoff","_whenSetChorus","_fileMenuHandler","_editMenuHandler","_optionsMenuHandler","savePreferences","operatorNumber","frequencySelect","amplitudeSlider","envelopeSelect","row","promptName","openPrompt","_wasPlaying","updatePlayButton","classList","remove","add","drums","patternCopy","ChangeNotifier","_watchers","_dirty","watcher","unwatch","SongDocument","_recentChange","_sequenceNumber","_barFromCurrentState","_channelFromCurrentState","_shouldPushState","_waitingToUpdateState","_whenHistoryStateChanged","state","sequenceNumber","canUndo","hash","replaceState","_cleanDocument","_updateHistoryState","pushState","_calcVolume","eventName","forward","editor","getElementById","autoplay","scrollRestoration","serviceWorker","register","updateViaCache","scope","catch"],"sources":["../synth/FFT.ts","../synth/SynthConfig.ts","../node_modules/imperative-html/src/elements-base.ts","../node_modules/imperative-html/src/elements-strict.ts","../synth/synth.ts","../editor/Change.ts","../editor/changes.ts","../editor/ColorConfig.ts","../editor/PatternEditor.ts","../editor/TrackEditor.ts","../editor/LoopEditor.ts","../editor/BarScrollBar.ts","../editor/OctaveScrollBar.ts","../editor/Piano.ts","../editor/MixPrompt.ts","../editor/ChorusPrompt.ts","../editor/ExportPrompt.ts","../editor/ImportPrompt.ts","../editor/ArchivePrompt.ts","../editor/RefreshPrompt.ts","../editor/SongDataPrompt.ts","../editor/RefreshKeyPrompt.ts","../editor/SongDurationPrompt.ts","../editor/InstrumentTypePrompt.ts","../editor/ManualPrompt.ts","../editor/ThemePrompt.ts","../editor/SongEditor.ts","../editor/ChangeNotifier.ts","../editor/SongDocument.ts","../editor/style.ts","../editor/main.ts"],"sourcesContent":["/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\n\n\t// interface shared by number[], Float32Array, and other typed arrays in JavaScript.\n\tinterface NumberArray {\n\t\tlength: number;\n\t\t[index: number]: number;\n\t}\n\t\n\t// A basic FFT operation scales the overall magnitude of elements by the\n\t// square root of the length of the array, √N. Performing a forward FFT and\n\t// then an inverse FFT results in the original array, but multiplied by N.\n\t// This helper function can be used to compensate for that. \n\texport function scaleElementsByFactor(array: NumberArray, factor: number): void {\n\t\tfor (let i: number = 0; i < array.length; i++) {\n\t\t\tarray[i] *= factor;\n\t\t}\n\t}\n\t\n\tfunction isPowerOf2(n: number): boolean {\n\t\treturn !!n && !(n & (n - 1));\n\t}\n\t\n\tfunction countBits(n: number): number {\n\t\tif (!isPowerOf2(n)) throw new Error(\"FFT array length must be a power of 2.\");\n\t\treturn Math.round(Math.log(n) / Math.log(2));\n\t}\n\t\n\t// Rearranges the elements of the array, swapping the element at an index\n\t// with an element at an index that is the bitwise reverse of the first\n\t// index in base 2. Useful for computing the FFT.\n\tfunction reverseIndexBits(array: NumberArray): void {\n\t\tconst fullArrayLength: number = array.length;\n\t\tconst bitCount: number = countBits(fullArrayLength);\n\t\tif (bitCount > 16) throw new Error(\"FFT array length must not be greater than 2^16.\");\n\t\tconst finalShift: number = 16 - bitCount;\n\t\tfor (let i: number = 0; i < fullArrayLength; i++) {\n\t\t\t// Dear Javascript: Please support bit order reversal intrinsics. Thanks! :D\n\t\t\tlet j: number;\n\t\t\tj = ((i & 0xaaaa) >> 1) | ((i & 0x5555) << 1);\n\t\t\tj = ((j & 0xcccc) >> 2) | ((j & 0x3333) << 2);\n\t\t\tj = ((j & 0xf0f0) >> 4) | ((j & 0x0f0f) << 4);\n\t\t\tj = ((j           >> 8) | ((j &   0xff) << 8)) >> finalShift;\n\t\t\tif (j > i) {\n\t\t\t\tlet temp: number = array[i];\n\t\t\t\tarray[i] = array[j];\n\t\t\t\tarray[j] = temp;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/* Commented out functions that BeepBox doesn't use...\n\t\n\t// Provided for educational purposes. Easier to read than\n\t// fastFourierTransform(), but computes the same result.\n\t// Takes two parallel arrays representing the real and imaginary elements,\n\t// respectively, and returns an array containing two new arrays, which\n\t// contain the complex result of the transform.\n\texport function discreteFourierTransform(realArray: NumberArray, imagArray: NumberArray): number[][] {\n\t\tconst fullArrayLength: number = realArray.length;\n\t\tif (fullArrayLength != imagArray.length) throw new Error(\"FFT arrays must be the same length.\");\n\t\tconst realOut: number[] = [];\n\t\tconst imagOut: number[] = [];\n\t\tfor (let i: number = 0; i < fullArrayLength; i++) {\n\t\t\trealOut[i] = 0.0;\n\t\t\timagOut[i] = 0.0;\n\t\t\tfor (let j: number = 0; j < fullArrayLength; j++) {\n\t\t\t\tconst radians: number = -6.2831853 * j * i / fullArrayLength;\n\t\t\t\tconst c: number = Math.cos(radians);\n\t\t\t\tconst s: number = Math.sin(radians);\n\t\t\t\trealOut[i] += realArray[j] * c - imagArray[j] * s;\n\t\t\t\timagOut[i] += realArray[j] * s + imagArray[j] * c;\n\t\t\t}\n\t\t}\n\t\treturn [realOut, imagOut];\n\t}\n\t\n\t// Performs a Fourier transform in O(N log(N)) operations. Overwrites the\n\t// input real and imaginary arrays. Can be used for both forward and inverse\n\t// transforms: swap the order of the arguments for the inverse.\n\texport function fastFourierTransform(realArray: NumberArray, imagArray: NumberArray): void {\n\t\tconst fullArrayLength: number = realArray.length;\n\t\tif (!isPowerOf2(fullArrayLength)) throw new Error(\"FFT array length must be a power of 2.\");\n\t\tif (fullArrayLength < 4) throw new Error(\"FFT array length must be at least 4.\");\n\t\tif (fullArrayLength != imagArray.length) throw new Error(\"FFT arrays must be the same length.\");\n\t\t\n\t\treverseIndexBits(realArray);\n\t\treverseIndexBits(imagArray);\n\t\t\n\t\t// First two passes, with strides of 2 and 4, can be combined and optimized.\n\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += 4) {\n\t\t\tconst startIndex1: number = startIndex + 1;\n\t\t\tconst startIndex2: number = startIndex + 2;\n\t\t\tconst startIndex3: number = startIndex + 3;\n\t\t\tconst real0: number = realArray[startIndex ];\n\t\t\tconst real1: number = realArray[startIndex1];\n\t\t\tconst real2: number = realArray[startIndex2];\n\t\t\tconst real3: number = realArray[startIndex3];\n\t\t\tconst imag0: number = imagArray[startIndex ];\n\t\t\tconst imag1: number = imagArray[startIndex1];\n\t\t\tconst imag2: number = imagArray[startIndex2];\n\t\t\tconst imag3: number = imagArray[startIndex3];\n\t\t\tconst realTemp0: number = real0 + real1;\n\t\t\tconst realTemp1: number = real0 - real1;\n\t\t\tconst realTemp2: number = real2 + real3;\n\t\t\tconst realTemp3: number = real2 - real3;\n\t\t\tconst imagTemp0: number = imag0 + imag1;\n\t\t\tconst imagTemp1: number = imag0 - imag1;\n\t\t\tconst imagTemp2: number = imag2 + imag3;\n\t\t\tconst imagTemp3: number = imag2 - imag3;\n\t\t\trealArray[startIndex ] = realTemp0 + realTemp2;\n\t\t\trealArray[startIndex1] = realTemp1 + imagTemp3;\n\t\t\trealArray[startIndex2] = realTemp0 - realTemp2;\n\t\t\trealArray[startIndex3] = realTemp1 - imagTemp3;\n\t\t\timagArray[startIndex ] = imagTemp0 + imagTemp2;\n\t\t\timagArray[startIndex1] = imagTemp1 - realTemp3;\n\t\t\timagArray[startIndex2] = imagTemp0 - imagTemp2;\n\t\t\timagArray[startIndex3] = imagTemp1 + realTemp3;\n\t\t}\n\t\t\n\t\tfor (let stride: number = 8; stride <= fullArrayLength; stride += stride) {\n\t\t\tconst halfLength: number = stride >>> 1;\n\t\t\tconst radiansIncrement: number = Math.PI * 2.0 / stride;\n\t\t\tconst cosIncrement: number = Math.cos(radiansIncrement);\n\t\t\tconst sinIncrement: number = Math.sin(radiansIncrement);\n\t\t\tconst oscillatorMultiplier: number = 2.0 * cosIncrement;\n\t\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += stride) {\n\t\t\t\tlet c: number = 1.0;\n\t\t\t\tlet s: number = 0.0;\n\t\t\t\tlet cPrev: number = cosIncrement;\n\t\t\t\tlet sPrev: number = sinIncrement;\n\t\t\t\tconst secondHalf: number = startIndex + halfLength;\n\t\t\t\tfor (let i: number = startIndex; i < secondHalf; i++) {\n\t\t\t\t\tconst j: number = i + halfLength;\n\t\t\t\t\tconst real0: number = realArray[i];\n\t\t\t\t\tconst imag0: number = imagArray[i];\n\t\t\t\t\tconst real1: number = realArray[j] * c - imagArray[j] * s;\n\t\t\t\t\tconst imag1: number = realArray[j] * s + imagArray[j] * c;\n\t\t\t\t\trealArray[i] = real0 + real1;\n\t\t\t\t\timagArray[i] = imag0 + imag1;\n\t\t\t\t\trealArray[j] = real0 - real1;\n\t\t\t\t\timagArray[j] = imag0 - imag1;\n\t\t\t\t\tconst cTemp: number = oscillatorMultiplier * c - cPrev;\n\t\t\t\t\tconst sTemp: number = oscillatorMultiplier * s - sPrev;\n\t\t\t\t\tcPrev = c;\n\t\t\t\t\tsPrev = s;\n\t\t\t\t\tc = cTemp;\n\t\t\t\t\ts = sTemp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// Computes the Fourier transform from an array of real-valued time-domain\n\t// samples. The output is specially formatted for space efficieny: elements\n\t// 0 through N/2 represent cosine wave amplitudes in ascending frequency,\n\t// and elements N/2+1 through N-1 represent sine wave amplitudes in\n\t// descending frequency. Overwrites the input array.\n\texport function forwardRealFourierTransform(array: NumberArray): void {\n\t\tconst fullArrayLength: number = array.length;\n\t\tconst totalPasses: number = countBits(fullArrayLength);\n\t\tif (fullArrayLength < 4) throw new Error(\"FFT array length must be at least 4.\");\n\t\t\n\t\treverseIndexBits(array);\n\t\t\n\t\t// First and second pass.\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 4) {\n\t\t\tconst index1: number = index + 1;\n\t\t\tconst index2: number = index + 2;\n\t\t\tconst index3: number = index + 3;\n\t\t\tconst real0: number = array[index ];\n\t\t\tconst real1: number = array[index1];\n\t\t\tconst real2: number = array[index2];\n\t\t\tconst real3: number = array[index3];\n\t\t\t// no imaginary elements yet since the input is fully real.\n\t\t\tconst tempA: number = real0 + real1;\n\t\t\tconst tempB: number = real2 + real3;\n\t\t\tarray[index ] = tempA + tempB;\n\t\t\tarray[index1] = real0 - real1;\n\t\t\tarray[index2] = tempA - tempB;\n\t\t\tarray[index3] = real2 - real3;\n\t\t}\n\t\t\n\t\t// Third pass.\n\t\tconst sqrt2over2: number = Math.sqrt(2.0) / 2.0;\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 8) {\n\t\t\tconst index1: number = index + 1;\n\t\t\tconst index3: number = index + 3;\n\t\t\tconst index4: number = index + 4;\n\t\t\tconst index5: number = index + 5;\n\t\t\tconst index7: number = index + 7;\n\t\t\tconst real0: number = array[index ];\n\t\t\tconst real1: number = array[index1];\n\t\t\tconst imag3: number = array[index3];\n\t\t\tconst real4: number = array[index4];\n\t\t\tconst real5: number = array[index5];\n\t\t\tconst imag7: number = array[index7];\n\t\t\tconst tempA: number = (real5 - imag7) * sqrt2over2;\n\t\t\tconst tempB: number = (real5 + imag7) * sqrt2over2;\n\t\t\tarray[index ] = real0 + real4;\n\t\t\tarray[index1] = real1 + tempA;\n\t\t\tarray[index3] = real1 - tempA;\n\t\t\tarray[index4] = real0 - real4;\n\t\t\tarray[index5] = tempB - imag3;\n\t\t\tarray[index7] = tempB + imag3;\n\t\t}\n\t\t\n\t\t// Handle remaining passes.\n\t\tfor (let pass: number = 3; pass < totalPasses; pass++) {\n\t\t\tconst subStride: number = 1 << pass;\n\t\t\tconst midSubStride: number = subStride >> 1;\n\t\t\tconst stride: number = subStride << 1;\n\t\t\tconst radiansIncrement: number = Math.PI * 2.0 / stride;\n\t\t\tconst cosIncrement: number = Math.cos(radiansIncrement);\n\t\t\tconst sinIncrement: number = Math.sin(radiansIncrement);\n\t\t\tconst oscillatorMultiplier: number = 2.0 * cosIncrement;\n\t\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += stride) {\n\t\t\t\tconst startIndexA: number = startIndex;\n\t\t\t\tconst startIndexB: number = startIndexA + subStride;\n\t\t\t\tconst stopIndex: number = startIndexB + subStride;\n\t\t\t\tconst realStartA: number = array[startIndexA];\n\t\t\t\tconst realStartB: number = array[startIndexB];\n\t\t\t\tarray[startIndexA] = realStartA + realStartB;\n\t\t\t\tarray[startIndexB] = realStartA - realStartB;\n\t\t\t\tlet c: number = cosIncrement;\n\t\t\t\tlet s: number = -sinIncrement;\n\t\t\t\tlet cPrev: number = 1.0;\n\t\t\t\tlet sPrev: number = 0.0;\n\t\t\t\tfor (let index: number = 1; index < midSubStride; index++) {\n\t\t\t\t\tconst indexA0: number = startIndexA + index;\n\t\t\t\t\tconst indexA1: number = startIndexB - index;\n\t\t\t\t\tconst indexB0: number = startIndexB + index;\n\t\t\t\t\tconst indexB1: number = stopIndex   - index;\n\t\t\t\t\tconst real0: number = array[indexA0];\n\t\t\t\t\tconst imag0: number = array[indexA1];\n\t\t\t\t\tconst real1: number = array[indexB0];\n\t\t\t\t\tconst imag1: number = array[indexB1];\n\t\t\t\t\tconst tempA: number = real1 * c + imag1 * s;\n\t\t\t\t\tconst tempB: number = real1 * s - imag1 * c;\n\t\t\t\t\tarray[indexA0] = real0 + tempA;\n\t\t\t\t\tarray[indexA1] = real0 - tempA;\n\t\t\t\t\tarray[indexB0] =-imag0 - tempB;\n\t\t\t\t\tarray[indexB1] = imag0 - tempB;\n\t\t\t\t\tconst cTemp: number = oscillatorMultiplier * c - cPrev;\n\t\t\t\t\tconst sTemp: number = oscillatorMultiplier * s - sPrev;\n\t\t\t\t\tcPrev = c;\n\t\t\t\t\tsPrev = s;\n\t\t\t\t\tc = cTemp;\n\t\t\t\t\ts = sTemp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t*/\n\t\n\t// Computes the inverse Fourier transform from a specially formatted array of\n\t// scalar values. Elements 0 through N/2 are expected to be the real values of\n\t// the corresponding complex elements, representing cosine wave amplitudes in\n\t// ascending frequency, and elements N/2+1 through N-1 correspond to the\n\t// imaginary values, representing sine wave amplitudes in descending frequency.\n\t// Generates real-valued time-domain samples. Overwrites the input array.\n\texport function inverseRealFourierTransform(array: NumberArray): void {\n\t\tconst fullArrayLength: number = array.length;\n\t\tconst totalPasses: number = countBits(fullArrayLength);\n\t\tif (fullArrayLength < 4) throw new Error(\"FFT array length must be at least 4.\");\n\t\n\t\t// Perform all but the last few passes in reverse.\n\t\tfor (let pass: number = totalPasses - 1; pass >= 2; pass--) {\n\t\t\tconst subStride: number = 1 << pass;\n\t\t\tconst midSubStride: number = subStride >> 1;\n\t\t\tconst stride: number = subStride << 1;\n\t\t\tconst radiansIncrement: number = Math.PI * 2.0 / stride;\n\t\t\tconst cosIncrement: number = Math.cos(radiansIncrement);\n\t\t\tconst sinIncrement: number = Math.sin(radiansIncrement);\n\t\t\tconst oscillatorMultiplier: number = 2.0 * cosIncrement;\n\t\t\t\n\t\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += stride) {\n\t\t\t\tconst startIndexA: number = startIndex;\n\t\t\t\tconst midIndexA: number = startIndexA + midSubStride;\n\t\t\t\tconst startIndexB: number = startIndexA + subStride;\n\t\t\t\tconst midIndexB: number = startIndexB + midSubStride;\n\t\t\t\tconst stopIndex: number = startIndexB + subStride;\n\t\t\t\tconst realStartA: number = array[startIndexA];\n\t\t\t\tconst imagStartB: number = array[startIndexB];\n\t\t\t\tarray[startIndexA] = realStartA + imagStartB;\n\t\t\t\tarray[midIndexA] *= 2;\n\t\t\t\tarray[startIndexB] = realStartA - imagStartB;\n\t\t\t\tarray[midIndexB] *= 2;\n\t\t\t\tlet c: number = cosIncrement;\n\t\t\t\tlet s: number = -sinIncrement;\n\t\t\t\tlet cPrev: number = 1.0;\n\t\t\t\tlet sPrev: number = 0.0;\n\t\t\t\tfor (let index: number = 1; index < midSubStride; index++) {\n\t\t\t\t\tconst indexA0: number = startIndexA + index;\n\t\t\t\t\tconst indexA1: number = startIndexB - index;\n\t\t\t\t\tconst indexB0: number = startIndexB + index;\n\t\t\t\t\tconst indexB1: number = stopIndex   - index;\n\t\t\t\t\tconst real0: number = array[indexA0];\n\t\t\t\t\tconst real1: number = array[indexA1];\n\t\t\t\t\tconst imag0: number = array[indexB0];\n\t\t\t\t\tconst imag1: number = array[indexB1];\n\t\t\t\t\tconst tempA: number = real0 - real1;\n\t\t\t\t\tconst tempB: number = imag0 + imag1;\n\t\t\t\t\tarray[indexA0] = real0 + real1;\n\t\t\t\t\tarray[indexA1] = imag1 - imag0;\n\t\t\t\t\tarray[indexB0] = tempA * c - tempB * s;\n\t\t\t\t\tarray[indexB1] = tempB * c + tempA * s;\n\t\t\t\t\tconst cTemp: number = oscillatorMultiplier * c - cPrev;\n\t\t\t\t\tconst sTemp: number = oscillatorMultiplier * s - sPrev;\n\t\t\t\t\tcPrev = c;\n\t\t\t\t\tsPrev = s;\n\t\t\t\t\tc = cTemp;\n\t\t\t\t\ts = sTemp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t/*\n\t\t// Commented out this block (and compensated with an extra pass above)\n\t\t// because it's slower in my testing so far.\n\t\t// Pass with stride 8.\n\t\tconst sqrt2over2: number = Math.sqrt(2.0) / 2.0;\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 8) {\n\t\t\tconst index1: number = index + 1;\n\t\t\tconst index2: number = index + 2;\n\t\t\tconst index3: number = index + 3;\n\t\t\tconst index4: number = index + 4;\n\t\t\tconst index5: number = index + 5;\n\t\t\tconst index6: number = index + 6;\n\t\t\tconst index7: number = index + 7;\n\t\t\tconst real0: number = array[index ];\n\t\t\tconst real1: number = array[index1];\n\t\t\tconst real2: number = array[index2];\n\t\t\tconst real3: number = array[index3];\n\t\t\tconst imag4: number = array[index4];\n\t\t\tconst imag5: number = array[index5];\n\t\t\tconst imag6: number = array[index6];\n\t\t\tconst imag7: number = array[index7];\n\t\t\tconst tempA: number = real1 - real3;\n\t\t\tconst tempB: number = imag5 + imag7;\n\t\t\tarray[index ] = real0 + imag4;\n\t\t\tarray[index1] = real1 + real3;\n\t\t\tarray[index2] = real2 * 2;\n\t\t\tarray[index3] = imag7 - imag5;\n\t\t\tarray[index4] = real0 - imag4;\n\t\t\tarray[index5] = (tempA + tempB) * sqrt2over2;\n\t\t\tarray[index6] = imag6 * 2;\n\t\t\tarray[index7] = (tempB - tempA) * sqrt2over2;\n\t\t}\n\t\t*/\n\t\t// The final passes with strides 4 and 2, combined into one loop.\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 4) {\n\t\t\tconst index1: number = index + 1;\n\t\t\tconst index2: number = index + 2;\n\t\t\tconst index3: number = index + 3;\n\t\t\tconst real0: number = array[index ];\n\t\t\tconst real1: number = array[index1] * 2;\n\t\t\tconst imag2: number = array[index2];\n\t\t\tconst imag3: number = array[index3] * 2;\n\t\t\tconst tempA: number = real0 + imag2;\n\t\t\tconst tempB: number = real0 - imag2;\n\t\t\tarray[index ] = tempA + real1;\n\t\t\tarray[index1] = tempA - real1;\n\t\t\tarray[index2] = tempB + imag3;\n\t\t\tarray[index3] = tempB - imag3;\n\t\t}\n\t\t\n\t\treverseIndexBits(array);\n\t}\n\n","/*!\nCopyright (c) 2012-2022 John Nesky and contributing authors\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { inverseRealFourierTransform, scaleElementsByFactor } from \"./FFT\";\n\nexport interface Dictionary<T> {\n\t[K: string]: T;\n}\n\nexport interface DictionaryArray<T> extends ReadonlyArray<T> {\n\tdictionary: Dictionary<T>;\n}\n\nexport interface BeepBoxOption {\n\treadonly index: number;\n\treadonly name: string;\n}\n\nexport const enum EnvelopeType {\n\tcustom,\n\tsteady,\n\tpunch,\n\tflare,\n\tpluck,\n\ttremolo,\n\tflute,\n}\n\nexport const enum InstrumentType {\n\tchip = 0,\n\tfm = 1,\n\tnoise = 2,\n\tpwm = 3,\n}\n\nexport class Config {\n\tpublic static readonly scaleNames: ReadonlyArray<string> = [\"easy :)\", \"easy :(\", \"island :)\", \"island :(\", \"blues :)\", \"blues :(\", \"normal :)\", \"normal :(\", \"dbl harmonic :)\", \"dbl harmonic :(\", \"enigma\", \"expert\", \"monotonic\", \"no dabbing\"];\n\tpublic static readonly scaleFlags: ReadonlyArray<ReadonlyArray<boolean>> = [\n\t\t[ true, false,  true, false,  true, false, false,  true, false,  true, false, false],\n\t\t[ true, false, false,  true, false,  true, false,  true, false, false,  true, false],\n\t\t[ true, false, false, false,  true,  true, false,  true, false, false, false,  true],\n\t\t[ true,  true, false,  true, false, false, false,  true,  true, false, false, false],\n\t\t[ true, false,  true,  true,  true, false, false,  true, false,  true, false, false],\n\t\t[ true, false, false,  true, false,  true,  true,  true, false, false,  true, false],\n\t\t[ true, false,  true, false,  true,  true, false,  true, false,  true, false,  true],\n\t\t[ true, false,  true,  true, false,  true, false,  true,  true, false,  true, false],\n\t\t[ true,  true, false, false,  true,  true, false,  true,  true, false, false,  true],\n\t\t[ true, false,  true,  true, false, false,  true,  true,  true, false, false,  true],\n\t\t[ true, false,  true, false,  true, false,  true, false,  true, false,  true, false],\n\t\t[ true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true],\n\t\t[ true, false, false, false, false, false, false, false, false, false, false, false],\n\t\t[ true,  true, false,  true,  true,  true,  true,  true,  true, false,  true, false],\n\t];\n\tpublic static readonly pianoScaleFlags: ReadonlyArray<boolean> = [ true, false,  true, false,  true,  true, false,  true, false,  true, false,  true];\n\tpublic static readonly blackKeyNameParents: ReadonlyArray<number> = [-1, 1, -1, 1, -1, 1, -1, -1, 1, -1, 1, -1];\n\tpublic static readonly pitchNames: ReadonlyArray<string | null> = [\"C\", null, \"D\", null, \"E\", \"F\", null, \"G\", null, \"A\", null, \"B\"];\n\tpublic static readonly keyNames: ReadonlyArray<string> = [\"B\", \"A♯\", \"A\", \"G♯\", \"G\", \"F♯\", \"F\", \"E\", \"D♯\", \"D\", \"C♯\", \"C\"];\n\t// C1 has index 24 on the MIDI scale. C8 is 108, and C9 is 120. C10 is barely in the audible range.\n\tpublic static readonly keyTransposes: ReadonlyArray<number> = [23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12];\n\tpublic static readonly mixNames: ReadonlyArray<string> = [\"Type A (B & S)\", \"Type B (M)\", \"Type C\"];\n\tpublic static readonly sampleRateNames: ReadonlyArray<string> = [\"44100kHz\", \"48000kHz\", \"default\", \"×4\", \"×2\", \"÷2\", \"÷4\", \"÷8\", \"÷16\"];\n\tpublic static readonly tempoSteps: number = 24;\n\tpublic static readonly reverbRange: number = 5;\n\tpublic static readonly blendRange: number = 4;\n\tpublic static readonly riffRange: number = 11;\n\tpublic static readonly detuneRange: number = 24;\n\tpublic static readonly muffRange: number = 24;\n\tpublic static readonly beatsPerBarMin: number = 1;\n\tpublic static readonly beatsPerBarMax: number = 24;\n\tpublic static readonly barCountMin: number = 1;\n\tpublic static readonly barCountMax: number = 256;\n\tpublic static readonly patternsPerChannelMin: number = 1;\n\tpublic static readonly patternsPerChannelMax: number = 64;\n\tpublic static readonly instrumentsPerChannelMin: number = 1;\n\tpublic static readonly instrumentsPerChannelMax: number = 64;\n\tpublic static readonly partNames: ReadonlyArray<string> = [\"÷3 (triplets)\", \"÷4 (standard)\", \"÷6\", \"÷8\", \"÷16 (arpfest)\", \"÷12\", \"÷9\", \"÷5\", \"÷50\", \"÷24\"];\n\tpublic static readonly partCounts: ReadonlyArray<number> = [3, 4, 6, 8, 16, 12, 9, 5, 50, 24];\n\tpublic static readonly waveNames: ReadonlyArray<string> = [\"triangle\", \"square\", \"pulse wide\", \"pulse narrow\", \"sawtooth\", \"double saw\", \"double pulse\", \"spiky\", \"plateau\", \"glitch\", \"10% pulse\", \"sunsoft bass\", \"loud pulse\", \"sax\", \"guitar\", \"sine\", \"atari bass\", \"atari pulse\", \"1% pulse\", \"curved sawtooth\", \"viola\", \"brass\", \"acoustic bass\", \"lyre\", \"ramp pulse\", \"piccolo\", \"squaretooth\", \"flatline\", \"pnryshk a (u5)\", \"pnryshk b (riff)\"];\n\tpublic static readonly waveVolumes: ReadonlyArray<number> = [1.0,        0.5,      0.5,          0.5,            0.65,       0.5,          0.4,            0.4,     0.94,      0.5,      0.5,         1.0,            0.6,          0.1,   0.25,     1.0,    1.0,          1.0,           1.0,        1.0,               1.0,     1.0,     1.0,             0.2,    0.2,          0.9,       0.9,           1.0,        0.4,                 0.5];\n\tpublic static readonly drumNames: ReadonlyArray<string> = [\"retro\", \"white\", \"periodic\", \"detuned periodic\", \"shine\", \"hollow\", \"deep\", \"cutter\", \"metallic\", \"snare\"/*, \"tom-tom\", \"cymbal\", \"bass\"*/];\n\tpublic static readonly drumVolumes: ReadonlyArray<number> = [0.25, 1.0, 0.4, 0.3, 0.3, 1.5, 1.5, 0.25, 1.0, 1.0/*, 1.5, 1.5, 1.5*/];\n\tpublic static readonly drumBasePitches: ReadonlyArray<number> = [69, 69, 69, 69, 69, 96, 120, 96, 96, 69/*, 96, 90, 126*/];\n\tpublic static readonly drumPitchFilterMult: ReadonlyArray<number> = [100.0, 8.0, 100.0, 100.0, 100.0, 1.0, 100.0, 100.0, 100.0, 100.0/*, 1.0, 1.0, 1.0*/];\n\tpublic static readonly drumWaveIsSoft: ReadonlyArray<boolean> = [false, true, false, false, false, true, true, false, false, false/*, true, true, true*/];\n\t// Noise waves have too many samples to write by hand, they're generated on-demand by getDrumWave instead.\n\tprivate static readonly _drumWaves: Array<Float32Array | null> = [null, null, null, null, null, null, null, null, null, null/*, null, null, null*/];\n\tpublic static readonly pwmwaveNames: ReadonlyArray<string> = [\"5%\", \"10%\", \"15%\", \"20%\", \"25%\", \"30%\", \"35%\", \"40%\", \"45%\", \"50%\"];\n\tpublic static readonly pwmwaveVolumes: ReadonlyArray<number> = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];\n\tpublic static readonly filterNames: ReadonlyArray<string> = [\"none\", \"sustain sharp\", \"sustain medium\", \"sustain soft\", \"decay sharp\", \"decay medium\", \"decay soft\", \"decay drawn\", \"fade sharp\", \"fade medium\", \"fade soft\", \"ring\", \"muffled\", \"submerged\", \"shift\", \"overtone\", \"woosh\", \"undertone\"];\n\tpublic static readonly filterBases: ReadonlyArray<number> = [0.0, 2.0, 3.5, 5.0, 1.0, 2.5, 4.0, 1.0, 5.0, 7.5, 10.0, -1.0, 4.0, 6.0, 0.0, 1.0, 2.0, 5.0];\n\tpublic static readonly filterDecays: ReadonlyArray<number> = [0.0, 0.0, 0.0, 0.0, 10.0, 7.0, 4.0, 0.5, -10.0, -7.0, -4.0, 0.2, 0.2, 0.3, 0.0, 0.0, -6.0, 0.0];\n\tpublic static readonly filterVolumes: ReadonlyArray<number> = [0.2, 0.4, 0.7, 1.0, 0.5, 0.75, 1.0, 0.5, 0.4, 0.7, 1.0, 0.5, 0.75, 0.4, 0.4, 1.0, 0.5, 1.75];\n\tpublic static readonly transitionNames: ReadonlyArray<string> = [\"seamless\", \"sudden\", \"smooth\", \"slide\", \"trill\", \"click\", \"bow\", \"blip\"];\n\tpublic static readonly effectNames: ReadonlyArray<string> = [\"none\", \"vibrato light\", \"vibrato delayed\", \"vibrato heavy\", \"tremolo light\", \"tremolo heavy\", \"alien\", \"stutter\", \"strum\"];\n\tpublic static readonly effectVibratos: ReadonlyArray<number> = [0.0, 0.15, 0.3, 0.45, 0.0, 0.0, 1.0, 0.0, 0.05];\n\tpublic static readonly effectTremolos: ReadonlyArray<number> = [0.0, 0.0, 0.0, 0.0, 0.25, 0.5, 0.0, 1.0, 0.025];\n\tpublic static readonly effectVibratoDelays: ReadonlyArray<number> = [0, 0, 3, 0, 0, 0, 0, 0];\n\tpublic static readonly chorusNames: ReadonlyArray<string> = [\"union\", \"shimmer\", \"hum\", \"honky tonk\", \"dissonant\", \"fifths\", \"octaves\", \"spinner\", \"detune\", \"bowed\", \"rising\", \"vibrate\", \"fourths\", \"bass\", \"dirty\", \"stationary\", \"harmonic (legacy)\", \"recurve\", \"voiced\", \"fluctuate\"];\n\tpublic static readonly chorusIntervals: ReadonlyArray<number> = [0.0, 0.02, 0.05, 0.1, 0.25, 3.5, 6, 0.02, 0.0, 0.02, 1.0, 3.5, 4, 0, 0.0, 3.5, 0.0, 0.005, 0.25, 12];\n\tpublic static readonly chorusOffsets: ReadonlyArray<number> = [0.0, 0.0, 0.0, 0.0, 0.0, 3.5, 6, 0.0, 0.25, 0.0, 0.7, 7, 4, -7, 0.1, 0.0, 0.0, 0.0, 3.0, 0.0];\n\tpublic static readonly chorusVolumes: ReadonlyArray<number> = [0.9, 0.9, 1.0, 1.0, 0.95, 0.95, 0.9, 1.0, 1.0, 1.0, 0.95, 0.975, 0.95, 1.0, 0.975, 0.9, 1.0, 1.0, 0.9, 1.0];\n\tpublic static readonly chorusSigns: ReadonlyArray<number> = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, -1.0, 1.0, 1.0];\n\tpublic static readonly chorusRiffApp: ReadonlyArray<number> = [0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];\n\tpublic static readonly chorusHarmonizes: ReadonlyArray<boolean> = [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false];\n\tpublic static readonly harmDisplay: ReadonlyArray<string> = [\"arpeggio\", \"duet\", \"chord\", \"seventh\", \"half arpeggio\", \"arp-chord\"];\n\tpublic static readonly harmNames: ReadonlyArray<number> = [0, 1, 2, 3, 4, 5];\n\tpublic static readonly fmChorusDisplay: ReadonlyArray<string> = [\"none\", \"default\", \"detune\", \"honky tonk\", \"consecutive\", \"alt. major thirds\", \"alt. minor thirds\", \"fifths\", \"octaves\"];\n\tpublic static readonly fmChorusNames: ReadonlyArray<number> = [0, 1, 2, 3, 4, 5, 6, 7, 8];\n\tpublic static readonly imuteNames: ReadonlyArray<string> = [\"◉\", \"◎\"];\n\tpublic static readonly imuteValues: ReadonlyArray<number> = [1, 0];\n\tpublic static readonly octoffNames: ReadonlyArray<string> = [\"none\", \"+2 (2 octaves)\",  \"+1 1/2 (octave and fifth)\",  \"+1 (octave)\",  \"+1/2 (fifth)\", \"-1/2 (fifth)\", \"-1 (octave)\", \"-1 1/2 (octave and fifth)\", \"-2 (2 octaves\"];\n\tpublic static readonly octoffValues: ReadonlyArray<number> = [0.0, 24.0, 19.0, 12.0, 7.0, -7.0, -12.0, -19.0, -24.0];\n\tpublic static readonly volumeNames: ReadonlyArray<string> = [\"loudest\", \"loud\", \"medium\", \"quiet\", \"quietest\", \"mute\", \"i\", \"couldnt\", \"be\", \"bothered\"];\n\tpublic static readonly volumeValues: ReadonlyArray<number> = [0.0, 0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0, -1.0];\n\tpublic static readonly volumeMValues: ReadonlyArray<number> = [0.0, 0.5, 1.0, 1.5, 2.0, -1.0];\n\tpublic static readonly ipanValues: ReadonlyArray<number> = [-1.0, -0.75, -0.5, -0.25, 0.0, 0.25, 0.5, 0.75, 1.0];\n\tpublic static readonly operatorCount: number = 4;\n\tpublic static readonly operatorAlgorithmNames: ReadonlyArray<string> = [\n\t\t\"1←(2 3 4)\",\n\t\t\"1←(2 3←4)\",\n\t\t\"1←2←(3 4)\",\n\t\t\"1←(2 3)←4\",\n\t\t\"1←2←3←4\",\n\t\t\"1←3 2←4\",\n\t\t\"1 2←(3 4)\",\n\t\t\"1 2←3←4\",\n\t\t\"(1 2)←3←4\",\n\t\t\"(1 2)←(3 4)\",\n\t\t\"1 2 3←4\",\n\t\t\"(1 2 3)←4\",\n\t\t\"1 2 3 4\",\n\t];\n\tpublic static readonly midiAlgorithmNames: ReadonlyArray<string> = [\"1<(2 3 4)\", \"1<(2 3<4)\", \"1<2<(3 4)\", \"1<(2 3)<4\", \"1<2<3<4\", \"1<3 2<4\", \"1 2<(3 4)\", \"1 2<3<4\", \"(1 2)<3<4\", \"(1 2)<(3 4)\", \"1 2 3<4\", \"(1 2 3)<4\", \"1 2 3 4\"];\n\tpublic static readonly operatorModulatedBy: ReadonlyArray<ReadonlyArray<ReadonlyArray<number>>> = [\n\t\t[[2, 3, 4], [],     [],  []],\n\t\t[[2, 3],    [],     [4], []],\n\t\t[[2],       [3, 4], [],  []],\n\t\t[[2, 3],    [4],    [4], []],\n\t\t[[2],       [3],    [4], []],\n\t\t[[3],       [4],    [],  []],\n\t\t[[],        [3, 4], [],  []],\n\t\t[[],        [3],    [4], []],\n\t\t[[3],       [3],    [4], []],\n\t\t[[3, 4],    [3, 4], [],  []],\n\t\t[[],        [],     [4], []],\n\t\t[[4],       [4],    [4], []],\n\t\t[[],        [],     [],  []],\n\t];\n\tpublic static readonly operatorAssociatedCarrier: ReadonlyArray<ReadonlyArray<number>> = [\n\t\t[1, 1, 1, 1],\n\t\t[1, 1, 1, 1],\n\t\t[1, 1, 1, 1],\n\t\t[1, 1, 1, 1],\n\t\t[1, 1, 1, 1],\n\t\t[1, 2, 1, 2],\n\t\t[1, 2, 2, 2],\n\t\t[1, 2, 2, 2],\n\t\t[1, 2, 2, 2],\n\t\t[1, 2, 2, 2],\n\t\t[1, 2, 3, 3],\n\t\t[1, 2, 3, 3],\n\t\t[1, 2, 3, 4],\n\t];\n\tpublic static readonly operatorCarrierCounts: ReadonlyArray<number> = [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 4];\n\tpublic static readonly operatorCarrierChorus: ReadonlyArray<ReadonlyArray<number>> = [\n\t\t[0.0, 0.0, 0.0, 0.0],\n\t\t[0.0, 0.04, -0.073, 0.091],\n\t\t[0.5, 0.54, 0.427, 0.591],\n\t\t[0.0, 0.26, -0.45, 0.67],\n\t\t[0.0, 1.0, 2.0, 3.0],\n\t\t[0.0, 4.0, 7.0, 11.0],\n\t\t[0.0, 3.0, 7.0, 10.0],\n\t\t[0.0, 7.0, 14.0, 21.0],\n\t\t[0.0, 12.0, 24.0, 36.0],\n\t];\n\tpublic static readonly operatorAmplitudeMax: number = 15;\n\tpublic static readonly operatorFrequencyNames: ReadonlyArray<string> = [\"1×\", \"~1×\", \"2×\", \"~2×\", \"3×\", \"4×\", \"5×\", \"6×\", \"7×\", \"8×\", \"9×\", \"10×\", \"11×\", \"13×\", \"16×\", \"20×\"];\n\tpublic static readonly midiFrequencyNames: ReadonlyArray<string> = [\"1x\", \"~1x\", \"2x\", \"~2x\", \"3x\", \"4x\", \"5x\", \"6x\", \"7x\", \"8x\", \"9x\", \"10x\", \"11x\", \"13x\", \"16x\", \"20x\"];\n\tpublic static readonly operatorFrequencies: ReadonlyArray<number> =    [1.0, 1.0, 2.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 13.0, 16.0, 20.0];\n\tpublic static readonly operatorHzOffsets: ReadonlyArray<number> =      [0.0, 1.5, 0.0, -1.3, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];\n\tpublic static readonly operatorAmplitudeSigns: ReadonlyArray<number> = [1.0, -1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];\n\tpublic static readonly operatorEnvelopeNames: ReadonlyArray<string> = [\"custom\", \"steady\", \"punch\", \"flare 1\", \"flare 2\", \"flare 3\", \"pluck 1\", \"pluck 2\", \"pluck 3\", \"swell 1\", \"swell 2\", \"swell 3\", \"tremolo1\", \"tremolo2\", \"tremolo3\", \"custom flare\", \"custom tremolo\", \"flute 1\", \"flute 2\", \"flute 3\"];\n\tpublic static readonly operatorEnvelopeType: ReadonlyArray<EnvelopeType> = [EnvelopeType.custom, EnvelopeType.steady, EnvelopeType.punch, EnvelopeType.flare, EnvelopeType.flare, EnvelopeType.flare, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.tremolo, EnvelopeType.tremolo, EnvelopeType.tremolo, EnvelopeType.flare, EnvelopeType.tremolo, EnvelopeType.flute, EnvelopeType.flute, EnvelopeType.flute];\n\tpublic static readonly operatorSpecialCustomVolume: ReadonlyArray<boolean> = [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, true, true, false, false, false];\n\tpublic static readonly operatorEnvelopeSpeed: ReadonlyArray<number> = [0.0, 0.0, 0.0, 32.0, 8.0, 2.0, 32.0, 8.0, 2.0, 32.0, 8.0, 2.0, 4.0, 2.0, 1.0, 8.0, 0.0, 16.0, 8.0, 4.0];\n\tpublic static readonly operatorEnvelopeInverted: ReadonlyArray<boolean> = [false, false, false, false, false, false, false, false, false, true, true, true, false, false, false, false, false, false, false, false];\n\tpublic static readonly operatorFeedbackNames: ReadonlyArray<string> = [\n\t\t\"1⟲\",\n\t\t\"2⟲\",\n\t\t\"3⟲\",\n\t\t\"4⟲\",\n\t\t\"1⟲ 2⟲\",\n\t\t\"3⟲ 4⟲\",\n\t\t\"1⟲ 2⟲ 3⟲ \",\n\t\t\"2⟲ 3⟲ 4⟲ \",\n\t\t\"1⟲ 2⟲ 3⟲ 4⟲ \",\n\t\t\"1→2\",\n\t\t\"1→3\",\n\t\t\"1→4\",\n\t\t\"2→3\",\n\t\t\"2→4\",\n\t\t\"3→4\",\n\t\t\"1→3 2→4\",\n\t\t\"1→4 2→3\",\n\t\t\"1→2→3→4\",\n\t\t\"1🗘2\",\n\t\t\"1🗘3\",\n\t\t\"1🗘4\",\n\t\t\"2🗘3\",\n\t\t\"2🗘4\",\n\t\t\"3🗘4\",\n\t];\n\tpublic static readonly midiFeedbackNames: ReadonlyArray<string> = [\n\t\t\"1\",\n\t\t\"2\",\n\t\t\"3\",\n\t\t\"4\",\n\t\t\"1 2\",\n\t\t\"3 4\",\n\t\t\"1 2 3\",\n\t\t\"2 3 4\",\n\t\t\"1 2 3 4\",\n\t\t\"1>2\",\n\t\t\"1>3\",\n\t\t\"1>4\",\n\t\t\"2>3\",\n\t\t\"2>4\",\n\t\t\"3>4\",\n\t\t\"1>3 2>4\",\n\t\t\"1>4 2>3\",\n\t\t\"1>2>3>4\",\n\t\t\"1-2\",\n\t\t\"1-3\",\n\t\t\"1-4\",\n\t\t\"2-3\",\n\t\t\"2-4\",\n\t\t\"3-4\",\n\t];\n\tpublic static readonly operatorFeedbackIndices: ReadonlyArray<ReadonlyArray<ReadonlyArray<number>>> = [\n\t\t[[1], [], [], []],\n\t\t[[], [2], [], []],\n\t\t[[], [], [3], []],\n\t\t[[], [], [], [4]],\n\t\t[[1], [2], [], []],\n\t\t[[], [], [3], [4]],\n\t\t[[1], [2], [3], []],\n\t\t[[], [2], [3], [4]],\n\t\t[[1], [2], [3], [4]],\n\t\t[[], [1], [], []],\n\t\t[[], [], [1], []],\n\t\t[[], [], [], [1]],\n\t\t[[], [], [2], []],\n\t\t[[], [], [], [2]],\n\t\t[[], [], [], [3]],\n\t\t[[], [], [1], [2]],\n\t\t[[], [], [2], [1]],\n\t\t[[], [1], [2], [3]],\n\t\t[[2], [1], [],  []  ],\n\t\t[[3], [],  [1], []  ],\n\t\t[[4], [],  [],  [1] ],\n\t\t[[],  [3], [2], []  ],\n\t\t[[],  [4], [],  [2] ],\n\t\t[[],  [],  [4], [3] ],\n\t];\n\tpublic static readonly pitchChannelTypeNames: ReadonlyArray<string> = [\"chip\", \"FM (expert)\", \"PWM (beta)\"];\n\tpublic static readonly pitchChannelTypeValues: ReadonlyArray<number> = [InstrumentType.chip, InstrumentType.fm, InstrumentType.pwm];\n\tpublic static readonly drumChannelTypeNames: ReadonlyArray<string> = [\"noise\"];\n\tpublic static readonly instrumentTypeNames: ReadonlyArray<string> = [\"chip\", \"FM\", \"noise\", \"PWM\"];\n\n\tpublic static readonly themeNames: ReadonlyArray<string> = [\"Default\", \"ModBox 2.0\", \"Artic\", \"Cinnamon Roll [!]\", \"Ocean\", \"Rainbow [!]\", \"Float [!]\", \"Windows\", \"Grassland\", \"Dessert\", \"Kahootiest\", \"Beam to the Bit [!]\", \"Pretty Egg\", \"Poniryoshka\", \"Gameboy [!]\", \"Woodkid\", \"Midnight\", \"Snedbox\", \"unnamed\", \"Piano [!] [↻]\", \"Halloween\", \"FrozenOver❄️\"];\n\tpublic static readonly volumeColorPallet: ReadonlyArray<string>            = [\"#777777\", \"#c4ffa3\", \"#42dcff\", \"#ba8418\", \"#090b3a\", \"#ff00cb\", \"#878787\", \"#15a0db\", \"#74bc21\", \"#ff0000\", \"#66bf39\", \"#fefe00\", \"#f01d7a\", \"#ffc100\", \"#8bac0f\", \"#ef3027\", \"#aa5599\", \"#a53a3d\", \"#ffffff\", \"#ff0000\", \"#9e2200\", \"#ed2d2d\"];\n\tpublic static readonly sliderOneColorPallet: ReadonlyArray<string>         = [\"#9900cc\", \"#00ff00\", \"#ffffff\", \"#ba8418\", \"#5982ff\", \"#ff0000\", \"#ffffff\", \"#2779c2\", \"#a0d168\", \"#ff6254\", \"#ff3355\", \"#fefe00\", \"#6b003a\", \"#4b4b4b\", \"#9bbc0f\", \"#e83c4e\", \"#445566\", \"#a53a3d\", \"#ffffff\", \"#ffffff\", \"#9e2200\", \"#38ef17\"];\n\tpublic static readonly sliderOctaveColorPallet: ReadonlyArray<string>      = [\"#444444\", \"#00ff00\", \"#a5eeff\", \"#e59900\", \"#4449a3\", \"#43ff00\", \"#ffffff\", \"#295294\", \"#74bc21\", \"#ff5e3a\", \"#eb670f\", \"#0001fc\", \"#ffb1f4\", \"#5f4c99\", \"#9bbc0f\", \"#ef3027\", \"#444444\", \"#444444\", \"#ffffff\", \"#211616\", \"#9e2200\", \"#ffffff\"];\n\tpublic static readonly sliderOctaveNotchColorPallet: ReadonlyArray<string> = [\"#886644\", \"#ffffff\", \"#cefffd\", \"#ffff25\", \"#3dffdb\", \"#0400ff\", \"#c9c9c9\", \"#fdd01d\", \"#20330a\", \"#fff570\", \"#ff3355\", \"#fa0103\", \"#b4001b\", \"#ff8291\", \"#8bac0f\", \"#ffedca\", \"#aa5599\", \"#a53a3d\", \"#ffffff\", \"#ff4c4c\", \"#701800\", \"#ed2d2d\"];\n\tpublic static readonly buttonColorPallet: ReadonlyArray<string>            = [\"#ffffff\", \"#00ff00\", \"#42dcff\", \"#ffff25\", \"#4449a3\", \"#f6ff00\", \"#000000\", \"#fdd01d\", \"#69c400\", \"#fffc5b\", \"#66bf39\", \"#fefe00\", \"#75093e\", \"#818383\", \"#8bac0f\", \"#ffedca\", \"#000000\", \"#ffffff\", \"#ffffff\", \"#ffffff\", \"#9e2200\", \"#38ef17\"];\n\n\tpublic static readonly noteOne: ReadonlyArray<string>    = [\"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#9e2200\"];\n\tpublic static readonly noteTwo: ReadonlyArray<string>    = [\"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#9e2200\"];\n\tpublic static readonly noteThree: ReadonlyArray<string>  = [\"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#9e2200\"];\n\tpublic static readonly noteFour: ReadonlyArray<string>   = [\"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#9e2200\"];\n\tpublic static readonly noteSix: ReadonlyArray<string>    = [\"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#9e2200\"];\n\tpublic static readonly noteSeven: ReadonlyArray<string>  = [\"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#9e2200\"];\n\tpublic static readonly noteEight: ReadonlyArray<string>  = [\"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#9e2200\"];\n\tpublic static readonly noteFive: ReadonlyArray<string>   = [\"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#9e2200\"];\n\tpublic static readonly noteNine: ReadonlyArray<string>   = [\"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#9e2200\"];\n\tpublic static readonly noteTen: ReadonlyArray<string>    = [\"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#9e2200\"];\n\tpublic static readonly noteEleven: ReadonlyArray<string> = [\"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#9e2200\"];\n\tpublic static readonly noteTwelve: ReadonlyArray<string> = [\"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#7a7a7a\", \"#bfbfbf\", \"#bfbfbf\", \"#9e2200\"];\n\n\tpublic static readonly baseNoteColorPallet: ReadonlyArray<string>    = [\"#886644\", \"#c4ffa3\", \"#eafffe\", \"#f5bb00\", \"#090b3a\", \"#ffaaaa\", \"#ffffff\", \"#da4e2a\", \"#20330a\", \"#fffc5b\", \"#45a3e5\", \"#fefe00\", \"#fffafa\", \"#1a2844\", \"#9bbc0f\", \"#fff6fe\", \"#222222\", \"#886644\", \"#ffffa0\", \"#ffffff\", \"#681701\", \"#88bce8\"];\n\tpublic static readonly secondNoteColorPallet: ReadonlyArray<string>  = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#ffceaa\", \"#ededed\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#111111\", \"#444444\", \"#444444\", \"#9bbc0f\", \"#41323b\", \"#222222\", \"#444444\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#99c8ef\"];\n\tpublic static readonly thirdNoteColorPallet: ReadonlyArray<string>   = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#ffdfaa\", \"#cecece\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#111111\", \"#444444\", \"#444444\", \"#9bbc0f\", \"#41323b\", \"#222222\", \"#444444\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#abd3f4\"];\n\tpublic static readonly fourthNoteColorPallet: ReadonlyArray<string>  = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#fff5aa\", \"#bababa\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#111111\", \"#444444\", \"#444444\", \"#8bac0f\", \"#41323b\", \"#222222\", \"#444444\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#b8d7f2\"];\n\tpublic static readonly sixthNoteColorPallet: ReadonlyArray<string>   = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#e8ffaa\", \"#afafaf\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#fa0103\", \"#444444\", \"#faf4c3\", \"#8bac0f\", \"#41323b\", \"#222222\", \"#10997e\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#cbe0f2\"];\n\tpublic static readonly seventhNoteColorPallet: ReadonlyArray<string> = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#bfffb2\", \"#a5a5a5\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#111111\", \"#444444\", \"#444444\", \"#8bac0f\", \"#41323b\", \"#222222\", \"#444444\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#e5f0f9\"];\n\tpublic static readonly eigthNoteColorPallet: ReadonlyArray<string>   = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#b2ffc8\", \"#999999\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#111111\", \"#444444\", \"#444444\", \"#306230\", \"#41323b\", \"#222222\", \"#444444\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#ffffff\"];\n\tpublic static readonly fifthNoteColorPallet: ReadonlyArray<string>   = [\"#446688\", \"#96fffb\", \"#b7f1ff\", \"#f5bb00\", \"#3f669b\", \"#b2ffe4\", \"#8e8e8e\", \"#5d9511\", \"#74bc21\", \"#ff5e3a\", \"#864cbf\", \"#111111\", \"#ff91ce\", \"#dabbe6\", \"#306230\", \"#fff6fe\", \"#444444\", \"#60389b\", \"#ffffa0\", \"#ffffff\", \"#914300\", \"#e5f0f9\"];\n\tpublic static readonly ninthNoteColorPallet: ReadonlyArray<string>   = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#b2f3ff\", \"#828282\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#0001fc\", \"#444444\", \"#444444\", \"#306230\", \"#41323b\", \"#222222\", \"#444444\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#cbe0f2\"];\n\tpublic static readonly tenNoteColorPallet: ReadonlyArray<string>     = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#b2b3ff\", \"#777777\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#111111\", \"#444444\", \"#444444\", \"#0f380f\", \"#41323b\", \"#222222\", \"#444444\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#b8d7f2\"];\n\tpublic static readonly elevenNoteColorPallet: ReadonlyArray<string>  = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#e0b2ff\", \"#565656\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#111111\", \"#444444\", \"#444444\", \"#0f380f\", \"#41323b\", \"#222222\", \"#444444\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#abd3f4\"];\n\tpublic static readonly twelveNoteColorPallet: ReadonlyArray<string>  = [\"#444444\", \"#444444\", \"#444444\", \"#f5bb00\", \"#444444\", \"#ffafe9\", \"#282828\", \"#444444\", \"#444444\", \"#444444\", \"#444444\", \"#111111\", \"#444444\", \"#444444\", \"#0f380f\", \"#41323b\", \"#222222\", \"#444444\", \"#ffffa0\", \"#ffffff\", \"#754a3f\", \"#99c8ef\"];\n\n\tpublic static readonly channelOneBrightColorPallet: string      = \"#25f3ff\";\n\tpublic static readonly channelTwoBrightColorPallet: string      = \"#44ff44\";\n\tpublic static readonly channelThreeBrightColorPallet: string    = \"#ffff25\";\n\tpublic static readonly channelFourBrightColorPallet: string     = \"#ff9752\";\n\tpublic static readonly channelFiveBrightColorPallet: string     = \"#ff90ff\";\n\tpublic static readonly channelSixBrightColorPallet: string      = \"#9f31ea\";\n\tpublic static readonly channelSevenBrightColorPallet: string    = \"#2b6aff\";\n\tpublic static readonly channelEightBrightColorPallet: string    = \"#00ff9f\";\n\tpublic static readonly channelNineBrightColorPallet: string     = \"#ffbf00\";\n\tpublic static readonly channelTenBrightColorPallet: string      = \"#d85d00\";\n\tpublic static readonly channelElevenBrightColorPallet: string   = \"#ff00a1\";\n\tpublic static readonly channelTwelveBrightColorPallet: string   = \"#c26afc\";\n\tpublic static readonly channelThirteenBrightColorPallet: string = \"#ff1616\";\n\tpublic static readonly channelFourteenBrightColorPallet: string = \"#ffffff\";\n\tpublic static readonly channelFifteenBrightColorPallet: string  = \"#768dfc\";\n\tpublic static readonly channelSixteenBrightColorPallet: string  = \"#a5ff00\";\n\n\tpublic static readonly channelOneDimColorPallet: string      = \"#0099a1\";\n\tpublic static readonly channelTwoDimColorPallet: string      = \"#439143\";\n\tpublic static readonly channelThreeDimColorPallet: string    = \"#a1a100\";\n\tpublic static readonly channelFourDimColorPallet: string     = \"#c75000\";\n\tpublic static readonly channelFiveDimColorPallet: string     = \"#d020d0\";\n\tpublic static readonly channelSixDimColorPallet: string      = \"#552377\";\n\tpublic static readonly channelSevenDimColorPallet: string    = \"#221b89\";\n\tpublic static readonly channelEightDimColorPallet: string    = \"#00995f\";\n\tpublic static readonly channelNineDimColorPallet: string     = \"#d6b03e\";\n\tpublic static readonly channelTenDimColorPallet: string      = \"#b25915\";\n\tpublic static readonly channelElevenDimColorPallet: string   = \"#891a60\";\n\tpublic static readonly channelTwelveDimColorPallet: string   = \"#965cbc\";\n\tpublic static readonly channelThirteenDimColorPallet: string = \"#991010\";\n\tpublic static readonly channelFourteenDimColorPallet: string = \"#aaaaaa\";\n\tpublic static readonly channelFifteenDimColorPallet: string  = \"#5869BD\";\n\tpublic static readonly channelSixteenDimColorPallet: string  = \"#7c9b42\";\n\n\tpublic static readonly pitchChannelColorsDim: ReadonlyArray<string>    = [Config.channelOneDimColorPallet, Config.channelTwoDimColorPallet, Config.channelThreeDimColorPallet, Config.channelFourDimColorPallet, Config.channelFiveDimColorPallet, Config.channelSixDimColorPallet, Config.channelSevenDimColorPallet, Config.channelEightDimColorPallet, Config.channelNineDimColorPallet, Config.channelTenDimColorPallet, Config.channelElevenDimColorPallet, Config.channelTwelveDimColorPallet];\n\tpublic static readonly pitchChannelColorsBright: ReadonlyArray<string> = [Config.channelOneBrightColorPallet, Config.channelTwoBrightColorPallet, Config.channelThreeBrightColorPallet, Config.channelFourBrightColorPallet, Config.channelFiveBrightColorPallet, Config.channelSixBrightColorPallet, Config.channelSevenBrightColorPallet, Config.channelEightBrightColorPallet, Config.channelNineBrightColorPallet, Config.channelTenBrightColorPallet, Config.channelElevenBrightColorPallet, Config.channelTwelveBrightColorPallet];\n\tpublic static readonly pitchNoteColorsDim: ReadonlyArray<string>       = [Config.channelOneDimColorPallet, Config.channelTwoDimColorPallet, Config.channelThreeDimColorPallet, Config.channelFourDimColorPallet, Config.channelFiveDimColorPallet, Config.channelSixDimColorPallet, Config.channelSevenDimColorPallet, Config.channelEightDimColorPallet, Config.channelNineDimColorPallet, Config.channelTenDimColorPallet, Config.channelElevenDimColorPallet, Config.channelTwelveDimColorPallet];\n\tpublic static readonly pitchNoteColorsBright: ReadonlyArray<string>    = [Config.channelOneBrightColorPallet, Config.channelTwoBrightColorPallet, Config.channelThreeBrightColorPallet, Config.channelFourBrightColorPallet, Config.channelFiveBrightColorPallet, Config.channelSixBrightColorPallet, Config.channelSevenBrightColorPallet, Config.channelEightBrightColorPallet, Config.channelNineBrightColorPallet, Config.channelTenBrightColorPallet, Config.channelElevenBrightColorPallet, Config.channelTwelveBrightColorPallet];\n\tpublic static readonly drumChannelColorsDim: ReadonlyArray<string>    = [Config.channelThirteenDimColorPallet, Config.channelFourteenDimColorPallet, Config.channelFifteenDimColorPallet, Config.channelSixteenDimColorPallet];\n\tpublic static readonly drumChannelColorsBright: ReadonlyArray<string> = [Config.channelThirteenBrightColorPallet, Config.channelFourteenBrightColorPallet, Config.channelFifteenBrightColorPallet, Config.channelSixteenBrightColorPallet];\n\tpublic static readonly drumNoteColorsDim: ReadonlyArray<string>       = [Config.channelThirteenDimColorPallet, Config.channelFourteenDimColorPallet, Config.channelFifteenDimColorPallet, Config.channelSixteenDimColorPallet];\n\tpublic static readonly drumNoteColorsBright: ReadonlyArray<string>    = [Config.channelThirteenBrightColorPallet, Config.channelFourteenBrightColorPallet, Config.channelFifteenBrightColorPallet, Config.channelSixteenBrightColorPallet];\n\n\tpublic static readonly midiPitchChannelNames: ReadonlyArray<string> = [\"cyan channel\", \"yellow channel\", \"orange channel\", \"green channel\", \"purple channel\", \"blue channel\"];\n\tpublic static readonly midiDrumChannelNames: ReadonlyArray<string> = [\"gray channel\", \"brown channel\", \"indigo channel\"];\n\tpublic static readonly midiSustainInstruments: number[] = [\n\t\t0x47, // triangle -> clarinet\n\t\t0x50, // square -> square wave\n\t\t0x46, // pulse wide -> bassoon\n\t\t0x44, // pulse narrow -> oboe\n\t\t0x51, // sawtooth -> sawtooth wave\n\t\t0x51, // double saw -> sawtooth wave\n\t\t0x51, // double pulse -> sawtooth wave\n\t\t0x51, // spiky -> sawtooth wave\n\t\t0x4A, // plateau -> recorder\n\t];\n\tpublic static readonly midiDecayInstruments: number[] = [\n\t\t0x2E, // triangle -> harp\n\t\t0x2E, // square -> harp\n\t\t0x06, // pulse wide -> harpsichord\n\t\t0x18, // pulse narrow -> nylon guitar\n\t\t0x19, // sawtooth -> steel guitar\n\t\t0x19, // double saw -> steel guitar\n\t\t0x6A, // double pulse -> shamisen\n\t\t0x6A, // spiky -> shamisen\n\t\t0x21, // plateau -> fingered bass\n\t];\n\tpublic static readonly drumInterval: number = 6;\n\tpublic static readonly drumCount: number = 12;\n\tpublic static readonly pitchCount: number = 37;\n\tpublic static readonly maxPitch: number = 84;\n\tpublic static readonly pitchChannelCountMin: number = 0;\n\tpublic static readonly pitchChannelCountMax: number = 12;\n\tpublic static readonly drumChannelCountMin: number = 0;\n\tpublic static readonly drumChannelCountMax: number = 4;\n\tpublic static readonly waves: ReadonlyArray<Float64Array> = [\n\t\tConfig._centerWave([1.0/15.0, 3.0/15.0, 5.0/15.0, 7.0/15.0, 9.0/15.0, 11.0/15.0, 13.0/15.0, 15.0/15.0, 15.0/15.0, 13.0/15.0, 11.0/15.0, 9.0/15.0, 7.0/15.0, 5.0/15.0, 3.0/15.0, 1.0/15.0, -1.0/15.0, -3.0/15.0, -5.0/15.0, -7.0/15.0, -9.0/15.0, -11.0/15.0, -13.0/15.0, -15.0/15.0, -15.0/15.0, -13.0/15.0, -11.0/15.0, -9.0/15.0, -7.0/15.0, -5.0/15.0, -3.0/15.0, -1.0/15.0]),\n\t\tConfig._centerWave([1.0, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0/31.0, 3.0/31.0, 5.0/31.0, 7.0/31.0, 9.0/31.0, 11.0/31.0, 13.0/31.0, 15.0/31.0, 17.0/31.0, 19.0/31.0, 21.0/31.0, 23.0/31.0, 25.0/31.0, 27.0/31.0, 29.0/31.0, 31.0/31.0, -31.0/31.0, -29.0/31.0, -27.0/31.0, -25.0/31.0, -23.0/31.0, -21.0/31.0, -19.0/31.0, -17.0/31.0, -15.0/31.0, -13.0/31.0, -11.0/31.0, -9.0/31.0, -7.0/31.0, -5.0/31.0, -3.0/31.0, -1.0/31.0]),\n\t\tConfig._centerWave([0.0, -0.2, -0.4, -0.6, -0.8, -1.0, 1.0, -0.8, -0.6, -0.4, -0.2, 1.0, 0.8, 0.6, 0.4, 0.2]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, 1.0, -1.0, 1.0, 0.0]),\n\t\tConfig._centerWave([0.0, 0.2, 0.4, 0.5, 0.6, 0.7, 0.8, 0.85, 0.9, 0.95, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.95, 0.9, 0.85, 0.8, 0.7, 0.6, 0.5, 0.4, 0.2, 0.0, -0.2, -0.4, -0.5, -0.6, -0.7, -0.8, -0.85, -0.9, -0.95, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.95, -0.9, -0.85, -0.8, -0.7, -0.6, -0.5, -0.4, -0.2]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0,1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([0.0, 0.1875, 0.3125, 0.5625, 0.5, 0.75, 0.875, 1.0, 1.0, 0.6875, 0.5, 0.625, 0.625, 0.5, 0.375, 0.5625, 0.4375, 0.5625, 0.4375, 0.4375, 0.3125, 0.1875, 0.1875, 0.375, 0.5625, 0.5625, 0.5625, 0.5625, 0.5625, 0.4375, 0.25, 0.0]),\n\t\tConfig._centerWave([1.0, 0.7, 0.1, 0.1, 0, 0, 0, 0, 0, 0.1, 0.2, 0.15, 0.25, 0.125, 0.215, 0.345, 4.0]),\n\t\tConfig._centerWave([1.0 / 15.0, 3.0 / 15.0, 5.0 / 15.0, 9.0, 0.06]),\n\t\tConfig._centerWave([-0.5, 3.5, 3.0, -0.5, -0.25, -1.0]),\n\t\tConfig._centerWave([0.0, 0.05, 0.125, 0.2, 0.25, 0.3, 0.425, 0.475, 0.525, 0.625, 0.675, 0.725, 0.775, 0.8, 0.825, 0.875, 0.9, 0.925, 0.95, 0.975, 0.98, 0.99, 0.995, 1, 0.995, 0.99, 0.98, 0.975, 0.95, 0.925, 0.9, 0.875, 0.825, 0.8, 0.775, 0.725, 0.675, 0.625, 0.525, 0.475, 0.425, 0.3, 0.25, 0.2, 0.125, 0.05, 0.0, -0.05, -0.125, -0.2, -0.25, -0.3, -0.425, -0.475, -0.525, -0.625, -0.675, -0.725, -0.775, -0.8, -0.825, -0.875, -0.9, -0.925, -0.95, -0.975, -0.98, -0.99, -0.995, -1, -0.995, -0.99, -0.98, -0.975, -0.95, -0.925, -0.9, -0.875, -0.825, -0.8, -0.775, -0.725, -0.675, -0.625, -0.525, -0.475, -0.425, -0.3, -0.25, -0.2, -0.125, -0.05]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0]),\n\t\tConfig._centerWave([0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]),\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0 / 2.0, 1.0 / 3.0, 1.0 / 4.0]),\n\t\tConfig._centerWave([-0.9, -1.0, -0.85, -0.775, -0.7, -0.6, -0.5, -0.4, -0.325, -0.225, -0.2, -0.125, -0.1, -0.11, -0.125, -0.15, -0.175, -0.18, -0.2, -0.21, -0.22, -0.21, -0.2, -0.175, -0.15, -0.1, -0.5, 0.75, 0.11, 0.175, 0.2, 0.25, 0.26, 0.275, 0.26, 0.25, 0.225, 0.2, 0.19, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.275, 0.28, 0.29, 0.3, 0.29, 0.28, 0.27, 0.26, 0.25, 0.225, 0.2, 0.175, 0.15, 0.1, 0.075, 0.0, -0.01, -0.025, 0.025, 0.075, 0.2, 0.3, 0.475, 0.6, 0.75, 0.85, 0.85, 1.0, 0.99, 0.95, 0.8, 0.675, 0.475, 0.275, 0.01, -0.15, -0.3, -0.475, -0.5, -0.6, -0.71, -0.81, -0.9, -1.0, -0.9]),\n\t\tConfig._centerWave([-1.0, -0.95, -0.975, -0.9, -0.85, -0.8, -0.775, -0.65, -0.6, -0.5, -0.475, -0.35, -0.275, -0.2, -0.125, -0.05, 0.0, 0.075, 0.125, 0.15, 0.20, 0.21, 0.225, 0.25, 0.225, 0.21, 0.20, 0.19, 0.175, 0.125, 0.10, 0.075, 0.06, 0.05, 0.04, 0.025, 0.04, 0.05, 0.10, 0.15, 0.225, 0.325, 0.425, 0.575, 0.70, 0.85, 0.95, 1.0, 0.9, 0.675, 0.375, 0.2, 0.275, 0.4, 0.5, 0.55, 0.6, 0.625, 0.65, 0.65, 0.65, 0.65, 0.64, 0.6, 0.55, 0.5, 0.4, 0.325, 0.25, 0.15, 0.05, -0.05, -0.15, -0.275, -0.35, -0.45, -0.55, -0.65, -0.7, -0.78, -0.825, -0.9, -0.925, -0.95, -0.975]),\n\t\tConfig._centerWave([1.0, 0.0, 0.1, -0.1, -0.2, -0.4, -0.3, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, 4.0, 2.15, 4.13, 5.15, 0.0, -0.05, 1.0]),\n\t\tConfig._centerWave([6.1, -2.9, 1.4, -2.9]),\n\t\tConfig._centerWave([1, 4, 2, 1, -0.1, -1, -0.12]),\n\t\tConfig._centerWave([0.2, 1.0, 2.6, 1.0, 0.0, -2.4]),\n\t\tConfig._centerWave([1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]),\n\t\tConfig._centerWave([1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0]),\n\t\tConfig._centerWave([1.0, -0.9, 0.8, -0.7, 0.6, -0.5, 0.4, -0.3, 0.2, -0.1, 0.0, -0.1, 0.2, -0.3, 0.4, -0.5, 0.6, -0.7, 0.8, -0.9, 1.0]),\n\t];\n\tpublic static readonly wavesMixC: ReadonlyArray<Float64Array> = [\n\t\tConfig._centerWave([1.0 / 15.0, 3.0 / 15.0, 5.0 / 15.0, 7.0 / 15.0, 9.0 / 15.0, 11.0 / 15.0, 13.0 / 15.0, 15.0 / 15.0, 15.0 / 15.0, 13.0 / 15.0, 11.0 / 15.0, 9.0 / 15.0, 7.0 / 15.0, 5.0 / 15.0, 3.0 / 15.0, 1.0 / 15.0, -1.0 / 15.0, -3.0 / 15.0, -5.0 / 15.0, -7.0 / 15.0, -9.0 / 15.0, -11.0 / 15.0, -13.0 / 15.0, -15.0 / 15.0, -15.0 / 15.0, -13.0 / 15.0, -11.0 / 15.0, -9.0 / 15.0, -7.0 / 15.0, -5.0 / 15.0, -3.0 / 15.0, -1.0 / 15.0]),\n\t\tConfig._centerWave([1.0, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0 / 31.0, 3.0 / 31.0, 5.0 / 31.0, 7.0 / 31.0, 9.0 / 31.0, 11.0 / 31.0, 13.0 / 31.0, 15.0 / 31.0, 17.0 / 31.0, 19.0 / 31.0, 21.0 / 31.0, 23.0 / 31.0, 25.0 / 31.0, 27.0 / 31.0, 29.0 / 31.0, 31.0 / 31.0, -31.0 / 31.0, -29.0 / 31.0, -27.0 / 31.0, -25.0 / 31.0, -23.0 / 31.0, -21.0 / 31.0, -19.0 / 31.0, -17.0 / 31.0, -15.0 / 31.0, -13.0 / 31.0, -11.0 / 31.0, -9.0 / 31.0, -7.0 / 31.0, -5.0 / 31.0, -3.0 / 31.0, -1.0 / 31.0]),\n\t\tConfig._centerWave([0.0, -0.2, -0.4, -0.6, -0.8, -1.0, 1.0, -0.8, -0.6, -0.4, -0.2, 1.0, 0.8, 0.6, 0.4, 0.2]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, 1.0, -1.0, 1.0, 0.0]),\n\t\tConfig._centerWave([0.0, 0.2, 0.4, 0.5, 0.6, 0.7, 0.8, 0.85, 0.9, 0.95, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.95, 0.9, 0.85, 0.8, 0.7, 0.6, 0.5, 0.4, 0.2, 0.0, -0.2, -0.4, -0.5, -0.6, -0.7, -0.8, -0.85, -0.9, -0.95, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.95, -0.9, -0.85, -0.8, -0.7, -0.6, -0.5, -0.4, -0.2]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0,1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([0.0, 0.1875, 0.3125, 0.5625, 0.5, 0.75, 0.875, 1.0, 1.0, 0.6875, 0.5, 0.625, 0.625, 0.5, 0.375, 0.5625, 0.4375, 0.5625, 0.4375, 0.4375, 0.3125, 0.1875, 0.1875, 0.375, 0.5625, 0.5625, 0.5625, 0.5625, 0.5625, 0.4375, 0.25, 0.0]),\n\t\tConfig._centerWave([1.0, 0.7, 0.1, 0.1, 0, 0, 0, 0, 0, 0.1, 0.2, 0.15, 0.25, 0.125, 0.215, 0.345, 4.0]),\n\t\tConfig._centerWave([1.0 / 15.0, 3.0 / 15.0, 5.0 / 15.0, 9.0, 0.06]),\n\t\tConfig._centerWave([-0.5, 3.5, 3.0, -0.5, -0.25, -1.0]),\n\t\tConfig._centerWave([0.0, 0.05, 0.125, 0.2, 0.25, 0.3, 0.425, 0.475, 0.525, 0.625, 0.675, 0.725, 0.775, 0.8, 0.825, 0.875, 0.9, 0.925, 0.95, 0.975, 0.98, 0.99, 0.995, 1, 0.995, 0.99, 0.98, 0.975, 0.95, 0.925, 0.9, 0.875, 0.825, 0.8, 0.775, 0.725, 0.675, 0.625, 0.525, 0.475, 0.425, 0.3, 0.25, 0.2, 0.125, 0.05, 0.0, -0.05, -0.125, -0.2, -0.25, -0.3, -0.425, -0.475, -0.525, -0.625, -0.675, -0.725, -0.775, -0.8, -0.825, -0.875, -0.9, -0.925, -0.95, -0.975, -0.98, -0.99, -0.995, -1, -0.995, -0.99, -0.98, -0.975, -0.95, -0.925, -0.9, -0.875, -0.825, -0.8, -0.775, -0.725, -0.675, -0.625, -0.525, -0.475, -0.425, -0.3, -0.25, -0.2, -0.125, -0.05]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0]),\n\t\tConfig._centerWave([0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]),\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0 / 2.0, 1.0 / 3.0, 1.0 / 4.0]),\n\t\tConfig._centerWave([-0.9, -1.0, -0.85, -0.775, -0.7, -0.6, -0.5, -0.4, -0.325, -0.225, -0.2, -0.125, -0.1, -0.11, -0.125, -0.15, -0.175, -0.18, -0.2, -0.21, -0.22, -0.21, -0.2, -0.175, -0.15, -0.1, -0.5, 0.75, 0.11, 0.175, 0.2, 0.25, 0.26, 0.275, 0.26, 0.25, 0.225, 0.2, 0.19, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.275, 0.28, 0.29, 0.3, 0.29, 0.28, 0.27, 0.26, 0.25, 0.225, 0.2, 0.175, 0.15, 0.1, 0.075, 0.0, -0.01, -0.025, 0.025, 0.075, 0.2, 0.3, 0.475, 0.6, 0.75, 0.85, 0.85, 1.0, 0.99, 0.95, 0.8, 0.675, 0.475, 0.275, 0.01, -0.15, -0.3, -0.475, -0.5, -0.6, -0.71, -0.81, -0.9, -1.0, -0.9]),\n\t\tConfig._centerWave([-1.0, -0.95, -0.975, -0.9, -0.85, -0.8, -0.775, -0.65, -0.6, -0.5, -0.475, -0.35, -0.275, -0.2, -0.125, -0.05, 0.0, 0.075, 0.125, 0.15, 0.20, 0.21, 0.225, 0.25, 0.225, 0.21, 0.20, 0.19, 0.175, 0.125, 0.10, 0.075, 0.06, 0.05, 0.04, 0.025, 0.04, 0.05, 0.10, 0.15, 0.225, 0.325, 0.425, 0.575, 0.70, 0.85, 0.95, 1.0, 0.9, 0.675, 0.375, 0.2, 0.275, 0.4, 0.5, 0.55, 0.6, 0.625, 0.65, 0.65, 0.65, 0.65, 0.64, 0.6, 0.55, 0.5, 0.4, 0.325, 0.25, 0.15, 0.05, -0.05, -0.15, -0.275, -0.35, -0.45, -0.55, -0.65, -0.7, -0.78, -0.825, -0.9, -0.925, -0.95, -0.975]),\n\t\tConfig._centerWave([0.7, 0.0, 0.1, -0.1, -0.2, -0.4, -0.3, -0.7]),\n\t\tConfig._centerWave([1.0, -1.0, 4.0, 2.15, 4.1, 5.05, 0.0, -0.05, 1.0]),\n\t\tConfig._centerWave([4.5, -1.7, 1.0, -1.7]),\n\t\tConfig._centerWave([0.1, 0.4, 0.2, 0.1, -0.1, -1, -0.12]),\n\t\tConfig._centerWave([.03, .13, .30, 1.0, 0.0, -.26]),\n\t\tConfig._centerWave([2, 1.75, 1.5, 1.25, 1, .75, .5, .25, 0.0, 0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75]),\n\t\tConfig._centerWave([1.0, 1.9, 1.8, 1.7, 1.6, 1.5, 1.4, 1.3, 1.2, 1.1, 1.0]),\n\t\tConfig._centerWave([-1.0, -0.9, 0.8, -0.7, 0.6, -0.5, 0.4, -0.3, 0.2, -0.1, 0.0, -0.1, 0.2, -0.3, 0.4, -0.5, 0.6, -0.7, 0.8, -0.9, -1.0]),\n\t];\n\tpublic static readonly pwmwaves: ReadonlyArray<Float64Array> = [\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\n\t];\n\tpublic static readonly sineWaveLength: number = 1 << 8; // 256\n\tpublic static readonly sineWaveMask: number = Config.sineWaveLength - 1;\n\tpublic static readonly sineWave: Float64Array = Config.generateSineWave();\n\t\n\tprivate static _centerWave(wave: Array<number>): Float64Array {\n\t\tlet sum: number = 0.0;\n\t\tfor (let i: number = 0; i < wave.length; i++) sum += wave[i];\n\t\tconst average: number = sum / wave.length;\n\t\tfor (let i: number = 0; i < wave.length; i++) wave[i] -= average;\n\t\treturn new Float64Array(wave);\n\t}\n\t\n\tpublic static getDrumWave(index: number): Float32Array {\n\t\tlet wave: Float32Array | null = Config._drumWaves[index];\n\t\tif (wave == null) {\n\t\t\twave = new Float32Array(32768);\n\t\t\tConfig._drumWaves[index] = wave;\n\t\t\t\n\t\t\tif (index == 0) {\n\t\t\t\t// The \"retro\" drum uses a \"Linear Feedback Shift Register\" similar to the NES noise channel.\n\t\t\t\tlet drumBuffer: number = 1;\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\n\t\t\t\t\t\tnewBuffer += 1 << 14;\n\t\t\t\t\t}\n\t\t\t\t\tdrumBuffer = newBuffer;\n\t\t\t\t}\n\t\t\t} else if (index == 1) {\n\t\t\t\t// White noise is just random values for each sample.\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\n\t\t\t\t\twave[i] = Math.random() * 2.0 - 1.0;\n\t\t\t\t}\n\t\t\t} else if (index == 2) {\n\t\t\t\t// \"periodic\" drum.\n\t\t\t\tlet drumBuffer: number = 1;\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\n\t\t\t\t\t\tnewBuffer += 2 << 14;\n\t\t\t\t\t}\n\t\t\t\t\tdrumBuffer = newBuffer;\n\t\t\t\t}\n\t\t\t} else if (index == 3) {\n\t\t\t\t// \"detuned periodic\" drum.\n\t\t\t\tlet drumBuffer: number = 1;\n\t\t\t\tfor (let i: number = 0; i < 32767; i++) {\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 2;\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\n\t\t\t\t\t\tnewBuffer += 4 << 14;\n\t\t\t\t\t}\n\t\t\t\t\tdrumBuffer = newBuffer;\n\t\t\t\t}\n\t\t\t} else if (index == 4) {\n\t\t\t\t// \"shine\" drum.\n\t\t\t\tlet drumBuffer: number = 1;\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\n\t\t\t\t\t\tnewBuffer += 10 << 2;\n\t\t\t\t\t}\n\t\t\t\t\tdrumBuffer = newBuffer;\n\t\t\t\t}\n\t\t\t} else if (index == 5) {\n\t\t\t\t// \"hollow\" drums, designed in frequency space and then converted via FFT:\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10, 11, 1, 1, 0);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11, 14, -2, -2, 0);\n\t\t\t\tinverseRealFourierTransform(wave);\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\n\t\t\t} else if (index == 6) {\n\t\t\t\t// \"deep\" drum, designed in frequency space and then converted via FFT:\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 1, 10, 1, 1, 0);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 20, 14, -2, -2, 0);\n\t\t\t\tinverseRealFourierTransform(wave);\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\n\t\t\t} else if (index == 7) {\n\t\t\t\t// \"cutter\" drum.\n\t\t\t\tlet drumBuffer: number = 1;\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 4.0 * Math.random();\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\n\t\t\t\t\t\tnewBuffer += 15 << 2;\n\t\t\t\t\t}\n\t\t\t\t\tdrumBuffer = newBuffer;\n\t\t\t\t}\n\t\t\t} else if (index == 8) {\n\t\t\t\t// \"metallic\" drum.\n\t\t\t\tlet drumBuffer: number = 1;\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\n\t\t\t\t\twave[i] = (drumBuffer & 1) / 2.0 + 0.5;\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\n\t\t\t\t\t\tnewBuffer -= 10 << 2;\n\t\t\t\t\t}\n\t\t\t\t\tdrumBuffer = newBuffer;\n\t\t\t\t}\n\t\t\t} else if (index == 9) {\n\t\t\t\t// \"snare\" drum.\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\n\t\t\t\t\twave[i] = Math.random() * 2.0 - 1.0;\n\t\t\t\t}\n\t\t\t/*\n\t\t\t} else if (index == 10) {\n\t\t\t\t// \"tom-tom\" drums, designed in frequency space and then converted via FFT:\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10, 14, 0, -4, 0);\n\t\t\t\tinverseRealFourierTransform(wave);\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\n\t\t\t} else if (index == 11) {\n\t\t\t\t// \"cymbal\" drums, designed in frequency space and then converted via FFT:\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 9, 9.4, -1, -1, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 9.7, 10, -1, -1, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10.3, 10.6, -1, -1, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10.9, 11.1, -1, -1, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11.3, 11.4, 0, 0, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11.5, 11.7, 1.5, 1.5, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11.7, 12, -1, -1, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 12, 12.1, 2, 2, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 12.1, 12.6, 0, 2, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 12.6, 13, 0, 0, -0.5);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 13, 14, 1, -3, -0.5);\n\t\t\t\tinverseRealFourierTransform(wave);\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\n\t\t\t} else if (index == 12) {\n\t\t\t\t// \"bass\" drums, designed in frequency space and then converted via FFT:\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 7, 8, -2, 4, 0);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 8, 9, 4, -2, 0);\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 9, 14, -2, -6, 0);\n\t\t\t\tinverseRealFourierTransform(wave);\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\n\t\t\t*/\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Unrecognized drum index: \" + index);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn wave;\n\t}\n\t\n\tprivate static drawNoiseSpectrum(wave: Float32Array, lowOctave: number, highOctave: number, lowPower: number, highPower: number, overalSlope: number): void {\n\t\tconst referenceOctave: number = 11;\n\t\tconst referenceIndex: number = 1 << referenceOctave;\n\t\tconst lowIndex: number = Math.pow(2, lowOctave) | 0;\n\t\tconst highIndex: number = Math.pow(2, highOctave) | 0;\n\t\tconst log2: number = Math.log(2);\n\t\tfor (let i: number = lowIndex; i < highIndex; i++) {\n\t\t\tlet amplitude: number = Math.pow(2, lowPower + (highPower - lowPower) * (Math.log(i) / log2 - lowOctave) / (highOctave - lowOctave));\n\t\t\tamplitude *= Math.pow(i / referenceIndex, overalSlope);\n\t\t\tconst radians: number = Math.random() * Math.PI * 2.0;\n\t\t\twave[i] = Math.cos(radians) * amplitude;\n\t\t\twave[32768 - i] = Math.sin(radians) * amplitude;\n\t\t}\n\t}\n\t\n\tprivate static generateSineWave(): Float64Array {\n\t\tconst wave: Float64Array = new Float64Array(Config.sineWaveLength + 1);\n\t\tfor (let i: number = 0; i < Config.sineWaveLength + 1; i++) {\n\t\t\twave[i] = Math.sin(i * Math.PI * 2.0 / Config.sineWaveLength);\n\t\t}\n\t\treturn wave;\n\t}\n}\n\n// Pardon the messy type casting. This allows accessing array members by numerical index or string name.\nexport function toNameMap<T extends BeepBoxOption>(array: Array<Pick<T, Exclude<keyof T, \"index\">>>): DictionaryArray<T> {\n\tconst dictionary: Dictionary<T> = {};\n\tfor (let i: number = 0; i < array.length; i++) {\n\t\tconst value: any = array[i];\n\t\tvalue.index = i;\n\t\tdictionary[value.name] = <T> value;\n\t}\n\tconst result: DictionaryArray<T> = <DictionaryArray<T>> <any> array;\n\tresult.dictionary = dictionary;\n\treturn result;\n}","// Copyright (C) John Nesky, distributed under the MIT license.\n\nexport function applyElementArgs<T extends HTMLElement | SVGElement | DocumentFragment>(element: T, args: Array<any>): T {\n\tfor (const arg of args) {\n\t\tif (arg instanceof Node) {\n\t\t\telement.appendChild(arg);\n\t\t} else if (typeof arg === \"string\") {\n\t\t\telement.appendChild(document.createTextNode(arg));\n\t\t} else if (typeof arg === \"function\") {\n\t\t\tapplyElementArgs(element, [arg()]);\n\t\t} else if (Array.isArray(arg)) {\n\t\t\tapplyElementArgs(element, arg);\n\t\t} else if (arg && typeof Symbol !== \"undefined\" && typeof arg[Symbol.iterator] === \"function\") {\n\t\t\tapplyElementArgs(element, [...arg]);\n\t\t} else if (arg && arg.constructor === Object && element instanceof Element) {\n\t\t\t// If the argument is a literal {} Object\n\t\t\tfor (const key of Object.keys(arg)) {\n\t\t\t\tconst value = arg[key];\n\t\t\t\t/*if (key === \"classList\") {\n\t\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\t\telement.classList.add(...value.split(\" \"));\n\t\t\t\t\t} else if (Array.isArray(arg) || (value && typeof Symbol !== \"undefined\" && typeof value[Symbol.iterator] === \"function\")) {\n\t\t\t\t\t\telement.classList.add(...value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn(\"Invalid classList value \\\"\" + value + \"\\\" on \" + element.tagName + \" element.\");\n\t\t\t\t\t}\n\t\t\t\t} else*/ if (key === \"class\" /* || key === \"className\" */) {\n\t\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\t\telement.setAttribute(\"class\", value);\n\t\t\t\t\t} else if (Array.isArray(arg) || (value && typeof Symbol !== \"undefined\" && typeof value[Symbol.iterator] === \"function\")) {\n\t\t\t\t\t\telement.setAttribute(\"class\", [...value].join(\" \"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn(\"Invalid \" + key + \" value \\\"\" + value + \"\\\" on \" + element.tagName + \" element.\");\n\t\t\t\t\t}\n\t\t\t\t} else if (key === \"style\") {\n\t\t\t\t\tif (value && value.constructor === Object) {\n\t\t\t\t\t\tfor (const styleKey of Object.keys(value)) {\n\t\t\t\t\t\t\tif (styleKey in (<HTMLElement | SVGElement>element).style) {\n\t\t\t\t\t\t\t\t// In practice, camelCase and kebab-case properties both work as properties on CSSStyleDeclaration objects.\n\t\t\t\t\t\t\t\t(<any> element).style[styleKey] = value[styleKey];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// CSS variables start with -- and must be set with setProperty.\n\t\t\t\t\t\t\t\t(<HTMLElement | SVGElement>element).style.setProperty(styleKey, value[styleKey]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.setAttribute(key, value);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof(value) === \"function\") {\n\t\t\t\t\t// If value is a callback, set as a property instead trying to coerce to string.\n\t\t\t\t\t(<any>element)[key] = value;\n\t\t\t\t} else if (typeof(value) === \"boolean\") {\n\t\t\t\t\t// If value is boolean, set attribute if true, remove if false.\n\t\t\t\t\tif (value) element.setAttribute(key, \"\");\n\t\t\t\t\telse element.removeAttribute(key);\n\t\t\t\t} else {\n\t\t\t\t\t// Default to setting attribute, as if writing html directly.\n\t\t\t\t\telement.setAttribute(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Just convert unrecognized objects to text and append them.\n\t\t\telement.appendChild(document.createTextNode(arg));\n\t\t}\n\t}\n\treturn element;\n}\n\nexport const svgNS: string = \"http://www.w3.org/2000/svg\";\n\nexport function parseHTML(...args: Array<any>): DocumentFragment {\n\treturn document.createRange().createContextualFragment(args.join());\n}\n\n//let svgParser: SVGSVGElement | null = null;\nexport function parseSVG(...args: Array<any>): DocumentFragment {\n\tconst fragment: DocumentFragment = document.createDocumentFragment();\n\t\n\t// Internet Explorer doesn't support the first method here, so I commented it out and used a slightly more complex one involving DOMParser below.\n\t/*\n\tif (svgParser === null) svgParser = <SVGSVGElement>document.createElementNS(svgNS, \"svg\");\n\tsvgParser.innerHTML = args.join();\n\twhile (svgParser.firstChild !== null) fragment.appendChild(svgParser.firstChild);\n\t*/\n\tconst svgParser: Element = new DOMParser().parseFromString(\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\">\" + args.join() + \"</svg>\", \"image/svg+xml\").documentElement;\n\twhile (svgParser.firstChild !== null) {\n\t\tdocument.importNode(svgParser.firstChild, true);\n\t\tfragment.appendChild(svgParser.firstChild);\n\t}\n\t\n\treturn fragment;\n}\n\nexport function replaceScriptWith(...args: Array<any>): void {\n\tlet currentScript: HTMLScriptElement | SVGScriptElement | null = document.currentScript;\n\tif (currentScript == null) { // double-equals to intentionally include undefined in Internet Explorer.\n\t\t\n\t\t// Internet Explorer doens't support currentScript, try this method instead:\n\t\tif (document.readyState === \"loading\") {\n\t\t\tconst scripts: HTMLCollectionOf<HTMLScriptElement> = document.getElementsByTagName(\"script\");\n\t\t\tcurrentScript = scripts[scripts.length - 1];\n\t\t}\n\t\t\n\t\tif (currentScript == null) {\n\t\t\tconsole.warn(\"Couldn't replace script because no script is currently being parsed and executed, maybe this is happening in a callback function or event handler instead?\");\n\t\t\treturn;\n\t\t}\n\t}\n\tif (currentScript.parentNode === null) {\n\t\tconsole.warn(\"Couldn't replace script element because it is not attached to a parent anymore, did you try to replace the same script more than once?\");\n\t\treturn;\n\t}\n\tcurrentScript.parentNode.replaceChild(applyElementArgs(document.createDocumentFragment(), args), currentScript);\n}\n\nexport function applyToElement<T extends HTMLElement | SVGElement | DocumentFragment>(element: T, ...args: Array<any>): T {\n\tif (!(element instanceof Element || element instanceof DocumentFragment)) {\n\t\tconsole.warn(\"Couldn't apply to provided argument because it's not an element or DocumentFragment.\");\n\t\treturn element;\n\t}\n\treturn applyElementArgs(element, args);\n}\n","// Copyright (C) John Nesky, distributed under the MIT license.\n\nimport {applyElementArgs, svgNS, parseHTML, parseSVG, replaceScriptWith, applyToElement} from \"./elements-base.js\";\nexport {replaceScriptWith, applyToElement};\n\ninterface HTMLElementFactory {\n\t(...args: Array<string>): DocumentFragment;\n\t//readonly [key: string]: (...args: Array<any>) => HTMLElement;\n\ta(...args: Array<any>): HTMLAnchorElement;\n\tabbr(...args: Array<any>): HTMLElement;\n\taddress(...args: Array<any>): HTMLElement;\n\tarea(...args: Array<any>): HTMLAreaElement;\n\tarticle(...args: Array<any>): HTMLElement;\n\taside(...args: Array<any>): HTMLElement;\n\taudio(...args: Array<any>): HTMLAudioElement;\n\tb(...args: Array<any>): HTMLElement;\n\tbase(...args: Array<any>): HTMLBaseElement;\n\tbdi(...args: Array<any>): HTMLElement;\n\tbdo(...args: Array<any>): HTMLElement;\n\tblockquote(...args: Array<any>): HTMLQuoteElement;\n\tbr(...args: Array<any>): HTMLBRElement;\n\tbutton(...args: Array<any>): HTMLButtonElement;\n\tcanvas(...args: Array<any>): HTMLCanvasElement;\n\tcaption(...args: Array<any>): HTMLTableCaptionElement;\n\tcite(...args: Array<any>): HTMLElement;\n\tcode(...args: Array<any>): HTMLElement;\n\tcol(...args: Array<any>): HTMLTableColElement;\n\tcolgroup(...args: Array<any>): HTMLTableColElement;\n\tdatalist(...args: Array<any>): HTMLDataListElement;\n\tdd(...args: Array<any>): HTMLElement;\n\tdel(...args: Array<any>): HTMLModElement;\n\tdetails(...args: Array<any>): HTMLDetailsElement;\n\tdfn(...args: Array<any>): HTMLElement;\n\tdialog(...args: Array<any>): HTMLDialogElement;\n\tdiv(...args: Array<any>): HTMLDivElement;\n\tdl(...args: Array<any>): HTMLDListElement;\n\tdt(...args: Array<any>): HTMLElement;\n\tem(...args: Array<any>): HTMLElement;\n\tembed(...args: Array<any>): HTMLEmbedElement;\n\tfieldset(...args: Array<any>): HTMLFieldSetElement;\n\tfigcaption(...args: Array<any>): HTMLElement;\n\tfigure(...args: Array<any>): HTMLElement;\n\tfooter(...args: Array<any>): HTMLElement;\n\tform(...args: Array<any>): HTMLFormElement;\n\th1(...args: Array<any>): HTMLHeadingElement;\n\th2(...args: Array<any>): HTMLHeadingElement;\n\th3(...args: Array<any>): HTMLHeadingElement;\n\th4(...args: Array<any>): HTMLHeadingElement;\n\th5(...args: Array<any>): HTMLHeadingElement;\n\th6(...args: Array<any>): HTMLHeadingElement;\n\theader(...args: Array<any>): HTMLElement;\n\thr(...args: Array<any>): HTMLHRElement;\n\ti(...args: Array<any>): HTMLElement;\n\tiframe(...args: Array<any>): HTMLIFrameElement;\n\timg(...args: Array<any>): HTMLImageElement;\n\tinput(...args: Array<any>): HTMLInputElement;\n\tins(...args: Array<any>): HTMLModElement;\n\tkbd(...args: Array<any>): HTMLElement;\n\tlabel(...args: Array<any>): HTMLLabelElement;\n\tlegend(...args: Array<any>): HTMLLegendElement;\n\tli(...args: Array<any>): HTMLLIElement;\n\tlink(...args: Array<any>): HTMLLinkElement;\n\tmain(...args: Array<any>): HTMLElement;\n\tmap(...args: Array<any>): HTMLMapElement;\n\tmark(...args: Array<any>): HTMLElement;\n\tmenu(...args: Array<any>): HTMLMenuElement;\n\tmenuitem(...args: Array<any>): HTMLUnknownElement;\n\tmeta(...args: Array<any>): HTMLMetaElement;\n\tmeter(...args: Array<any>): HTMLMeterElement;\n\tnav(...args: Array<any>): HTMLElement;\n\tnoscript(...args: Array<any>): HTMLElement;\n\tobject(...args: Array<any>): HTMLObjectElement;\n\tol(...args: Array<any>): HTMLOListElement;\n\toptgroup(...args: Array<any>): HTMLOptGroupElement;\n\toption(...args: Array<any>): HTMLOptionElement;\n\toutput(...args: Array<any>): HTMLOutputElement;\n\tp(...args: Array<any>): HTMLParagraphElement;\n\tparam(...args: Array<any>): HTMLParamElement;\n\tpicture(...args: Array<any>): HTMLPictureElement;\n\tpre(...args: Array<any>): HTMLPreElement;\n\tprogress(...args: Array<any>): HTMLProgressElement;\n\tq(...args: Array<any>): HTMLQuoteElement;\n\trp(...args: Array<any>): HTMLElement;\n\trt(...args: Array<any>): HTMLElement;\n\truby(...args: Array<any>): HTMLElement;\n\ts(...args: Array<any>): HTMLElement;\n\tsamp(...args: Array<any>): HTMLElement;\n\tscript(...args: Array<any>): HTMLScriptElement;\n\tsection(...args: Array<any>): HTMLElement;\n\tselect(...args: Array<any>): HTMLSelectElement;\n\tsmall(...args: Array<any>): HTMLElement;\n\tsource(...args: Array<any>): HTMLSourceElement;\n\tspan(...args: Array<any>): HTMLSpanElement;\n\tstrong(...args: Array<any>): HTMLElement;\n\tstyle(...args: Array<any>): HTMLStyleElement;\n\tsub(...args: Array<any>): HTMLElement;\n\tsummary(...args: Array<any>): HTMLElement;\n\tsup(...args: Array<any>): HTMLElement;\n\ttable(...args: Array<any>): HTMLTableElement;\n\ttbody(...args: Array<any>): HTMLTableSectionElement;\n\ttd(...args: Array<any>): HTMLTableCellElement;\n\ttemplate(...args: Array<any>): HTMLTemplateElement;\n\ttextarea(...args: Array<any>): HTMLTextAreaElement;\n\ttfoot(...args: Array<any>): HTMLTableSectionElement;\n\tth(...args: Array<any>): HTMLTableCellElement;\n\tthead(...args: Array<any>): HTMLTableSectionElement;\n\ttime(...args: Array<any>): HTMLTimeElement;\n\ttitle(...args: Array<any>): HTMLTitleElement;\n\ttr(...args: Array<any>): HTMLTableRowElement;\n\ttrack(...args: Array<any>): HTMLTrackElement;\n\tu(...args: Array<any>): HTMLElement;\n\tul(...args: Array<any>): HTMLUListElement;\n\tvar(...args: Array<any>): HTMLElement;\n\tvideo(...args: Array<any>): HTMLVideoElement;\n\twbr(...args: Array<any>): HTMLElement;\n}\n\ninterface SVGElementFactory {\n\t(...args: Array<string>): DocumentFragment;\n\t//readonly [key: string]: (...args: Array<any>) => SVGElement;\n\ta(...args: Array<any>): SVGAElement;\n\taltGlyph(...args: Array<any>): SVGElement;\n\taltGlyphDef(...args: Array<any>): SVGElement;\n\taltGlyphItem(...args: Array<any>): SVGElement;\n\tanimate(...args: Array<any>): SVGAnimateElement;\n\tanimateMotion(...args: Array<any>): SVGAnimateMotionElement;\n\tanimateTransform(...args: Array<any>): SVGAnimateTransformElement;\n\tcircle(...args: Array<any>): SVGCircleElement;\n\tclipPath(...args: Array<any>): SVGClipPathElement;\n\t\"color-profile\"(...args: Array<any>): SVGElement;\n\tcolor_profile(...args: Array<any>): SVGElement;\n\tcursor(...args: Array<any>): SVGElement;\n\tdefs(...args: Array<any>): SVGDefsElement;\n\tdesc(...args: Array<any>): SVGDescElement;\n\tdiscard(...args: Array<any>): SVGElement;\n\tellipse(...args: Array<any>): SVGEllipseElement;\n\tfeBlend(...args: Array<any>): SVGFEBlendElement;\n\tfeColorMatrix(...args: Array<any>): SVGFEColorMatrixElement;\n\tfeComponentTransfer(...args: Array<any>): SVGFEComponentTransferElement;\n\tfeComposite(...args: Array<any>): SVGFECompositeElement;\n\tfeConvolveMatrix(...args: Array<any>): SVGFEConvolveMatrixElement;\n\tfeDiffuseLighting(...args: Array<any>): SVGFEDiffuseLightingElement;\n\tfeDisplacementMap(...args: Array<any>): SVGFEDisplacementMapElement;\n\tfeDistantLight(...args: Array<any>): SVGFEDistantLightElement;\n\tfeDropShadow(...args: Array<any>): SVGElement;\n\tfeFlood(...args: Array<any>): SVGFEFloodElement;\n\tfeFuncA(...args: Array<any>): SVGFEFuncAElement;\n\tfeFuncB(...args: Array<any>): SVGFEFuncBElement;\n\tfeFuncG(...args: Array<any>): SVGFEFuncGElement;\n\tfeFuncR(...args: Array<any>): SVGFEFuncRElement;\n\tfeGaussianBlur(...args: Array<any>): SVGFEGaussianBlurElement;\n\tfeImage(...args: Array<any>): SVGFEImageElement;\n\tfeMerge(...args: Array<any>): SVGFEMergeElement;\n\tfeMergeNode(...args: Array<any>): SVGFEMergeNodeElement;\n\tfeMorphology(...args: Array<any>): SVGFEMorphologyElement;\n\tfeOffset(...args: Array<any>): SVGFEOffsetElement;\n\tfePointLight(...args: Array<any>): SVGFEPointLightElement;\n\tfeSpecularLighting(...args: Array<any>): SVGFESpecularLightingElement;\n\tfeSpotLight(...args: Array<any>): SVGFESpotLightElement;\n\tfeTile(...args: Array<any>): SVGFETileElement;\n\tfeTurbulence(...args: Array<any>): SVGFETurbulenceElement;\n\tfilter(...args: Array<any>): SVGFilterElement;\n\tfont(...args: Array<any>): SVGElement;\n\t\"font-face\"(...args: Array<any>): SVGElement;\n\tfont_face(...args: Array<any>): SVGElement;\n\t\"font-face-format\"(...args: Array<any>): SVGElement;\n\tfont_face_format(...args: Array<any>): SVGElement;\n\t\"font-face-name\"(...args: Array<any>): SVGElement;\n\tfont_face_name(...args: Array<any>): SVGElement;\n\t\"font-face-src\"(...args: Array<any>): SVGElement;\n\tfont_face_src(...args: Array<any>): SVGElement;\n\t\"font-face-uri\"(...args: Array<any>): SVGElement;\n\tfont_face_uri(...args: Array<any>): SVGElement;\n\tforeignObject(...args: Array<any>): SVGForeignObjectElement;\n\tg(...args: Array<any>): SVGGElement;\n\tglyph(...args: Array<any>): SVGElement;\n\tglyphRef(...args: Array<any>): SVGElement;\n\thkern(...args: Array<any>): SVGElement;\n\timage(...args: Array<any>): SVGImageElement;\n\tline(...args: Array<any>): SVGLineElement;\n\tlinearGradient(...args: Array<any>): SVGLinearGradientElement;\n\tmarker(...args: Array<any>): SVGMarkerElement;\n\tmask(...args: Array<any>): SVGMaskElement;\n\tmetadata(...args: Array<any>): SVGMetadataElement;\n\t\"missing-glyph\"(...args: Array<any>): SVGElement;\n\tmissing_glyph(...args: Array<any>): SVGElement;\n\tmpath(...args: Array<any>): SVGElement;\n\tpath(...args: Array<any>): SVGPathElement;\n\tpattern(...args: Array<any>): SVGPatternElement;\n\tpolygon(...args: Array<any>): SVGPolygonElement;\n\tpolyline(...args: Array<any>): SVGPolylineElement;\n\tradialGradient(...args: Array<any>): SVGRadialGradientElement;\n\trect(...args: Array<any>): SVGRectElement;\n\tscript(...args: Array<any>): SVGScriptElement;\n\tset(...args: Array<any>): SVGElement;\n\tstop(...args: Array<any>): SVGStopElement;\n\tstyle(...args: Array<any>): SVGStyleElement;\n\tsvg(...args: Array<any>): SVGSVGElement;\n\tswitch(...args: Array<any>): SVGSwitchElement;\n\tsymbol(...args: Array<any>): SVGSymbolElement;\n\ttext(...args: Array<any>): SVGTextElement;\n\ttextPath(...args: Array<any>): SVGTextPathElement;\n\ttitle(...args: Array<any>): SVGTitleElement;\n\ttref(...args: Array<any>): SVGElement;\n\ttspan(...args: Array<any>): SVGTSpanElement;\n\tuse(...args: Array<any>): SVGUseElement;\n\tview(...args: Array<any>): SVGViewElement;\n\tvkern(...args: Array<any>): SVGElement;\n}\n\nexport const HTML: HTMLElementFactory = <HTMLElementFactory> <unknown> parseHTML;\nexport const SVG: SVGElementFactory = <SVGElementFactory> <unknown> parseSVG;\n\nfor (const name of \"a abbr address area article aside audio b base bdi bdo blockquote br button canvas caption cite code col colgroup datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hr i iframe img input ins kbd label legend li link main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param picture pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td template textarea tfoot th thead time title tr track u ul var video wbr\".split(\" \")) {\n\t(<any>HTML)[name] = (...args: Array<any>) => applyElementArgs(document.createElement(name), args);\n}\nfor (const name of \"a altGlyph altGlyphDef altGlyphItem animate animateMotion animateTransform circle clipPath color-profile cursor defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font font-face font-face-format font-face-name font-face-src font-face-uri foreignObject g glyph glyphRef hkern image line linearGradient marker mask metadata missing-glyph mpath path pattern polygon polyline radialGradient rect script set stop style svg switch symbol text textPath title tref tspan use view vkern\".split(\" \")) {\n\t(<any>SVG)[name] = (...args: Array<any>) => applyElementArgs(<SVGElement> document.createElementNS(svgNS, name), args);\n\tif (/-/.test(name)) {\n\t\tconst snakeCaseName = name.replace(/-/g, \"_\");\n\t\t(<any>SVG)[snakeCaseName] = (...args: Array<any>) => applyElementArgs(<SVGElement> document.createElementNS(svgNS, name), args);\n\t}\n}\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { Config, Dictionary, InstrumentType, EnvelopeType } from \"./SynthConfig\";\n\ndeclare global {\n\tinterface Window {\n\t\tAudioContext: any;\n\t\twebkitAudioContext: any;\n\t}\n}\n\n\t\n\tconst enum CharCode {\n\t\tSPACE = 32,\n\t\tHASH = 35,\n\t\tDOLLAR_SIGN = 36,\n\t\tPERCENT = 37,\n\t\tAMPERSAND = 38,\n\t\tPLUS = 43,\n\t\tDASH = 45,\n\t\tDOT = 46,\n\t\tNUM_0 = 48,\n\t\tNUM_1 = 49,\n\t\tNUM_2 = 50,\n\t\tNUM_3 = 51,\n\t\tNUM_4 = 52,\n\t\tNUM_5 = 53,\n\t\tNUM_6 = 54,\n\t\tNUM_7 = 55,\n\t\tNUM_8 = 56,\n\t\tNUM_9 = 57,\n\t\tEQUALS = 61,\n\t\tA =  65,\n\t\tB =  66,\n\t\tC =  67,\n\t\tD =  68,\n\t\tE =  69,\n\t\tF =  70,\n\t\tG =  71,\n\t\tH =  72,\n\t\tI =  73,\n\t\tJ =  74,\n\t\tK =  75,\n\t\tL =  76,\n\t\tM =  77,\n\t\tN =  78,\n\t\tO =  79,\n\t\tP =  80,\n\t\tQ =  81,\n\t\tR =  82,\n\t\tS =  83,\n\t\tT =  84,\n\t\tU =  85,\n\t\tV =  86,\n\t\tW =  87,\n\t\tX =  88,\n\t\tY =  89,\n\t\tZ =  90,\n\t\tUNDERSCORE = 95,\n\t\ta =  97,\n\t\tb =  98,\n\t\tc =  99,\n\t\td = 100,\n\t\te = 101,\n\t\tf = 102,\n\t\tg = 103,\n\t\th = 104,\n\t\ti = 105,\n\t\tj = 106,\n\t\tk = 107,\n\t\tl = 108,\n\t\tm = 109,\n\t\tn = 110,\n\t\to = 111,\n\t\tp = 112,\n\t\tq = 113,\n\t\tr = 114,\n\t\ts = 115,\n\t\tt = 116,\n\t\tu = 117,\n\t\tv = 118,\n\t\tw = 119,\n\t\tx = 120,\n\t\ty = 121,\n\t\tz = 122,\n\t\tLEFT_CURLY_BRACE = 123,\n\t\tVERTICAL_LINE = 124,\n\t\tRIGHT_CURLY_BRACE = 125,\n\t}\n\t\n\tconst enum SongTagCode {\n\t\tfmChorus = CharCode.HASH, // [MB]\n\t\tmuff = CharCode.DOLLAR_SIGN, // [MB]\n\t\tbeatCount = CharCode.a,\n\t\tbars = CharCode.b,\n\t\teffect = CharCode.c,\n\t\ttransition = CharCode.d,\n\t\tloopEnd = CharCode.e,\n\t\tfilter = CharCode.f,\n\t\tbarCount = CharCode.g,\n\t\tchorus = CharCode.h,\n\t\tinstrumentCount = CharCode.i,\n\t\tpatternCount = CharCode.j,\n\t\tkey = CharCode.k,\n\t\tloopStart = CharCode.l,\n\t\treverb = CharCode.m,\n\t\tchannelCount = CharCode.n,\n\t\tchannelOctave = CharCode.o,\n\t\tpatterns = CharCode.p,\n\t\tharm = CharCode.q, // [MB]\n\t\trhythm = CharCode.r,\n\t\tscale = CharCode.s,\n\t\ttempo = CharCode.t,\n\t\tmix = CharCode.u, // [MB]\n\t\tvolume = CharCode.v,\n\t\twave = CharCode.w,\n\t\tblend = CharCode.x, // [MB]\n\t\triff = CharCode.y, // [MB]\n\t\ttheme = CharCode.z, // [MB]\n\t\tfeedbackAmplitude = CharCode.UNDERSCORE, // [MB] changed\n\t\talgorithm = CharCode.A,\n\t\toctoff = CharCode.B, // [MB]\n\t\toperatorEnvelopes = CharCode.E,\n\t\tfeedbackType = CharCode.F,\n\t\timute = CharCode.G, // [MB]\n\t\tdetune = CharCode.H, // [MB]\n\t\tipan = CharCode.L, // [MB]\n\t\toperatorAmplitudes = CharCode.P,\n\t\toperatorFrequencies = CharCode.Q,\n\t\tstartInstrument = CharCode.T,\n\t\tfeedbackEnvelope = CharCode.V,\n\t\tsampleRate = CharCode.VERTICAL_LINE, // [MB]\n\t}\n\t\n\tclass BitFieldReader {\n\t\tprivate _bits: number[] = [];\n\t\tprivate _readIndex: number = 0;\n\t\t\n\t\tconstructor(base64CharCodeToInt: ReadonlyArray<number>, source: string, startIndex: number, stopIndex: number) {\n\t\t\tfor (let i: number = startIndex; i < stopIndex; i++) {\n\t\t\t\tconst value: number = base64CharCodeToInt[source.charCodeAt(i)];\n\t\t\t\tthis._bits.push((value >> 5) & 0x1);\n\t\t\t\tthis._bits.push((value >> 4) & 0x1);\n\t\t\t\tthis._bits.push((value >> 3) & 0x1);\n\t\t\t\tthis._bits.push((value >> 2) & 0x1);\n\t\t\t\tthis._bits.push((value >> 1) & 0x1);\n\t\t\t\tthis._bits.push( value       & 0x1);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic read(bitCount: number): number {\n\t\t\tlet result: number = 0;\n\t\t\twhile (bitCount > 0) {\n\t\t\t\tresult = result << 1;\n\t\t\t\tresult += this._bits[this._readIndex++];\n\t\t\t\tbitCount--;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\t\n\t\tpublic readLongTail(minValue: number, minBits: number): number {\n\t\t\tlet result: number = minValue;\n\t\t\tlet numBits: number = minBits;\n\t\t\twhile (this._bits[this._readIndex++]) {\n\t\t\t\tresult += 1 << numBits;\n\t\t\t\tnumBits++;\n\t\t\t}\n\t\t\twhile (numBits > 0) {\n\t\t\t\tnumBits--;\n\t\t\t\tif (this._bits[this._readIndex++]) {\n\t\t\t\t\tresult += 1 << numBits;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\t\n\t\tpublic readPartDuration(): number {\n\t\t\treturn this.readLongTail(1, 2);\n\t\t}\n\t\t\n\t\tpublic readPinCount(): number {\n\t\t\treturn this.readLongTail(1, 0);\n\t\t}\n\t\t\n\t\tpublic readPitchInterval(): number {\n\t\t\tif (this.read(1)) {\n\t\t\t\treturn -this.readLongTail(1, 3);\n\t\t\t} else {\n\t\t\t\treturn this.readLongTail(1, 3);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tclass BitFieldWriter {\n\t\tprivate _bits: number[] = [];\n\t\t\n\t\tpublic write(bitCount: number, value: number): void {\n\t\t\tbitCount--;\n\t\t\twhile (bitCount >= 0) {\n\t\t\t\tthis._bits.push((value >>> bitCount) & 1);\n\t\t\t\tbitCount--;\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic writeLongTail(minValue: number, minBits: number, value: number): void {\n\t\t\tif (value < minValue) throw new Error(\"value out of bounds\");\n\t\t\tvalue -= minValue;\n\t\t\tlet numBits: number = minBits;\n\t\t\twhile (value >= (1 << numBits)) {\n\t\t\t\tthis._bits.push(1);\n\t\t\t\tvalue -= 1 << numBits;\n\t\t\t\tnumBits++;\n\t\t\t}\n\t\t\tthis._bits.push(0);\n\t\t\twhile (numBits > 0) {\n\t\t\t\tnumBits--;\n\t\t\t\tthis._bits.push((value >>> numBits) & 1);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic writePartDuration(value: number): void {\n\t\t\tthis.writeLongTail(1, 2, value);\n\t\t}\n\t\t\n\t\tpublic writePinCount(value: number): void {\n\t\t\tthis.writeLongTail(1, 0, value);\n\t\t}\n\t\t\n\t\tpublic writePitchInterval(value: number): void {\n\t\t\tif (value < 0) {\n\t\t\t\tthis.write(1, 1); // sign\n\t\t\t\tthis.writeLongTail(1, 3, -value);\n\t\t\t} else {\n\t\t\t\tthis.write(1, 0); // sign\n\t\t\t\tthis.writeLongTail(1, 3, value);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic concat(other: BitFieldWriter): void {\n\t\t\tthis._bits = this._bits.concat(other._bits);\n\t\t}\n\t\t\n\t\tpublic encodeBase64(base64IntToCharCode: ReadonlyArray<number>, buffer: number[]): number[] {\n\t\t\tfor (let i: number = 0; i < this._bits.length; i += 6) {\n\t\t\t\tconst value: number = (this._bits[i] << 5) | (this._bits[i+1] << 4) | (this._bits[i+2] << 3) | (this._bits[i+3] << 2) | (this._bits[i+4] << 1) | this._bits[i+5];\n\t\t\t\tbuffer.push(base64IntToCharCode[value]);\n\t\t\t}\n\t\t\treturn buffer;\n\t\t}\n\t\t\n\t\tpublic lengthBase64(): number {\n\t\t\treturn Math.ceil(this._bits.length / 6);\n\t\t}\n\t}\n\t\n\texport interface NotePin {\n\t\tinterval: number;\n\t\ttime: number;\n\t\tvolume: number;\n\t}\n\t\n\texport function makeNotePin(interval: number, time: number, volume: number): NotePin {\n\t\treturn {interval: interval, time: time, volume: volume};\n\t}\n\t\n\texport interface Note {\n\t\tpitches: number[];\n\t\tpins: NotePin[];\n\t\tstart: number;\n\t\tend: number;\n\t}\n\t\n\texport function makeNote(pitch: number, start: number, end: number, volume: number, fadeout: boolean = false) {\n\t\treturn {\n\t\t\tpitches: [pitch],\n\t\t\tpins: [makeNotePin(0, 0, volume), makeNotePin(0, end - start, fadeout ? 0 : volume)],\n\t\t\tstart: start,\n\t\t\tend: end,\n\t\t};\n\t}\n\t\n\texport class Pattern {\n\t\tpublic notes: Note[] = [];\n\t\tpublic instrument: number = 0;\n\t\t\n\t\tpublic cloneNotes(): Note[] {\n\t\t\tconst result: Note[] = [];\n\t\t\tfor (const oldNote of this.notes) {\n\t\t\t\tconst newNote: Note = makeNote(-1, oldNote.start, oldNote.end, 3);\n\t\t\t\tnewNote.pitches = oldNote.pitches.concat();\n\t\t\t\tnewNote.pins = [];\n\t\t\t\tfor (const oldPin of oldNote.pins) {\n\t\t\t\t\tnewNote.pins.push(makeNotePin(oldPin.interval, oldPin.time, oldPin.volume));\n\t\t\t\t}\n\t\t\t\tresult.push(newNote);\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\t\n\t\tpublic reset(): void {\n\t\t\tthis.notes.length = 0;\n\t\t\tthis.instrument = 0;\n\t\t}\n\t}\n\t\n\texport class Operator {\n\t\tpublic frequency: number = 0;\n\t\tpublic amplitude: number = 0;\n\t\tpublic envelope: number = 0;\n\t\t\n\t\tconstructor(index: number) {\n\t\t\tthis.reset(index);\n\t\t}\n\t\t\n\t\tpublic reset(index: number): void {\n\t\t\tthis.frequency = 0;\n\t\t\tthis.amplitude = (index <= 1) ? Config.operatorAmplitudeMax : 0;\n\t\t\tthis.envelope = 1;\n\t\t}\n\t\t\n\t\tpublic copy(other: Operator): void {\n\t\t\tthis.frequency = other.frequency;\n\t\t\tthis.amplitude = other.amplitude;\n\t\t\tthis.envelope = other.envelope;\n\t\t}\n\t}\n\t\n\texport class Instrument {\n\t\tpublic type: InstrumentType = 0;\n\t\tpublic wave: number = 1;\n\t\tpublic filter: number = 1;\n\t\tpublic transition: number = 1;\n\t\tpublic effect: number = 0;\n\t\tpublic harm: number = 0;\n\t\tpublic fmChorus: number = 1;\n\t\tpublic imute: number = 0;\n\t\tpublic octoff: number = 0;\n\t\tpublic chorus: number = 0;\n\t\tpublic volume: number = 0;\n\t\tpublic ipan: number = 4;\n\t\tpublic algorithm: number = 0;\n\t\tpublic feedbackType: number = 0;\n\t\tpublic feedbackAmplitude: number = 0;\n\t\tpublic feedbackEnvelope: number = 1;\n\t\tpublic readonly operators: Operator[] = [];\n\t\t\n\t\tconstructor() {\n\t\t\tfor (let i = 0; i < Config.operatorCount; i++) {\n\t\t\t\tthis.operators.push(new Operator(i));\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic reset(): void {\n\t\t\tthis.type = 0;\n\t\t\tthis.wave = 1;\n\t\t\tthis.filter = 1;\n\t\t\tthis.transition = 1;\n\t\t\tthis.effect = 0;\n\t\t\tthis.harm = 0;\n\t\t\tthis.fmChorus = 1;\n\t\t\tthis.imute = 0;\n\t\t\tthis.ipan = 4;\n\t\t\tthis.octoff = 0;\n\t\t\tthis.chorus = 0;\n\t\t\tthis.volume = 0;\n\t\t\tthis.algorithm = 0;\n\t\t\tthis.feedbackType = 0;\n\t\t\tthis.feedbackAmplitude = 0;\n\t\t\tthis.feedbackEnvelope = 1;\n\t\t\tfor (let i: number = 0; i < this.operators.length; i++) {\n\t\t\t\tthis.operators[i].reset(i);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic setTypeAndReset(type: InstrumentType): void {\n\t\t\tthis.type = type;\n\t\t\tswitch (type) {\n\t\t\t\tcase InstrumentType.chip:\n\t\t\t\t\tthis.wave = 1;\n\t\t\t\t\tthis.filter = 1;\n\t\t\t\t\tthis.transition = 1;\n\t\t\t\t\tthis.effect = 0;\n\t\t\t\t\tthis.harm = 0;\n\t\t\t\t\tthis.imute = 0;\n\t\t\t\t\tthis.ipan = 4;\n\t\t\t\t\tthis.octoff = 0;\n\t\t\t\t\tthis.chorus = 0;\n\t\t\t\t\tthis.volume = 0;\n\t\t\t\t\tbreak;\n\t\t\t\t// @TODO: Investigate whether this being incorrect leads to\n\t\t\t\t// any observable issues.\n\t\t\t\tcase InstrumentType.fm:\n\t\t\t\t\tthis.wave = 1;\n\t\t\t\t\tthis.transition = 1;\n\t\t\t\t\tthis.volume = 0;\n\t\t\t\t\tthis.imute = 0;\n\t\t\t\t\tthis.ipan = 4;\n\t\t\t\t\tthis.harm = 0;\n\t\t\t\t\tthis.octoff = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase InstrumentType.noise:\n\t\t\t\t\tthis.transition = 1;\n\t\t\t\t\tthis.octoff = 0;\n\t\t\t\t\tthis.fmChorus = 1;\n\t\t\t\t\tthis.ipan = 4;\n\t\t\t\t\tthis.effect = 0;\n\t\t\t\t\tthis.algorithm = 0;\n\t\t\t\t\tthis.feedbackType = 0;\n\t\t\t\t\tthis.feedbackAmplitude = 0;\n\t\t\t\t\tthis.feedbackEnvelope = 1;\n\t\t\t\t\tthis.volume = 0;\n\t\t\t\t\tfor (let i: number = 0; i < this.operators.length; i++) {\n\t\t\t\t\t\tthis.operators[i].reset(i);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase InstrumentType.pwm:\n\t\t\t\t\tthis.wave = 1;\n\t\t\t\t\tthis.filter = 1;\n\t\t\t\t\tthis.transition = 1;\n\t\t\t\t\tthis.effect = 0;\n\t\t\t\t\tthis.harm = 0;\n\t\t\t\t\tthis.imute = 0;\n\t\t\t\t\tthis.ipan = 4;\n\t\t\t\t\tthis.octoff = 0;\n\t\t\t\t\tthis.chorus = 0;\n\t\t\t\t\tthis.volume = 0;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic copy(other: Instrument): void {\n\t\t\tthis.type = other.type;\n\t\t\tthis.wave = other.wave;\n\t\t\tthis.filter = other.filter;\n\t\t\tthis.transition = other.transition;\n\t\t\tthis.effect = other.effect;\n\t\t\tthis.chorus = other.chorus;\n\t\t\tthis.volume = other.volume;\n\t\t\tthis.harm = other.harm;\n\t\t\tthis.fmChorus = other.fmChorus;\n\t\t\tthis.imute = other.imute;\n\t\t\tthis.ipan = other.ipan;\n\t\t\tthis.octoff = other.octoff;\n\t\t\tthis.algorithm = other.algorithm;\n\t\t\tthis.feedbackType = other.feedbackType;\n\t\t\tthis.feedbackAmplitude = other.feedbackAmplitude;\n\t\t\tthis.feedbackEnvelope = other.feedbackEnvelope;\n\t\t\tfor (let i: number = 0; i < this.operators.length; i++) {\n\t\t\t\tthis.operators[i].copy(other.operators[i]);\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class Channel {\n\t\tpublic octave: number = 0;\n\t\tpublic readonly instruments: Instrument[] = [];\n\t\tpublic readonly patterns: Pattern[] = [];\n\t\tpublic readonly bars: number[] = [];\n\t}\n\t\n\texport class Song {\n\t\tprivate static readonly _format: string = \"BeepBox\";\n\t\tprivate static readonly _oldestVersion: number = 2;\n\t\tprivate static readonly _latestVersion: number = 6;\n\t\tprivate static readonly _base64CharCodeToInt: ReadonlyArray<number> = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,62,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,0,0,0,0,63,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,0,0,0,0,0]; // 62 could be represented by either \"-\" or \".\" for historical reasons. New songs should use \"-\".\n\t\tprivate static readonly _base64IntToCharCode: ReadonlyArray<number> = [48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,45,95];\n\t\t\n\t\tpublic scale: number;\n\t\tpublic theme: number;\n\t\tpublic key: number;\n\t\tpublic mix: number;\n\t\tpublic sampleRate: number;\n\t\tpublic tempo: number;\n\t\tpublic reverb: number;\n\t\tpublic blend: number;\n\t\tpublic riff: number;\n\t\tpublic detune: number;\n\t\tpublic muff: number;\n\t\tpublic beatsPerBar: number;\n\t\tpublic barCount: number;\n\t\tpublic patternsPerChannel: number;\n\t\tpublic partsPerBeat: number;\n\t\tpublic instrumentsPerChannel: number;\n\t\tpublic loopStart: number;\n\t\tpublic loopLength: number;\n\t\tpublic pitchChannelCount: number;\n\t\tpublic drumChannelCount: number;\n\t\tpublic readonly channels: Channel[] = [];\n\t\t\n\t\tconstructor(string?: string) {\n\t\t\tif (string != undefined) {\n\t\t\t\tthis.fromBase64String(string);\n\t\t\t} else {\n\t\t\t\tthis.initToDefault(true);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic getChannelCount(): number {\n\t\t\treturn this.pitchChannelCount + this.drumChannelCount;\n\t\t}\n\n\t\tpublic getChannelUnusedCount(): number {\n\t\t\treturn (Config.pitchChannelCountMax + Config.drumChannelCountMax) - (this.pitchChannelCount + this.drumChannelCount);\n\t\t}\n\n\t\tpublic getThemeName(): string {\n\t\t\treturn Config.themeNames[this.theme];\n\t\t}\n\n\t\tpublic getTimeSig(): string {\n\t\t\treturn this.beatsPerBar + \"/\" + this.partsPerBeat + \" with \" + this.barCount + \" bars.\";\n\t\t}\n\n\t\tpublic getScaleNKey(): string {\n\t\t\treturn ' \"' + Config.scaleNames[this.scale] + '\" and your key is ' + Config.keyNames[this.key];\n\t\t}\n\t\t\n\t\tpublic getChannelIsDrum(channel: number): boolean {\n\t\t\treturn (channel >= this.pitchChannelCount);\n\t\t}\n\t\t\n\t\tpublic getChannelColorDim(channel: number): string {\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchChannelColorsDim[channel] : Config.drumChannelColorsDim[channel - this.pitchChannelCount];\n\t\t}\n\t\tpublic getChannelColorBright(channel: number): string {\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchChannelColorsBright[channel] : Config.drumChannelColorsBright[channel - this.pitchChannelCount];\n\t\t}\n\t\tpublic getNoteColorDim(channel: number): string {\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchNoteColorsDim[channel] : Config.drumNoteColorsDim[channel - this.pitchChannelCount];\n\t\t}\n\t\tpublic getNoteColorBright(channel: number): string {\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchNoteColorsBright[channel] : Config.drumNoteColorsBright[channel - this.pitchChannelCount];\n\t\t}\n\t\t\n\t\tpublic initToDefault(andResetChannels: boolean = true): void {\n\t\t\tthis.scale = 0;\n\t\t\tthis.theme = 0;\n\t\t\tthis.key = Config.keyNames.length - 1;\n\t\t\tthis.mix = 1;\n\t\t\tthis.sampleRate = 2;\n\t\t\tthis.loopStart = 0;\n\t\t\tthis.loopLength = 4;\n\t\t\tthis.tempo = 7;\n\t\t\tthis.reverb = 0;\n\t\t\tthis.blend = 0;\n\t\t\tthis.riff = 0;\n\t\t\tthis.detune = 0;\n\t\t\tthis.muff = 0;\n\t\t\tthis.beatsPerBar = 8;\n\t\t\tthis.barCount = 16;\n\t\t\tthis.patternsPerChannel = 8;\n\t\t\tthis.partsPerBeat = 4;\n\t\t\tthis.instrumentsPerChannel = 1;\n\t\t\t\n\t\t\tif (andResetChannels) {\n\t\t\t\tthis.pitchChannelCount = 4;\n\t\t\t\tthis.drumChannelCount = 1;\n\t\t\t\tfor (let channelIndex = 0; channelIndex < this.getChannelCount(); channelIndex++) {\n\t\t\t\t\tif (this.channels.length <= channelIndex) {\n\t\t\t\t\t\tthis.channels[channelIndex] = new Channel();\n\t\t\t\t\t}\n\t\t\t\t\tconst channel: Channel = this.channels[channelIndex];\n\t\t\t\t\tchannel.octave = 4 - channelIndex; // [4, 3, 2, 1, 0]; Descending octaves with drums at zero in last channel.\n\t\t\t\t\n\t\t\t\t\tfor (let pattern = 0; pattern < this.patternsPerChannel; pattern++) {\n\t\t\t\t\t\tif (channel.patterns.length <= pattern) {\n\t\t\t\t\t\t\tchannel.patterns[pattern] = new Pattern();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tchannel.patterns[pattern].reset();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tchannel.patterns.length = this.patternsPerChannel;\n\t\t\t\t\n\t\t\t\t\tfor (let instrument = 0; instrument < this.instrumentsPerChannel; instrument++) {\n\t\t\t\t\t\tif (channel.instruments.length <= instrument) {\n\t\t\t\t\t\t\tchannel.instruments[instrument] = new Instrument();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tchannel.instruments[instrument].reset();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tchannel.instruments.length = this.instrumentsPerChannel;\n\t\t\t\t\n\t\t\t\t\tfor (let bar = 0; bar < this.barCount; bar++) {\n\t\t\t\t\t\tchannel.bars[bar] = bar < 4 ? 1 : 0;\n\t\t\t\t\t}\n\t\t\t\t\tchannel.bars.length = this.barCount;\n\t\t\t\t}\n\t\t\t\tthis.channels.length = this.getChannelCount();\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic toBase64String(): string {\n\t\t\tlet bits: BitFieldWriter;\n\t\t\tlet buffer: number[] = [];\n\t\t\t\n\t\t\tconst base64IntToCharCode: ReadonlyArray<number> = Song._base64IntToCharCode;\n\t\t\t\n\t\t\tbuffer.push(base64IntToCharCode[Song._latestVersion]);\n\t\t\tbuffer.push(SongTagCode.channelCount, base64IntToCharCode[this.pitchChannelCount], base64IntToCharCode[this.drumChannelCount]);\n\t\t\tbuffer.push(SongTagCode.theme, base64IntToCharCode[this.theme]);\n\t\t\tbuffer.push(SongTagCode.scale, base64IntToCharCode[this.scale]);\n\t\t\tbuffer.push(SongTagCode.mix, base64IntToCharCode[this.mix]);\n\t\t\tbuffer.push(SongTagCode.sampleRate, base64IntToCharCode[this.sampleRate]);\n\t\t\tbuffer.push(SongTagCode.key, base64IntToCharCode[this.key]);\n\t\t\tbuffer.push(SongTagCode.loopStart, base64IntToCharCode[this.loopStart >> 6], base64IntToCharCode[this.loopStart & 0x3f]);\n\t\t\tbuffer.push(SongTagCode.loopEnd, base64IntToCharCode[(this.loopLength - 1) >> 6], base64IntToCharCode[(this.loopLength - 1) & 0x3f]);\n\t\t\tbuffer.push(SongTagCode.tempo, base64IntToCharCode[this.tempo]);\n\t\t\tbuffer.push(SongTagCode.reverb, base64IntToCharCode[this.reverb]);\n\t\t\tbuffer.push(SongTagCode.blend, base64IntToCharCode[this.blend]);\n\t\t\tbuffer.push(SongTagCode.riff, base64IntToCharCode[this.riff]);\n\t\t\tbuffer.push(SongTagCode.detune, base64IntToCharCode[this.detune]);\n\t\t\tbuffer.push(SongTagCode.muff, base64IntToCharCode[this.muff]);\n\t\t\tbuffer.push(SongTagCode.beatCount, base64IntToCharCode[this.beatsPerBar - 1]);\n\t\t\tbuffer.push(SongTagCode.barCount, base64IntToCharCode[(this.barCount - 1) >> 6], base64IntToCharCode[(this.barCount - 1) & 0x3f]);\n\t\t\tbuffer.push(SongTagCode.patternCount, base64IntToCharCode[this.patternsPerChannel - 1]);\n\t\t\tbuffer.push(SongTagCode.instrumentCount, base64IntToCharCode[this.instrumentsPerChannel - 1]);\n\t\t\tbuffer.push(SongTagCode.rhythm, base64IntToCharCode[Config.partCounts.indexOf(this.partsPerBeat)]);\n\t\t\t\n\t\t\tbuffer.push(SongTagCode.channelOctave);\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\tbuffer.push(base64IntToCharCode[this.channels[channel].octave]);\n\t\t\t}\n\t\t\t\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[i];\n\t\t\t\t\t\n\t\t\t\t\tif (channel < this.pitchChannelCount) {\n\t\t\t\t\t\tbuffer.push(SongTagCode.startInstrument, base64IntToCharCode[instrument.type]);\n\t\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\n\t\t\t\t\t\t\t// chip\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.wave, base64IntToCharCode[instrument.wave]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.filter, base64IntToCharCode[instrument.filter]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.effect, base64IntToCharCode[instrument.effect]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.harm, base64IntToCharCode[instrument.harm]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.chorus,base64IntToCharCode[instrument.chorus]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\n\t\t\t\t\t\t\t// FM\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.effect, base64IntToCharCode[instrument.effect]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.fmChorus, base64IntToCharCode[instrument.fmChorus]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.algorithm, base64IntToCharCode[instrument.algorithm]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.feedbackType, base64IntToCharCode[instrument.feedbackType]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.feedbackAmplitude, base64IntToCharCode[instrument.feedbackAmplitude]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.feedbackEnvelope, base64IntToCharCode[instrument.feedbackEnvelope]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.operatorFrequencies);\n\t\t\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\n\t\t\t\t\t\t\t\tbuffer.push(base64IntToCharCode[instrument.operators[o].frequency]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.operatorAmplitudes);\n\t\t\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\n\t\t\t\t\t\t\t\tbuffer.push(base64IntToCharCode[instrument.operators[o].amplitude]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.operatorEnvelopes);\n\t\t\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\n\t\t\t\t\t\t\t\tbuffer.push(base64IntToCharCode[instrument.operators[o].envelope]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.wave, base64IntToCharCode[instrument.wave]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.filter, base64IntToCharCode[instrument.filter]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.effect, base64IntToCharCode[instrument.effect]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.harm, base64IntToCharCode[instrument.harm]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.chorus, base64IntToCharCode[instrument.chorus]);\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"Unknown instrument type.\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// NOISE\n\t\t\t\t\t\tbuffer.push(SongTagCode.startInstrument, base64IntToCharCode[InstrumentType.noise]);\n\t\t\t\t\t\tbuffer.push(SongTagCode.wave, base64IntToCharCode[instrument.wave]);\n\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\n\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\n\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\n\t\t\t\t\t\tbuffer.push(SongTagCode.harm, base64IntToCharCode[instrument.harm]);\n\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\n\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tbuffer.push(SongTagCode.bars);\n\t\t\tbits = new BitFieldWriter();\n\t\t\tlet neededBits: number = 0;\n\t\t\twhile ((1 << neededBits) < this.patternsPerChannel + 1) neededBits++;\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) for (let i: number = 0; i < this.barCount; i++) {\n\t\t\t\tbits.write(neededBits, this.channels[channel].bars[i]);\n\t\t\t}\n\t\t\tbits.encodeBase64(base64IntToCharCode, buffer);\n\t\t\t\n\t\t\tbuffer.push(SongTagCode.patterns);\n\t\t\tbits = new BitFieldWriter();\n\t\t\tlet neededInstrumentBits: number = 0;\n\t\t\twhile ((1 << neededInstrumentBits) < this.instrumentsPerChannel) neededInstrumentBits++;\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\tconst isDrum: boolean = this.getChannelIsDrum(channel);\n\t\t\t\tconst octaveOffset: number = isDrum ? 0 : this.channels[channel].octave * 12;\n\t\t\t\tlet lastPitch: number = (isDrum ? 4 : 12) + octaveOffset;\n\t\t\t\tconst recentPitches: number[] = isDrum ? [4,6,7,2,3,8,0,10] : [12, 19, 24, 31, 36, 7, 0];\n\t\t\t\tconst recentShapes: string[] = [];\n\t\t\t\tfor (let i: number = 0; i < recentPitches.length; i++) {\n\t\t\t\t\trecentPitches[i] += octaveOffset;\n\t\t\t\t}\n\t\t\t\tfor (const p of this.channels[channel].patterns) {\n\t\t\t\t\tbits.write(neededInstrumentBits, p.instrument);\n\t\t\t\t\t\n\t\t\t\t\tif (p.notes.length > 0) {\n\t\t\t\t\t\tbits.write(1, 1);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet curPart: number = 0;\n\t\t\t\t\t\tfor (const t of p.notes) {\n\t\t\t\t\t\t\tif (t.start > curPart) {\n\t\t\t\t\t\t\t\tbits.write(2, 0); // rest\n\t\t\t\t\t\t\t\tbits.writePartDuration(t.start - curPart);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconst shapeBits: BitFieldWriter = new BitFieldWriter();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 0: 1 pitch, 10: 2 pitches, 110: 3 pitches, 111: 4 pitches\n\t\t\t\t\t\t\tfor (let i: number = 1; i < t.pitches.length; i++) shapeBits.write(1,1);\n\t\t\t\t\t\t\tif (t.pitches.length < 4) shapeBits.write(1,0);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tshapeBits.writePinCount(t.pins.length - 1);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tshapeBits.write(2, t.pins[0].volume); // volume\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlet shapePart: number = 0;\n\t\t\t\t\t\t\tlet startPitch: number = t.pitches[0];\n\t\t\t\t\t\t\tlet currentPitch: number = startPitch;\n\t\t\t\t\t\t\tconst pitchBends: number[] = [];\n\t\t\t\t\t\t\tfor (let i: number = 1; i < t.pins.length; i++) {\n\t\t\t\t\t\t\t\tconst pin: NotePin = t.pins[i];\n\t\t\t\t\t\t\t\tconst nextPitch: number = startPitch + pin.interval;\n\t\t\t\t\t\t\t\tif (currentPitch != nextPitch) {\n\t\t\t\t\t\t\t\t\tshapeBits.write(1, 1);\n\t\t\t\t\t\t\t\t\tpitchBends.push(nextPitch);\n\t\t\t\t\t\t\t\t\tcurrentPitch = nextPitch;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tshapeBits.write(1, 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tshapeBits.writePartDuration(pin.time - shapePart);\n\t\t\t\t\t\t\t\tshapePart = pin.time;\n\t\t\t\t\t\t\t\tshapeBits.write(2, pin.volume);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconst shapeString: string = String.fromCharCode.apply(null, shapeBits.encodeBase64(base64IntToCharCode, []));\n\t\t\t\t\t\t\tconst shapeIndex: number = recentShapes.indexOf(shapeString);\n\t\t\t\t\t\t\tif (shapeIndex == -1) {\n\t\t\t\t\t\t\t\tbits.write(2, 1); // new shape\n\t\t\t\t\t\t\t\tbits.concat(shapeBits);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tbits.write(1, 1); // old shape\n\t\t\t\t\t\t\t\tbits.writeLongTail(0, 0, shapeIndex);\n\t\t\t\t\t\t\t\trecentShapes.splice(shapeIndex, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trecentShapes.unshift(shapeString);\n\t\t\t\t\t\t\tif (recentShapes.length > 10) recentShapes.pop();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconst allPitches: number[] = t.pitches.concat(pitchBends);\n\t\t\t\t\t\t\tfor (let i: number = 0; i < allPitches.length; i++) {\n\t\t\t\t\t\t\t\tconst pitch: number = allPitches[i];\n\t\t\t\t\t\t\t\tconst pitchIndex: number = recentPitches.indexOf(pitch);\n\t\t\t\t\t\t\t\tif (pitchIndex == -1) {\n\t\t\t\t\t\t\t\t\tlet interval: number = 0;\n\t\t\t\t\t\t\t\t\tlet pitchIter: number = lastPitch;\n\t\t\t\t\t\t\t\t\tif (pitchIter < pitch) {\n\t\t\t\t\t\t\t\t\t\twhile (pitchIter != pitch) {\n\t\t\t\t\t\t\t\t\t\t\tpitchIter++;\n\t\t\t\t\t\t\t\t\t\t\tif (recentPitches.indexOf(pitchIter) == -1) interval++;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\twhile (pitchIter != pitch) {\n\t\t\t\t\t\t\t\t\t\t\tpitchIter--;\n\t\t\t\t\t\t\t\t\t\t\tif (recentPitches.indexOf(pitchIter) == -1) interval--;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbits.write(1, 0);\n\t\t\t\t\t\t\t\t\tbits.writePitchInterval(interval);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tbits.write(1, 1);\n\t\t\t\t\t\t\t\t\tbits.write(3, pitchIndex);\n\t\t\t\t\t\t\t\t\trecentPitches.splice(pitchIndex, 1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\trecentPitches.unshift(pitch);\n\t\t\t\t\t\t\t\tif (recentPitches.length > 8) recentPitches.pop();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (i == t.pitches.length - 1) {\n\t\t\t\t\t\t\t\t\tlastPitch = t.pitches[0];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlastPitch = pitch;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcurPart = t.end;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (curPart < this.beatsPerBar * this.partsPerBeat) {\n\t\t\t\t\t\t\tbits.write(2, 0); // rest\n\t\t\t\t\t\t\tbits.writePartDuration(this.beatsPerBar * this.partsPerBeat - curPart);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbits.write(1, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet stringLength: number = bits.lengthBase64();\n\t\t\tlet digits: number[] = [];\n\t\t\twhile (stringLength > 0) {\n\t\t\t\tdigits.unshift(base64IntToCharCode[stringLength & 0x3f]);\n\t\t\t\tstringLength = stringLength >> 6;\n\t\t\t}\n\t\t\tbuffer.push(base64IntToCharCode[digits.length]);\n\t\t\tArray.prototype.push.apply(buffer, digits); // append digits to buffer.\n\t\t\tbits.encodeBase64(base64IntToCharCode, buffer);\n\t\t\t\n\t\t\t// HACK: This breaks for strings longer than 65535. \n\t\t\tif (buffer.length >= 65535) throw new Error(\"Song hash code too long.\");\n\t\t\treturn String.fromCharCode.apply(null, buffer);\n\t\t}\n\t\t\n\t\tpublic fromBase64String(compressed: string): void {\n\t\t\tif (compressed == null || compressed == \"\") {\n\t\t\t\tthis.initToDefault(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet charIndex: number = 0;\n\t\t\t// skip whitespace.\n\t\t\twhile (compressed.charCodeAt(charIndex) <= CharCode.SPACE) charIndex++;\n\t\t\t// skip hash mark.\n\t\t\tif (compressed.charCodeAt(charIndex) == CharCode.HASH) charIndex++;\n\t\t\t// if it starts with curly brace, treat it as JSON.\n\t\t\tif (compressed.charCodeAt(charIndex) == CharCode.LEFT_CURLY_BRACE) {\n\t\t\t\tthis.fromJsonObject(JSON.parse(charIndex == 0 ? compressed : compressed.substring(charIndex)));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tconst version: number = Song._base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\tif (version == -1 || version > Song._latestVersion || version < Song._oldestVersion) return;\n\t\t\tconst beforeThree: boolean = version < 3;\n\t\t\tconst beforeFour:  boolean = version < 4;\n\t\t\tconst beforeFive:  boolean = version < 5;\n\t\t\tconst beforeSix:   boolean = version < 6;\n\t\t\tconst base64CharCodeToInt: ReadonlyArray<number> = Song._base64CharCodeToInt;\n\t\t\tthis.initToDefault(beforeSix);\n\t\t\t\n\t\t\tif (beforeThree) {\n\t\t\t\t// Originally, the only instrument transition was \"seamless\" and the only drum wave was \"retro\".\n\t\t\t\tfor (const channel of this.channels) channel.instruments[0].transition = 0;\n\t\t\t\tthis.channels[3].instruments[0].wave = 0;\n\t\t\t}\n\t\t\t\n\t\t\tlet instrumentChannelIterator: number = 0;\n\t\t\tlet instrumentIndexIterator: number = -1;\n\t\t\t\n\t\t\twhile (charIndex < compressed.length) {\n\t\t\t\tconst command: number = compressed.charCodeAt(charIndex++);\n\t\t\t\tlet channel: number;\n\t\t\t\tif (command == SongTagCode.channelCount) {\n\t\t\t\t\tthis.pitchChannelCount = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\tthis.drumChannelCount  = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\tthis.pitchChannelCount = Song._clip(Config.pitchChannelCountMin, Config.pitchChannelCountMax + 1, this.pitchChannelCount);\n\t\t\t\t\tthis.drumChannelCount = Song._clip(Config.drumChannelCountMin, Config.drumChannelCountMax + 1, this.drumChannelCount);\n\t\t\t\t\tfor (let channelIndex = this.channels.length; channelIndex < this.getChannelCount(); channelIndex++) {\n\t\t\t\t\t\tthis.channels[channelIndex] = new Channel();\n\t\t\t\t\t}\n\t\t\t\t\tthis.channels.length = this.getChannelCount();\n\t\t\t\t} else if (command == SongTagCode.scale) {\n\t\t\t\t\tthis.scale = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\tif (beforeThree && this.scale == 10) this.scale = 11;\n\t\t\t\t} else if (command == SongTagCode.mix) {\n\t\t\t\t\tthis.mix = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t} else if (command == SongTagCode.key) {\n\t\t\t\t\tthis.key = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t} else if (command == SongTagCode.theme) {\n\t\t\t\t\tthis.theme = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t} else if (command == SongTagCode.loopStart) {\n\t\t\t\t\tif (beforeFive) {\n\t\t\t\t\t\tthis.loopStart = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.loopStart = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.loopEnd) {\n\t\t\t\t\tif (beforeFive) {\n\t\t\t\t\t\tthis.loopLength = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.loopLength = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.tempo) {\n\t\t\t\t\tif (beforeFour) {\n\t\t\t\t\t\tthis.tempo = [1, 4, 7, 10][base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.tempo = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t}\n\t\t\t\t\tthis.tempo = Song._clip(0, Config.tempoSteps, this.tempo);\n\t\t\t\t} else if (command == SongTagCode.reverb) {\n\t\t\t\t\tthis.reverb = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\tthis.reverb = Song._clip(0, Config.reverbRange, this.reverb);\n\t\t\t\t} else if (command == SongTagCode.blend) {\n\t\t\t\t\tthis.blend = Song._clip(0, Config.blendRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.riff) {\n\t\t\t\t\tthis.riff = Song._clip(0, Config.riffRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.sampleRate) {\n\t\t\t\t\tthis.sampleRate = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t} else if (command == SongTagCode.detune) {\n\t\t\t\t\tthis.detune = Song._clip(0, Config.detuneRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.muff) {\n\t\t\t\t\tthis.muff = Song._clip(0, Config.muffRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.beatCount) {\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tthis.beatsPerBar = [6, 7, 8, 9, 10][base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.beatsPerBar = base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\n\t\t\t\t\t}\n\t\t\t\t\tthis.beatsPerBar = Math.max(Config.beatsPerBarMin, Math.min(Config.beatsPerBarMax, this.beatsPerBar));\n\t\t\t\t} else if (command == SongTagCode.barCount) {\n\t\t\t\t\tthis.barCount = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\n\t\t\t\t\tthis.barCount = Math.max(Config.barCountMin, Math.min(Config.barCountMax, this.barCount));\n\t\t\t\t\tfor (let channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\tfor (let bar = this.channels[channel].bars.length; bar < this.barCount; bar++) {\n\t\t\t\t\t\t\tthis.channels[channel].bars[bar] = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.channels[channel].bars.length = this.barCount;\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.patternCount) {\n\t\t\t\t\tthis.patternsPerChannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\n\t\t\t\t\tthis.patternsPerChannel = Math.max(1, Math.min(Config.barCountMax, this.patternsPerChannel));\n\t\t\t\t\tfor (let channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\tfor (let pattern = this.channels[channel].patterns.length; pattern < this.patternsPerChannel; pattern++) {\n\t\t\t\t\t\t\tthis.channels[channel].patterns[pattern] = new Pattern();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.channels[channel].patterns.length = this.patternsPerChannel;\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.instrumentCount) {\n\t\t\t\t\tthis.instrumentsPerChannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\n\t\t\t\t\tthis.instrumentsPerChannel = Math.max(Config.instrumentsPerChannelMin, Math.min(Config.instrumentsPerChannelMax, this.instrumentsPerChannel));\n\t\t\t\t\tfor (let channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\tfor (let instrument = this.channels[channel].instruments.length; instrument < this.instrumentsPerChannel; instrument++) {\n\t\t\t\t\t\t\tthis.channels[channel].instruments[instrument] = new Instrument();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.channels[channel].instruments.length = this.instrumentsPerChannel;\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.rhythm) {\n\t\t\t\t\tthis.partsPerBeat = Config.partCounts[base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\n\t\t\t\t} else if (command == SongTagCode.channelOctave) {\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tthis.channels[channel].octave = Song._clip(0, 5, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tthis.channels[channel].octave = Song._clip(0, 5, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.startInstrument) {\n\t\t\t\t\tinstrumentIndexIterator++;\n\t\t\t\t\tif (instrumentIndexIterator >= this.instrumentsPerChannel) {\n\t\t\t\t\t\tinstrumentChannelIterator++;\n\t\t\t\t\t\tinstrumentIndexIterator = 0;\n\t\t\t\t\t}\n\t\t\t\t\tconst isPitchChannel: boolean = instrumentChannelIterator < this.pitchChannelCount;\n\t\t\t\t\tconst instrument: Instrument = this.channels[instrumentChannelIterator].instruments[instrumentIndexIterator];\n\t\t\t\t\tconst rawInstrumentType: number = Song._clip(0, 4, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\tlet instrumentType: number = rawInstrumentType;\n\t\t\t\t\tif (instrumentType == InstrumentType.noise && isPitchChannel) {\n\t\t\t\t\t\tinstrumentType = InstrumentType.pwm;\n\t\t\t\t\t}\n\t\t\t\t\tinstrument.setTypeAndReset(instrumentType);\n\t\t\t\t} else if (command == SongTagCode.wave) {\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tthis.channels[channel].instruments[0].wave = Song._clip(0, Config.waveNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t} else if (beforeSix) {\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tconst isDrums = (channel >= this.pitchChannelCount);\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].wave = Song._clip(0, isDrums ? Config.drumNames.length : Config.waveNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst isDrums = (instrumentChannelIterator >= this.pitchChannelCount);\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].wave = Song._clip(0, isDrums ? Config.drumNames.length : Config.waveNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.filter) {\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tthis.channels[channel].instruments[0].filter = [1, 3, 4, 5][Song._clip(0, Config.filterNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)])];\n\t\t\t\t\t} else if (beforeSix) {\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].filter = Song._clip(0, Config.filterNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].filter = Song._clip(0, Config.filterNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.transition) {\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tthis.channels[channel].instruments[0].transition = Song._clip(0, Config.transitionNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t} else if (beforeSix) {\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].transition = Song._clip(0, Config.transitionNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].transition = Song._clip(0, Config.transitionNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.effect) {\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tlet effect: number = Song._clip(0, Config.effectNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t\tif (effect == 1) effect = 3;\n\t\t\t\t\t\telse if (effect == 3) effect = 5;\n\t\t\t\t\t\tthis.channels[channel].instruments[0].effect = effect;\n\t\t\t\t\t} else if (beforeSix) {\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].effect = Song._clip(0, Config.effectNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].effect = Song._clip(0, Config.effectNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.chorus) {\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tthis.channels[channel].instruments[0].chorus = Song._clip(0, Config.chorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t} else if (beforeSix) {\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].chorus = Song._clip(0, Config.chorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].chorus = Song._clip(0, Config.chorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.harm) {\n\t\t\t\t\t// Harmony was added in this commit: https://github.com/ModdedBeepbox/modded-beepbox-2.3/commit/cd1cc3d1891eda506e77e7619822ec2a48f375f2\n\t\t\t\t\t// _latestVersion was 5 in that commit, so the beforeThree\n\t\t\t\t\t// if in the reading code shouldn't ever run. Thus, it has\n\t\t\t\t\t// been omitted here.\n\t\t\t\t\tif (beforeSix) {\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].harm = Song._clip(0, Config.harmNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].harm = Song._clip(0, Config.harmNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.fmChorus) {\n\t\t\t\t\t// FM chorus was added in this commit: https://github.com/ModdedBeepbox/beta/commit/5c47acd9e5892709596d81df987a496f468b7115\n\t\t\t\t\t// Smaller diff: https://github.com/ModdedBeepbox/beta/compare/5427a7c491aae9fef15576bbc33a0d43ca18f758..5c47acd9e5892709596d81df987a496f468b7115\n\t\t\t\t\t// _latestVersion remained 6 before and after this, and the\n\t\t\t\t\t// tag code was never used for anything else previously, so\n\t\t\t\t\t// no backwards compatibility code is needed here.\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].fmChorus = Song._clip(0, Config.fmChorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.imute) {\n\t\t\t\t\t// Muting was added in this commit: https://github.com/ModdedBeepbox/3.0/commit/f177e34831ab85c58e0492ae47a5df80e709d9b4\n\t\t\t\t\t// _latestVersion remained 6 before and after this, and the\n\t\t\t\t\t// tag code was never used for anything else previously, so\n\t\t\t\t\t// no backwards compatibility code is needed here.\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].imute = Song._clip(0, Config.imuteNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.ipan) {\n\t\t\t\t\t// @TODO: Add SongTagCode.oldIpan = CharCode.M? Normally it\n\t\t\t\t\t// will be ignored if present on songs made before Oct 22, 2018\n\t\t\t\t\t// or so.\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].ipan = Song._clip(0, Config.ipanValues.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.octoff) {\n\t\t\t\t\t// Octave offset was first added in this commit: https://github.com/ModdedBeepbox/3.0/commit/54bdad302110cbde72b18f041091e53e3c35c189 (see BeepBox_files/5_channel.js)\n\t\t\t\t\t// It used CharCode.VERTICAL_LINE as the tag code value.\n\t\t\t\t\t// Later, it was changed to use CharCode.B in this commit: https://github.com/ModdedBeepbox/3.0/commit/84b9a7608c22addf01af2acebee6d5f6c65a5122\n\t\t\t\t\t// _latestVersion was 5, and the only major difference here\n\t\t\t\t\t// is that the octave offsets were pushed for every channel\n\t\t\t\t\t// one after another.\n\t\t\t\t\t// The beforeThree if was never needed.\n\t\t\t\t\tif (beforeSix) {\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].octoff = Song._clip(0, Config.octoffNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].octoff = Song._clip(0, Config.octoffNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.volume) {\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tthis.channels[channel].instruments[0].volume = Song._clip(0, Config.volumeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t} else if (beforeSix) {\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].volume = Song._clip(0, Config.volumeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].volume = Song._clip(0, Config.volumeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.algorithm) {\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].algorithm = Song._clip(0, Config.operatorAlgorithmNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.feedbackType) {\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].feedbackType = Song._clip(0, Config.operatorFeedbackNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.feedbackAmplitude) {\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].feedbackAmplitude = Song._clip(0, Config.operatorAmplitudeMax + 1, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.feedbackEnvelope) {\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].feedbackEnvelope = Song._clip(0, Config.operatorEnvelopeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t} else if (command == SongTagCode.operatorFrequencies) {\n\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].operators[o].frequency = Song._clip(0, Config.operatorFrequencyNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.operatorAmplitudes) {\n\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].operators[o].amplitude = Song._clip(0, Config.operatorAmplitudeMax + 1, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.operatorEnvelopes) {\n\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].operators[o].envelope = Song._clip(0, Config.operatorEnvelopeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\n\t\t\t\t\t}\n\t\t\t\t} else if (command == SongTagCode.bars) {\n\t\t\t\t\tlet subStringLength: number;\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tconst barCount: number = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tsubStringLength = Math.ceil(barCount * 0.5);\n\t\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + subStringLength);\n\t\t\t\t\t\tfor (let i: number = 0; i < barCount; i++) {\n\t\t\t\t\t\t\tthis.channels[channel].bars[i] = bits.read(3) + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (beforeFive) {\n\t\t\t\t\t\tlet neededBits: number = 0;\n\t\t\t\t\t\twhile ((1 << neededBits) < this.patternsPerChannel) neededBits++;\n\t\t\t\t\t\tsubStringLength = Math.ceil(this.getChannelCount() * this.barCount * neededBits / 6);\n\t\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + subStringLength);\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].bars[i] = bits.read(neededBits) + 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet neededBits: number = 0;\n\t\t\t\t\t\twhile ((1 << neededBits) < this.patternsPerChannel + 1) neededBits++;\n\t\t\t\t\t\tsubStringLength = Math.ceil(this.getChannelCount() * this.barCount * neededBits / 6);\n\t\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + subStringLength);\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\n\t\t\t\t\t\t\t\tthis.channels[channel].bars[i] = bits.read(neededBits);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcharIndex += subStringLength;\n\t\t\t\t} else if (command == SongTagCode.patterns) {\n\t\t\t\t\tlet bitStringLength: number = 0;\n\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\t\n\t\t\t\t\t\t// The old format used the next character to represent the number of patterns in the channel, which is usually eight, the default. \n\t\t\t\t\t\tcharIndex++; //let patternCount: number = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\t\n\t\t\t\t\t\tbitStringLength = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\tbitStringLength = bitStringLength << 6;\n\t\t\t\t\t\tbitStringLength += base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchannel = 0;\n\t\t\t\t\t\tlet bitStringLengthLength: number = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\twhile (bitStringLengthLength > 0) {\n\t\t\t\t\t\t\tbitStringLength = bitStringLength << 6;\n\t\t\t\t\t\t\tbitStringLength += base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\n\t\t\t\t\t\t\tbitStringLengthLength--;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + bitStringLength);\n\t\t\t\t\tcharIndex += bitStringLength;\n\t\t\t\t\t\n\t\t\t\t\tlet neededInstrumentBits: number = 0;\n\t\t\t\t\twhile ((1 << neededInstrumentBits) < this.instrumentsPerChannel) neededInstrumentBits++;\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tconst isDrum: boolean = this.getChannelIsDrum(channel);\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst octaveOffset: number = isDrum ? 0 : this.channels[channel].octave * 12;\n\t\t\t\t\t\tlet note: Note | null = null;\n\t\t\t\t\t\tlet pin: NotePin | null = null;\n\t\t\t\t\t\tlet lastPitch: number = (isDrum ? 4 : 12) + octaveOffset;\n\t\t\t\t\t\tconst recentPitches: number[] = isDrum ? [4,6,7,2,3,8,0,10] : [12, 19, 24, 31, 36, 7, 0];\n\t\t\t\t\t\tconst recentShapes: any[] = [];\n\t\t\t\t\t\tfor (let i: number = 0; i < recentPitches.length; i++) {\n\t\t\t\t\t\t\trecentPitches[i] += octaveOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (let i: number = 0; i < this.patternsPerChannel; i++) {\n\t\t\t\t\t\t\tconst newPattern: Pattern = this.channels[channel].patterns[i];\n\t\t\t\t\t\t\tnewPattern.reset();\n\t\t\t\t\t\t\tnewPattern.instrument = bits.read(neededInstrumentBits);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!beforeThree && bits.read(1) == 0) continue;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlet curPart: number = 0;\n\t\t\t\t\t\t\tconst newNotes: Note[] = newPattern.notes;\n\t\t\t\t\t\t\twhile (curPart < this.beatsPerBar * this.partsPerBeat) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tconst useOldShape: boolean = bits.read(1) == 1;\n\t\t\t\t\t\t\t\tlet newNote: boolean = false;\n\t\t\t\t\t\t\t\tlet shapeIndex: number = 0;\n\t\t\t\t\t\t\t\tif (useOldShape) {\n\t\t\t\t\t\t\t\t\tshapeIndex = bits.readLongTail(0, 0);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tnewNote = bits.read(1) == 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (!useOldShape && !newNote) {\n\t\t\t\t\t\t\t\t\tconst restLength: number = bits.readPartDuration();\n\t\t\t\t\t\t\t\t\tcurPart += restLength;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlet shape: any;\n\t\t\t\t\t\t\t\t\tlet pinObj: any;\n\t\t\t\t\t\t\t\t\tlet pitch: number;\n\t\t\t\t\t\t\t\t\tif (useOldShape) {\n\t\t\t\t\t\t\t\t\t\tshape = recentShapes[shapeIndex];\n\t\t\t\t\t\t\t\t\t\trecentShapes.splice(shapeIndex, 1);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tshape = {};\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tshape.pitchCount = 1;\n\t\t\t\t\t\t\t\t\t\twhile (shape.pitchCount < 4 && bits.read(1) == 1) shape.pitchCount++;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tshape.pinCount = bits.readPinCount();\n\t\t\t\t\t\t\t\t\t\tshape.initialVolume = bits.read(2);\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tshape.pins = [];\n\t\t\t\t\t\t\t\t\t\tshape.length = 0;\n\t\t\t\t\t\t\t\t\t\tshape.bendCount = 0;\n\t\t\t\t\t\t\t\t\t\tfor (let j: number = 0; j < shape.pinCount; j++) {\n\t\t\t\t\t\t\t\t\t\t\tpinObj = {};\n\t\t\t\t\t\t\t\t\t\t\tpinObj.pitchBend = bits.read(1) == 1;\n\t\t\t\t\t\t\t\t\t\t\tif (pinObj.pitchBend) shape.bendCount++;\n\t\t\t\t\t\t\t\t\t\t\tshape.length += bits.readPartDuration();\n\t\t\t\t\t\t\t\t\t\t\tpinObj.time = shape.length;\n\t\t\t\t\t\t\t\t\t\t\tpinObj.volume = bits.read(2);\n\t\t\t\t\t\t\t\t\t\t\tshape.pins.push(pinObj);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\trecentShapes.unshift(shape);\n\t\t\t\t\t\t\t\t\tif (recentShapes.length > 10) recentShapes.pop();\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tnote = makeNote(0,curPart,curPart + shape.length, shape.initialVolume);\n\t\t\t\t\t\t\t\t\tnote.pitches = [];\n\t\t\t\t\t\t\t\t\tnote.pins.length = 1;\n\t\t\t\t\t\t\t\t\tconst pitchBends: number[] = [];\n\t\t\t\t\t\t\t\t\tfor (let j: number = 0; j < shape.pitchCount + shape.bendCount; j++) {\n\t\t\t\t\t\t\t\t\t\tconst useOldPitch: boolean = bits.read(1) == 1;\n\t\t\t\t\t\t\t\t\t\tif (!useOldPitch) {\n\t\t\t\t\t\t\t\t\t\t\tconst interval: number = bits.readPitchInterval();\n\t\t\t\t\t\t\t\t\t\t\tpitch = lastPitch;\n\t\t\t\t\t\t\t\t\t\t\tlet intervalIter: number = interval;\n\t\t\t\t\t\t\t\t\t\t\twhile (intervalIter > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tpitch++;\n\t\t\t\t\t\t\t\t\t\t\t\twhile (recentPitches.indexOf(pitch) != -1) pitch++;\n\t\t\t\t\t\t\t\t\t\t\t\tintervalIter--;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\twhile (intervalIter < 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tpitch--;\n\t\t\t\t\t\t\t\t\t\t\t\twhile (recentPitches.indexOf(pitch) != -1) pitch--;\n\t\t\t\t\t\t\t\t\t\t\t\tintervalIter++;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tconst pitchIndex: number = bits.read(3);\n\t\t\t\t\t\t\t\t\t\t\tpitch = recentPitches[pitchIndex];\n\t\t\t\t\t\t\t\t\t\t\trecentPitches.splice(pitchIndex, 1);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\trecentPitches.unshift(pitch);\n\t\t\t\t\t\t\t\t\t\tif (recentPitches.length > 8) recentPitches.pop();\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (j < shape.pitchCount) {\n\t\t\t\t\t\t\t\t\t\t\tnote.pitches.push(pitch);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tpitchBends.push(pitch);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (j == shape.pitchCount - 1) {\n\t\t\t\t\t\t\t\t\t\t\tlastPitch = note.pitches[0];\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tlastPitch = pitch;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tpitchBends.unshift(note.pitches[0]);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tfor (const pinObj of shape.pins) {\n\t\t\t\t\t\t\t\t\t\tif (pinObj.pitchBend) pitchBends.shift();\n\t\t\t\t\t\t\t\t\t\tpin = makeNotePin(pitchBends[0] - note.pitches[0], pinObj.time, pinObj.volume);\n\t\t\t\t\t\t\t\t\t\tnote.pins.push(pin);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tcurPart = note.end;\n\t\t\t\t\t\t\t\t\tnewNotes.push(note);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (beforeThree) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tchannel++;\n\t\t\t\t\t\t\tif (channel >= this.getChannelCount()) break;\n\t\t\t\t\t\t}\n\t\t\t\t\t} // while (true)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic toJsonObject(enableIntro: boolean = true, loopCount: number = 1, enableOutro: boolean = true): Object {\n\t\t\tconst channelArray: Object[] = [];\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\n\t\t\t\tconst instrumentArray: Object[] = [];\n\t\t\t\tconst isDrum: boolean = this.getChannelIsDrum(channel);\n\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[i];\n\t\t\t\t\tif (isDrum) {\n\t\t\t\t\t\tinstrumentArray.push({\n\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[InstrumentType.noise],\n\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\n\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\n\t\t\t\t\t\t\twave: Config.drumNames[instrument.wave],\n\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\n\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\n\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\n\t\t\t\t\t\t\tinstrumentArray.push({\n\t\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[instrument.type],\n\t\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\n\t\t\t\t\t\t\t\twave: Config.waveNames[instrument.wave],\n\t\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\n\t\t\t\t\t\t\t\tfilter: Config.filterNames[instrument.filter],\n\t\t\t\t\t\t\t\tchorus: Config.chorusNames[instrument.chorus],\n\t\t\t\t\t\t\t\teffect: Config.effectNames[instrument.effect],\n\t\t\t\t\t\t\t\tharm: Config.harmNames[instrument.harm],\n\t\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\n\t\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\n\t\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\n\t\t\t\t\t\t\tconst operatorArray: Object[] = [];\n\t\t\t\t\t\t\tfor (const operator of instrument.operators) {\n\t\t\t\t\t\t\t\toperatorArray.push({\n\t\t\t\t\t\t\t\t\tfrequency: Config.operatorFrequencyNames[operator.frequency],\n\t\t\t\t\t\t\t\t\tamplitude: operator.amplitude,\n\t\t\t\t\t\t\t\t\tenvelope: Config.operatorEnvelopeNames[operator.envelope],\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinstrumentArray.push({\n\t\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[instrument.type],\n\t\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\n\t\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\n\t\t\t\t\t\t\t\teffect: Config.effectNames[instrument.effect],\n\t\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\n\t\t\t\t\t\t\t\tfmChorus: Config.fmChorusNames[instrument.fmChorus],\n\t\t\t\t\t\t\t\talgorithm: Config.operatorAlgorithmNames[instrument.algorithm],\n\t\t\t\t\t\t\t\tfeedbackType: Config.operatorFeedbackNames[instrument.feedbackType],\n\t\t\t\t\t\t\t\tfeedbackAmplitude: instrument.feedbackAmplitude,\n\t\t\t\t\t\t\t\tfeedbackEnvelope: Config.operatorEnvelopeNames[instrument.feedbackEnvelope],\n\t\t\t\t\t\t\t\toperators: operatorArray,\n\t\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\n\t\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\n\t\t\t\t\t\t\tinstrumentArray.push({\n\t\t\t\t\t\t\t\t// This uses the wrong instrument type in order\n\t\t\t\t\t\t\t\t// to make JSON exports compatible with\n\t\t\t\t\t\t\t\t// https://thestarworld.github.io/modboxfixed/\n\t\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[InstrumentType.noise],\n\t\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\n\t\t\t\t\t\t\t\twave: Config.pwmwaveNames[instrument.wave],\n\t\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\n\t\t\t\t\t\t\t\tfilter: Config.filterNames[instrument.filter],\n\t\t\t\t\t\t\t\tchorus: Config.chorusNames[instrument.chorus],\n\t\t\t\t\t\t\t\teffect: Config.effectNames[instrument.effect],\n\t\t\t\t\t\t\t\tharm: Config.harmNames[instrument.harm],\n\t\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\n\t\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\n\t\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"Unrecognized instrument type\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst patternArray: Object[] = [];\n\t\t\t\tfor (const pattern of this.channels[channel].patterns) {\n\t\t\t\t\tconst noteArray: Object[] = [];\n\t\t\t\t\tfor (const note of pattern.notes) {\n\t\t\t\t\t\tconst pointArray: Object[] = [];\n\t\t\t\t\t\tfor (const pin of note.pins) {\n\t\t\t\t\t\t\tpointArray.push({\n\t\t\t\t\t\t\t\ttick: pin.time + note.start,\n\t\t\t\t\t\t\t\tpitchBend: pin.interval,\n\t\t\t\t\t\t\t\tvolume: Math.round(pin.volume * 100 / 3),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tnoteArray.push({\n\t\t\t\t\t\t\tpitches: note.pitches,\n\t\t\t\t\t\t\tpoints: pointArray,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tpatternArray.push({\n\t\t\t\t\t\tinstrument: pattern.instrument + 1,\n\t\t\t\t\t\tnotes: noteArray, \n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst sequenceArray: number[] = [];\n\t\t\t\tif (enableIntro) for (let i: number = 0; i < this.loopStart; i++) {\n\t\t\t\t\tsequenceArray.push(this.channels[channel].bars[i]);\n\t\t\t\t}\n\t\t\t\tfor (let l: number = 0; l < loopCount; l++) for (let i: number = this.loopStart; i < this.loopStart + this.loopLength; i++) {\n\t\t\t\t\tsequenceArray.push(this.channels[channel].bars[i]);\n\t\t\t\t}\n\t\t\t\tif (enableOutro) for (let i: number = this.loopStart + this.loopLength; i < this.barCount; i++) {\n\t\t\t\t\tsequenceArray.push(this.channels[channel].bars[i]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tchannelArray.push({\n\t\t\t\t\ttype: isDrum ? \"drum\" : \"pitch\",\n\t\t\t\t\toctaveScrollBar: this.channels[channel].octave,\n\t\t\t\t\tinstruments: instrumentArray,\n\t\t\t\t\tpatterns: patternArray,\n\t\t\t\t\tsequence: sequenceArray,\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\treturn {\n\t\t\t\tformat: Song._format,\n\t\t\t\tversion: Song._latestVersion,\n\t\t\t\ttheme: Config.themeNames[this.theme],\n\t\t\t\tscale: Config.scaleNames[this.scale],\n\t\t\t\tmix: Config.mixNames[this.mix],\n\t\t\t\tsampleRate: Config.sampleRateNames[this.sampleRate],\n\t\t\t\tkey: Config.keyNames[this.key],\n\t\t\t\tintroBars: this.loopStart,\n\t\t\t\tloopBars: this.loopLength,\n\t\t\t\tbeatsPerBar: this.beatsPerBar,\n\t\t\t\tticksPerBeat: this.partsPerBeat,\n\t\t\t\tbeatsPerMinute: this.getBeatsPerMinute(), // represents tempo\n\t\t\t\treverb: this.reverb,\n\t\t\t\tblend: this.blend,\n\t\t\t\triff: this.riff,\n\t\t\t\tdetune: this.detune,\n\t\t\t\tmuff: this.muff,\n\t\t\t\t//outroBars: this.barCount - this.loopStart - this.loopLength; // derive this from bar arrays?\n\t\t\t\t//patternCount: this.patternsPerChannel, // derive this from pattern arrays?\n\t\t\t\t//instrumentsPerChannel: this.instrumentsPerChannel, //derive this from instrument arrays?\n\t\t\t\tchannels: channelArray,\n\t\t\t};\n\t\t}\n\t\t\n\t\tpublic fromJsonObject(jsonObject: any): void {\n\t\t\tthis.initToDefault(true);\n\t\t\tif (!jsonObject) return;\n\t\t\tconst version: any = jsonObject.version;\n\t\t\tif (version > Song._format) return;\n\t\t\t\n\t\t\tthis.scale = 11; // default to expert.\n\t\t\tif (jsonObject.scale != undefined) {\n\t\t\t\tconst oldScaleNames: Dictionary<number> = {\"romani :)\": 8, \"romani :(\": 9};\n\t\t\t\tconst scale: number = oldScaleNames[jsonObject.scale] != undefined ? oldScaleNames[jsonObject.scale] : Config.scaleNames.indexOf(jsonObject.scale);\n\t\t\t\tif (scale != -1) this.scale = scale;\n\t\t\t}\n\n\t\t\tif (jsonObject.mix != undefined) {\n\t\t\t\tthis.mix = Config.mixNames.indexOf(jsonObject.mix);\n\t\t\t\tif (this.mix == -1) this.mix = 1;\n\t\t\t}\n\n\t\t\tif (jsonObject.sampleRate != undefined) {\n\t\t\t\tthis.sampleRate = Config.sampleRateNames.indexOf(jsonObject.sampleRate);\n\t\t\t\tif (this.sampleRate == -1) this.sampleRate = 2;\n\t\t\t}\n\t\t\t\n\t\t\tif (jsonObject.key != undefined) {\n\t\t\t\tif (typeof(jsonObject.key) == \"number\") {\n\t\t\t\t\tthis.key = Config.keyNames.length - 1 - (((jsonObject.key + 1200) >>> 0) % Config.keyNames.length);\n\t\t\t\t} else if (typeof(jsonObject.key) == \"string\") {\n\t\t\t\t\tconst key: string = jsonObject.key;\n\t\t\t\t\tconst letter: string = key.charAt(0).toUpperCase();\n\t\t\t\t\tconst symbol: string = key.charAt(1).toLowerCase();\n\t\t\t\t\tconst letterMap: Readonly<Dictionary<number>> = {\"C\": 11, \"D\": 9, \"E\": 7, \"F\": 6, \"G\": 4, \"A\": 2, \"B\": 0};\n\t\t\t\t\tconst accidentalMap: Readonly<Dictionary<number>> = {\"#\": -1, \"♯\": -1, \"b\": 1, \"♭\": 1};\n\t\t\t\t\tlet index: number | undefined = letterMap[letter];\n\t\t\t\t\tconst offset: number | undefined = accidentalMap[symbol];\n\t\t\t\t\tif (index != undefined) {\n\t\t\t\t\t\tif (offset != undefined) index += offset;\n\t\t\t\t\t\tif (index < 0) index += 12;\n\t\t\t\t\t\tindex = index % 12;\n\t\t\t\t\t\tthis.key = index;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (jsonObject.beatsPerMinute != undefined) {\n\t\t\t\tconst bpm: number = jsonObject.beatsPerMinute | 0;\n\t\t\t\tthis.tempo = Math.round(4.0 + 9.0 * Math.log(bpm / 120) / Math.LN2);\n\t\t\t\tthis.tempo = Song._clip(0, Config.tempoSteps, this.tempo);\n\t\t\t}\n\t\t\t\n\t\t\tif (jsonObject.reverb != undefined) {\n\t\t\t\tthis.reverb = Song._clip(0, Config.reverbRange, jsonObject.reverb | 0);\n\t\t\t}\n\n\t\t\tif (jsonObject.blend != undefined) {\n\t\t\t\tthis.blend = Song._clip(0, Config.blendRange, jsonObject.blend | 0);\n\t\t\t}\n\n\t\t\tif (jsonObject.riff != undefined) {\n\t\t\t\tthis.riff = Song._clip(0, Config.riffRange, jsonObject.riff | 0);\n\t\t\t}\n\n\t\t\tif (jsonObject.detune != undefined) {\n\t\t\t\tthis.detune = Song._clip(0, Config.detuneRange, jsonObject.detune | 0);\n\t\t\t}\n\n\t\t\tif (jsonObject.muff != undefined) {\n\t\t\t\tthis.muff = Song._clip(0, Config.muffRange, jsonObject.muff | 0);\n\t\t\t}\n\t\t\t\n\t\t\tif (jsonObject.beatsPerBar != undefined) {\n\t\t\t\tthis.beatsPerBar = Math.max(Config.beatsPerBarMin, Math.min(Config.beatsPerBarMax, jsonObject.beatsPerBar | 0));\n\t\t\t}\n\t\t\t\n\t\t\tif (jsonObject.ticksPerBeat != undefined) {\n\t\t\t\tthis.partsPerBeat = jsonObject.ticksPerBeat | 0;\n\t\t\t\tif (Config.partCounts.indexOf(this.partsPerBeat) == -1) {\n\t\t\t\t\tthis.partsPerBeat = Config.partCounts[Config.partCounts.length - 1];\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tlet maxInstruments: number = 1;\n\t\t\tlet maxPatterns: number = 1;\n\t\t\tlet maxBars: number = 1;\n\t\t\tif (jsonObject.channels) {\n\t\t\t\tfor (const channelObject of jsonObject.channels) {\n\t\t\t\t\tif (channelObject.instruments) maxInstruments = Math.max(maxInstruments, channelObject.instruments.length | 0);\n\t\t\t\t\tif (channelObject.patterns) maxPatterns = Math.max(maxPatterns, channelObject.patterns.length | 0);\n\t\t\t\t\tif (channelObject.sequence) maxBars = Math.max(maxBars, channelObject.sequence.length | 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.instrumentsPerChannel = maxInstruments;\n\t\t\tthis.patternsPerChannel = maxPatterns;\n\t\t\tthis.barCount = maxBars;\n\t\t\t\n\t\t\tif (jsonObject.introBars != undefined) {\n\t\t\t\tthis.loopStart = Song._clip(0, this.barCount, jsonObject.introBars | 0);\n\t\t\t}\n\t\t\tif (jsonObject.loopBars != undefined) {\n\t\t\t\tthis.loopLength = Song._clip(1, this.barCount - this.loopStart + 1, jsonObject.loopBars | 0);\n\t\t\t}\n\t\t\t\n\t\t\tlet pitchChannelCount = 0;\n\t\t\tlet drumChannelCount = 0;\n\t\t\tif (jsonObject.channels) {\n\t\t\t\tfor (let channel: number = 0; channel < jsonObject.channels.length; channel++) {\n\t\t\t\t\tlet channelObject: any = jsonObject.channels[channel];\n\t\t\t\t\t\n\t\t\t\t\tif (this.channels.length <= channel) this.channels[channel] = new Channel();\n\t\t\t\t\t\n\t\t\t\t\tif (channelObject.octaveScrollBar != undefined) {\n\t\t\t\t\t\tthis.channels[channel].octave = Song._clip(0, 5, channelObject.octaveScrollBar | 0);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfor (let i: number = this.channels[channel].instruments.length; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\tthis.channels[channel].instruments[i] = new Instrument();\n\t\t\t\t\t}\n\t\t\t\t\tthis.channels[channel].instruments.length = this.instrumentsPerChannel;\n\t\t\t\t\t\n\t\t\t\t\tfor (let i: number = this.channels[channel].patterns.length; i < this.patternsPerChannel; i++) {\n\t\t\t\t\t\tthis.channels[channel].patterns[i] = new Pattern();\n\t\t\t\t\t}\n\t\t\t\t\tthis.channels[channel].patterns.length = this.patternsPerChannel;\n\t\t\t\t\t\n\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\n\t\t\t\t\t\tthis.channels[channel].bars[i] = 1;\n\t\t\t\t\t}\n\t\t\t\t\tthis.channels[channel].bars.length = this.barCount;\n\t\t\t\t\t\n\t\t\t\t\tlet isDrum: boolean = false;\n\t\t\t\t\tif (channelObject.type) {\n\t\t\t\t\t\tisDrum = (channelObject.type == \"drum\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// for older files, assume drums are channel 3.\n\t\t\t\t\t\tisDrum = (channel >= 3);\n\t\t\t\t\t}\n\t\t\t\t\tif (isDrum) drumChannelCount++; else pitchChannelCount++;\n\t\t\t\t\t\n\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\n\t\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[i];\n\t\t\t\t\t\tlet instrumentObject: any = undefined;\n\t\t\t\t\t\tif (channelObject.instruments) instrumentObject = channelObject.instruments[i];\n\t\t\t\t\t\tif (instrumentObject == undefined) instrumentObject = {};\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst oldTransitionNames: Dictionary<number> = {\"binary\": 0};\n\t\t\t\t\t\tconst transitionObject = instrumentObject.transition || instrumentObject.envelope; // the transition property used to be called envelope, so try that too.\n\t\t\t\t\t\tinstrument.transition = oldTransitionNames[transitionObject] != undefined ? oldTransitionNames[transitionObject] : Config.transitionNames.indexOf(transitionObject);\n\t\t\t\t\t\tif (instrument.transition == -1) instrument.transition = 1;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (isDrum) {\n\t\t\t\t\t\t\tif (instrumentObject.volume != undefined) {\n\t\t\t\t\t\t\t\tinstrument.volume = Song._clip(0, Config.volumeNames.length, Math.round(5 - (instrumentObject.volume | 0) / 20));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tinstrument.volume = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinstrument.wave = Config.drumNames.indexOf(instrumentObject.wave);\n\t\t\t\t\t\t\tif (instrument.wave == -1) instrument.wave = 1;\n\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\n\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\n\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\n\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinstrument.type = Config.instrumentTypeNames.indexOf(instrumentObject.type);\n\t\t\t\t\t\t\tif (instrument.type == null) instrument.type = InstrumentType.chip;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\n\t\t\t\t\t\t\t\tif (instrumentObject.volume != undefined) {\n\t\t\t\t\t\t\t\t\tinstrument.volume = Song._clip(0, Config.volumeNames.length, Math.round(5 - (instrumentObject.volume | 0) / 20));\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tinstrument.volume = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tinstrument.wave = Config.waveNames.indexOf(instrumentObject.wave);\n\t\t\t\t\t\t\t\tif (instrument.wave == -1) instrument.wave = 1;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tconst oldFilterNames: Dictionary<number> = {\"sustain sharp\": 1, \"sustain medium\": 2, \"sustain soft\": 3, \"decay sharp\": 4};\n\t\t\t\t\t\t\t\tinstrument.filter = oldFilterNames[instrumentObject.filter] != undefined ? oldFilterNames[instrumentObject.filter] : Config.filterNames.indexOf(instrumentObject.filter);\n\t\t\t\t\t\t\t\tif (instrument.filter == -1) instrument.filter = 0;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tinstrument.chorus = Config.chorusNames.indexOf(instrumentObject.chorus);\n\t\t\t\t\t\t\t\tif (instrument.chorus == -1) instrument.chorus = 0;\n\t\t\t\t\t\t\t\tinstrument.effect = Config.effectNames.indexOf(instrumentObject.effect);\n\t\t\t\t\t\t\t\tif (instrument.effect == -1) instrument.effect = 0;\n\t\t\t\t\t\t\t\tinstrument.harm = Config.harmNames.indexOf(instrumentObject.harm);\n\t\t\t\t\t\t\t\tif (instrument.harm == -1) instrument.harm = 0;\n\t\t\t\t\t\t\t\tinstrument.octoff = Config.octoffNames.indexOf(instrumentObject.octoff);\n\t\t\t\t\t\t\t\tif (instrument.octoff == -1) instrument.octoff = 0;\n\t\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\n\t\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\n\t\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\n\t\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\n\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\tinstrument.type == InstrumentType.pwm\n\t\t\t\t\t\t\t\t|| instrument.type == InstrumentType.noise\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tif (instrument.type == InstrumentType.noise) {\n\t\t\t\t\t\t\t\t\tinstrument.type = InstrumentType.pwm;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (instrumentObject.volume != undefined) {\n\t\t\t\t\t\t\t\t\tinstrument.volume = Song._clip(0, Config.volumeNames.length, Math.round(5 - (instrumentObject.volume | 0) / 20));\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tinstrument.volume = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tinstrument.wave = Config.pwmwaveNames.indexOf(instrumentObject.wave);\n\t\t\t\t\t\t\t\tif (instrument.wave == -1) instrument.wave = 1;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tconst oldFilterNames: Dictionary<number> = {\"sustain sharp\": 1, \"sustain medium\": 2, \"sustain soft\": 3, \"decay sharp\": 4};\n\t\t\t\t\t\t\t\tinstrument.filter = oldFilterNames[instrumentObject.filter] != undefined ? oldFilterNames[instrumentObject.filter] : Config.filterNames.indexOf(instrumentObject.filter);\n\t\t\t\t\t\t\t\tif (instrument.filter == -1) instrument.filter = 0;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tinstrument.chorus = Config.chorusNames.indexOf(instrumentObject.chorus);\n\t\t\t\t\t\t\t\tif (instrument.chorus == -1) instrument.chorus = 0;\n\t\t\t\t\t\t\t\tinstrument.effect = Config.effectNames.indexOf(instrumentObject.effect);\n\t\t\t\t\t\t\t\tif (instrument.effect == -1) instrument.effect = 0;\n\t\t\t\t\t\t\t\tinstrument.harm = Config.harmNames.indexOf(instrumentObject.harm);\n\t\t\t\t\t\t\t\tif (instrument.harm == -1) instrument.harm = 0;\n\t\t\t\t\t\t\t\tinstrument.octoff = Config.octoffNames.indexOf(instrumentObject.octoff);\n\t\t\t\t\t\t\t\tif (instrument.octoff == -1) instrument.octoff = 0;\n\t\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\n\t\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\n\t\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\n\t\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\n\t\t\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\n\t\t\t\t\t\t\t\tinstrument.effect = Config.effectNames.indexOf(instrumentObject.effect);\n\t\t\t\t\t\t\t\tif (instrument.effect == -1) instrument.effect = 0;\n\n\t\t\t\t\t\t\t\tinstrument.octoff = Config.octoffNames.indexOf(instrumentObject.octoff);\n\t\t\t\t\t\t\t\tif (instrument.octoff == -1) instrument.octoff = 0;\n\n\t\t\t\t\t\t\t\tinstrument.fmChorus = Config.fmChorusNames.indexOf(instrumentObject.fmChorus);\n\t\t\t\t\t\t\t\tif (instrument.fmChorus == -1) instrument.fmChorus = 0;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tinstrument.algorithm = Config.operatorAlgorithmNames.indexOf(instrumentObject.algorithm);\n\t\t\t\t\t\t\t\tif (instrument.algorithm == -1) instrument.algorithm = 0;\n\t\t\t\t\t\t\t\tinstrument.feedbackType = Config.operatorFeedbackNames.indexOf(instrumentObject.feedbackType);\n\t\t\t\t\t\t\t\tif (instrument.feedbackType == -1) instrument.feedbackType = 0;\n\t\t\t\t\t\t\t\tif (instrumentObject.feedbackAmplitude != undefined) {\n\t\t\t\t\t\t\t\t\tinstrument.feedbackAmplitude = Song._clip(0, Config.operatorAmplitudeMax + 1, instrumentObject.feedbackAmplitude | 0);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tinstrument.feedbackAmplitude = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tinstrument.feedbackEnvelope = Config.operatorEnvelopeNames.indexOf(instrumentObject.feedbackEnvelope);\n\t\t\t\t\t\t\t\tif (instrument.feedbackEnvelope == -1) instrument.feedbackEnvelope = 0;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tfor (let j: number = 0; j < Config.operatorCount; j++) {\n\t\t\t\t\t\t\t\t\tconst operator: Operator = instrument.operators[j];\n\t\t\t\t\t\t\t\t\tlet operatorObject: any = undefined;\n\t\t\t\t\t\t\t\t\tif (instrumentObject.operators) operatorObject = instrumentObject.operators[j];\n\t\t\t\t\t\t\t\t\tif (operatorObject == undefined) operatorObject = {};\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\toperator.frequency = Config.operatorFrequencyNames.indexOf(operatorObject.frequency);\n\t\t\t\t\t\t\t\t\tif (operator.frequency == -1) operator.frequency = 0;\n\t\t\t\t\t\t\t\t\tif (operatorObject.amplitude != undefined) {\n\t\t\t\t\t\t\t\t\t\toperator.amplitude = Song._clip(0, Config.operatorAmplitudeMax + 1, operatorObject.amplitude | 0);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\toperator.amplitude = 0;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\toperator.envelope = Config.operatorEnvelopeNames.indexOf(operatorObject.envelope);\n\t\t\t\t\t\t\t\t\tif (operator.envelope == -1) operator.envelope = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\n\t\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\n\t\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\n\t\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new Error(\"Unrecognized instrument type.\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tfor (let i: number = 0; i < this.patternsPerChannel; i++) {\n\t\t\t\t\t\tconst pattern: Pattern = this.channels[channel].patterns[i];\n\t\t\t\t\t\n\t\t\t\t\t\tlet patternObject: any = undefined;\n\t\t\t\t\t\tif (channelObject.patterns) patternObject = channelObject.patterns[i];\n\t\t\t\t\t\tif (patternObject == undefined) continue;\n\t\t\t\t\t\n\t\t\t\t\t\tpattern.instrument = Song._clip(0, this.instrumentsPerChannel, (patternObject.instrument | 0) - 1);\n\t\t\t\t\t\n\t\t\t\t\t\tif (patternObject.notes && patternObject.notes.length > 0) {\n\t\t\t\t\t\t\tconst maxNoteCount: number = Math.min(this.beatsPerBar * this.partsPerBeat, patternObject.notes.length >>> 0);\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t///@TODO: Consider supporting notes specified in any timing order, sorting them and truncating as necessary. \n\t\t\t\t\t\t\tlet tickClock: number = 0;\n\t\t\t\t\t\t\tfor (let j: number = 0; j < patternObject.notes.length; j++) {\n\t\t\t\t\t\t\t\tif (j >= maxNoteCount) break;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tconst noteObject = patternObject.notes[j];\n\t\t\t\t\t\t\t\tif (!noteObject || !noteObject.pitches || !(noteObject.pitches.length >= 1) || !noteObject.points || !(noteObject.points.length >= 2)) {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tconst note: Note = makeNote(0, 0, 0, 0);\n\t\t\t\t\t\t\t\tnote.pitches = [];\n\t\t\t\t\t\t\t\tnote.pins = [];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < noteObject.pitches.length; k++) {\n\t\t\t\t\t\t\t\t\tconst pitch: number = noteObject.pitches[k] | 0;\n\t\t\t\t\t\t\t\t\tif (note.pitches.indexOf(pitch) != -1) continue;\n\t\t\t\t\t\t\t\t\tnote.pitches.push(pitch);\n\t\t\t\t\t\t\t\t\tif (note.pitches.length >= 4) break;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (note.pitches.length < 1) continue;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tlet noteClock: number = tickClock;\n\t\t\t\t\t\t\t\tlet startInterval: number = 0;\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < noteObject.points.length; k++) {\n\t\t\t\t\t\t\t\t\tconst pointObject: any = noteObject.points[k];\n\t\t\t\t\t\t\t\t\tif (pointObject == undefined || pointObject.tick == undefined) continue;\n\t\t\t\t\t\t\t\t\tconst interval: number = (pointObject.pitchBend == undefined) ? 0 : (pointObject.pitchBend | 0);\n\t\t\t\t\t\t\t\t\tconst time: number = pointObject.tick | 0;\n\t\t\t\t\t\t\t\t\tconst volume: number = (pointObject.volume == undefined) ? 3 : Math.max(0, Math.min(3, Math.round((pointObject.volume | 0) * 3 / 100)));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (time > this.beatsPerBar * this.partsPerBeat) continue;\n\t\t\t\t\t\t\t\t\tif (note.pins.length == 0) {\n\t\t\t\t\t\t\t\t\t\tif (time < noteClock) continue;\n\t\t\t\t\t\t\t\t\t\tnote.start = time;\n\t\t\t\t\t\t\t\t\t\tstartInterval = interval;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (time <= noteClock) continue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tnoteClock = time;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tnote.pins.push(makeNotePin(interval - startInterval, time - note.start, volume));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (note.pins.length < 2) continue;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tnote.end = note.pins[note.pins.length - 1].time + note.start;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tconst maxPitch: number = isDrum ? Config.drumCount - 1 : Config.maxPitch;\n\t\t\t\t\t\t\t\tlet lowestPitch: number = maxPitch;\n\t\t\t\t\t\t\t\tlet highestPitch: number = 0;\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < note.pitches.length; k++) {\n\t\t\t\t\t\t\t\t\tnote.pitches[k] += startInterval;\n\t\t\t\t\t\t\t\t\tif (note.pitches[k] < 0 || note.pitches[k] > maxPitch) {\n\t\t\t\t\t\t\t\t\t\tnote.pitches.splice(k, 1);\n\t\t\t\t\t\t\t\t\t\tk--;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (note.pitches[k] < lowestPitch) lowestPitch = note.pitches[k];\n\t\t\t\t\t\t\t\t\tif (note.pitches[k] > highestPitch) highestPitch = note.pitches[k];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (note.pitches.length < 1) continue;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < note.pins.length; k++) {\n\t\t\t\t\t\t\t\t\tconst pin: NotePin = note.pins[k];\n\t\t\t\t\t\t\t\t\tif (pin.interval + lowestPitch < 0) pin.interval = -lowestPitch;\n\t\t\t\t\t\t\t\t\tif (pin.interval + highestPitch > maxPitch) pin.interval = maxPitch - highestPitch;\n\t\t\t\t\t\t\t\t\tif (k >= 2) {\n\t\t\t\t\t\t\t\t\t\tif (pin.interval == note.pins[k-1].interval && \n\t\t\t\t\t\t\t\t\t\t\tpin.interval == note.pins[k-2].interval && \n\t\t\t\t\t\t\t\t\t\t\tpin.volume == note.pins[k-1].volume && \n\t\t\t\t\t\t\t\t\t\t\tpin.volume == note.pins[k-2].volume)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tnote.pins.splice(k-1, 1);\n\t\t\t\t\t\t\t\t\t\t\tk--;\n\t\t\t\t\t\t\t\t\t\t}    \n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tpattern.notes.push(note);\n\t\t\t\t\t\t\t\ttickClock = note.end;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\n\t\t\t\t\t\tthis.channels[channel].bars[i] = channelObject.sequence ? Math.min(this.patternsPerChannel, channelObject.sequence[i] >>> 0) : 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.pitchChannelCount = pitchChannelCount;\n\t\t\tthis.drumChannelCount = drumChannelCount;\n\t\t\tthis.channels.length = this.getChannelCount();\n\t\t}\n\t\t\n\t\tprivate static _clip(min: number, max: number, val: number): number {\n\t\t\tmax = max - 1;\n\t\t\tif (val <= max) {\n\t\t\t\tif (val >= min) return val;\n\t\t\t\telse return min;\n\t\t\t} else {\n\t\t\t\treturn max;\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic getPattern(channel: number, bar: number): Pattern | null {\n\t\t\tconst patternIndex: number = this.channels[channel].bars[bar];\n\t\t\tif (patternIndex == 0) return null;\n\t\t\treturn this.channels[channel].patterns[patternIndex - 1];\n\t\t}\n\t\t\n\t\tpublic getPatternInstrument(channel: number, bar: number): number {\n\t\t\tconst pattern: Pattern | null = this.getPattern(channel, bar);\n\t\t\treturn pattern == null ? 0 : pattern.instrument;\n\t\t}\n\n\t\tpublic getPatternInstrumentMute(channel: number, bar: number): number {\n\t\t\tconst pattern: Pattern | null = this.getPattern(channel, bar);\n\t\t\tconst instrumentIndex: number = this.getPatternInstrument(channel, bar);\n\t\t\tconst instrument: Instrument = this.channels[channel].instruments[instrumentIndex];\n\t\t\treturn pattern == null ? 0 : instrument.imute;\n\t\t}\n\n\t\tpublic getPatternInstrumentVolume(channel: number, bar: number): number {\n\t\t\tconst pattern: Pattern | null = this.getPattern(channel, bar);\n\t\t\tconst instrumentIndex: number = this.getPatternInstrument(channel, bar);\n\t\t\tconst instrument: Instrument = this.channels[channel].instruments[instrumentIndex];\n\t\t\treturn pattern == null ? 0 : instrument.volume;\n\t\t}\n\t\t\n\t\tpublic getBeatsPerMinute(): number {\n\t\t\treturn Math.round(120.0 * Math.pow(2.0, (-4.0 + this.tempo) / 9.0));\n\t\t}\n\t\t\n\t\tprivate readonly _fingerprint: Array<string | number> = [];\n\t\tpublic getChannelFingerprint(bar: number): string {\n\t\t\tconst channelCount: number = this.getChannelCount();\n\t\t\tlet charCount: number = 0;\n\t\t\tfor (let channel: number = 0; channel < channelCount; channel++) {\n\t\t\t\tif (channel < this.pitchChannelCount) {\n\t\t\t\t\tconst instrumentIndex: number = this.getPatternInstrument(channel, bar);\n\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[instrumentIndex];\n\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\n\t\t\t\t\t\tthis._fingerprint[charCount++] = \"c\";\n\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\n\t\t\t\t\t\tthis._fingerprint[charCount++] = \"f\"\n\t\t\t\t\t\tthis._fingerprint[charCount++] = instrument.algorithm;\n\t\t\t\t\t\tthis._fingerprint[charCount++] = instrument.feedbackType;\n\t\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\n\t\t\t\t\t\tthis._fingerprint[charCount++] = \"p\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"Unknown instrument type.\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._fingerprint[charCount++] = \"d\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._fingerprint.length = charCount;\n\t\t\treturn this._fingerprint.join(\"\");\n\t\t}\n\t}\n\t\n\tclass SynthChannel {\n\t\tpublic sampleLeft: number = 0.0;\n\t\tpublic sampleRight: number = 0.0;\n\t\tpublic readonly phases: number[] = [];\n\t\tpublic readonly phaseDeltas: number[] = [];\n\t\tpublic readonly volumeStarts: number[] = [];\n\t\tpublic readonly volumeDeltas: number[] = [];\n\t\tpublic readonly volumeLeft: number[] = [];\n\t\tpublic readonly volumeRight: number[] = [];\n\t\tpublic phaseDeltaScale: number = 0.0;\n\t\tpublic filter: number = 0.0;\n\t\tpublic filterScale: number = 0.0;\n\t\tpublic vibratoScale: number = 0.0;\n\t\tpublic harmonyMult: number = 0.0;\n\t\tpublic harmonyVolumeMult: number = 1.0;\n\t\tpublic feedbackOutputs: number[] = [];\n\t\tpublic feedbackMult: number = 0.0;\n\t\tpublic feedbackDelta: number = 0.0;\n\t\t\n\t\tconstructor() {\n\t\t\tthis.reset();\n\t\t}\n\t\t\n\t\tpublic reset(): void {\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\n\t\t\t\tthis.phases[i] = 0.0;\n\t\t\t\tthis.feedbackOutputs[i] = 0.0;\n\t\t\t}\n\t\t\tthis.sampleLeft = 0.0;\n\t\t\tthis.sampleRight = 0.0;\n\t\t}\n\t}\n\t\n\texport class Synth {\n\t\t\n\t\tprivate static warmUpSynthesizer(song: Song | null): void {\n\t\t\t// Don't bother to generate the drum waves unless the song actually\n\t\t\t// uses them, since they may require a lot of computation.\n\t\t\tif (song != null) {\n\t\t\t\tfor (let i: number = 0; i < song.instrumentsPerChannel; i++) {\n\t\t\t\t\tfor (let j: number = song.pitchChannelCount; j < song.pitchChannelCount + song.drumChannelCount; j++) {\n\t\t\t\t\t\tConfig.getDrumWave(song.channels[j].instruments[i].wave);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (let i: number = 0; i < song.barCount; i++) {\n\t\t\t\t\tSynth.getGeneratedSynthesizer(song, i);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate static operatorAmplitudeCurve(amplitude: number): number {\n\t\t\treturn (Math.pow(16.0, amplitude / 15.0) - 1.0) / 15.0;\n\t\t}\n\t\t\n\t\tprivate static readonly negativePhaseGuard: number = 1000;\n\t\t\n\t\tpublic samplesPerSecond: number = 44100;\n\t\tprivate effectDuration: number = 0.14;\n\t\tprivate effectAngle: number = Math.PI * 2.0 / (this.effectDuration * this.samplesPerSecond);\n\t\tpublic effectYMult: number = 2.0 * Math.cos(this.effectAngle);\n\t\tpublic limitDecay: number = 1.0 / (2.0 * this.samplesPerSecond);\n\t\t\n\t\tpublic song: Song | null = null;\n\t\tpublic pianoPressed: boolean = false;\n\t\tpublic pianoPitch: number[] = [0];\n\t\tpublic pianoChannel: number = 0;\n\t\tpublic enableIntro: boolean = true;\n\t\tpublic enableOutro: boolean = false;\n\t\tpublic loopCount: number = -1;\n\t\tpublic volume: number = 1.0;\n\t\t\n\t\tprivate playheadInternal: number = 0.0;\n\t\tprivate bar: number = 0;\n\t\tprivate beat: number = 0;\n\t\tprivate part: number = 0;\n\t\tprivate arpeggio: number = 0;\n\t\tprivate arpeggioSampleCountdown: number = 0;\n\t\tprivate paused: boolean = true;\n\t\t\n\t\tprivate readonly channels: SynthChannel[] = [];\n\t\tpublic stillGoing: boolean = false;\n\t\tpublic effectPhase: number = 0.0;\n\t\tpublic limit: number = 0.0;\n\t\t\n\t\tprivate delayLineLeft: Float32Array = new Float32Array(16384);\n\t\tprivate delayLineRight: Float32Array = new Float32Array(16384);\n\t\tpublic delayPosLeft: number = 0;\n\t\tpublic delayPosRight: number = 0;\n\t\tpublic delayFeedback0Left: number = 0.0;\n\t\tpublic delayFeedback0Right: number = 0.0;\n\t\tpublic delayFeedback1Left: number = 0.0;\n\t\tpublic delayFeedback1Right: number = 0.0;\n\t\tpublic delayFeedback2Left: number = 0.0;\n\t\tpublic delayFeedback2Right: number = 0.0;\n\t\tpublic delayFeedback3Left: number = 0.0;\n\t\tpublic delayFeedback3Right: number = 0.0;\n\t\t\n\t\tprivate audioCtx: any;\n\t\tprivate scriptNode: any;\n\t\t\n\t\tpublic get playing(): boolean {\n\t\t\treturn !this.paused;\n\t\t}\n\t\t\n\t\tpublic get playhead(): number {\n\t\t\treturn this.playheadInternal;\n\t\t}\n\t\t\n\t\tpublic set playhead(value: number) {\n\t\t\tif (this.song != null) {\n\t\t\t\tthis.playheadInternal = Math.max(0, Math.min(this.song.barCount, value));\n\t\t\t\tlet remainder: number = this.playheadInternal;\n\t\t\t\tthis.bar = Math.floor(remainder);\n\t\t\t\tremainder = this.song.beatsPerBar * (remainder - this.bar);\n\t\t\t\tthis.beat = Math.floor(remainder);\n\t\t\t\tremainder = this.song.partsPerBeat * (remainder - this.beat);\n\t\t\t\tthis.part = Math.floor(remainder);\n\t\t\t\tremainder = 4 * (remainder - this.part);\n\t\t\t\tthis.arpeggio = Math.floor(remainder);\n\t\t\t\tconst samplesPerArpeggio: number = this.getSamplesPerArpeggio();\n\t\t\t\tremainder = samplesPerArpeggio * (remainder - this.arpeggio);\n\t\t\t\tthis.arpeggioSampleCountdown = Math.floor(samplesPerArpeggio - remainder);\n\t\t\t\tif (this.bar < this.song.loopStart) {\n\t\t\t\t\tthis.enableIntro = true;\n\t\t\t\t}\n\t\t\t\tif (this.bar > this.song.loopStart + this.song.loopLength) {\n\t\t\t\t\tthis.enableOutro = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic get totalSamples(): number {\n\t\t\tif (this.song == null) return 0;\n\t\t\tconst samplesPerBar: number = this.getSamplesPerArpeggio() * 4 * this.song.partsPerBeat * this.song.beatsPerBar;\n\t\t\tlet loopMinCount: number = this.loopCount;\n\t\t\tif (loopMinCount < 0) loopMinCount = 1;\n\t\t\tlet bars: number = this.song.loopLength * loopMinCount;\n\t\t\tif (this.enableIntro) bars += this.song.loopStart;\n\t\t\tif (this.enableOutro) bars += this.song.barCount - (this.song.loopStart + this.song.loopLength);\n\t\t\treturn bars * samplesPerBar;\n\t\t}\n\t\t\n\t\tpublic get totalSeconds(): number {\n\t\t\t// @TODO: Revisit\n\t\t\treturn Math.round(this.totalSamples / this.samplesPerSecond);\n\t\t}\n\t\t\n\t\tpublic get totalBars(): number {\n\t\t\tif (this.song == null) return 0.0;\n\t\t\treturn this.song.barCount;\n\t\t}\n\t\t\n\t\tconstructor(song: any = null) {\n\t\t\tif (song != null) this.setSong(song);\n\t\t}\n\t\t\n\t\tpublic setSong(song: any): void {\n\t\t\tif (typeof(song) == \"string\") {\n\t\t\t\tthis.song = new Song(song);\n\t\t\t} else if (song instanceof Song) {\n\t\t\t\tthis.song = song;\n\t\t\t}\n\t\t}\n\n\t\tprivate spsCalc(): number {\n\t\t\tSynth.warmUpSynthesizer(this.song);\n\t\t\tif (this.song!.sampleRate == 0) return 44100;\n\t\t\telse if (this.song!.sampleRate == 1) return 48000;\n\t\t\telse if (this.song!.sampleRate == 2) return this.audioCtx.sampleRate;\n\t\t\telse if (this.song!.sampleRate == 3) return this.audioCtx.sampleRate * 4;\n\t\t\telse if (this.song!.sampleRate == 4) return this.audioCtx.sampleRate * 2;\n\t\t\telse if (this.song!.sampleRate == 5) return this.audioCtx.sampleRate / 2;\n\t\t\telse if (this.song!.sampleRate == 6) return this.audioCtx.sampleRate / 4;\n\t\t\telse if (this.song!.sampleRate == 7) return this.audioCtx.sampleRate / 8;\n\t\t\telse if (this.song!.sampleRate == 8) return this.audioCtx.sampleRate / 16;\n\t\t\telse return this.audioCtx.sampleRate;\n\t\t}\n\t\t\n\t\tpublic play(): void {\n\t\t\tif (!this.paused) return;\n\t\t\tthis.paused = false;\n\t\t\t\n\t\t\tSynth.warmUpSynthesizer(this.song);\n\t\t\t\n\t\t\tconst contextClass = (window.AudioContext);\n\t\t\tthis.audioCtx = this.audioCtx || new contextClass();\n\t\t\tthis.scriptNode = this.audioCtx.createScriptProcessor ? this.audioCtx.createScriptProcessor(2048, 0, 2) : this.audioCtx.createJavaScriptNode(2048, 0, 2); // 2048, 0 input channels, 2 outputs\n\t\t\tthis.scriptNode.onaudioprocess = this.audioProcessCallback;\n\t\t\tthis.scriptNode.connect(this.audioCtx.destination);\n\t\t\tthis.scriptNode.channelCountMode = 'explicit';\n\t\t\tthis.scriptNode.channelInterpretation = 'speakers';\n\t\t\t\n\t\t\tthis.samplesPerSecond = this.spsCalc();\n\t\t\tthis.effectAngle = Math.PI * 2.0 / (this.effectDuration * this.samplesPerSecond);\n\t\t\tthis.effectYMult = 2.0 * Math.cos(this.effectAngle);\n\t\t\tthis.limitDecay = 1.0 / (2.0 * this.samplesPerSecond);\n\t\t}\n\t\t\n\t\tpublic pause(): void {\n\t\t\tif (this.paused) return;\n\t\t\tthis.paused = true;\n\t\t\t// this.scriptNode.disconnect(this.audioCtx.destination);\n\t\t\tif (this.audioCtx.close) {\n\t\t\t\tthis.audioCtx.close(); // firefox is missing this function?\n\t\t\t\tthis.audioCtx = null;\n\t\t\t}\n\t\t\tthis.scriptNode = null;\n\t\t}\n\t\t\n\t\tpublic snapToStart(): void {\n\t\t\tthis.bar = 0;\n\t\t\tthis.enableIntro = true;\n\t\t\tthis.snapToBar();\n\t\t}\n\t\t\n\t\tpublic snapToBar(bar?: number): void {\n\t\t\tif (bar !== undefined) this.bar = bar;\n\t\t\tthis.playheadInternal = this.bar;\n\t\t\tthis.beat = 0;\n\t\t\tthis.part = 0;\n\t\t\tthis.arpeggio = 0;\n\t\t\tthis.arpeggioSampleCountdown = 0;\n\t\t\tthis.effectPhase = 0.0;\n\t\t\t\n\t\t\tfor (const channel of this.channels) channel.reset();\n\t\t\t\n\t\t\tthis.delayPosLeft = 0;\n\t\t\tthis.delayPosRight = 0;\n\t\t\tthis.delayFeedback0Left = 0.0;\n\t\t\tthis.delayFeedback0Right = 0.0;\n\t\t\tthis.delayFeedback1Left = 0.0;\n\t\t\tthis.delayFeedback1Right = 0.0;\n\t\t\tthis.delayFeedback2Left = 0.0;\n\t\t\tthis.delayFeedback2Right = 0.0;\n\t\t\tthis.delayFeedback3Left = 0.0;\n\t\t\tthis.delayFeedback3Right = 0.0;\n\t\t\tfor (let i: number = 0; i < this.delayLineLeft.length; i++) this.delayLineLeft[i] = 0.0;\n\t\t\tfor (let i: number = 0; i < this.delayLineRight.length; i++) this.delayLineRight[i] = 0.0;\n\t\t}\n\t\t\n\t\tpublic nextBar(): void {\n\t\t\tif (!this.song) return;\n\t\t\tconst oldBar: number = this.bar;\n\t\t\tthis.bar++;\n\t\t\tif (this.enableOutro) {\n\t\t\t\tif (this.bar >= this.song.barCount) {\n\t\t\t\t\tthis.bar = this.enableIntro ? 0 : this.song.loopStart;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.bar >= this.song.loopStart + this.song.loopLength || this.bar >= this.song.barCount) {\n\t\t\t\t\tthis.bar = this.song.loopStart;\n\t\t\t\t}\n \t\t\t}\n\t\t\tthis.playheadInternal += this.bar - oldBar;\n\t\t}\n\t\t\n\t\tpublic prevBar(): void {\n\t\t\tif (!this.song) return;\n\t\t\tconst oldBar: number = this.bar;\n\t\t\tthis.bar--;\n\t\t\tif (this.bar < 0) {\n\t\t\t\tthis.bar = this.song.loopStart + this.song.loopLength - 1;\n\t\t\t}\n\t\t\tif (this.bar >= this.song.barCount) {\n\t\t\t\tthis.bar = this.song.barCount - 1;\n\t\t\t}\n\t\t\tif (this.bar < this.song.loopStart) {\n\t\t\t\tthis.enableIntro = true;\n\t\t\t}\n\t\t\tif (!this.enableOutro && this.bar >= this.song.loopStart + this.song.loopLength) {\n\t\t\t\tthis.bar = this.song.loopStart + this.song.loopLength - 1;\n\t\t\t}\n\t\t\tthis.playheadInternal += this.bar - oldBar;\n\t\t}\n\t\t\n\t\tprivate audioProcessCallback = (audioProcessingEvent: any): void => {\n\t\t\tconst outputBuffer = audioProcessingEvent.outputBuffer;\n\t\t\tconst outputDataLeft: Float32Array = outputBuffer.getChannelData(0);\n\t\t\tconst outputDataRight: Float32Array = outputBuffer.getChannelData(1);\n\t\t\tthis.synthesize(outputDataLeft, outputDataRight, outputBuffer.length);\n\t\t}\n\t\t\n\t\tpublic synthesize(dataLeft: Float32Array, dataRight: Float32Array, bufferLength: number): void {\n\t\t\tif (this.song == null) {\n\t\t\t\tfor (let i: number = 0; i < bufferLength; i++) {\n\t\t\t\t\tdataLeft[i] = 0.0;\n\t\t\t\t\tdataRight[i] = 0.0;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tconst channelCount: number = this.song.getChannelCount();\n\t\t\tfor (let i: number = this.channels.length; i < channelCount; i++) {\n\t\t\t\tthis.channels[i] = new SynthChannel();\n\t\t\t}\n\t\t\tthis.channels.length = channelCount;\n\t\t\t\n\t\t\tconst samplesPerArpeggio: number = this.getSamplesPerArpeggio();\n\t\t\tlet bufferIndex: number = 0;\n\t\t\tlet ended: boolean = false;\n\t\t\t\n\t\t\t// Check the bounds of the playhead:\n\t\t\tif (this.arpeggioSampleCountdown == 0 || this.arpeggioSampleCountdown > samplesPerArpeggio) {\n\t\t\t\tthis.arpeggioSampleCountdown = samplesPerArpeggio;\n\t\t\t}\n\t\t\tif (this.part >= this.song.partsPerBeat) {\n\t\t\t\tthis.beat++;\n\t\t\t\tthis.part = 0;\n\t\t\t\tthis.arpeggio = 0;\n\t\t\t\tthis.arpeggioSampleCountdown = samplesPerArpeggio;\n\t\t\t}\n\t\t\tif (this.beat >= this.song.beatsPerBar) {\n\t\t\t\tthis.bar++;\n\t\t\t\tthis.beat = 0;\n\t\t\t\tthis.part = 0;\n\t\t\t\tthis.arpeggio = 0;\n\t\t\t\tthis.arpeggioSampleCountdown = samplesPerArpeggio;\n\t\t\t\t\n\t\t\t\tif (this.loopCount == -1) {\n\t\t\t\t\tif (this.bar < this.song.loopStart && !this.enableIntro) this.bar = this.song.loopStart;\n\t\t\t\t\tif (this.bar >= this.song.loopStart + this.song.loopLength && !this.enableOutro) this.bar = this.song.loopStart;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.bar >= this.song.barCount) {\n\t\t\t\tif (this.enableOutro) {\n\t\t\t\t\tthis.bar = 0;\n\t\t\t\t\tthis.enableIntro = true;\n\t\t\t\t\tended = true;\n\t\t\t\t\tthis.pause();\n\t\t\t\t} else {\n\t\t\t\t\tthis.bar = this.song.loopStart;\n\t\t\t\t}\n \t\t\t}\n\t\t\tif (this.bar >= this.song.loopStart) {\n\t\t\t\tthis.enableIntro = false;\n\t\t\t}\n\t\t\t\n \t\t\twhile (true) {\n\t\t\t\tif (ended) {\n\t\t\t\t\twhile (bufferIndex < bufferLength) {\n\t\t\t\t\t\tdataLeft[bufferIndex] = 0.0;\n\t\t\t\t\t\tdataRight[bufferIndex] = 0.0;\n\t\t\t\t\t\tbufferIndex++;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst generatedSynthesizer: Function = Synth.getGeneratedSynthesizer(this.song, this.bar);\n\t\t\t\tbufferIndex = generatedSynthesizer(this, this.song, dataLeft, dataRight, bufferLength, bufferIndex, samplesPerArpeggio);\n\t\t\t\t\n\t\t\t\tconst finishedBuffer: boolean = (bufferIndex == -1);\n\t\t\t\tif (finishedBuffer) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\t// bar changed, reset for next bar:\n\t\t\t\t\tthis.beat = 0;\n\t\t\t\t\tthis.effectPhase = 0.0;\n\t\t\t\t\tthis.bar++;\n\t\t\t\t\tif (this.bar < this.song.loopStart) {\n\t\t\t\t\t\tif (!this.enableIntro) this.bar = this.song.loopStart;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.enableIntro = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (this.bar >= this.song.loopStart + this.song.loopLength) {\n\t\t\t\t\t\tif (this.loopCount > 0) this.loopCount--;\n\t\t\t\t\t\tif (this.loopCount > 0 || !this.enableOutro) {\n\t\t\t\t\t\t\tthis.bar = this.song.loopStart;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.bar >= this.song.barCount) {\n\t\t\t\t\t\tthis.bar = 0;\n\t\t\t\t\t\tthis.enableIntro = true;\n\t\t\t\t\t\tended = true;\n\t\t\t\t\t\tthis.pause();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.playheadInternal = (((this.arpeggio + 1.0 - this.arpeggioSampleCountdown / samplesPerArpeggio) / 4.0 + this.part) / this.song.partsPerBeat + this.beat) / this.song.beatsPerBar + this.bar;\n\t\t}\n\t\t\n\t\tprivate static computeOperatorEnvelope(envelope: number, time: number, beats: number, customVolume: number): number {\n\t\t\tswitch(Config.operatorEnvelopeType[envelope]) {\n\t\t\t\tcase EnvelopeType.custom: return customVolume;\n\t\t\t\tcase EnvelopeType.steady: return 1.0;\n\t\t\t\tcase EnvelopeType.pluck:\n\t\t\t\t\tlet curve: number = 1.0 / (1.0 + time * Config.operatorEnvelopeSpeed[envelope]);\n\t\t\t\t\tif (Config.operatorEnvelopeInverted[envelope]) {\n\t\t\t\t\t\treturn 1.0 - curve;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn curve;\n\t\t\t\t\t}\n\t\t\t\tcase EnvelopeType.tremolo: \n\t\t\t\t\tif (Config.operatorSpecialCustomVolume[envelope]) {\n\t\t\t\t\t\treturn 0.5 - Math.cos(beats * 2.0 * Math.PI * (customVolume * 4)) * 0.5;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn 0.5 - Math.cos(beats * 2.0 * Math.PI * Config.operatorEnvelopeSpeed[envelope]) * 0.5;\n\t\t\t\t\t}\n\t\t\t\tcase EnvelopeType.punch: \n\t\t\t\t\treturn Math.max(1.0, 2.0 - time * 10.0);\n\t\t\t\tcase EnvelopeType.flare:\n\t\t\t\t\tif (Config.operatorSpecialCustomVolume[envelope]) {\n\t\t\t\t\t\tconst attack: number = 0.25 / Math.sqrt(customVolume);\n\t\t\t\t\t\treturn time < attack ? time / attack : 1.0 / (1.0 + (time - attack) * (customVolume * 16));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst speed: number = Config.operatorEnvelopeSpeed[envelope];\n\t\t\t\t\t\tconst attack: number = 0.25 / Math.sqrt(speed);\n\t\t\t\t\t\treturn time < attack ? time / attack : 1.0 / (1.0 + (time - attack) * speed);\n\t\t\t\t\t}\n\t\t\t\tcase EnvelopeType.flute:\n\t\t\t\t\treturn Math.max(-1.0 - time, -2.0 + time);\n\t\t\t\tdefault: throw new Error(\"Unrecognized operator envelope type.\");\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic static computeChannelInstrument(synth: Synth, song: Song, channel: number, time: number, sampleTime: number, samplesPerArpeggio: number, samples: number): void {\n\t\t\tconst isDrum: boolean = song.getChannelIsDrum(channel);\n\t\t\tconst synthChannel: SynthChannel = synth.channels[channel];\n\t\t\tconst pattern: Pattern | null = song.getPattern(channel, synth.bar);\n\t\t\tconst instrument: Instrument = song.channels[channel].instruments[pattern == null ? 0 : pattern.instrument];\n\t\t\tconst pianoMode = (synth.pianoPressed && channel == synth.pianoChannel);\n\t\t\tconst basePitch: number = isDrum ? Config.drumBasePitches[instrument.wave] : Config.keyTransposes[song.key];\n\t\t\tconst intervalScale: number = isDrum ? Config.drumInterval : 1;\n\t\t\tconst pitchDamping: number = isDrum ? (Config.drumWaveIsSoft[instrument.wave] ? 24.0 : 60.0) : 48.0;\n\t\t\tconst secondsPerPart: number = 4.0 * samplesPerArpeggio / synth.samplesPerSecond;\n\t\t\tconst beatsPerPart: number = 1.0 / song.partsPerBeat;\n\t\t\t\n\t\t\tsynthChannel.phaseDeltaScale = 0.0;\n\t\t\tsynthChannel.filter = 1.0;\n\t\t\tsynthChannel.filterScale = 1.0;\n\t\t\tsynthChannel.vibratoScale = 0.0;\n\t\t\tsynthChannel.harmonyMult = 1.0;\n\t\t\tsynthChannel.harmonyVolumeMult = 1.0;\n\t\t\t\n\t\t\tlet partsSinceStart: number = 0.0;\n\t\t\tlet arpeggio: number = synth.arpeggio;\n\t\t\tlet arpeggioSampleCountdown: number = synth.arpeggioSampleCountdown;\n\t\t\t\n\t\t\tlet pitches: number[] | null = null;\n\t\t\tlet resetPhases: boolean = true;\n\t\t\t\n\t\t\tlet intervalStart: number = 0.0;\n\t\t\tlet intervalEnd: number = 0.0;\n\t\t\tlet transitionVolumeStart: number = 1.0;\n\t\t\tlet transitionVolumeEnd: number = 1.0;\n\t\t\tlet envelopeVolumeStart: number = 0.0;\n\t\t\tlet envelopeVolumeEnd: number = 0.0;\n\t\t\t// TODO: probably part time can be calculated independently of any notes?\n\t\t\tlet partTimeStart: number = 0.0;\n\t\t\tlet partTimeEnd:   number = 0.0;\n\t\t\tlet decayTimeStart: number = 0.0;\n\t\t\tlet decayTimeEnd:   number = 0.0;\n\t\t\t\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\n\t\t\t\tsynthChannel.phaseDeltas[i] = 0.0;\n\t\t\t\tsynthChannel.volumeStarts[i] = 0.0;\n\t\t\t\tsynthChannel.volumeDeltas[i] = 0.0;\n\t\t\t\tsynthChannel.volumeLeft[0] = 0.0;\n\t\t\t\tsynthChannel.volumeRight[0] = 0.0;\n\t\t\t}\n\t\t\t\n\t\t\tif (pianoMode) {\n\t\t\t\tpitches = synth.pianoPitch;\n\t\t\t\ttransitionVolumeStart = transitionVolumeEnd = 1;\n\t\t\t\tenvelopeVolumeStart = envelopeVolumeEnd = 1;\n\t\t\t\tresetPhases = false;\n\t\t\t\t// TODO: track time since live piano note started for transition, envelope, decays, delayed vibrato, etc.\n\t\t\t} else if (pattern != null) {\n\t\t\t\tlet note: Note | null = null;\n\t\t\t\tlet prevNote: Note | null = null;\n\t\t\t\tlet nextNote: Note | null = null;\n\t\t\t\tfor (let i: number = 0; i < pattern.notes.length; i++) {\n\t\t\t\t\tif (pattern.notes[i].end <= time) {\n\t\t\t\t\t\tprevNote = pattern.notes[i];\n\t\t\t\t\t} else if (pattern.notes[i].start <= time && pattern.notes[i].end > time) {\n\t\t\t\t\t\tnote = pattern.notes[i];\n\t\t\t\t\t} else if (pattern.notes[i].start > time) {\n\t\t\t\t\t\tnextNote = pattern.notes[i];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (note != null && prevNote != null && prevNote.end != note.start) prevNote = null;\n\t\t\t\tif (note != null && nextNote != null && nextNote.start != note.end) nextNote = null;\n\t\t\t\t\n\t\t\t\tif (note != null) {\n\t\t\t\t\tpitches = note.pitches;\n\t\t\t\t\tpartsSinceStart = time - note.start;\n\t\t\t\t\t\n\t\t\t\t\tlet endPinIndex: number;\n\t\t\t\t\tfor (endPinIndex = 1; endPinIndex < note.pins.length - 1; endPinIndex++) {\n\t\t\t\t\t\tif (note.pins[endPinIndex].time + note.start > time) break;\n\t\t\t\t\t}\n\t\t\t\t\tconst startPin: NotePin = note.pins[endPinIndex-1];\n\t\t\t\t\tconst endPin: NotePin = note.pins[endPinIndex];\n\t\t\t\t\tconst noteStart: number = note.start * 4;\n\t\t\t\t\tconst noteEnd:   number = note.end   * 4;\n\t\t\t\t\tconst pinStart: number  = (note.start + startPin.time) * 4;\n\t\t\t\t\tconst pinEnd:   number  = (note.start +   endPin.time) * 4;\n\t\t\t\t\t\n\t\t\t\t\tconst tickTimeStart: number = time * 4 + arpeggio;\n\t\t\t\t\tconst tickTimeEnd:   number = time * 4 + arpeggio + 1;\n\t\t\t\t\tconst pinRatioStart: number = (tickTimeStart - pinStart) / (pinEnd - pinStart);\n\t\t\t\t\tconst pinRatioEnd:   number = (tickTimeEnd   - pinStart) / (pinEnd - pinStart);\n\t\t\t\t\tlet envelopeVolumeTickStart: number = startPin.volume + (endPin.volume - startPin.volume) * pinRatioStart;\n\t\t\t\t\tlet envelopeVolumeTickEnd:   number = startPin.volume + (endPin.volume - startPin.volume) * pinRatioEnd;\n\t\t\t\t\tlet transitionVolumeTickStart: number = 1.0;\n\t\t\t\t\tlet transitionVolumeTickEnd:   number = 1.0;\n\t\t\t\t\tlet intervalTickStart: number = startPin.interval + (endPin.interval - startPin.interval) * pinRatioStart;\n\t\t\t\t\tlet intervalTickEnd:   number = startPin.interval + (endPin.interval - startPin.interval) * pinRatioEnd;\n\t\t\t\t\tlet partTimeTickStart: number = startPin.time + (endPin.time - startPin.time) * pinRatioStart;\n\t\t\t\t\tlet partTimeTickEnd:   number = startPin.time + (endPin.time - startPin.time) * pinRatioEnd;\n\t\t\t\t\tlet decayTimeTickStart: number = partTimeTickStart;\n\t\t\t\t\tlet decayTimeTickEnd:   number = partTimeTickEnd;\n\t\t\t\t\t\n\t\t\t\t\tconst startRatio: number = 1.0 - (arpeggioSampleCountdown + samples) / samplesPerArpeggio;\n\t\t\t\t\tconst endRatio:   number = 1.0 - (arpeggioSampleCountdown)           / samplesPerArpeggio;\n\t\t\t\t\tresetPhases = (tickTimeStart + startRatio - noteStart == 0.0);\n\t\t\t\t\t\n\t\t\t\t\tconst transition: number = instrument.transition;\n\t\t\t\t\tif (tickTimeStart == noteStart) {\n\t\t\t\t\t\tif (transition == 0) {\n\t\t\t\t\t\t\t// seamless start\n\t\t\t\t\t\t\tresetPhases = false;\n\t\t\t\t\t\t} else if (transition == 2) {\n\t\t\t\t\t\t\t// smooth start\n\t\t\t\t\t\t\ttransitionVolumeTickStart = 0.0;\n\t\t\t\t\t\t} else if (transition == 3) {\n\t\t\t\t\t\t\t// slide start\n\t\t\t\t\t\t\tif (prevNote == null) {\n\t\t\t\t\t\t\t\ttransitionVolumeTickStart = 0.0;\n\t\t\t\t\t\t\t} else if (prevNote.pins[prevNote.pins.length-1].volume == 0 || note.pins[0].volume == 0) {\n\t\t\t\t\t\t\t\ttransitionVolumeTickStart = 0.0;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tintervalTickStart = (prevNote.pitches[0] + prevNote.pins[prevNote.pins.length-1].interval - note.pitches[0]) * 0.5;\n\t\t\t\t\t\t\t\tdecayTimeTickStart = prevNote.pins[prevNote.pins.length-1].time * 0.5;\n\t\t\t\t\t\t\t\tresetPhases = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (transition == 4) {\n\t\t\t\t\t\t\t// trill start\n\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\n\t\t\t\t\t\t} else if (transition == 5) {\n\t\t\t\t\t\t\t// click start\n\t\t\t\t\t\t\tintervalTickStart = 100.0;\n\t\t\t\t\t\t} else if (transition == 6) {\n\t\t\t\t\t\t\t// bow start\n\t\t\t\t\t\t\tintervalTickStart = -1.0;\n\t\t\t\t\t\t} else if (transition == 7) {\n\t\t\t\t\t\t\t// blip start\n\t\t\t\t\t\t\ttransitionVolumeTickStart = 6.0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (tickTimeEnd == noteEnd) {\n\t\t\t\t\t\tif (transition == 0) {\n\t\t\t\t\t\t\t// seamless ending: fade out, unless adjacent to another note or at end of bar.\n\t\t\t\t\t\t\tif (nextNote == null && note.start + endPin.time != song.partsPerBeat * song.beatsPerBar) {\n\t\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (transition == 1 || transition == 2) {\n\t\t\t\t\t\t\t// sudden/smooth ending\n\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\n\t\t\t\t\t\t} else if (transition == 3) {\n\t\t\t\t\t\t\t// slide ending\n\t\t\t\t\t\t\tif (nextNote == null) {\n\t\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\n\t\t\t\t\t\t\t} else if (note.pins[note.pins.length-1].volume == 0 || nextNote.pins[0].volume == 0) {\n\t\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tintervalTickEnd = (nextNote.pitches[0] - note.pitches[0] + note.pins[note.pins.length-1].interval) * 0.5;\n\t\t\t\t\t\t\t\tdecayTimeTickEnd *= 0.5;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tintervalStart = intervalTickStart + (intervalTickEnd - intervalTickStart) * startRatio;\n\t\t\t\t\tintervalEnd   = intervalTickStart + (intervalTickEnd - intervalTickStart) * endRatio;\n\t\t\t\t\tenvelopeVolumeStart = synth.volumeConversion(envelopeVolumeTickStart + (envelopeVolumeTickEnd - envelopeVolumeTickStart) * startRatio);\n\t\t\t\t\tenvelopeVolumeEnd   = synth.volumeConversion(envelopeVolumeTickStart + (envelopeVolumeTickEnd - envelopeVolumeTickStart) * endRatio);\n\t\t\t\t\ttransitionVolumeStart = transitionVolumeTickStart + (transitionVolumeTickEnd - transitionVolumeTickStart) * startRatio;\n\t\t\t\t\ttransitionVolumeEnd   = transitionVolumeTickStart + (transitionVolumeTickEnd - transitionVolumeTickStart) * endRatio;\n\t\t\t\t\tpartTimeStart = note.start + partTimeTickStart + (partTimeTickEnd - partTimeTickStart) * startRatio;\n\t\t\t\t\tpartTimeEnd   = note.start + partTimeTickStart + (partTimeTickEnd - partTimeTickStart) * endRatio;\n\t\t\t\t\tdecayTimeStart = decayTimeTickStart + (decayTimeTickEnd - decayTimeTickStart) * startRatio;\n\t\t\t\t\tdecayTimeEnd   = decayTimeTickStart + (decayTimeTickEnd - decayTimeTickStart) * endRatio;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (pitches != null) {\n\t\t\t\tif (!isDrum && instrument.type == InstrumentType.fm) {\n\t\t\t\t\t// phase modulation!\n\t\t\t\t\t\n\t\t\t\t\tlet sineVolumeBoost: number = 1.0;\n\t\t\t\t\tlet totalCarrierVolume: number = 0.0;\n\t\t\t\t\t\n\t\t\t\t\tconst carrierCount: number = Config.operatorCarrierCounts[instrument.algorithm];\n\t\t\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\n\t\t\t\t\t\tconst isCarrier: boolean = i < Config.operatorCarrierCounts[instrument.algorithm];\n\t\t\t\t\t\tconst associatedCarrierIndex: number = Config.operatorAssociatedCarrier[instrument.algorithm][i] - 1;\n\t\t\t\t\t\tconst pitch: number = pitches[(i < pitches.length) ? i : ((associatedCarrierIndex < pitches.length) ? associatedCarrierIndex : 0)] + Config.octoffValues[instrument.octoff] + (song.detune / 24);\n\t\t\t\t\t\tconst freqMult = Config.operatorFrequencies[instrument.operators[i].frequency];\n\t\t\t\t\t\tconst chorusInterval = Config.operatorCarrierChorus[Config.fmChorusNames[instrument.fmChorus]][associatedCarrierIndex];\n\t\t\t\t\t\tconst startPitch: number = (pitch + intervalStart) * intervalScale + chorusInterval;\n\t\t\t\t\t\tconst startFreq: number = freqMult * (synth.frequencyFromPitch(basePitch + startPitch)) + Config.operatorHzOffsets[instrument.operators[i].frequency];\n\t\t\t\t\t\t\n\t\t\t\t\t\tsynthChannel.phaseDeltas[i] = startFreq * sampleTime * Config.sineWaveLength;\n\t\t\t\t\t\tif (resetPhases) synthChannel.reset();\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst amplitudeCurve: number = Synth.operatorAmplitudeCurve(instrument.operators[i].amplitude);\n\t\t\t\t\t\t// const amplitudeMult: number = amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency];\n\t\t\t\t\t\t// @TODO: Revisit\n\t\t\t\t\t\tlet amplitudeMult: number = 0;\n\t\t\t\t\t\tif ((Config.volumeValues[instrument.volume] != -1.0 && song.mix == 2) || (Config.volumeMValues[instrument.volume] != -1.0 && song.mix != 2)) {\n\t\t\t\t\t\t\tif (song.mix == 2) {\n\t\t\t\t\t\t\t\tamplitudeMult = isCarrier ? (amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency]) * (1 - Config.volumeValues[instrument.volume] / 2.3) : (amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tamplitudeMult = (amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency]) * (1 - Config.volumeMValues[instrument.volume] / 2.3);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (Config.volumeValues[instrument.volume] != -1.0) {\n\t\t\t\t\t\t\tamplitudeMult = 0;\n\t\t\t\t\t\t} else if (Config.volumeMValues[instrument.volume] != -1.0) {\n\t\t\t\t\t\t\tamplitudeMult = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet volumeStart: number = amplitudeMult * Config.imuteValues[instrument.imute];\n\t\t\t\t\t\tlet volumeEnd: number = amplitudeMult * Config.imuteValues[instrument.imute];\n\t\t\t\t\t\tsynthChannel.volumeLeft[0] = Math.min(1, 1 + Config.ipanValues[instrument.ipan]);\n\t\t\t\t\t\tsynthChannel.volumeRight[0] = Math.min(1, 1 - Config.ipanValues[instrument.ipan]);\n\t\t\t\t\t\tif (i < carrierCount) {\n\t\t\t\t\t\t\t// carrier\n\t\t\t\t\t\t\tconst volumeMult: number = 0.03;\n\t\t\t\t\t\t\t// The commented out portion in the line below fixes\n\t\t\t\t\t\t\t// the crackling heard when using FM chorus. It seems\n\t\t\t\t\t\t\t// that it was accidentally omitted in BeepBox 2.3.\n\t\t\t\t\t\t\tconst endPitch: number = (pitch + intervalEnd) * intervalScale/* + chorusInterval */;\n\t\t\t\t\t\t\tlet pitchVolumeStart: number = 0;\n\t\t\t\t\t\t\tlet pitchVolumeEnd: number = 0;\n\t\t\t\t\t\t\tif (song.mix == 3) {\n\t\t\t\t\t\t\t\tpitchVolumeStart = Math.pow(5.0, -startPitch / pitchDamping);\n\t\t\t\t\t\t\t\tpitchVolumeEnd   = Math.pow(5.0,   -endPitch / pitchDamping);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpitchVolumeStart = Math.pow(2.0, -startPitch / pitchDamping);\n\t\t\t\t\t\t\t\tpitchVolumeEnd   = Math.pow(2.0,   -endPitch / pitchDamping);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvolumeStart *= pitchVolumeStart * volumeMult * transitionVolumeStart;\n\t\t\t\t\t\t\tvolumeEnd *= pitchVolumeEnd * volumeMult * transitionVolumeEnd;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\ttotalCarrierVolume += amplitudeCurve;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// modulator\n\t\t\t\t\t\t\tvolumeStart *= Config.sineWaveLength * 1.5;\n\t\t\t\t\t\t\tvolumeEnd *= Config.sineWaveLength * 1.5;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tsineVolumeBoost *= 1.0 - Math.min(1.0, instrument.operators[i].amplitude / 15);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst envelope: number = instrument.operators[i].envelope;\n\t\t\t\t\t\t\n\t\t\t\t\t\tvolumeStart *= Synth.computeOperatorEnvelope(envelope, secondsPerPart * decayTimeStart, beatsPerPart * partTimeStart, envelopeVolumeStart);\n\t\t\t\t\t\tvolumeEnd *= Synth.computeOperatorEnvelope(envelope, secondsPerPart * decayTimeEnd, beatsPerPart * partTimeEnd, envelopeVolumeEnd);\n\t\t\t\t\t\t\n\t\t\t\t\t\tsynthChannel.volumeStarts[i] = volumeStart;\n\t\t\t\t\t\tsynthChannel.volumeDeltas[i] = (volumeEnd - volumeStart) / samples;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst feedbackAmplitude: number = Config.sineWaveLength * 0.3 * instrument.feedbackAmplitude / 15.0;\n\t\t\t\t\tlet feedbackStart: number = feedbackAmplitude * Synth.computeOperatorEnvelope(instrument.feedbackEnvelope, secondsPerPart * decayTimeStart, beatsPerPart * partTimeStart, envelopeVolumeStart);\n\t\t\t\t\tlet feedbackEnd: number = feedbackAmplitude * Synth.computeOperatorEnvelope(instrument.feedbackEnvelope, secondsPerPart * decayTimeEnd, beatsPerPart * partTimeEnd, envelopeVolumeEnd);\n\t\t\t\t\tsynthChannel.feedbackMult = feedbackStart;\n\t\t\t\t\tsynthChannel.feedbackDelta = (feedbackEnd - synthChannel.feedbackMult) / samples;\n\t\t\t\t\t\n\t\t\t\t\tsineVolumeBoost *= 1.0 - instrument.feedbackAmplitude / 15.0;\n\t\t\t\t\t\n\t\t\t\t\tsineVolumeBoost *= 1.0 - Math.min(1.0, Math.max(0.0, totalCarrierVolume - 1) / 2.0);\n\t\t\t\t\tfor (let i: number = 0; i < carrierCount; i++) {\n\t\t\t\t\t\tsynthChannel.volumeStarts[i] *= 1.0 + sineVolumeBoost * 3.0;\n\t\t\t\t\t\tsynthChannel.volumeDeltas[i] *= 1.0 + sineVolumeBoost * 3.0;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet pitch: number = pitches[0];\n\t\t\t\t\t// if (Config.chorusHarmonizes[instrument.chorus]) {\n\t\t\t\t\t// \tlet harmonyOffset: number = 0.0;\n\t\t\t\t\t// \tif (pitches.length == 2) {\n\t\t\t\t\t// \t\tharmonyOffset = pitches[1] - pitches[0];\n\t\t\t\t\t// \t} else if (pitches.length == 3) {\n\t\t\t\t\t// \t\tharmonyOffset = pitches[(arpeggio >> 1) + 1] - pitches[0];\n\t\t\t\t\t// \t} else if (pitches.length == 4) {\n\t\t\t\t\t// \t\tharmonyOffset = pitches[(arpeggio == 3 ? 1 : arpeggio) + 1] - pitches[0];\n\t\t\t\t\t// \t}\n\t\t\t\t\t// \tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\n\t\t\t\t\t// \tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\n\t\t\t\t\t// } else {\n\t\t\t\t\t// \tif (pitches.length == 2) {\n\t\t\t\t\t// \t\tpitch = pitches[arpeggio >> 1];\n\t\t\t\t\t// \t} else if (pitches.length == 3) {\n\t\t\t\t\t// \t\tpitch = pitches[arpeggio == 3 ? 1 : arpeggio];\n\t\t\t\t\t// \t} else if (pitches.length == 4) {\n\t\t\t\t\t// \t\tpitch = pitches[arpeggio];\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\t\t\t\t\tif (!isDrum) {\n\t\t\t\t\t\tif (Config.harmNames[instrument.harm] == 1) {\n\t\t\t\t\t\t\t// duet\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\n\t\t\t\t\t\t\tif (pitches.length == 2) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio >> 1) + 1] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio == 3 ? 1 : arpeggio) + 1] - pitches[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 2) {\n\t\t\t\t\t\t\t// chord\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\n\t\t\t\t\t\t\tif (pitches.length == 2) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[2] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio == 3 ? 2 : arpeggio) + 1] - pitches[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 3) {\n\t\t\t\t\t\t\t// seventh\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\n\t\t\t\t\t\t\tif (pitches.length == 2) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[2] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[3] - pitches[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 4) {\n\t\t\t\t\t\t\t// half arpeggio\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\n\t\t\t\t\t\t\tif (pitches.length == 2) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio >> 1) + 1] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio >> 1) + 2] - pitches[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 5) {\n\t\t\t\t\t\t\t// arp-chord\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\n\t\t\t\t\t\t\tif (pitches.length == 2) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[2] - pitches[0];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio == 3 ? 2 : arpeggio)] - pitches[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 0) {\n\t\t\t\t\t\t\t// arpeggio\n\t\t\t\t\t\t\tif (pitches.length == 2) {\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio >> 1];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio == 3 ? 1 : arpeggio];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (Config.harmNames[instrument.harm] == 0) {\n\t\t\t\t\t\t\t// arpeggio\n\t\t\t\t\t\t\tif (pitches.length == 1) {\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio >> 1] + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio == 3 ? 1 : arpeggio] + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio] + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 1) {\n\t\t\t\t\t\t\t// duet\n\t\t\t\t\t\t\tif (pitches.length == 1) {\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio >> 1) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio == 3 ? 1 : arpeggio) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 2) {\n\t\t\t\t\t\t\t// chord\n\t\t\t\t\t\t\tif (pitches.length == 1) {\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tpitch = (pitches[2] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio == 3 ? 2 : arpeggio) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 3) {\n\t\t\t\t\t\t\t// seventh\n\t\t\t\t\t\t\tif (pitches.length == 1) {\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tpitch = (pitches[2] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tpitch = (pitches[3] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 4) {\n\t\t\t\t\t\t\t// half arpeggio\n\t\t\t\t\t\t\tif (pitches.length == 1) {\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio >> 1) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\n\t\t\t\t\t\t\t\tpitch = pitches[(arpeggio >> 1) + 2] + pitches[0] + Config.octoffValues[instrument.octoff];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst startPitch: number = (pitch + intervalStart) * intervalScale;\n\t\t\t\t\tconst endPitch: number = (pitch + intervalEnd) * intervalScale;\n\t\t\t\t\tconst startFreq: number = synth.frequencyFromPitch(basePitch + startPitch);\n\t\t\t\t\tconst pitchVolumeStart: number = Math.pow(2.0, -startPitch / pitchDamping);\n\t\t\t\t\tconst pitchVolumeEnd: number   = Math.pow(2.0,   -endPitch / pitchDamping);\n\t\t\t\t\tif (isDrum && Config.drumWaveIsSoft[instrument.wave]) {\n\t\t\t\t\t\tsynthChannel.filter = Math.min(1.0, startFreq * sampleTime * Config.drumPitchFilterMult[instrument.wave]);\n\t\t\t\t\t}\n\t\t\t\t\tlet settingsVolumeMult: number;\n\t\t\t\t\tif (!isDrum) {\n\t\t\t\t\t\tconst filterScaleRate: number = Config.filterDecays[instrument.filter];\n\t\t\t\t\t\tsynthChannel.filter = Math.pow(2, -filterScaleRate * secondsPerPart * decayTimeStart);\n\t\t\t\t\t\tconst endFilter: number = Math.pow(2, -filterScaleRate * secondsPerPart * decayTimeEnd);\n\t\t\t\t\t\tsynthChannel.filterScale = Math.pow(endFilter / synthChannel.filter, 1.0 / samples);\n\t\t\t\t\t\tsettingsVolumeMult = 0.27 * 0.5 * Config.waveVolumes[instrument.wave] * Config.filterVolumes[instrument.filter] * Config.chorusVolumes[instrument.chorus];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (song.mix == 0) {\n\t\t\t\t\t\t\tsettingsVolumeMult = 0.19 * Config.drumVolumes[instrument.wave];\n\t\t\t\t\t\t} else if (song.mix == 3) {\n\t\t\t\t\t\t\tsettingsVolumeMult = 0.12 * Config.drumVolumes[instrument.wave];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsettingsVolumeMult = 0.09 * Config.drumVolumes[instrument.wave];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (resetPhases && !isDrum) {\n\t\t\t\t\t\tsynthChannel.reset();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tsynthChannel.phaseDeltas[0] = startFreq * sampleTime;\n\t\t\t\t\t\n\t\t\t\t\tlet instrumentVolumeMult: number = 0;\n\t\t\t\t\tif (song.mix == 2) {\n\t\t\t\t\t\tinstrumentVolumeMult = (instrument.volume == 9) ? 0.0 : Math.pow(3, -Config.volumeValues[instrument.volume]) * Config.imuteValues[instrument.imute];\n\t\t\t\t\t} else if (song.mix == 1) {\n\t\t\t\t\t\tinstrumentVolumeMult = (instrument.volume >= 5) ? 0.0 : Math.pow(3, -Config.volumeMValues[instrument.volume]) * Config.imuteValues[instrument.imute];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinstrumentVolumeMult = (instrument.volume >= 5) ? 0.0 : Math.pow(2, -Config.volumeMValues[instrument.volume]) * Config.imuteValues[instrument.imute];\n\t\t\t\t\t}\n\t\t\t\t\tsynthChannel.volumeStarts[0] = transitionVolumeStart * envelopeVolumeStart * pitchVolumeStart * settingsVolumeMult * instrumentVolumeMult;\n\t\t\t\t\tconst volumeEnd: number = transitionVolumeEnd * envelopeVolumeEnd * pitchVolumeEnd * settingsVolumeMult * instrumentVolumeMult;\n\t\t\t\t\tsynthChannel.volumeDeltas[0] = (volumeEnd - synthChannel.volumeStarts[0]) / samples;\n\t\t\t\t\tsynthChannel.volumeLeft[0] = Math.min(1, 1 + Config.ipanValues[instrument.ipan]);\n\t\t\t\t\tsynthChannel.volumeRight[0] = Math.min(1, 1 - Config.ipanValues[instrument.ipan]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tsynthChannel.phaseDeltaScale = Math.pow(2.0, ((intervalEnd - intervalStart) * intervalScale / 12.0) / samples);\n\t\t\t\tsynthChannel.vibratoScale = (partsSinceStart < Config.effectVibratoDelays[instrument.effect]) ? 0.0 : Math.pow(2.0, Config.effectVibratos[instrument.effect] / 12.0) - 1.0;\n\t\t\t} else {\n\t\t\t\t// @TODO: ModBox doesn't have this guard around .reset, why?\n\t\t\t\t// if (!isDrum) {\n\t\t\t\t\tsynthChannel.reset();\n\t\t\t\t// }\n\t\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\n\t\t\t\t\tsynthChannel.phaseDeltas[0] = 0.0;\n\t\t\t\t\tsynthChannel.volumeStarts[0] = 0.0;\n\t\t\t\t\tsynthChannel.volumeDeltas[0] = 0.0;\n\t\t\t\t\tsynthChannel.volumeLeft[0] = 0.0;\n\t\t\t\t\tsynthChannel.volumeRight[0] = 0.0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate static readonly generatedSynthesizers: Dictionary<Function> = {};\n\t\t\n\t\tprivate static getGeneratedSynthesizer(song: Song, bar: number): Function {\n\t\t\tconst fingerprint: string = song.getChannelFingerprint(bar);\n\t\t\tif (Synth.generatedSynthesizers[fingerprint] == undefined) {\n\t\t\t\tconst synthSource: string[] = [];\n\t\t\t\tconst instruments: Instrument[] = [];\n\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\n\t\t\t\t\tinstruments[channel] = song.channels[channel].instruments[song.getPatternInstrument(channel, bar)];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfor (const line of Synth.synthSourceTemplate) {\n\t\t\t\t\tif (line.indexOf(\"#\") != -1) {\n\t\t\t\t\t\tif (line.indexOf(\"// PITCH\") != -1) {\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\n\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (line.indexOf(\"// JCHIP\") != -1) {\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.chip) {\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (line.indexOf(\"// CHIP\") != -1) {\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.chip) {\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\n\t\t\t\t\t\t\t\t} else if (instruments[channel].type == InstrumentType.pwm) {\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (line.indexOf(\"// FM\") != -1) {\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.fm) {\n\t\t\t\t\t\t\t\t\tif (line.indexOf(\"$\") != -1) {\n\t\t\t\t\t\t\t\t\t\tfor (let j = 0; j < Config.operatorCount; j++) {\n\t\t\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\").replace(/\\$/g, j + \"\"));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (line.indexOf(\"// PWM\") != -1) {\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.pwm) {\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (line.indexOf(\"// CARRIER OUTPUTS\") != -1) {\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.fm) {\n\t\t\t\t\t\t\t\t\tconst outputs: string[] = [];\n\t\t\t\t\t\t\t\t\tfor (let j = 0; j < Config.operatorCarrierCounts[instruments[channel].algorithm]; j++) {\n\t\t\t\t\t\t\t\t\t\toutputs.push(\"channel\" + channel + \"Operator\" + j + \"Scaled\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\").replace(\"/*channel\" + channel + \"Operator$Scaled*/\", outputs.join(\" + \")));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (line.indexOf(\"// NOISE\") != -1) {\n\t\t\t\t\t\t\tfor (let channel = song.pitchChannelCount; channel < song.pitchChannelCount + song.drumChannelCount; channel++) {\n\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (line.indexOf(\"// ALL\") != -1) {\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount + song.drumChannelCount; channel++) {\n\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"Missing channel type annotation for line: \" + line);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (line.indexOf(\"// INSERT OPERATOR COMPUTATION HERE\") != -1) {\n\t\t\t\t\t\tfor (let j = Config.operatorCount - 1; j >= 0; j--) {\n\t\t\t\t\t\t\tfor (const operatorLine of Synth.operatorSourceTemplate) {\n\t\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\n\t\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.fm) {\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (operatorLine.indexOf(\"/* + channel#Operator@Scaled*/\") != -1) {\n\t\t\t\t\t\t\t\t\t\t\tlet modulators = \"\";\n\t\t\t\t\t\t\t\t\t\t\tfor (const modulatorNumber of Config.operatorModulatedBy[instruments[channel].algorithm][j]) {\n\t\t\t\t\t\t\t\t\t\t\t\tmodulators += \" + channel\" + channel + \"Operator\" + (modulatorNumber - 1) + \"Scaled\";\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\tconst feedbackIndices: ReadonlyArray<number> = Config.operatorFeedbackIndices[instruments[channel].feedbackType][j];\n\t\t\t\t\t\t\t\t\t\t\tif (feedbackIndices.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tmodulators += \" + channel\" + channel + \"FeedbackMult * (\";\n\t\t\t\t\t\t\t\t\t\t\t\tconst feedbacks: string[] = [];\n\t\t\t\t\t\t\t\t\t\t\t\tfor (const modulatorNumber of feedbackIndices) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfeedbacks.push(\"channel\" + channel + \"Operator\" + (modulatorNumber - 1) + \"Output\");\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tmodulators += feedbacks.join(\" + \") + \")\";\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tsynthSource.push(operatorLine.replace(/#/g, channel + \"\").replace(/\\$/g, j + \"\").replace(\"/* + channel\" + channel + \"Operator@Scaled*/\", modulators));\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tsynthSource.push(operatorLine.replace(/#/g, channel + \"\").replace(/\\$/g, j + \"\"));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsynthSource.push(line);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//console.log(synthSource.join(\"\\n\"));\n\t\t\t\t\n\t\t\t\tSynth.generatedSynthesizers[fingerprint] = new Function(\"synth\", \"song\", \"dataLeft\", \"dataRight\", \"bufferLength\", \"bufferIndex\", \"samplesPerArpeggio\", synthSource.join(\"\\n\"));\n\t\t\t}\n\t\t\treturn Synth.generatedSynthesizers[fingerprint];\n\t\t}\n\n\t\tprivate static synthSourceTemplate: string[] = (`\n\t\t\tvar sampleTime = 1.0 / synth.samplesPerSecond;\n\t\t\tvar effectYMult = +synth.effectYMult;\n\t\t\tvar limitDecay = +synth.limitDecay;\n\t\t\tvar volume = +synth.volume;\n\t\t\tvar delayLineLeft = synth.delayLineLeft;\n\t\t\tvar delayLineRight = synth.delayLineRight;\n\t\t\tvar reverb = Math.pow(song.reverb / beepbox.Config.reverbRange, 0.667) * 0.425;\n\t\t\tvar blend = Math.pow(song.blend / beepbox.Config.blendRange, 0.667) * 0.425;\n\t\t\tvar mix = song.mix;\n\t\t\tvar muff = Math.pow(song.muff / beepbox.Config.muffRange, 0.667) * 0.425;\n\t\t\tvar detune = song.detune;\n\t\t\tvar riff = Math.pow(song.riff / beepbox.Config.riffRange, 0.667) * 0.425; \n\t\t\tvar sineWave = beepbox.Config.sineWave;\n\t\t\t\n\t\t\t// Initialize instruments based on current pattern.\n\t\t\tvar instrumentChannel# = song.getPatternInstrument(#, synth.bar); // ALL\n\t\t\tvar instrument# = song.channels[#].instruments[instrumentChannel#]; // ALL\n\t\t\tvar channel#Wave = (mix <= 1) ? beepbox.Config.waves[instrument#.wave] : beepbox.Config.wavesMixC[instrument#.wave]; // CHIP\n\t\t\tvar channel#Wave = beepbox.Config.getDrumWave(instrument#.wave); // NOISE\n\t\t\tvar channel#WaveLength = channel#Wave.length; // CHIP\n\t\t\tvar channel#Wave = beepbox.Config.pwmwaves[instrument#.wave]; // PWM\n\t\t\tvar channel#WaveLength = channel#Wave.length; // PWM\n\t\t\tvar channel#FilterBase = (song.mix == 2) ? Math.pow(2 - (blend * 2) + (muff * 2), -beepbox.Config.filterBases[instrument#.filter]) : Math.pow(2, -beepbox.Config.filterBases[instrument#.filter] + (blend * 4) - (muff * 4)); // CHIP\n\t\t\tvar channel#TremoloScale = beepbox.Config.effectTremolos[instrument#.effect]; // PITCH\n\t\t\t\n\t\t\twhile (bufferIndex < bufferLength) {\n\t\t\t\t\n\t\t\t\tvar samples;\n\t\t\t\tvar samplesLeftInBuffer = bufferLength - bufferIndex;\n\t\t\t\tif (synth.arpeggioSampleCountdown <= samplesLeftInBuffer) {\n\t\t\t\t\tsamples = synth.arpeggioSampleCountdown;\n\t\t\t\t} else {\n\t\t\t\t\tsamples = samplesLeftInBuffer;\n\t\t\t\t}\n\t\t\t\tsynth.arpeggioSampleCountdown -= samples;\n\t\t\t\t\n\t\t\t\tvar time = synth.part + synth.beat * song.partsPerBeat;\n\t\t\t\t\n\t\t\t\tbeepbox.Synth.computeChannelInstrument(synth, song, #, time, sampleTime, samplesPerArpeggio, samples); // ALL\n\t\t\t\tvar synthChannel# = synth.channels[#]; // ALL\n\t\t\t\t\n\t\t\t\tvar channel#ChorusA = Math.pow(2.0, (beepbox.Config.chorusOffsets[instrument#.chorus] + beepbox.Config.chorusIntervals[instrument#.chorus] + beepbox.Config.octoffValues[instrument#.octoff] + (detune / 24) * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1)) / 12.0); // CHIP\n\t\t\t\tvar channel#ChorusB = Math.pow(2.0, (beepbox.Config.chorusOffsets[instrument#.chorus] - beepbox.Config.chorusIntervals[instrument#.chorus] + beepbox.Config.octoffValues[instrument#.octoff] + (detune / 24) * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1)) / 12.0); // CHIP\n\t\t\t\tvar channel#ChorusSign = synthChannel#.harmonyVolumeMult * (beepbox.Config.chorusSigns[instrument#.chorus]); // CHIP\n\t\t\t\tchannel#ChorusB *= synthChannel#.harmonyMult; // CHIP\n\t\t\t\tvar channel#ChorusDeltaRatio = channel#ChorusB / channel#ChorusA * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1); // CHIP\n\t\t\t\t\n\t\t\t\tvar channel#PhaseDelta = synthChannel#.phaseDeltas[0] * channel#ChorusA * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1); // CHIP\n\t\t\t\tvar channel#PhaseDelta = synthChannel#.phaseDeltas[0] / 32768.0; // NOISE\n\t\t\t\tvar channel#PhaseDeltaScale = synthChannel#.phaseDeltaScale; // ALL\n\t\t\t\tvar channel#Volume = synthChannel#.volumeStarts[0]; // CHIP\n\t\t\t\tvar channel#Volume = synthChannel#.volumeStarts[0]; // NOISE\n\t\t\t\tvar channel#VolumeLeft = synthChannel#.volumeLeft[0]; // ALL\n\t\t\t\tvar channel#VolumeRight = synthChannel#.volumeRight[0]; // ALL\n\t\t\t\tvar channel#VolumeDelta = synthChannel#.volumeDeltas[0]; // CHIP\n\t\t\t\tvar channel#VolumeDelta = synthChannel#.volumeDeltas[0]; // NOISE\n\t\t\t\tvar channel#Filter = synthChannel#.filter * channel#FilterBase; // CHIP\n\t\t\t\tvar channel#Filter = synthChannel#.filter; // NOISE\n\t\t\t\tvar channel#FilterScale = synthChannel#.filterScale; // CHIP\n\t\t\t\tvar channel#VibratoScale = synthChannel#.vibratoScale; // PITCH\n\t\t\t\t\n\t\t\t\tvar effectY     = Math.sin(synth.effectPhase);\n\t\t\t\tvar prevEffectY = Math.sin(synth.effectPhase - synth.effectAngle);\n\t\t\t\t\n\t\t\t\tvar channel#PhaseA = synth.channels[#].phases[0] % 1; // CHIP\n\t\t\t\tvar channel#PhaseB = synth.channels[#].phases[1] % 1; // CHIP\n\t\t\t\tvar channel#Phase  = synth.channels[#].phases[0] % 1; // NOISE\n\t\t\t\t\n\t\t\t\tvar channel#Operator$Phase       = ((synth.channels[#].phases[$] % 1) + ` + Synth.negativePhaseGuard + `) * ` + Config.sineWaveLength + `; // FM\n\t\t\t\tvar channel#Operator$PhaseDelta  = synthChannel#.phaseDeltas[$]; // FM\n\t\t\t\tvar channel#Operator$OutputMult  = synthChannel#.volumeStarts[$]; // FM\n\t\t\t\tvar channel#Operator$OutputDelta = synthChannel#.volumeDeltas[$]; // FM\n\t\t\t\tvar channel#Operator$Output      = synthChannel#.feedbackOutputs[$]; // FM\n\t\t\t\tvar channel#FeedbackMult         = synthChannel#.feedbackMult; // FM\n\t\t\t\tvar channel#FeedbackDelta        = synthChannel#.feedbackDelta; // FM\n\t\t\t\t\n\t\t\t\tvar channel#SampleLeft = +synth.channels[#].sampleLeft; // ALL\n\t\t\t\tvar channel#SampleRight = +synth.channels[#].sampleRight; // ALL\n\t\t\t\t\n\t\t\t\tvar delayPosLeft = 0|synth.delayPosLeft;\n\t\t\t\tvar delayFeedback0Left = +synth.delayFeedback0Left;\n\t\t\t\tvar delayFeedback1Left = +synth.delayFeedback1Left;\n\t\t\t\tvar delayFeedback2Left = +synth.delayFeedback2Left;\n\t\t\t\tvar delayFeedback3Left = +synth.delayFeedback3Left;\n\t\t\t\tvar delayPosRight = 0|synth.delayPosRight;\n\t\t\t\tvar delayFeedback0Right = +synth.delayFeedback0Right;\n\t\t\t\tvar delayFeedback1Right = +synth.delayFeedback1Right;\n\t\t\t\tvar delayFeedback2Right = +synth.delayFeedback2Right;\n\t\t\t\tvar delayFeedback3Right = +synth.delayFeedback3Right;\n\t\t\t\tvar limit = +synth.limit;\n\t\t\t\t\n\t\t\t\twhile (samples) {\n\t\t\t\t\tvar channel#Vibrato = 1.0 + channel#VibratoScale * effectY; // PITCH\n\t\t\t\t\tvar channel#Tremolo = 1.0 + channel#TremoloScale * (effectY - 1.0); // PITCH\n\t\t\t\t\tvar temp = effectY;\n\t\t\t\t\teffectY = effectYMult * effectY - prevEffectY;\n\t\t\t\t\tprevEffectY = temp;\n\t\t\t\t\t\n\t\t\t\t\tchannel#SampleLeft += ((channel#Wave[0|(channel#PhaseA * channel#WaveLength)] + channel#Wave[0|(channel#PhaseB * channel#WaveLength)] * channel#ChorusSign) * channel#Volume * channel#Tremolo - channel#SampleLeft) * channel#Filter * channel#VolumeLeft; // CHIP \n\t\t\t\t\tchannel#SampleLeft += (channel#Wave[0|(channel#Phase * 32768.0)] * channel#Volume - channel#SampleLeft) * channel#Filter * channel#VolumeLeft; // NOISE\n\t\t\t\t\tchannel#SampleRight += ((channel#Wave[0|(channel#PhaseA * channel#WaveLength)] + channel#Wave[0|(channel#PhaseB * channel#WaveLength)] * channel#ChorusSign) * channel#Volume * channel#Tremolo - channel#SampleRight) * channel#Filter * channel#VolumeRight; // CHIP \n\t\t\t\t\tchannel#SampleRight += (channel#Wave[0|(channel#Phase * 32768.0)] * channel#Volume - channel#SampleRight) * channel#Filter * channel#VolumeRight; // NOISE\n\t\t\t\t\tchannel#Volume += channel#VolumeDelta; // CHIP\n\t\t\t\t\tchannel#Volume += channel#VolumeDelta; // NOISE\n\t\t\t\t\tchannel#PhaseA += channel#PhaseDelta * channel#Vibrato; // CHIP\n\t\t\t\t\tchannel#PhaseB += channel#PhaseDelta * channel#Vibrato * channel#ChorusDeltaRatio; // CHIP\n\t\t\t\t\tchannel#Phase += channel#PhaseDelta; // NOISE\n\t\t\t\t\tchannel#Filter *= channel#FilterScale; // CHIP\n\t\t\t\t\tchannel#PhaseA -= 0|channel#PhaseA; // CHIP\n\t\t\t\t\tchannel#PhaseB -= 0|channel#PhaseB; // CHIP\n\t\t\t\t\tchannel#Phase -= 0|channel#Phase; // NOISE\n\t\t\t\t\tchannel#PhaseDelta *= channel#PhaseDeltaScale; // CHIP\n\t\t\t\t\tchannel#PhaseDelta *= channel#PhaseDeltaScale; // NOISE\n\t\t\t\t\t\n\t\t\t\t\t// INSERT OPERATOR COMPUTATION HERE\n\t\t\t\t\tchannel#SampleLeft = channel#Tremolo * (/*channel#Operator$Scaled*/) * channel#VolumeLeft; // CARRIER OUTPUTS\n\t\t\t\t\tchannel#SampleRight = channel#Tremolo * (/*channel#Operator$Scaled*/) * channel#VolumeRight; // CARRIER OUTPUTS\n\t\t\t\t\tchannel#FeedbackMult += channel#FeedbackDelta; // FM\n\t\t\t\t\tchannel#Operator$OutputMult += channel#Operator$OutputDelta; // FM\n\t\t\t\t\tchannel#Operator$Phase += channel#Operator$PhaseDelta * channel#Vibrato; // FM\n\t\t\t\t\tchannel#Operator$PhaseDelta *= channel#PhaseDeltaScale; // FM\n\t\t\t\t\t\n\t\t\t\t\t// Reverb, implemented using a feedback delay network with a Hadamard matrix and lowpass filters.\n\t\t\t\t\t// good ratios:    0.555235 + 0.618033 + 0.818 +   1.0 = 2.991268\n\t\t\t\t\t// Delay lengths:  3041     + 3385     + 4481  +  5477 = 16384 = 2^14\n\t\t\t\t\t// Buffer offsets: 3041    -> 6426   -> 10907 -> 16384\n\t\t\t\t\tvar delayPos1Left = (delayPosLeft +  3041) & 0x3FFF;\n\t\t\t\t\tvar delayPos2Left = (delayPosLeft +  6426) & 0x3FFF;\n\t\t\t\t\tvar delayPos3Left = (delayPosLeft + 10907) & 0x3FFF;\n\t\t\t\t\tvar delaySampleLeft0 = (delayLineLeft[delayPosLeft]\n\t\t\t\t\t\t+ channel#SampleLeft // PITCH\n\t\t\t\t\t);\n\t\t\t\t\tvar delayPos1Right = (delayPosRight +  3041) & 0x3FFF;\n\t\t\t\t\tvar delayPos2Right = (delayPosRight +  6426) & 0x3FFF;\n\t\t\t\t\tvar delayPos3Right = (delayPosRight + 10907) & 0x3FFF;\n\t\t\t\t\tvar delaySampleRight0 = (delayLineRight[delayPosRight]\n\t\t\t\t\t\t+ channel#SampleRight // PITCH\n\t\t\t\t\t);\n\t\t\t\t\tvar delaySampleLeft1 = delayLineLeft[delayPos1Left];\n\t\t\t\t\tvar delaySampleLeft2 = delayLineLeft[delayPos2Left];\n\t\t\t\t\tvar delaySampleLeft3 = delayLineLeft[delayPos3Left];\n\t\t\t\t\tvar delayTemp0Left = -delaySampleLeft0 + delaySampleLeft1;\n\t\t\t\t\tvar delayTemp1Left = -delaySampleLeft0 - delaySampleLeft1;\n\t\t\t\t\tvar delayTemp2Left = -delaySampleLeft2 + delaySampleLeft3;\n\t\t\t\t\tvar delayTemp3Left = -delaySampleLeft2 - delaySampleLeft3;\n\t\t\t\t\tdelayFeedback0Left += ((delayTemp0Left + delayTemp2Left) * reverb - delayFeedback0Left) * 0.5;\n\t\t\t\t\tdelayFeedback1Left += ((delayTemp1Left + delayTemp3Left) * reverb - delayFeedback1Left) * 0.5;\n\t\t\t\t\tdelayFeedback2Left += ((delayTemp0Left - delayTemp2Left) * reverb - delayFeedback2Left) * 0.5;\n\t\t\t\t\tdelayFeedback3Left += ((delayTemp1Left - delayTemp3Left) * reverb - delayFeedback3Left) * 0.5;\n\t\t\t\t\tdelayLineLeft[delayPos1Left] = delayFeedback0Left;\n\t\t\t\t\tdelayLineLeft[delayPos2Left] = delayFeedback1Left;\n\t\t\t\t\tdelayLineLeft[delayPos3Left] = delayFeedback2Left;\n\t\t\t\t\tdelayLineLeft[delayPosLeft ] = delayFeedback3Left;\n\t\t\t\t\tdelayPosLeft = (delayPosLeft + 1) & 0x3FFF;\n\t\t\t\t\t\n\t\t\t\t\tvar delaySampleRight1 = delayLineRight[delayPos1Right];\n\t\t\t\t\tvar delaySampleRight2 = delayLineRight[delayPos2Right];\n\t\t\t\t\tvar delaySampleRight3 = delayLineRight[delayPos3Right];\n\t\t\t\t\tvar delayTemp0Right = -delaySampleRight0 + delaySampleRight1;\n\t\t\t\t\tvar delayTemp1Right = -delaySampleRight0 - delaySampleRight1;\n\t\t\t\t\tvar delayTemp2Right = -delaySampleRight2 + delaySampleRight3;\n\t\t\t\t\tvar delayTemp3Right = -delaySampleRight2 - delaySampleRight3;\n\t\t\t\t\tdelayFeedback0Right += ((delayTemp0Right + delayTemp2Right) * reverb - delayFeedback0Right) * 0.5;\n\t\t\t\t\tdelayFeedback1Right += ((delayTemp1Right + delayTemp3Right) * reverb - delayFeedback1Right) * 0.5;\n\t\t\t\t\tdelayFeedback2Right += ((delayTemp0Right - delayTemp2Right) * reverb - delayFeedback2Right) * 0.5;\n\t\t\t\t\tdelayFeedback3Right += ((delayTemp1Right - delayTemp3Right) * reverb - delayFeedback3Right) * 0.5;\n\t\t\t\t\tdelayLineRight[delayPos1Right] = delayFeedback0Right;\n\t\t\t\t\tdelayLineRight[delayPos2Right] = delayFeedback1Right;\n\t\t\t\t\tdelayLineRight[delayPos3Right] = delayFeedback2Right;\n\t\t\t\t\tdelayLineRight[delayPosRight ] = delayFeedback3Right;\n\t\t\t\t\tdelayPosRight = (delayPosRight + 1) & 0x3FFF;\n\t\t\t\t\t\n\t\t\t\t\tvar sampleLeft = delaySampleLeft0 + delaySampleLeft1 + delaySampleLeft2 + delaySampleLeft3\n\t\t\t\t\t\t+ channel#SampleLeft // NOISE\n\t\t\t\t\t;\n\t\t\t\t\t\n\t\t\t\t\tvar sampleRight = delaySampleRight0 + delaySampleRight1 + delaySampleRight2 + delaySampleRight3\n\t\t\t\t\t\t+ channel#SampleRight // NOISE\n\t\t\t\t\t;\n\t\t\t\t\t\n\t\t\t\t\tvar abs = sampleLeft < 0.0 ? -sampleLeft : sampleLeft;\n\t\t\t\t\tlimit -= limitDecay;\n\t\t\t\t\tif (limit < abs) limit = abs;\n\t\t\t\t\tsampleLeft /= limit * 0.75 + 0.25;\n\t\t\t\t\tsampleLeft *= volume;\n\t\t\t\t\tsampleLeft = sampleLeft;\n\t\t\t\t\tdataLeft[bufferIndex] = sampleLeft;\n\t\t\t\t\tsampleRight /= limit * 0.75 + 0.25;\n\t\t\t\t\tsampleRight *= volume;\n\t\t\t\t\tsampleRight = sampleRight;\n\t\t\t\t\tdataRight[bufferIndex] = sampleRight;\n\t\t\t\t\tbufferIndex++;\n\t\t\t\t\tsamples--;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tsynthChannel#.phases[0] = channel#PhaseA; // CHIP\n\t\t\t\tsynthChannel#.phases[1] = channel#PhaseB; // CHIP\n\t\t\t\tsynthChannel#.phases[0] = channel#Phase; // NOISE\n\t\t\t\tsynthChannel#.phases[$] = channel#Operator$Phase / ` + Config.sineWaveLength + `; // FM\n\t\t\t\tsynthChannel#.feedbackOutputs[$] = channel#Operator$Output; // FM\n\t\t\t\tsynthChannel#.sampleLeft = channel#SampleLeft; // ALL\n\t\t\t\tsynthChannel#.sampleRight = channel#SampleRight; // ALL\n\t\t\t\t\n\t\t\t\tsynth.delayPosLeft = delayPosLeft;\n\t\t\t\tsynth.delayFeedback0Left = delayFeedback0Left;\n\t\t\t\tsynth.delayFeedback1Left = delayFeedback1Left;\n\t\t\t\tsynth.delayFeedback2Left = delayFeedback2Left;\n\t\t\t\tsynth.delayFeedback3Left = delayFeedback3Left;\n\t\t\t\tsynth.delayPosRight = delayPosRight;\n\t\t\t\tsynth.delayFeedback0Right = delayFeedback0Right;\n\t\t\t\tsynth.delayFeedback1Right = delayFeedback1Right;\n\t\t\t\tsynth.delayFeedback2Right = delayFeedback2Right;\n\t\t\t\tsynth.delayFeedback3Right = delayFeedback3Right;\n\t\t\t\tsynth.limit = limit;\n\t\t\t\t\n\t\t\t\tif (effectYMult * effectY - prevEffectY > prevEffectY) {\n\t\t\t\t\tsynth.effectPhase = Math.asin(effectY);\n\t\t\t\t} else {\n\t\t\t\t\tsynth.effectPhase = Math.PI - Math.asin(effectY);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (synth.arpeggioSampleCountdown == 0) {\n\t\t\t\t\tsynth.arpeggio++;\n\t\t\t\t\tsynth.arpeggioSampleCountdown = samplesPerArpeggio;\n\t\t\t\t\tif (synth.arpeggio == 4) {\n\t\t\t\t\t\tsynth.arpeggio = 0;\n\t\t\t\t\t\tsynth.part++;\n\t\t\t\t\t\tif (synth.part == song.partsPerBeat) {\n\t\t\t\t\t\t\tsynth.part = 0;\n\t\t\t\t\t\t\tsynth.beat++;\n\t\t\t\t\t\t\tif (synth.beat == song.beatsPerBar) {\n\t\t\t\t\t\t\t\t// The bar ended, may need to regenerate synthesizer.\n\t\t\t\t\t\t\t\treturn bufferIndex;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Indicate that the buffer is finished generating.\n\t\t\treturn -1;\n\t\t`).split(\"\\n\");\n\t\t\n\t\tprivate static operatorSourceTemplate: string[] = (`\n\t\t\t\t\t\tvar channel#Operator$PhaseMix = channel#Operator$Phase/* + channel#Operator@Scaled*/;\n\t\t\t\t\t\tvar channel#Operator$PhaseInt = channel#Operator$PhaseMix|0;\n\t\t\t\t\t\tvar channel#Operator$Index    = channel#Operator$PhaseInt & ` + Config.sineWaveMask + `;\n\t\t\t\t\t\tvar channel#Operator$Sample   = sineWave[channel#Operator$Index];\n\t\t\t\t\t\tchannel#Operator$Output       = channel#Operator$Sample + (sineWave[channel#Operator$Index + 1] - channel#Operator$Sample) * (channel#Operator$PhaseMix - channel#Operator$PhaseInt);\n\t\t\t\t\t\tvar channel#Operator$Scaled   = channel#Operator$OutputMult * channel#Operator$Output;\n\t\t`).split(\"\\n\");\n\t\t\n\t\tprivate frequencyFromPitch(pitch: number): number {\n\t\t\treturn 440.0 * Math.pow(2.0, (pitch - 69.0) / 12.0);\n\t\t}\n\t\t\n\t\tprivate volumeConversion(noteVolume: number): number {\n\t\t\treturn Math.pow(noteVolume / 3.0, 1.5);\n\t\t}\n\t\t\n\t\tprivate getSamplesPerArpeggio(): number {\n\t\t\tif (this.song == null) return 0;\n\t\t\tconst beatsPerMinute: number = this.song.getBeatsPerMinute();\n\t\t\tconst beatsPerSecond: number = beatsPerMinute / 60.0;\n\t\t\tconst partsPerSecond: number = beatsPerSecond * this.song.partsPerBeat;\n\t\t\tconst arpeggioPerSecond: number = partsPerSecond * 4.0;\n\t\t\treturn Math.floor(this.samplesPerSecond / arpeggioPerSecond);\n\t\t}\n\t}\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\n\n\texport class Change {\n\t\tprivate _noop: boolean = true;\n\t\t\n\t\tprotected _didSomething(): void {\n\t\t\tthis._noop = false;\n\t\t}\n\t\t\n\t\tpublic isNoop(): boolean {\n\t\t\treturn this._noop;\n\t\t}\n\t}\n\t\n\texport class UndoableChange extends Change {\n\t\tprivate _reversed: boolean;\n\t\tprivate _doneForwards: boolean;\n\t\tconstructor(reversed: boolean) {\n\t\t\tsuper();\n\t\t\tthis._reversed = reversed;\n\t\t\tthis._doneForwards = !reversed;\n\t\t}\n\t\t\n\t\tpublic undo(): void {\n\t\t\tif (this._reversed) {\n\t\t\t\tthis._doForwards();\n\t\t\t\tthis._doneForwards = true;\n\t\t\t} else {\n\t\t\t\tthis._doBackwards();\n\t\t\t\tthis._doneForwards = false;\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic redo(): void {\n\t\t\tif (this._reversed) {\n\t\t\t\tthis._doBackwards();\n\t\t\t\tthis._doneForwards = false;\n\t\t\t} else {\n\t\t\t\tthis._doForwards();\n\t\t\t\tthis._doneForwards = true;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// isDoneForwards() returns whether or not the Change was most recently \n\t\t// performed forwards or backwards. If the change created something, do not \n\t\t// delete it in the change destructor unless the Change was performed \n\t\t// backwards: \n\t\tprotected _isDoneForwards(): boolean {\n\t\t\treturn this._doneForwards;\n\t\t}\n\t\t\n\t\tprotected _doForwards(): void {\n\t\t\tthrow new Error(\"Change.doForwards(): Override me.\");\n\t\t}\n\t\t\n\t\tprotected _doBackwards(): void {\n\t\t\tthrow new Error(\"Change.doBackwards(): Override me.\");\n\t\t}\n\t}\n\t\n\texport class ChangeGroup extends Change {\n\t\tconstructor() {\n\t\t\tsuper();\n\t\t}\n\t\t\n\t\tpublic append(change: Change): void {\n\t\t\tif (change.isNoop()) return;\n\t\t\tthis._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeSequence extends UndoableChange {\n\t\tprivate _changes: UndoableChange[];\n\t\tconstructor(changes?: UndoableChange[]) {\n\t\t\tsuper(false);\n\t\t\tif (changes == undefined) {\n\t\t\t\tthis._changes = [];\n\t\t\t} else {\n\t\t\t\tthis._changes = changes.concat();\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic append(change: UndoableChange): void {\n\t\t\tif (change.isNoop()) return;\n\t\t\tthis._changes[this._changes.length] = change;\n\t\t\tthis._didSomething();\n\t\t}\n\t\t\n\t\tprotected _doForwards(): void {\n\t\t\tfor (let i: number = 0; i < this._changes.length; i++) {\n\t\t\t\tthis._changes[i].redo();\n\t\t\t}\n\t\t}\n\t\t\n\t\tprotected _doBackwards(): void {\n\t\t\tfor (let i: number = this._changes.length-1; i >= 0 ; i--) {\n\t\t\t\tthis._changes[i].undo();\n\t\t\t}\n\t\t}\n\t}\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { SongDocument } from \"./SongDocument\";\nimport { Change, UndoableChange, ChangeSequence, ChangeGroup } from \"./Change\";\nimport { NotePin, Note, Instrument, Channel, Pattern, makeNotePin, Song } from \"../synth/synth\";\nimport { InstrumentType, Config } from \"../synth/SynthConfig\";\n\n\texport class ChangePins extends UndoableChange {\n\t\tprotected _oldStart: number;\n\t\tprotected _newStart: number;\n\t\tprotected _oldEnd: number;\n\t\tprotected _newEnd: number;\n\t\tprotected _oldPins: NotePin[];\n\t\tprotected _newPins: NotePin[];\n\t\tprotected _oldPitches: number[];\n\t\tprotected _newPitches: number[];\n\t\tconstructor(protected _doc: SongDocument, protected _note: Note) {\n\t\t\tsuper(false);\n\t\t\tthis._oldStart = this._note.start;\n\t\t\tthis._oldEnd   = this._note.end;\n\t\t\tthis._newStart = this._note.start;\n\t\t\tthis._newEnd   = this._note.end;\n\t\t\tthis._oldPins = this._note.pins;\n\t\t\tthis._newPins = [];\n\t\t\tthis._oldPitches = this._note.pitches;\n\t\t\tthis._newPitches = [];\n\t\t}\n\t\t\n\t\tprotected _finishSetup(): void {\n\t\t\tfor (let i: number = 0; i < this._newPins.length - 1; ) {\n\t\t\t\tif (this._newPins[i].time >= this._newPins[i+1].time) {\n\t\t\t\t\tthis._newPins.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfor (let i: number = 1; i < this._newPins.length - 1; ) {\n\t\t\t\tif (this._newPins[i-1].interval == this._newPins[i].interval && \n\t\t\t\t    this._newPins[i].interval == this._newPins[i+1].interval && \n\t\t\t\t    this._newPins[i-1].volume == this._newPins[i].volume && \n\t\t\t\t    this._newPins[i].volume == this._newPins[i+1].volume)\n\t\t\t\t{\n\t\t\t\t\tthis._newPins.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tconst firstInterval: number = this._newPins[0].interval;\n\t\t\tconst firstTime: number = this._newPins[0].time;\n\t\t\tfor (let i: number = 0; i < this._oldPitches.length; i++) {\n\t\t\t\tthis._newPitches[i] = this._oldPitches[i] + firstInterval;\n\t\t\t}\n\t\t\tfor (let i: number = 0; i < this._newPins.length; i++) {\n\t\t\t\tthis._newPins[i].interval -= firstInterval;\n\t\t\t\tthis._newPins[i].time -= firstTime;\n\t\t\t}\n\t\t\tthis._newStart = this._oldStart + firstTime;\n\t\t\tthis._newEnd   = this._newStart + this._newPins[this._newPins.length-1].time;\n\t\t\t\n\t\t\tthis._doForwards();\n\t\t\tthis._didSomething();\n\t\t}\n\t\t\n\t\tprotected _doForwards(): void {\n\t\t\tthis._note.pins = this._newPins;\n\t\t\tthis._note.pitches = this._newPitches;\n\t\t\tthis._note.start = this._newStart;\n\t\t\tthis._note.end = this._newEnd;\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t\t\n\t\tprotected _doBackwards(): void {\n\t\t\tthis._note.pins = this._oldPins;\n\t\t\tthis._note.pitches = this._oldPitches;\n\t\t\tthis._note.start = this._oldStart;\n\t\t\tthis._note.end = this._oldEnd;\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t}\n\t\n\texport class ChangeInstrumentType extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].type;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].type = newValue;\n\t\t\t\tif (newValue == InstrumentType.chip) {\n\t\t\t\t\t// This is technically not necessary, so long as there are\n\t\t\t\t\t// more chip waves than pwm waves, but might as well have\n\t\t\t\t\t// it here for safety.\n\t\t\t\t\tconst instrument: Instrument = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()];\n\t\t\t\t\tinstrument.wave = Math.max(0, Math.min(Config.waves.length - 1, instrument.wave));\n\t\t\t\t} else if (newValue == InstrumentType.pwm) {\n\t\t\t\t\t// When going from chip to pwm, if there are more chip\n\t\t\t\t\t// waves than pwm waves, .wave can be invalid.\n\t\t\t\t\tconst instrument: Instrument = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()];\n\t\t\t\t\tinstrument.wave = Math.max(0, Math.min(Config.pwmwaves.length - 1, instrument.wave));\n\t\t\t\t}\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeTransition extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].transition;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tthis._didSomething();\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].transition = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangePattern extends Change {\n\t\tconstructor(doc: SongDocument, public oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (newValue > doc.song.patternsPerChannel) throw new Error(\"invalid pattern\");\n\t\t\tdoc.song.channels[doc.channel].bars[doc.bar] = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeBarCount extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.barCount != newValue) {\n\t\t\t\tfor (let channel: number = 0; channel < doc.song.getChannelCount(); channel++) {\n\t\t\t\t\tfor (let bar: number = doc.song.barCount; bar < newValue; bar++) {\n\t\t\t\t\t\tdoc.song.channels[channel].bars[bar] = 0;\n\t\t\t\t\t}\n\t\t\t\t\tdoc.song.channels[channel].bars.length = newValue;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlet newBar: number = doc.bar;\n\t\t\t\tlet newBarScrollPos: number = doc.barScrollPos;\n\t\t\t\tlet newLoopStart: number = doc.song.loopStart;\n\t\t\t\tlet newLoopLength: number = doc.song.loopLength;\n\t\t\t\tif (doc.song.barCount > newValue) {\n\t\t\t\t\tnewBar = Math.min(newBar, newValue - 1);\n\t\t\t\t\tnewBarScrollPos = Math.max(0, Math.min(newValue - doc.trackVisibleBars, newBarScrollPos));\n\t\t\t\t\tnewLoopLength = Math.min(newValue, newLoopLength);\n\t\t\t\t\tnewLoopStart = Math.min(newValue - newLoopLength, newLoopStart);\n\t\t\t\t}\n\t\t\t\tdoc.bar = newBar;\n\t\t\t\tdoc.barScrollPos = newBarScrollPos;\n\t\t\t\tdoc.song.loopStart = newLoopStart;\n\t\t\t\tdoc.song.loopLength = newLoopLength;\n\t\t\t\tdoc.song.barCount = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\t\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeInsertBars extends Change {\n\t\tconstructor(doc: SongDocument, start: number, count: number) {\n\t\t\tsuper();\n\t\t\t\n\t\t\tconst newLength: number = Math.min(Config.barCountMax, doc.song.barCount + count);\n\t\t\tcount = newLength - doc.song.barCount;\n\t\t\tif (count == 0) return;\n\t\t\t\n\t\t\tfor (const channel of doc.song.channels) {\n\t\t\t\twhile (channel.bars.length < newLength) {\n\t\t\t\t\tchannel.bars.splice(start, 0, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdoc.song.barCount = newLength;\n\t\t\t\n\t\t\tdoc.bar += count;\n\t\t\tdoc.barScrollPos += count;\n\t\t\tif (doc.song.loopStart >= start) {\n\t\t\t\tdoc.song.loopStart += count;\n\t\t\t} else if (doc.song.loopStart + doc.song.loopLength >= start) {\n\t\t\t\tdoc.song.loopLength += count;\n\t\t\t}\n\t\t\t\n\t\t\tdoc.notifier.changed();\n\t\t\tthis._didSomething();\n\t\t}\n\t}\n\n\texport class ChangeDeleteBars extends Change {\n\t\tconstructor(doc: SongDocument, start: number, count: number) {\n\t\t\tsuper();\n\t\t\t\n\t\t\tfor (const channel of doc.song.channels) {\n\t\t\t\tchannel.bars.splice(start, count);\n\t\t\t\tif (channel.bars.length == 0) channel.bars.push(0);\n\t\t\t}\n\t\t\tdoc.song.barCount = Math.max(1, doc.song.barCount - count);\n\t\t\t\n\t\t\tdoc.bar = Math.max(0, doc.bar - count);\n\t\t\tdoc.barScrollPos = Math.max(0, doc.barScrollPos - count);\n\t\t\tif (doc.song.loopStart >= start) {\n\t\t\t\tdoc.song.loopStart = Math.max(0, doc.song.loopStart - count);\n\t\t\t} else if (doc.song.loopStart + doc.song.loopLength > start) {\n\t\t\t\tdoc.song.loopLength -= count;\n\t\t\t}\n\t\t\tdoc.song.loopLength = Math.max(1, Math.min(doc.song.barCount - doc.song.loopStart, doc.song.loopLength));\n\t\t\t\n\t\t\tdoc.notifier.changed();\n\t\t\tthis._didSomething();\n\t\t}\n\t}\n\n\texport class ChangeChannelCount extends Change {\n\t\tconstructor(doc: SongDocument, newPitchChannelCount: number, newDrumChannelCount: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.pitchChannelCount != newPitchChannelCount || doc.song.drumChannelCount != newDrumChannelCount) {\n\t\t\t\tconst newChannels: Channel[] = [];\n\t\t\t\t\n\t\t\t\tfor (let i: number = 0; i < newPitchChannelCount; i++) {\n\t\t\t\t\tconst channel = i;\n\t\t\t\t\tconst oldChannel = i;\n\t\t\t\t\tif (i < doc.song.pitchChannelCount) {\n\t\t\t\t\t\tnewChannels[channel] = doc.song.channels[oldChannel]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewChannels[channel] = new Channel();\n\t\t\t\t\t\tnewChannels[channel].octave = 2;\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.instrumentsPerChannel; j++) newChannels[channel].instruments[j] = new Instrument();\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.patternsPerChannel; j++) newChannels[channel].patterns[j] = new Pattern();\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.barCount; j++) newChannels[channel].bars[j] = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (let i: number = 0; i < newDrumChannelCount; i++) {\n\t\t\t\t\tconst channel = i + newPitchChannelCount;\n\t\t\t\t\tconst oldChannel = i + doc.song.pitchChannelCount;\n\t\t\t\t\tif (i < doc.song.drumChannelCount) {\n\t\t\t\t\t\tnewChannels[channel] = doc.song.channels[oldChannel]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewChannels[channel] = new Channel();\n\t\t\t\t\t\tnewChannels[channel].octave = 0;\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.instrumentsPerChannel; j++) newChannels[channel].instruments[j] = new Instrument();\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.patternsPerChannel; j++) newChannels[channel].patterns[j] = new Pattern();\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.barCount; j++) newChannels[channel].bars[j] = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdoc.song.pitchChannelCount = newPitchChannelCount;\n\t\t\t\tdoc.song.drumChannelCount = newDrumChannelCount;\n\t\t\t\tfor (let channel: number = 0; channel < doc.song.getChannelCount(); channel++) {\n\t\t\t\t\tdoc.song.channels[channel] = newChannels[channel];\n\t\t\t\t}\n\t\t\t\tdoc.song.channels.length = doc.song.getChannelCount();\n\t\t\t\t\n\t\t\t\tdoc.channel = Math.min(doc.channel, newPitchChannelCount + newDrumChannelCount - 1);\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\t\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeBeatsPerBar extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.beatsPerBar != newValue) {\n\t\t\t\tif (doc.song.beatsPerBar > newValue) {\n\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\n\t\t\t\t\tfor (let i: number = 0; i < doc.song.getChannelCount(); i++) {\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.channels[i].patterns.length; j++) {\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(doc, doc.song.channels[i].patterns[j], newValue * doc.song.partsPerBeat, doc.song.beatsPerBar * doc.song.partsPerBeat));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdoc.song.beatsPerBar = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeChannelOrder extends Change {\n\t\tconstructor(doc: SongDocument, selectionMin: number, selectionMax: number, offset: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.channels.splice(selectionMin + offset, 0, ...doc.song.channels.splice(selectionMin, selectionMax - selectionMin + 1));\n\t\t\tdoc.notifier.changed();\n\t\t\tthis._didSomething();\n\t\t}\n\t}\n\n\texport class ChangeAddChannel extends ChangeGroup {\n\t\tconstructor(doc: SongDocument, index: number, isNoise: boolean) {\n\t\t\tsuper();\n\t\t\tconst newPitchChannelCount: number = doc.song.pitchChannelCount + (isNoise ? 0 : 1);\n\t\t\tconst newNoiseChannelCount: number = doc.song.drumChannelCount + (isNoise ? 1 : 0);\n\t\t\tif (newPitchChannelCount <= Config.pitchChannelCountMax && newNoiseChannelCount <= Config.drumChannelCountMax) {\n\t\t\t\tconst addedChannelIndex: number = isNoise ? doc.song.pitchChannelCount + doc.song.drumChannelCount : doc.song.pitchChannelCount;\n\t\t\t\tthis.append(new ChangeChannelCount(doc, newPitchChannelCount, newNoiseChannelCount));\n\t\t\t\tthis.append(new ChangeChannelOrder(doc, index, addedChannelIndex - 1, 1));\n\t\t\t}\n\t\t\tdoc.notifier.changed();\n\t\t\tthis._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeRemoveChannel extends ChangeGroup {\n\t\tconstructor(doc: SongDocument, minIndex: number, maxIndex: number) {\n\t\t\tsuper();\n\t\t\t\n\t\t\twhile (maxIndex >= minIndex) {\n\t\t\t\tconst isNoise: boolean = doc.song.getChannelIsDrum(maxIndex);\n\t\t\t\tdoc.song.channels.splice(maxIndex, 1);\n\t\t\t\tif (isNoise) {\n\t\t\t\t\tdoc.song.drumChannelCount--;\n\t\t\t\t} else {\n\t\t\t\t\tdoc.song.pitchChannelCount--;\n\t\t\t\t}\n\t\t\t\tmaxIndex--;\n\t\t\t}\n\t\t\t\n\t\t\tif (doc.song.pitchChannelCount < Config.pitchChannelCountMin) {\n\t\t\t\tthis.append(new ChangeChannelCount(doc, Config.pitchChannelCountMin, doc.song.drumChannelCount));\n\t\t\t}\n\t\t\t\n\t\t\tthis.append(new ChangeChannelBar(doc, Math.max(0, minIndex - 1), doc.bar));\n\t\t\t\n\t\t\tthis._didSomething();\n\t\t\tdoc.notifier.changed();\n\t\t}\n\t}\n\n\texport class ChangeChannelBar extends Change {\n\t\tconstructor(doc: SongDocument, newChannel: number, newBar: number) {\n\t\t\tsuper();\n\t\t\tconst oldChannel: number = doc.channel;\n\t\t\tconst oldBar: number = doc.bar;\n\t\t\tdoc.channel = newChannel;\n\t\t\tdoc.bar = newBar;\n\t\t\tdoc.barScrollPos = Math.min(doc.bar, Math.max(doc.bar - (doc.trackVisibleBars - 1), doc.barScrollPos));\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldChannel != newChannel || oldBar != newBar) {\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeChorus extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].chorus;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tthis._didSomething();\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].chorus = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeEffect extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].effect;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].effect = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeHarm extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].harm;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].harm = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\n\texport class ChangeFMChorus extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].fmChorus;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].fmChorus = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeOctoff extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].octoff;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].octoff = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeImute extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].imute;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].imute = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeIpan extends Change {\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].ipan = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeFilter extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].filter;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].filter = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeAlgorithm extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].algorithm;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].algorithm = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeFeedbackType extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackType;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackType = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeFeedbackEnvelope extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackEnvelope;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackEnvelope = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeOperatorEnvelope extends Change {\n\t\tconstructor(doc: SongDocument, operatorIndex: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].envelope;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].envelope = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeOperatorFrequency extends Change {\n\t\tconstructor(doc: SongDocument, operatorIndex: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].frequency;\n\t\t\tif (oldValue != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].frequency = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeOperatorAmplitude extends Change {\n\t\tconstructor(doc: SongDocument, operatorIndex: number, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].amplitude = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeFeedbackAmplitude extends Change {\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackAmplitude = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeInstrumentsPerChannel extends Change {\n\t\tconstructor(doc: SongDocument, newInstrumentsPerChannel: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.instrumentsPerChannel != newInstrumentsPerChannel) {\n\t\t\t\tfor (let channel: number = 0; channel < doc.song.getChannelCount(); channel++) {\n\t\t\t\t\tconst sampleInstrument: Instrument = doc.song.channels[channel].instruments[doc.song.instrumentsPerChannel - 1];\n\t\t\t\t\tfor (let j: number = doc.song.instrumentsPerChannel; j < newInstrumentsPerChannel; j++) {\n\t\t\t\t\t\tconst newInstrument: Instrument = new Instrument();\n\t\t\t\t\t\tnewInstrument.copy(sampleInstrument);\n\t\t\t\t\t\tdoc.song.channels[channel].instruments[j] = newInstrument;\n\t\t\t\t\t}\n\t\t\t\t\tdoc.song.channels[channel].instruments.length = newInstrumentsPerChannel;\n\t\t\t\t\tfor (let j: number = 0; j < doc.song.patternsPerChannel; j++) {\n\t\t\t\t\t\tif (doc.song.channels[channel].patterns[j].instrument >= newInstrumentsPerChannel) {\n\t\t\t\t\t\t\tdoc.song.channels[channel].patterns[j].instrument = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdoc.song.instrumentsPerChannel = newInstrumentsPerChannel;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeKey extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.key != newValue) {\n\t\t\t\tdoc.song.key = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeTheme extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.theme != newValue) {\n\t\t\t\tdoc.song.theme = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeLoop extends Change {\n\t\tconstructor(private _doc: SongDocument, public oldStart: number, public oldLength: number, public newStart: number, public newLength: number) {\n\t\t\tsuper();\n\t\t\tthis._doc.song.loopStart = this.newStart;\n\t\t\tthis._doc.song.loopLength = this.newLength;\n\t\t\tthis._doc.notifier.changed();\n\t\t\tif (this.oldStart != this.newStart || this.oldLength != this.newLength) {\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangePitchAdded extends UndoableChange {\n\t\tprivate _doc: SongDocument;\n\t\tprivate _note: Note;\n\t\tprivate _pitch: number;\n\t\tprivate _index: number;\n\t\tconstructor(doc: SongDocument, note: Note, pitch: number, index: number, deletion: boolean = false) {\n\t\t\tsuper(deletion);\n\t\t\tthis._doc = doc;\n\t\t\tthis._note = note;\n\t\t\tthis._pitch = pitch;\n\t\t\tthis._index = index;\n\t\t\tthis._didSomething();\n\t\t\tthis.redo();\n\t\t}\n\t\t\n\t\tprotected _doForwards(): void {\n\t\t\tthis._note.pitches.splice(this._index, 0, this._pitch);\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t\t\n\t\tprotected _doBackwards(): void {\n\t\t\tthis._note.pitches.splice(this._index, 1);\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t}\n\t\n\texport class ChangeOctave extends Change {\n\t\tconstructor(doc: SongDocument, public oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.channels[doc.channel].octave = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangePartsPerBeat extends ChangeGroup {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.partsPerBeat != newValue) {\n\t\t\t\tfor (let i: number = 0; i < doc.song.getChannelCount(); i++) {\n\t\t\t\t\tfor (let j: number = 0; j < doc.song.channels[i].patterns.length; j++) {\n\t\t\t\t\t\tthis.append(new ChangeRhythm(doc, doc.song.channels[i].patterns[j], doc.song.partsPerBeat, newValue));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdoc.song.partsPerBeat = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangePaste extends ChangeGroup {\n\t\tconstructor(doc: SongDocument, pattern: Pattern, notes: Note[], newBeatsPerBar: number, newPartsPerBeat: number) {\n\t\t\tsuper();\n\t\t\tpattern.notes = notes;\n\t\t\t\n\t\t\tif (doc.song.partsPerBeat != newPartsPerBeat) {\n\t\t\t\tthis.append(new ChangeRhythm(doc, pattern, newPartsPerBeat, doc.song.partsPerBeat));\n\t\t\t}\n\t\t\t\n\t\t\tif (doc.song.beatsPerBar != newBeatsPerBar) {\n\t\t\t\tthis.append(new ChangeNoteTruncate(doc, pattern, doc.song.beatsPerBar * doc.song.partsPerBeat, newBeatsPerBar * doc.song.partsPerBeat));\n\t\t\t}\n\t\t\t\n\t\t\tdoc.notifier.changed();\n\t\t\tthis._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangePatternInstrument extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number, pattern: Pattern) {\n\t\t\tsuper();\n\t\t\tif (pattern.instrument != newValue) {\n\t\t\t\tpattern.instrument = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangePatternsPerChannel extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.patternsPerChannel != newValue) {\n\t\t\t\tfor (let i: number = 0; i < doc.song.getChannelCount(); i++) {\n\t\t\t\t\tconst channelBars: number[] = doc.song.channels[i].bars;\n\t\t\t\t\tconst channelPatterns: Pattern[] = doc.song.channels[i].patterns;\n\t\t\t\t\tfor (let j: number = 0; j < channelBars.length; j++) {\n\t\t\t\t\t\tif (channelBars[j] > newValue) channelBars[j] = 0;\n\t\t\t\t\t}\n\t\t\t\t\tfor (let j: number = channelPatterns.length; j < newValue; j++) {\n\t\t\t\t\t\tchannelPatterns[j] = new Pattern();\n\t\t\t\t\t}\n\t\t\t\t\tchannelPatterns.length = newValue;\n\t\t\t\t}\n\t\t\t\tdoc.song.patternsPerChannel = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeEnsurePatternExists extends UndoableChange {\n\t\tprivate _doc: SongDocument;\n\t\tprivate _bar: number;\n\t\tprivate _channel: number;\n\t\tprivate _patternIndex: number;\n\t\tprivate _patternOldNotes: Note[] | null = null;\n\t\tprivate _oldPatternCount: number;\n\t\tprivate _newPatternCount: number;\n\n\t\tconstructor(doc: SongDocument) {\n\t\t\tsuper(false);\n\t\t\tconst song: Song = doc.song;\n\t\t\tif (song.channels[doc.channel].bars[doc.bar] != 0) return;\n\n\t\t\tthis._doc = doc;\n\t\t\tthis._bar = doc.bar;\n\t\t\tthis._channel = doc.channel;\n\t\t\tthis._oldPatternCount = song.patternsPerChannel;\n\t\t\tthis._newPatternCount = song.patternsPerChannel;\n\n\t\t\tlet firstEmptyUnusedIndex: number | null = null;\n\t\t\tlet firstUnusedIndex: number | null = null;\n\t\t\tfor (let patternIndex: number = 1; patternIndex <= song.patternsPerChannel; patternIndex++) {\n\t\t\t\tlet used = false;\n\t\t\t\tfor (let barIndex: number = 0; barIndex < song.barCount; barIndex++) {\n\t\t\t\t\tif (song.channels[doc.channel].bars[barIndex] == patternIndex) {\n\t\t\t\t\t\tused = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (used) continue;\n\t\t\t\tif (firstUnusedIndex == null) {\n\t\t\t\t\tfirstUnusedIndex = patternIndex;\n\t\t\t\t}\n\t\t\t\tconst pattern: Pattern = song.channels[doc.channel].patterns[patternIndex - 1];\n\t\t\t\tif (pattern.notes.length == 0) {\n\t\t\t\t\tfirstEmptyUnusedIndex = patternIndex;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (firstEmptyUnusedIndex != null) {\n\t\t\t\tthis._patternIndex = firstEmptyUnusedIndex;\n\t\t\t} else if (song.patternsPerChannel < song.barCount) {\n\t\t\t\tthis._newPatternCount = song.patternsPerChannel + 1;\n\t\t\t\tthis._patternIndex = song.patternsPerChannel + 1;\n\t\t\t} else if (firstUnusedIndex != null) {\n\t\t\t\tthis._patternIndex = firstUnusedIndex;\n\t\t\t\tthis._patternOldNotes = song.channels[doc.channel].patterns[firstUnusedIndex - 1].notes;\n\t\t\t} else {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\n\t\t\tthis._didSomething();\n\t\t\tthis._doForwards();\n\t\t}\n\n\t\tprotected _doForwards(): void {\n\t\t\tconst song: Song = this._doc.song;\n\t\t\tfor (let j: number = song.patternsPerChannel; j < this._newPatternCount; j++) {\n\t\t\t\tfor (let i: number = 0; i < song.getChannelCount(); i++) {\n\t\t\t\t\tsong.channels[i].patterns[j] = new Pattern();\n\t\t\t\t}\n\t\t\t}\n\t\t\tsong.patternsPerChannel = this._newPatternCount;\n\t\t\tconst pattern: Pattern = song.channels[this._channel].patterns[this._patternIndex - 1];\n\t\t\tpattern.notes = [];\n\t\t\tsong.channels[this._channel].bars[this._bar] = this._patternIndex;\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\n\t\tprotected _doBackwards(): void {\n\t\t\tconst song: Song = this._doc.song;\n\t\t\tconst pattern: Pattern = song.channels[this._channel].patterns[this._patternIndex - 1];\n\t\t\tif (this._patternOldNotes != null) pattern.notes = this._patternOldNotes;\n\t\t\tsong.channels[this._channel].bars[this._bar] = 0;\n\t\t\tfor (let i: number = 0; i < song.getChannelCount(); i++) {\n\t\t\t\tsong.channels[i].patterns.length = this._oldPatternCount;\n\t\t\t}\n\t\t\tsong.patternsPerChannel = this._oldPatternCount;\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t}\n\n\texport class ChangePinTime extends ChangePins {\n\t\tconstructor(doc: SongDocument, note: Note, pinIndex: number, shiftedTime: number) {\n\t\t\tsuper(doc, note);\n\t\t\t\n\t\t\tshiftedTime -= this._oldStart;\n\t\t\tconst originalTime: number = this._oldPins[pinIndex].time;\n\t\t\tconst skipStart: number = Math.min(originalTime, shiftedTime);\n\t\t\tconst skipEnd: number = Math.max(originalTime, shiftedTime);\n\t\t\tlet setPin: boolean = false;\n\t\t\tfor (let i: number = 0; i < this._oldPins.length; i++) {\n\t\t\t\tconst oldPin: NotePin = note.pins[i];\n\t\t\t\tconst time: number = oldPin.time;\n\t\t\t\tif (time < skipStart) {\n\t\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, time, oldPin.volume));\n\t\t\t\t} else if (time > skipEnd) {\n\t\t\t\t\tif (!setPin) {\n\t\t\t\t\t\tthis._newPins.push(makeNotePin(this._oldPins[pinIndex].interval, shiftedTime, this._oldPins[pinIndex].volume));\n\t\t\t\t\t\tsetPin = true;\n\t\t\t\t\t}\n\t\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, time, oldPin.volume));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!setPin) {\n\t\t\t\tthis._newPins.push(makeNotePin(this._oldPins[pinIndex].interval, shiftedTime, this._oldPins[pinIndex].volume));\n\t\t\t}\n\t\t\t\n\t\t\tthis._finishSetup();\n\t\t}\n\t}\n\t\n\texport class ChangePitchBend extends ChangePins {\n\t\tconstructor(doc: SongDocument, note: Note, bendStart: number, bendEnd: number, bendTo: number, pitchIndex: number) {\n\t\t\tsuper(doc, note);\n\t\t\t\n\t\t\tbendStart -= this._oldStart;\n\t\t\tbendEnd   -= this._oldStart;\n\t\t\tbendTo    -= note.pitches[pitchIndex];\n\t\t\t\n\t\t\tlet setStart: boolean = false;\n\t\t\tlet setEnd: boolean   = false;\n\t\t\tlet prevInterval: number = 0;\n\t\t\tlet prevVolume: number = 3;\n\t\t\tlet persist: boolean = true;\n\t\t\tlet i: number;\n\t\t\tlet direction: number;\n\t\t\tlet stop: number;\n\t\t\tlet push: (item: NotePin)=>void;\n\t\t\tif (bendEnd > bendStart) {\n\t\t\t\ti = 0;\n\t\t\t\tdirection = 1;\n\t\t\t\tstop = note.pins.length;\n\t\t\t\tpush = (item: NotePin)=>{ this._newPins.push(item); };\n\t\t\t} else {\n\t\t\t\ti = note.pins.length - 1;\n\t\t\t\tdirection = -1;\n\t\t\t\tstop = -1;\n\t\t\t\tpush = (item: NotePin)=>{ this._newPins.unshift(item); };\n\t\t\t}\n\t\t\tfor (; i != stop; i += direction) {\n\t\t\t\tconst oldPin: NotePin = note.pins[i];\n\t\t\t\tconst time: number = oldPin.time;\n\t\t\t\tfor (;;) {\n\t\t\t\t\tif (!setStart) {\n\t\t\t\t\t\tif (time * direction <= bendStart * direction) {\n\t\t\t\t\t\t\tprevInterval = oldPin.interval;\n\t\t\t\t\t\t\tprevVolume = oldPin.volume;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (time * direction < bendStart * direction) {\n\t\t\t\t\t\t\tpush(makeNotePin(oldPin.interval, time, oldPin.volume));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpush(makeNotePin(prevInterval, bendStart, prevVolume));\n\t\t\t\t\t\t\tsetStart = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (!setEnd) {\n\t\t\t\t\t\tif (time * direction <= bendEnd * direction) {\n\t\t\t\t\t\t\tprevInterval = oldPin.interval;\n\t\t\t\t\t\t\tprevVolume = oldPin.volume;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (time * direction < bendEnd * direction) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpush(makeNotePin(bendTo, bendEnd, prevVolume));\n\t\t\t\t\t\t\tsetEnd = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (time * direction == bendEnd * direction) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (oldPin.interval != prevInterval) persist = false;\n\t\t\t\t\t\t\tpush(makeNotePin(persist ? bendTo : oldPin.interval, time, oldPin.volume));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!setEnd) {\n\t\t\t\tpush(makeNotePin(bendTo, bendEnd, prevVolume));\n\t\t\t}\n\t\t\t\n\t\t\tthis._finishSetup();\n\t\t}\n\t}\n\t\n\texport class ChangeRhythm extends ChangeSequence {\n\t\tconstructor(doc: SongDocument, bar: Pattern, oldPartsPerBeat: number, newPartsPerBeat: number) {\n\t\t\tsuper();\n\t\t\tlet changeRhythm: (oldTime:number)=>number;\n\t\t\t\n\t\t\tif (oldPartsPerBeat > newPartsPerBeat) {\n\t\t\t\tchangeRhythm = (oldTime: number)=> Math.ceil(oldTime * newPartsPerBeat / oldPartsPerBeat);\n\t\t\t} else if (oldPartsPerBeat < newPartsPerBeat) {\n\t\t\t\tchangeRhythm = (oldTime: number)=> Math.floor(oldTime * newPartsPerBeat / oldPartsPerBeat);\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"ChangeRhythm couldn't handle rhythm change from \" + oldPartsPerBeat + \" to \" + newPartsPerBeat + \".\");\n\t\t\t}\n\t\t\tlet i: number = 0;\n\t\t\twhile (i < bar.notes.length) {\n\t\t\t\tconst note: Note = bar.notes[i];\n\t\t\t\tif (changeRhythm(note.start) >= changeRhythm(note.end)) {\n\t\t\t\t\tthis.append(new ChangeNoteAdded(doc, bar, note, i, true));\n\t\t\t\t} else {\n\t\t\t\t\tthis.append(new ChangeRhythmNote(doc, note, changeRhythm));\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeRhythmNote extends ChangePins {\n\t\tconstructor(doc: SongDocument, note: Note, changeRhythm: (oldTime:number)=>number) {\n\t\t\tsuper(doc, note);\n\t\t\t\n\t\t\tfor (const oldPin of this._oldPins) {\n\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, changeRhythm(oldPin.time + this._oldStart) - this._oldStart, oldPin.volume));\n\t\t\t}\n\t\t\t\n\t\t\tthis._finishSetup();\n\t\t}\n\t}\n\t\n\texport class ChangeScale extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.scale != newValue) {\n\t\t\t\tdoc.song.scale = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeMix extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.mix != newValue) {\n\t\t\t\tdoc.song.mix = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeSampleRate extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.sampleRate != newValue) {\n\t\t\t\tdoc.song.sampleRate = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeSong extends Change {\n\t\tconstructor(doc: SongDocument, newHash: string) {\n\t\t\tsuper();\n\t\t\tdoc.song.fromBase64String(newHash);\n\t\t\tdoc.channel = Math.min(doc.channel, doc.song.getChannelCount() - 1);\n\t\t\tdoc.bar = Math.max(0, Math.min(doc.song.barCount - 1, doc.bar));\n\t\t\tdoc.barScrollPos = Math.max(0, Math.min(doc.song.barCount - doc.trackVisibleBars, doc.barScrollPos));\n\t\t\tdoc.barScrollPos = Math.min(doc.bar, Math.max(doc.bar - (doc.trackVisibleBars - 1), doc.barScrollPos));\n\t\t\tdoc.notifier.changed();\n\t\t\tthis._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeTempo extends Change {\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.tempo = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeReverb extends Change {\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.reverb = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeBlend extends Change {\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.blend = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeRiff extends Change {\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.riff = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeDetune extends Change {\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.detune = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeMuff extends Change {\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.muff = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeNoteAdded extends UndoableChange {\n\t\tprivate _doc: SongDocument;\n\t\tprivate _pattern: Pattern;\n\t\tprivate _note: Note;\n\t\tprivate _index: number;\n\t\tconstructor(doc: SongDocument, pattern: Pattern, note: Note, index: number, deletion: boolean = false) {\n\t\t\tsuper(deletion);\n\t\t\tthis._doc = doc;\n\t\t\tthis._pattern = pattern;\n\t\t\tthis._note = note;\n\t\t\tthis._index = index;\n\t\t\tthis._didSomething();\n\t\t\tthis.redo();\n\t\t}\n\t\t\n\t\tprotected _doForwards(): void {\n\t\t\tthis._pattern.notes.splice(this._index, 0, this._note);\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t\t\n\t\tprotected _doBackwards(): void {\n\t\t\tthis._pattern.notes.splice(this._index, 1);\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t}\n\t\n\texport class ChangeNoteLength extends ChangePins {\n\t\tconstructor(doc: SongDocument, note: Note, truncStart: number, truncEnd: number) {\n\t\t\tsuper(doc, note);\n\t\t\t\n\t\t\ttruncStart -= this._oldStart;\n\t\t\ttruncEnd   -= this._oldStart;\n\t\t\tlet setStart: boolean = false;\n\t\t\tlet prevVolume: number = this._oldPins[0].volume;\n\t\t\tlet prevInterval: number = this._oldPins[0].interval;\n\t\t\tlet pushLastPin: boolean = true;\n\t\t\tlet i: number;\n\t\t\tfor (i = 0; i < this._oldPins.length; i++) {\n\t\t\t\tconst oldPin: NotePin = this._oldPins[i];\n\t\t\t\tif (oldPin.time < truncStart) {\n\t\t\t\t\tprevVolume = oldPin.volume;\n\t\t\t\t\tprevInterval = oldPin.interval;\n\t\t\t\t} else if (oldPin.time <= truncEnd) {\n\t\t\t\t\tif (oldPin.time > truncStart && !setStart) {\n\t\t\t\t\t\tthis._newPins.push(makeNotePin(prevInterval, truncStart, prevVolume));\n\t\t\t\t\t}\n\t\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, oldPin.time, oldPin.volume));\n\t\t\t\t\tsetStart = true;\n\t\t\t\t\tif (oldPin.time == truncEnd) {\n\t\t\t\t\t\tpushLastPin = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t} \n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\tif (pushLastPin) this._newPins.push(makeNotePin(this._oldPins[i].interval, truncEnd, this._oldPins[i].volume));\n\t\t\t\n\t\t\tthis._finishSetup();\n\t\t}\n\t}\n\t\n\texport class ChangeNoteTruncate extends ChangeSequence {\n\t\tconstructor(doc: SongDocument, pattern: Pattern, start: number, end: number, skipNote?: Note) {\n\t\t\tsuper();\n\t\t\tlet i: number = 0;\n\t\t\twhile (i < pattern.notes.length) {\n\t\t\t\tconst note: Note = pattern.notes[i];\n\t\t\t\tif (note == skipNote && skipNote != undefined) {\n\t\t\t\t\ti++;\n\t\t\t\t} else if (note.end <= start) {\n\t\t\t\t\ti++;\n\t\t\t\t} else if (note.start >= end) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (note.start < start) {\n\t\t\t\t\tthis.append(new ChangeNoteLength(doc, note, note.start, start));\n\t\t\t\t\ti++;\n\t\t\t\t} else if (note.end > end) {\n\t\t\t\t\tthis.append(new ChangeNoteLength(doc, note, end, note.end));\n\t\t\t\t\ti++;\n\t\t\t\t} else {\n\t\t\t\t\tthis.append(new ChangeNoteAdded(doc, pattern, note, i, true));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeTransposeNote extends UndoableChange {\n\t\tprotected _doc: SongDocument;\n\t\tprotected _note: Note;\n\t\tprotected _oldStart: number;\n\t\tprotected _newStart: number;\n\t\tprotected _oldEnd: number;\n\t\tprotected _newEnd: number;\n\t\tprotected _oldPins: NotePin[];\n\t\tprotected _newPins: NotePin[];\n\t\tprotected _oldPitches: number[];\n\t\tprotected _newPitches: number[];\n\t\tconstructor(doc: SongDocument, note: Note, upward: boolean) {\n\t\t\tsuper(false);\n\t\t\tthis._doc = doc;\n\t\t\tthis._note = note;\n\t\t\tthis._oldPins = note.pins;\n\t\t\tthis._newPins = [];\n\t\t\tthis._oldPitches = note.pitches;\n\t\t\tthis._newPitches = [];\n\t\t\t\n\t\t\tconst maxPitch: number = (doc.song.getChannelIsDrum(doc.channel) ? Config.drumCount - 1 : Config.maxPitch);\n\t\t\t\n\t\t\tfor (let i: number = 0; i < this._oldPitches.length; i++) {\n\t\t\t\tlet pitch: number = this._oldPitches[i];\n\t\t\t\tif (upward) {\n\t\t\t\t\tfor (let j: number = pitch + 1; j <= maxPitch; j++) {\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scaleFlags[doc.song.scale][j%12]) {\n\t\t\t\t\t\t\tpitch = j;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (let j: number = pitch - 1; j >= 0; j--) {\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scaleFlags[doc.song.scale][j%12]) {\n\t\t\t\t\t\t\tpitch = j;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlet foundMatch: boolean = false;\n\t\t\t\tfor (let j: number = 0; j < this._newPitches.length; j++) {\n\t\t\t\t\tif (this._newPitches[j] == pitch) {\n\t\t\t\t\t\tfoundMatch = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!foundMatch) this._newPitches.push(pitch);\n\t\t\t}\n\t\t\t\n\t\t\tlet min: number = 0;\n\t\t\tlet max: number = maxPitch;\n\t\t\t\n\t\t\tfor (let i: number = 1; i < this._newPitches.length; i++) {\n\t\t\t\tconst diff: number = this._newPitches[0] - this._newPitches[i];\n\t\t\t\tif (min < diff) min = diff;\n\t\t\t\tif (max > diff + maxPitch) max = diff + maxPitch;\n\t\t\t}\n\t\t\t\n\t\t\tfor (const oldPin of this._oldPins) {\n\t\t\t\tlet interval: number = oldPin.interval + this._oldPitches[0];\n\t\t\t\t\n\t\t\t\tif (interval < min) interval = min;\n\t\t\t\tif (interval > max) interval = max;\n\t\t\t\tif (upward) {\n\t\t\t\t\tfor (let i: number = interval + 1; i <= max; i++) {\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scaleFlags[doc.song.scale][i%12]) {\n\t\t\t\t\t\t\tinterval = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i: number = interval - 1; i >= min; i--) {\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scaleFlags[doc.song.scale][i%12]) {\n\t\t\t\t\t\t\tinterval = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tinterval -= this._newPitches[0];\n\t\t\t\tthis._newPins.push(makeNotePin(interval, oldPin.time, oldPin.volume));\n\t\t\t}\n\t\t\t\n\t\t\tif (this._newPins[0].interval != 0) throw new Error(\"wrong pin start interval\");\n\t\t\t\n\t\t\tfor (let i: number = 1; i < this._newPins.length - 1; ) {\n\t\t\t\tif (this._newPins[i-1].interval == this._newPins[i].interval && \n\t\t\t\t    this._newPins[i].interval == this._newPins[i+1].interval && \n\t\t\t\t    this._newPins[i-1].volume == this._newPins[i].volume && \n\t\t\t\t    this._newPins[i].volume == this._newPins[i+1].volume)\n\t\t\t\t{\n\t\t\t\t\tthis._newPins.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis._doForwards();\n\t\t\tthis._didSomething();\n\t\t}\n\t\t\n\t\tprotected _doForwards(): void {\n\t\t\tthis._note.pins = this._newPins;\n\t\t\tthis._note.pitches = this._newPitches;\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t\t\n\t\tprotected _doBackwards(): void {\n\t\t\tthis._note.pins = this._oldPins;\n\t\t\tthis._note.pitches = this._oldPitches;\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t}\n\t\n\texport class ChangeTranspose extends ChangeSequence {\n\t\tconstructor(doc: SongDocument, pattern: Pattern, upward: boolean) {\n\t\t\tsuper();\n\t\t\tfor (let i: number = 0; i < pattern.notes.length; i++) {\n\t\t\t\tthis.append(new ChangeTransposeNote(doc, pattern.notes[i], upward));\n\t\t\t}\n\t\t}\n\t}\n\t\n\texport class ChangeVolume extends Change {\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\n\t\t\tsuper();\n\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].volume = newValue;\n\t\t\tdoc.notifier.changed();\n\t\t\tif (oldValue != newValue) this._didSomething();\n\t\t}\n\t}\n\t\n\texport class ChangeVolumeBend extends UndoableChange {\n\t\tprivate _doc: SongDocument;\n\t\tprivate _note: Note;\n\t\tprivate _oldPins: NotePin[];\n\t\tprivate _newPins: NotePin[];\n\t\tconstructor(doc: SongDocument, note: Note, bendPart: number, bendVolume: number, bendInterval: number) {\n\t\t\tsuper(false);\n\t\t\tthis._doc = doc;\n\t\t\tthis._note = note;\n\t\t\tthis._oldPins = note.pins;\n\t\t\tthis._newPins = [];\n\t\t\t\n\t\t\tlet inserted: boolean = false;\n\t\t\t\n\t\t\tfor (const pin of note.pins) {\n\t\t\t\tif (pin.time < bendPart) {\n\t\t\t\t\tthis._newPins.push(pin);\n\t\t\t\t} else if (pin.time == bendPart) {\n\t\t\t\t\tthis._newPins.push(makeNotePin(bendInterval, bendPart, bendVolume));\n\t\t\t\t\tinserted = true;\n\t\t\t\t} else {\n\t\t\t\t\tif (!inserted) {\n\t\t\t\t\t\tthis._newPins.push(makeNotePin(bendInterval, bendPart, bendVolume));\n\t\t\t\t\t\tinserted = true;\n\t\t\t\t\t}\n\t\t\t\t\tthis._newPins.push(pin);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfor (let i: number = 1; i < this._newPins.length - 1; ) {\n\t\t\t\tif (this._newPins[i-1].interval == this._newPins[i].interval && \n\t\t\t\t    this._newPins[i].interval == this._newPins[i+1].interval && \n\t\t\t\t    this._newPins[i-1].volume == this._newPins[i].volume && \n\t\t\t\t    this._newPins[i].volume == this._newPins[i+1].volume)\n\t\t\t\t{\n\t\t\t\t\tthis._newPins.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis._doForwards();\n\t\t\tthis._didSomething();\n\t\t}\n\t\t\n\t\tprotected _doForwards(): void {\n\t\t\tthis._note.pins = this._newPins;\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t\t\n\t\tprotected _doBackwards(): void {\n\t\t\tthis._note.pins = this._oldPins;\n\t\t\tthis._doc.notifier.changed();\n\t\t}\n\t}\n\t\n\texport class ChangeWave extends Change {\n\t\tconstructor(doc: SongDocument, newValue: number) {\n\t\t\tsuper();\n\t\t\tif (doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].wave != newValue) {\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].wave = newValue;\n\t\t\t\tdoc.notifier.changed();\n\t\t\t\tthis._didSomething();\n\t\t\t}\n\t\t}\n\t}\n\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport {DictionaryArray, BeepBoxOption, toNameMap} from \"../synth/SynthConfig\";\r\nimport { Song } from \"../synth/synth\";\r\n\r\nexport interface ChannelColors extends BeepBoxOption {\r\n    readonly secondaryChannel: string;\r\n    readonly primaryChannel: string;\r\n    readonly secondaryNote: string;\r\n    readonly primaryNote: string;\r\n}\r\n\r\n\r\nexport class ColorConfig {\r\n\tpublic static colorLookup: Map<number, ChannelColors> = new Map<number, ChannelColors>();\r\n\tpublic static usesPianoScheme: boolean = false;\r\n\tprivate static readonly _themeMap: {[K: string]: string} = {\r\n\t\t\"default\": `\r\n            :root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #9900cc;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #864;\r\n\t\t\t\t--fifth-note: #468;\r\n                --volume-icon: #777777;\r\n\t\t\t\t--octave-scrollbar: #444;\r\n\t\t\t\t--scrollbar-octave: #864;\r\n\t\t\t\t--channel-box: #444;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n            }\r\n        `,\r\n\t\t\"nepbox\": `\r\n            :root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: #00fff5;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #00fff5;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #0a2d44;\r\n\t\t\t\t--tonic: #9150ff;\r\n\t\t\t\t--fifth-note: #990000;\r\n                --volume-icon: #00fff5;\r\n\t\t\t\t--octave-scrollbar: #484848;\r\n\t\t\t\t--scrollbar-octave: #9150ff;\r\n\t\t\t\t--channel-box: #444;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #c13cbf;\r\n\t\t\t\t--pitch1-primary-channel: #f75dff;\r\n\t\t\t\t--pitch1-secondary-note: #b930a2;\r\n\t\t\t\t--pitch1-primary-note: #fca5ff;\r\n\t\t\t\t--pitch2-secondary-channel: #800000;\r\n\t\t\t\t--pitch2-primary-channel: #f00;\r\n\t\t\t\t--pitch2-secondary-note: #8c2121;\r\n\t\t\t\t--pitch2-primary-note: #ff5252;\r\n\t\t\t\t--pitch3-secondary-channel: #004bb3;\r\n\t\t\t\t--pitch3-primary-channel: #1792ff;\r\n\t\t\t\t--pitch3-secondary-note: #005cb3;\r\n\t\t\t\t--pitch3-primary-note: #00ffe9;\r\n\t\t\t\t--pitch4-secondary-channel: #a48800;\r\n\t\t\t\t--pitch4-primary-channel: #fb0;\r\n\t\t\t\t--pitch4-secondary-note: #9c4100;\r\n\t\t\t\t--pitch4-primary-note: #ffd84e;\r\n\t\t\t\t--pitch5-secondary-channel: #6c0000;\r\n\t\t\t\t--pitch5-primary-channel:   #ff3e3e;\r\n\t\t\t\t--pitch5-secondary-note:    #6c0000;\r\n\t\t\t\t--pitch5-primary-note:      #ff3e3e;\r\n\t\t\t\t--pitch6-secondary-channel:#d25a00;\r\n\t\t\t\t--pitch6-primary-channel:  #fdff00;\r\n\t\t\t\t--pitch6-secondary-note:   #d25a00;\r\n\t\t\t\t--pitch6-primary-note:     #fdff00;\r\n\t\t\t\t--pitch7-secondary-channel: #046000;\r\n\t\t\t\t--pitch7-primary-channel:   #0c79ff;\r\n\t\t\t\t--pitch7-secondary-note:    #046000;\r\n\t\t\t\t--pitch7-primary-note:      #0c79ff;\r\n\t\t\t\t--pitch8-secondary-channel:#3b2bae;\r\n\t\t\t\t--pitch8-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch8-secondary-note:   #3b2bae;\r\n\t\t\t\t--pitch8-primary-note:     #d85d00;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #868686;\r\n\t\t\t\t--noise1-primary-channel: #fff;\r\n\t\t\t\t--noise1-secondary-note: #868686;\r\n\t\t\t\t--noise1-primary-note: #fff;\r\n\t\t\t\t--noise2-secondary-channel: #805300;\r\n\t\t\t\t--noise2-primary-channel: #ff8c00;\r\n\t\t\t\t--noise2-secondary-note: #6a3500;\r\n\t\t\t\t--noise2-primary-note: #a85400;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n            }\r\n        `,\r\n\t\t\"modbox2\": `\r\n            :root {\r\n                --page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #00ff00;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #c4ffa3;\r\n\t\t\t\t--fifth-note: #96fffb;\r\n                --volume-icon: #c4ffa3;\r\n\t\t\t\t--octave-scrollbar: #00ff00;\r\n\t\t\t\t--scrollbar-octave: #fff;\r\n\t\t\t\t--channel-box: #444;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n            }\r\n\t\t`,\r\n\t\t\"artic\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ffffff;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #eafffe;\r\n\t\t\t\t--fifth-note: #b7f1ff;\r\n\t\t\t\t--octave-scrollbar: #a5eeff;\r\n\t\t\t\t--scrollbar-octave: #cefffd;\r\n\t\t\t\t--volume-icon: #42dcff;\t\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"Cinnamon Roll\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ba8418;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--pitch1-background: #f5bb00;\r\n\t\t\t\t--pitch2-background: #f5bb00;\r\n\t\t\t\t--pitch3-background: #f5bb00;\r\n\t\t\t\t--pitch4-background: #f5bb00;\r\n\t\t\t\t--pitch5-background: #f5bb00;\r\n\t\t\t\t--pitch6-background: #f5bb00;\r\n\t\t\t\t--pitch8-background: #f5bb00;\r\n\t\t\t\t--pitch9-background: #f5bb00;\r\n\t\t\t\t--pitch10-background: #f5bb00;\r\n\t\t\t\t--pitch11-background: #f5bb00;\r\n\t\t\t\t--pitch12-background: #f5bb00;\r\n\t\t\t\t--tonic: #f5bb00;\r\n\t\t\t\t--fifth-note: #f5bb00;\r\n\t\t\t\t--volume-icon: #ba8418;\t\r\n\r\n\t\t\t\t--octave-scrollbar: #e59900;\r\n\t\t\t\t--scrollbar-octave: #ffff25;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"Ocean\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #5982ff;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #090b3a;\r\n\t\t\t\t--fifth-note: #3f669b;\r\n\t\t\t\t--volume-icon: #090b3a;\t\r\n\r\n\t\t\t\t--octave-scrollbar: #4449a3;\r\n\t\t\t\t--scrollbar-octave: #3dffdb;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"rainbow\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff0000;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\r\n\t\t\t\t--pitch-background: #444; \r\n\t\t\t\t--tonic: #ffaaaa; \r\n\t\t\t\t--pitch1-background: #ffceaa; \r\n\t\t\t\t--pitch2-background: #ffdfaa; \r\n\t\t\t\t--pitch3-background: #fff5aa; \r\n\t\t\t\t--pitch4-background: #e8ffaa;\r\n\t\t\t\t--pitch5-background: #bfffb2; \r\n\t\t\t\t--pitch6-background: #b2ffc8; \r\n\t\t\t\t--fifth-note: #b2ffe4; \r\n\t\t\t\t--pitch8-background: #b2f3ff; \r\n\t\t\t\t--pitch9-background: #b2b3ff; \r\n\t\t\t\t--pitch10-background: #e0b2ff; \r\n\t\t\t\t--pitch11-background: #ffafe9; \r\n\t\t\t\t--octave-scrollbar: #43ff00; \r\n\t\t\t\t--volume-icon: #ff00cb;\t\r\n\r\n\t\t\t\t--octave-scrollbar: #43ff00;\r\n\t\t\t\t--scrollbar-octave: #0400ff;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"float\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff0000;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #878787;\t\r\n\r\n\t\t\t\t--pitch-background: #444; \r\n\t\t\t\t--tonic: #ffffff; \r\n\t\t\t\t--pitch1-background: #ededed;  \r\n\t\t\t\t--pitch2-background: #cecece;  \r\n\t\t\t\t--pitch3-background: #bababa;  \r\n\t\t\t\t--pitch4-background: #afafaf;\r\n\t\t\t\t--pitch5-background: #a5a5a5; \r\n\t\t\t\t--pitch6-background: #999999; \r\n\t\t\t\t--fifth-note: #8e8e8e; \r\n\t\t\t\t--pitch8-background: #828282; \r\n\t\t\t\t--pitch9-background: #777777; \r\n\t\t\t\t--pitch10-background: #565656; \r\n\t\t\t\t--pitch11-background: #282828; \r\n\t\t\t\t--octave-scrollbar: #ffffff; \r\n\t\t\t\t--scrollbar-octave: #c9c9c9;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"windows\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff0000;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #15a0db;\t\r\n\r\n\t\t\t\t--tonic: #da4e2a;\r\n\t\t\t\t--fifth-note: #5d9511;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #295294; \r\n\t\t\t\t--scrollbar-octave: #fdd01d;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"grassland\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #a0d168;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #74bc21;\t\r\n\r\n\t\t\t\t--tonic: #20330a;\r\n\t\t\t\t--fifth-note: #74bc21;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #74bc21; \r\n\t\t\t\t--scrollbar-octave: #20330a;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"dessert\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff6254;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ff0000;\t\r\n\r\n\t\t\t\t--tonic: #fffc5b;\r\n\t\t\t\t--fifth-note: #ff5e3a;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ff5e3a; \r\n\t\t\t\t--scrollbar-octave: #fffc5b;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"kahootiest\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff3355;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #66bf39;\t\r\n\r\n\t\t\t\t--tonic: #45a3e5;\r\n\t\t\t\t--fifth-note: #864cbf;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #eb670f; \r\n\t\t\t\t--scrollbar-octave: #ff3355;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"beambit\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #fefe00;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #fefe00;\t\r\n\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--tonic: #fefe00;\r\n\t\t\t\t--pitch1-background: #111111; \r\n\t\t\t\t--pitch2-background: #111111; \r\n\t\t\t\t--pitch3-background: #111111; \r\n\t\t\t\t--pitch4-background: #fa0103;\r\n\t\t\t\t--pitch5-background: #111111; \r\n\t\t\t\t--pitch6-background: #111111; \r\n\t\t\t\t--fifth-note: #111111; \r\n\t\t\t\t--pitch8-background: #0001fc; \r\n\t\t\t\t--pitch9-background: #111111; \r\n\t\t\t\t--pitch10-background: #111111; \r\n\t\t\t\t--pitch11-background: #111111;\r\n\r\n\t\t\t\t--octave-scrollbar: #0001fc; \r\n\t\t\t\t--scrollbar-octave: #fa0103;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"egg\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #6b003a;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #f01d7a;\t\r\n\r\n\t\t\t\t--tonic: #fffafa;\r\n\t\t\t\t--fifth-note: #ff91ce;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ffb1f4; \r\n\t\t\t\t--scrollbar-octave: #b4001b;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"Poniryoshka\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #4b4b4b;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ffc100;\t\r\n\r\n\t\t\t\t--tonic: #1a2844;\r\n\t\t\t\t--fifth-note: #dabbe6;\r\n\t\t\t\t--pitch4-background: #faf4c3;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #5f4c99; \r\n\t\t\t\t--scrollbar-octave: #ff8291;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"gameboy\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #9bbc0f;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #8bac0f;\t\r\n\r\n\t\t\t\t--tonic: #9bbc0f; \r\n\t\t\t\t--pitch1-background: #9bbc0f; \r\n\t\t\t\t--pitch2-background: #9bbc0f; \r\n\t\t\t\t--pitch3-background: #9bbc0f; \r\n\t\t\t\t--pitch4-background: #9bbc0f;\r\n\t\t\t\t--pitch5-background: #9bbc0f; \r\n\t\t\t\t--pitch6-background: #306230; \r\n\t\t\t\t--fifth-note: #306230; \r\n\t\t\t\t--pitch8-background: #306230; \r\n\t\t\t\t--pitch9-background: #0f380f; \r\n\t\t\t\t--pitch10-background: #0f380f; \r\n\t\t\t\t--pitch11-background: #0f380f; \r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #9bbc0f; \r\n\t\t\t\t--scrollbar-octave: #8bac0f;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"woodkid\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #e83c4e;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ef3027;\t\r\n\r\n\t\t\t\t--tonic: #fff6fe;\r\n\t\t\t\t--pitch1-background: #41323b;\r\n\t\t\t\t--pitch2-background: #41323b;\r\n\t\t\t\t--pitch3-background: #41323b;\r\n\t\t\t\t--pitch4-background: #fff6fe;\r\n\t\t\t\t--pitch5-background: #41323b;\r\n\t\t\t\t--pitch6-background: #41323b;\r\n\t\t\t\t--fifth-note: #fff6fe;\r\n\t\t\t\t--pitch8-background: #41323b;\r\n\t\t\t\t--pitch9-background: #41323b;\r\n\t\t\t\t--pitch10-background: #41323b;\r\n\t\t\t\t--pitch11-background: #41323b;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ef3027; \r\n\t\t\t\t--scrollbar-octave: #ffedca;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"midnight\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #445566;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #aa5599;\t\r\n\r\n\t\t\t\t--tonic: #222222;\r\n\t\t\t\t--pitch1-background: #222222;\r\n\t\t\t\t--pitch2-background: #222222;\r\n\t\t\t\t--pitch3-background: #222222;\r\n\t\t\t\t--pitch4-background: #222222;\r\n\t\t\t\t--pitch5-background: #222222;\r\n\t\t\t\t--pitch6-background:#222222;\r\n\t\t\t\t--fifth-note: #444444;\r\n\t\t\t\t--pitch8-background: #222222;\r\n\t\t\t\t--pitch9-background: #222222;\r\n\t\t\t\t--pitch10-background: #222222;\r\n\t\t\t\t--pitch11-background: #222222;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #444444; \r\n\t\t\t\t--scrollbar-octave: #aa5599;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"snedbox\": `\r\n\t\t:root {\r\n\t\t\t--page-margin: black;\r\n\t\t\t--editor-background: black;\r\n\t\t\t--hover-preview: white;\r\n\t\t\t--playhead: white;\r\n\t\t\t--primary-text: white;\r\n\t\t\t--secondary-text: #999;\r\n\t\t\t--inverted-text: black;\r\n\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t--loop-accent: #a53a3d;\r\n\t\t\t--link-accent: #98f;\r\n\t\t\t--ui-widget-background: #363636;\r\n\t\t\t--ui-widget-focus: #777;\r\n\t\t\t--pitch-background: #444;\r\n\t\t\t--tonic: #864;\r\n\t\t\t--fifth-note: #60389b;\r\n\t\t\t--pitch4-background: #10997e;\r\n\t\t\t--volume-icon: #a53a3d;\r\n\t\t\t--octave-scrollbar: #444;\r\n\t\t\t--scrollbar-octave: #a53a3d;\r\n\t\t\t--channel-box: #444;\r\n\r\n\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t--pitch10-primary-note:     #d85d00;\r\n\r\n\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\r\n\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t--pitch12-primary-note:     #c26afc;\r\n\r\n\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t}\r\n\t`,\r\n\t\"unnamed\": `\r\n\t:root {\r\n\t\t\t--page-margin: black;\r\n\t\t\t--editor-background: black;\r\n\t\t\t--hover-preview: white;\r\n\t\t\t--playhead: white;\r\n\t\t\t--primary-text: white;\r\n\t\t\t--secondary-text: #999;\r\n\t\t\t--inverted-text: black;\r\n\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t--loop-accent: #ffffff;\r\n\t\t\t--link-accent: #98f;\r\n\t\t\t--ui-widget-background: #363636;\r\n\t\t\t--ui-widget-focus: #777;\r\n\t\t\t--pitch-background: #444;\r\n\t\t\t--pitch1-background: #ffffa0;\r\n\t\t\t--pitch2-background: #ffffa0;\r\n\t\t\t--pitch3-background: #ffffa0;\r\n\t\t\t--pitch4-background: #ffffa0;\r\n\t\t\t--pitch5-background: #ffffa0;\r\n\t\t\t--pitch6-background: #ffffa0;\r\n\t\t\t--pitch8-background: #ffffa0;\r\n\t\t\t--pitch9-background: #ffffa0;\r\n\t\t\t--pitch10-background: #ffffa0;\r\n\t\t\t--pitch11-background: #ffffa0;\r\n\t\t\t--pitch12-background: #ffffa0;\r\n\t\t\t--tonic: #ffffa0;\r\n\t\t\t--fifth-note: #ffffa0;\r\n\t\t\t--volume-icon: #ffffff;\t\r\n\r\n\t\t\t--octave-scrollbar: #ffffff;\r\n\t\t\t--scrollbar-octave: #ffffff;\r\n\r\n\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t\"piano\": `\r\n\t:root {\r\n\t\t\t--page-margin: black;\r\n\t\t\t--editor-background: black;\r\n\t\t\t--hover-preview: white;\r\n\t\t\t--playhead: white;\r\n\t\t\t--primary-text: white;\r\n\t\t\t--secondary-text: #999;\r\n\t\t\t--inverted-text: black;\r\n\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t--loop-accent: #ffffff;\r\n\t\t\t--link-accent: #98f;\r\n\t\t\t--ui-widget-background: #363636;\r\n\t\t\t--ui-widget-focus: #777;\r\n\r\n\t\t\t--use-piano-scheme: true;\r\n\r\n\t\t\t--pitch-background: #444;\r\n\t\t\t--volume-icon: #ff0000;\t\r\n\r\n\t\t\t--tonic: #ffffff;\r\n\t\t\t--white-tonic: #fff;\r\n\t\t\t--black-tonic: #222;\r\n\t\t\t--fifth-note: #7a7a7a;\r\n\r\n\t\t\t--octave-scrollbar: #211616;\r\n\t\t\t--scrollbar-octave: #ff4c4c;\r\n\t\t\t--pitch-white-key: #bfbfbf;\r\n\t\t\t--pitch-black-key: #7a7a7a;\r\n\r\n\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t\"halloween\": `\r\n\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #9e2200;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #9e2200;\t\r\n\r\n\t\t\t\t--tonic: #681701;\r\n\t\t\t\t--pitch1-background: #754a3f;\r\n\t\t\t\t--pitch2-background: #754a3f;\r\n\t\t\t\t--pitch3-background: #754a3f;\r\n\t\t\t\t--pitch4-background: #754a3f;\r\n\t\t\t\t--pitch5-background: #754a3f;\r\n\t\t\t\t--pitch6-background:#754a3f;\r\n\t\t\t\t--fifth-note: #914300;\r\n\t\t\t\t--pitch8-background: #754a3f;\r\n\t\t\t\t--pitch9-background: #754a3f;\r\n\t\t\t\t--pitch10-background: #754a3f;\r\n\t\t\t\t--pitch11-background: #754a3f;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #9e2200; \r\n\t\t\t\t--scrollbar-octave: #701800;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t\"frozen\": `\r\n\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #38ef17;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ed2d2d;\t\r\n\r\n\t\t\t\t--tonic: #88bce8; \r\n\t\t\t\t--pitch1-background: #99c8ef; \r\n\t\t\t\t--pitch2-background: #abd3f4; \r\n\t\t\t\t--pitch3-background: #b8d7f2; \r\n\t\t\t\t--pitch4-background: #cbe0f2;\r\n\t\t\t\t--pitch5-background: #e5f0f9; \r\n\t\t\t\t--pitch6-background: #ffffff; \r\n\t\t\t\t--fifth-note: #e5f0f9; \r\n\t\t\t\t--pitch8-background: #cbe0f2; \r\n\t\t\t\t--pitch9-background: #b8d7f2; \r\n\t\t\t\t--pitch10-background: #abd3f4; \r\n\t\t\t\t--pitch11-background: #99c8ef;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ffffff; \r\n\t\t\t\t--scrollbar-octave: #ed2d2d;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t}\r\n\r\n    public static readonly pageMargin: string = \"var(--page-margin, black)\";\r\n    public static readonly editorBackground: string = \"var(--editor-background, black)\";\r\n    public static readonly hoverPreview: string = \"var(--hover-preview, white)\";\r\n    public static readonly playhead: string = \"var(--playhead, white)\";\r\n    public static readonly primaryText: string = \"var(--primary-text, white)\";\r\n    public static readonly secondaryText: string = \"var(--secondary-text, #999)\";\r\n    public static readonly invertedText: string = \"var(--inverted-text, black)\";\r\n    public static readonly textSelection: string = \"var(--text-selection, rgba(119,68,255,0.99))\";\r\n    public static readonly boxSelectionFill: string = \"var(--box-selection-fill, rgba(255,255,255,0.2))\";\r\n    public static readonly loopAccent: string = \"var(--loop-accent, #9900cc)\";\r\n    public static readonly linkAccent: string = \"var(--link-accent, #98f)\";\r\n    public static readonly uiWidgetBackground: string = \"var(--ui-widget-background, #444)\";\r\n    public static readonly uiWidgetFocus: string = \"var(--ui-widget-focus)\";\r\n    public static readonly pitchBackground: string = \"var(--pitch-background, #444)\";\r\n    public static readonly tonic: string = \"var(--tonic, #864)\";\r\n    public static readonly fifthNote: string = \"var(--fifth-note, #468)\";\r\n\r\n\tpublic static readonly pitch1Background: string = \"var(--pitch1-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch2Background: string = \"var(--pitch2-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch3Background: string = \"var(--pitch3-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch4Background: string = \"var(--pitch4-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch5Background: string = \"var(--pitch5-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch6Background: string = \"var(--pitch6-background, var(--pitch-background, #444))\";\r\n\t// no need for a 7th since that's the --fifth-note's job\r\n\tpublic static readonly pitch8Background: string = \"var(--pitch8-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch9Background: string = \"var(--pitch9-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch10Background: string = \"var(--pitch10-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch11Background: string = \"var(--pitch11-background, var(--pitch-background, #444))\";\r\n    public static readonly volumeIcon: string = \"var(--volume-icon, #777777)\";\r\n\tpublic static readonly octaveScrollbar: string = \"var(--octave-scrollbar, #444444)\";\r\n\tpublic static readonly scrollbarOctave: string = \"var(--scrollbar-octave, #886644)\";\r\n\tpublic static readonly channelBox: string = \"var(--channel-box, #444444)\";\r\n\tpublic static readonly blackPianoKey: string = \"var(--black-piano-key, #000)\";\r\n\tpublic static readonly whitePianoKey: string = \"var(--white-piano-key, #fff)\";\r\n\t\r\n\tpublic static readonly pitchChannels: DictionaryArray<ChannelColors> = toNameMap([\r\n        {\r\n            name: \"pitch1\", // cyan\r\n            secondaryChannel: \"var(--pitch1-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch1-primary-channel)\",\r\n            secondaryNote: \"var(--pitch1-secondary-note)\",\r\n            primaryNote: \"var(--pitch1-primary-note)\",\r\n        }, {\r\n            name: \"pitch2\", // yellow\r\n            secondaryChannel: \"var(--pitch2-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch2-primary-channel)\",\r\n            secondaryNote: \"var(--pitch2-secondary-note)\",\r\n            primaryNote: \"var(--pitch2-primary-note)\",\r\n        }, {\r\n            name: \"pitch3\", // orange\r\n            secondaryChannel: \"var(--pitch3-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch3-primary-channel)\",\r\n            secondaryNote: \"var(--pitch3-secondary-note)\",\r\n            primaryNote: \"var(--pitch3-primary-note)\",\r\n        }, {\r\n            name: \"pitch4\", // green\r\n            secondaryChannel: \"var(--pitch4-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch4-primary-channel)\",\r\n            secondaryNote: \"var(--pitch4-secondary-note)\",\r\n            primaryNote: \"var(--pitch4-primary-note)\",\r\n        }, {\r\n            name: \"pitch5\", // magenta\r\n            secondaryChannel: \"var(--pitch5-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch5-primary-channel)\",\r\n            secondaryNote: \"var(--pitch5-secondary-note)\",\r\n            primaryNote: \"var(--pitch5-primary-note)\",\r\n        }, {\r\n            name: \"pitch6\", // blue\r\n            secondaryChannel: \"var(--pitch6-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch6-primary-channel)\",\r\n            secondaryNote: \"var(--pitch6-secondary-note)\",\r\n            primaryNote: \"var(--pitch6-primary-note)\",\r\n        }, {\r\n            name: \"pitch7\", // olive\r\n            secondaryChannel: \"var(--pitch7-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch7-primary-channel)\",\r\n            secondaryNote: \"var(--pitch7-secondary-note)\",\r\n            primaryNote: \"var(--pitch7-primary-note)\",\r\n        }, {\r\n            name: \"pitch8\", // red\r\n            secondaryChannel: \"var(--pitch8-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch8-primary-channel)\",\r\n            secondaryNote: \"var(--pitch8-secondary-note)\",\r\n            primaryNote: \"var(--pitch8-primary-note)\",\r\n        }, {\r\n            name: \"pitch9\", // teal\r\n            secondaryChannel: \"var(--pitch9-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch9-primary-channel)\",\r\n            secondaryNote: \"var(--pitch9-secondary-note)\",\r\n            primaryNote: \"var(--pitch9-primary-note)\",\r\n        }, {\r\n            name: \"pitch10\", // purple\r\n            secondaryChannel: \"var(--pitch10-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch10-primary-channel)\",\r\n            secondaryNote: \"var(--pitch10-secondary-note)\",\r\n            primaryNote: \"var(--pitch10-primary-note)\",\r\n        },\r\n\t\t{\r\n            name: \"pitch11\", // teal\r\n            secondaryChannel: \"var(--pitch11-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch11-primary-channel)\",\r\n            secondaryNote: \"var(--pitch11-secondary-note)\",\r\n            primaryNote: \"var(--pitch11-primary-note)\",\r\n        }, {\r\n            name: \"pitch12\", // purple\r\n            secondaryChannel: \"var(--pitch12-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch12-primary-channel)\",\r\n            secondaryNote: \"var(--pitch12-secondary-note)\",\r\n            primaryNote: \"var(--pitch12-primary-note)\",\r\n        },\r\n    ]);\r\n\tpublic static readonly noiseChannels: DictionaryArray<ChannelColors> = toNameMap([\r\n        {\r\n            name: \"noise1\", // gray\r\n            secondaryChannel: \"var(--noise1-secondary-channel)\",\r\n            primaryChannel: \"var(--noise1-primary-channel)\",\r\n            secondaryNote: \"var(--noise1-secondary-note)\",\r\n            primaryNote: \"var(--noise1-primary-note)\",\r\n        }, {\r\n            name: \"noise2\", // brown\r\n            secondaryChannel: \"var(--noise2-secondary-channel)\",\r\n            primaryChannel: \"var(--noise2-primary-channel)\",\r\n            secondaryNote: \"var(--noise2-secondary-note)\",\r\n            primaryNote: \"var(--noise2-primary-note)\",\r\n        }, {\r\n            name: \"noise3\", // azure\r\n            secondaryChannel: \"var(--noise3-secondary-channel)\",\r\n            primaryChannel: \"var(--noise3-primary-channel)\",\r\n            secondaryNote: \"var(--noise3-secondary-note)\",\r\n            primaryNote: \"var(--noise3-primary-note)\",\r\n        }, {\r\n            name: \"noise4\", // purple\r\n            secondaryChannel: \"var(--noise4-secondary-channel)\",\r\n            primaryChannel: \"var(--noise4-primary-channel)\",\r\n            secondaryNote: \"var(--noise4-secondary-note)\",\r\n            primaryNote: \"var(--noise4-primary-note)\",\r\n        },\r\n    ]);\r\n\r\n\tpublic static getChannelColor(song: Song, channel: number): ChannelColors {\r\n\t\treturn channel < song.pitchChannelCount\r\n\t\t\t? ColorConfig.pitchChannels[channel % ColorConfig.pitchChannels.length]\r\n\t\t\t: ColorConfig.noiseChannels[(channel - song.pitchChannelCount) % ColorConfig.noiseChannels.length];\r\n\t}\r\n\t\tprivate static readonly _styleElement: HTMLStyleElement = document.head.appendChild(HTML.style({type: \"text/css\"}));\r\n\t\t\r\n\tpublic static setTheme(theme: string): void {\r\n\t\tthis._styleElement.textContent = this._themeMap[theme];\r\n\t\tthis.usesPianoScheme = (getComputedStyle(this._styleElement).getPropertyValue(\"--use-piano-scheme\").trim() == \"true\");\r\n\t\tconsole.log(\"use-piano-scheme: \"+this.usesPianoScheme);\r\n\t}\r\n}","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Note, NotePin, makeNotePin, makeNote, Pattern } from \"../synth/synth\";\nimport {Config} from \"../synth/SynthConfig\";\nimport { UndoableChange, ChangeSequence } from \"./Change\";\nimport { ChangeChannelBar, ChangeNoteAdded, ChangeNoteTruncate, ChangePinTime, ChangeVolumeBend, ChangePitchBend, ChangePitchAdded, ChangeEnsurePatternExists } from \"./changes\";\nimport { ColorConfig } from \"./ColorConfig\";\n\tconst {div} = HTML;\n\n\n\tfunction prettyNumber(value: number): string {\n\t\treturn value.toFixed(2).replace(/\\.?0*$/, \"\");\n\t}\n\t\n\tfunction makeEmptyReplacementElement(node: Node): Node {\n\t\tconst clone: Node = node.cloneNode(false);\n\t\tnode.parentNode!.replaceChild(clone, node);\n\t\treturn clone;\n\t}\n\t\n\tclass PatternCursor {\n\t\tpublic valid:        boolean = false;\n\t\tpublic prevNote:     Note | null = null;\n\t\tpublic curNote:      Note | null = null;\n\t\tpublic nextNote:     Note | null = null;\n\t\tpublic pitch:        number = 0;\n\t\tpublic pitchIndex:   number = -1;\n\t\tpublic curIndex:     number = 0;\n\t\tpublic start:        number = 0;\n\t\tpublic end:          number = 0;\n\t\tpublic part:         number = 0;\n\t\tpublic notePart:     number = 0;\n\t\tpublic nearPinIndex: number = 0;\n\t\tpublic pins:         NotePin[] = [];\n\t}\n\t\n\texport class PatternEditor {\n\t\tprivate readonly _svgNoteBackground: SVGPatternElement = <SVGPatternElement> SVG.pattern( {id: \"patternEditorNoteBackground\", x: \"0\", y: \"0\", width: \"64\", height: \"156\", patternUnits: \"userSpaceOnUse\"});\n\t\tprivate readonly _svgDrumBackground: SVGPatternElement = <SVGPatternElement> SVG.pattern( {id: \"patternEditorDrumBackground\", x: \"0\", y: \"0\", width: \"64\", height: \"40\", patternUnits: \"userSpaceOnUse\"});\n\t\tprivate readonly _svgBackground: SVGRectElement = <SVGRectElement> SVG.rect( {x: \"0\", y: \"0\", width: \"512\", height: \"481\", \"pointer-events\": \"none\", fill: \"url(#patternEditorNoteBackground)\"});\n\t\tprivate _svgNoteContainer: SVGSVGElement = <SVGSVGElement> SVG.svg();\n\t\tprivate readonly _svgPlayhead: SVGRectElement = <SVGRectElement> SVG.rect( {id: \"\", x: \"0\", y: \"0\", width: \"4\", height: \"481\", fill: \"white\", \"pointer-events\": \"none\"});\n\t\tprivate readonly _svgPreview: SVGPathElement = <SVGPathElement> SVG.path( {fill: \"none\", stroke: \"white\", \"stroke-width\": \"2\", \"pointer-events\": \"none\"});\n\t\tprivate readonly _svg: SVGSVGElement = <SVGSVGElement> SVG.svg( {style: \"touch-action: none; position: absolute;\", width: \"100%\", height: \"100%\", viewBox: \"0 0 512 481\", preserveAspectRatio: \"none\"}, [\n\t\t\tSVG.defs( undefined, [\n\t\t\t\tthis._svgNoteBackground,\n\t\t\t\tthis._svgDrumBackground,\n\t\t\t]),\n\t\t\tthis._svgBackground,\n\t\t\tthis._svgNoteContainer,\n\t\t\tthis._svgPreview,\n\t\t\tthis._svgPlayhead,\n\t\t]);\n\t\tpublic readonly container: HTMLDivElement = div({style: \"height: 100%; overflow:hidden; position: relative; flex-grow: 1;\"}, [this._svg]);\n\t\t\n\t\tprivate readonly _defaultPitchHeight: number = 13;\n\t\tprivate readonly _defaultDrumHeight: number = 40;\n\t\tprivate readonly _backgroundPitchRows: SVGRectElement[] = [];\n\t\tprivate readonly _backgroundDrumRow: SVGRectElement = <SVGRectElement> SVG.rect();\n\t\t// The below array is unused.\n\t\tpublic readonly _defaultPinChannels: NotePin[][] = [\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 3)],\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 3)],\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 3)],\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 0)],\n\t\t];\n\t\t\n\t\tprivate _editorWidth: number;\n\t\tprivate _editorHeight: number = 481;\n\t\tprivate _partWidth: number;\n\t\tprivate _pitchHeight: number;\n\t\tprivate _pitchCount: number;\n\t\tprivate _mouseX: number = 0;\n\t\tprivate _mouseY: number = 0;\n\t\tprivate _mouseDown: boolean = false;\n\t\tprivate _mouseOver: boolean = false;\n\t\tprivate _mouseDragging: boolean = false;\n\t\tprivate _mouseHorizontal: boolean = false;\n\t\tprivate _usingTouch: boolean = false;\n\t\tprivate _copiedPinChannels: NotePin[][] = [];\n\t\tprivate _copiedPins: NotePin[];\n\t\tprivate _mouseXStart: number = 0;\n\t\tprivate _mouseYStart: number = 0;\n\t\tpublic _mouseXPrev: number = 0;\n\t\tpublic _mouseYPrev: number = 0;\n\t\tprivate _dragTime: number = 0;\n\t\tprivate _dragPitch: number = 0;\n\t\tprivate _dragVolume: number = 0;\n\t\tprivate _dragVisible: boolean = false;\n\t\t//private _precise: boolean = false;\n\t\t//private _precisionX: number = 0;\n\t\tprivate _dragChange: UndoableChange | null = null;\n\t\tprivate _cursor: PatternCursor = new PatternCursor();\n\t\tprivate _pattern: Pattern | null = null;\n\t\tprivate _playheadX: number = 0.0;\n\t\tprivate _octaveOffset: number = 0;\n\t\tprivate _renderedWidth: number = -1;\n\t\tprivate _renderedBeatWidth: number = -1;\n\t\tprivate _renderedFifths: boolean = false;\n\t\tprivate _renderedACS: boolean = false;\n\t\tprivate _renderedPiano: boolean = false;\n\t\tprivate _renderedDrums: boolean = false;\n\t\tprivate _setKey: number = 1;\n\t\tprivate _renderedPartsPerBeat: number = -1;\n\t\tprivate _renderedPitchChannelCount: number = -1;\n\t\tprivate _renderedDrumChannelCount: number = -1;\n\t\tprivate _followPlayheadBar: number = -1;\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tfor (let i: number = 0; i < 12; i++) {\n\t\t\t\tconst y: number = (12 - i) % 12;\n\t\t\t\tconst rectangle: SVGRectElement = <SVGRectElement> SVG.rect();\n\t\t\t\trectangle.setAttribute(\"x\", \"1\");\n\t\t\t\trectangle.setAttribute(\"y\", \"\" + (y * this._defaultPitchHeight + 1));\n\t\t\t\trectangle.setAttribute(\"height\", \"\" + (this._defaultPitchHeight - 2));\n\t\t\t\trectangle.setAttribute(\"fill\", (i == 0) ? ColorConfig.tonic : ColorConfig.uiWidgetBackground);\n\t\t\t\tthis._svgNoteBackground.appendChild(rectangle);\n\t\t\t\tthis._backgroundPitchRows[i] = rectangle;\n\t\t\t}\n\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\n\n\t\t\tthis._backgroundDrumRow.setAttribute(\"x\", \"1\");\n\t\t\tthis._backgroundDrumRow.setAttribute(\"y\", \"1\");\n\t\t\tthis._backgroundDrumRow.setAttribute(\"height\", \"\" + (this._defaultDrumHeight - 2));\n\t\t\tthis._backgroundDrumRow.setAttribute(\"fill\", \"#444444\");\n\t\t\tthis._svgDrumBackground.appendChild(this._backgroundDrumRow);\n\t\t\t\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\n\t\t\tthis._documentChanged();\n\t\t\tthis._updateCursorStatus();\n\t\t\tthis._updatePreview();\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\n\t\t\tthis._svg.addEventListener(\"mousedown\", this._whenMousePressed);\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\n\t\t\tthis._svg.addEventListener(\"mouseover\", this._whenMouseOver);\n\t\t\tthis._svg.addEventListener(\"mouseout\", this._whenMouseOut);\n\t\t\t\n\t\t\tthis._svg.addEventListener(\"touchstart\", this._whenTouchPressed);\n\t\t\tthis._svg.addEventListener(\"touchmove\", this._whenTouchMoved);\n\t\t\tthis._svg.addEventListener(\"touchend\", this._whenCursorReleased);\n\t\t\tthis._svg.addEventListener(\"touchcancel\", this._whenCursorReleased);\n\t\t\t\n\t\t\tthis.resetCopiedPins();\n\t\t}\n\t\t\n\t\tprivate _getMaxDivision(): number {\n\t\t\tif (this._doc.song.partsPerBeat % 3 == 0) {\n\t\t\t\t// Beat is divisible by 3.\n\t\t\t\treturn this._doc.song.partsPerBeat / 3;\n\t\t\t} else if (this._doc.song.partsPerBeat % 2 == 0) {\n\t\t\t\t// Beat is divisible by 2.\n\t\t\t\treturn this._doc.song.partsPerBeat / 2;\n\t\t\t}\n\t\t\treturn this._doc.song.partsPerBeat;\n\t\t}\n\t\t\n\t\tprivate _updateCursorStatus(): void {\n\t\t\t//if (this._pattern == null) return;\n\t\t\t\n\t\t\tthis._cursor = new PatternCursor();\n\t\t\t\n\t\t\tif (this._mouseX < 0 || this._mouseX > this._editorWidth || this._mouseY < 0 || this._mouseY > this._editorHeight) return;\n\t\t\t\n\t\t\tthis._cursor.part = Math.floor(Math.max(0, Math.min(this._doc.song.beatsPerBar * this._doc.song.partsPerBeat - 1, this._mouseX / this._partWidth)));\n\t\t\t\n\t\t\tif (this._pattern != null) {\n\t\t\t\tfor (const note of this._pattern.notes) {\n\t\t\t\t\tif (note.end <= this._cursor.part) {\n\t\t\t\t\t\tthis._cursor.prevNote = note;\n\t\t\t\t\t\tthis._cursor.curIndex++;\n\t\t\t\t\t} else if (note.start <= this._cursor.part && note.end > this._cursor.part) {\n\t\t\t\t\t\tthis._cursor.curNote = note;\n\t\t\t\t\t} else if (note.start > this._cursor.part) {\n\t\t\t\t\t\tthis._cursor.nextNote = note;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet mousePitch: number = this._findMousePitch(this._mouseY);\n\t\t\t\n\t\t\tif (this._cursor.curNote != null) {\n\t\t\t\tthis._cursor.start = this._cursor.curNote.start;\n\t\t\t\tthis._cursor.end   = this._cursor.curNote.end;\n\t\t\t\tthis._cursor.pins  = this._cursor.curNote.pins;\n\t\t\t\t\n\t\t\t\tlet interval: number = 0;\n\t\t\t\tlet error: number = 0;\n\t\t\t\tlet prevPin: NotePin;\n\t\t\t\tlet nextPin: NotePin = this._cursor.curNote.pins[0];\n\t\t\t\tfor (let j: number = 1; j < this._cursor.curNote.pins.length; j++) {\n\t\t\t\t\tprevPin = nextPin;\n\t\t\t\t\tnextPin = this._cursor.curNote.pins[j];\n\t\t\t\t\tconst leftSide:    number = this._partWidth * (this._cursor.curNote.start + prevPin.time);\n\t\t\t\t\tconst rightSide:   number = this._partWidth * (this._cursor.curNote.start + nextPin.time);\n\t\t\t\t\tif (this._mouseX > rightSide) continue;\n\t\t\t\t\tif (this._mouseX < leftSide) throw new Error();\n\t\t\t\t\tconst intervalRatio: number = (this._mouseX - leftSide) / (rightSide - leftSide);\n\t\t\t\t\tconst arc: number = Math.sqrt(1.0 / Math.sqrt(4.0) - Math.pow(intervalRatio - 0.5, 2.0)) - 0.5;\n\t\t\t\t\tconst bendHeight: number = Math.abs(nextPin.interval - prevPin.interval);\n\t\t\t\t\tinterval = prevPin.interval * (1.0 - intervalRatio) + nextPin.interval * intervalRatio;\n\t\t\t\t\terror = arc * bendHeight + 1.0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlet minInterval: number = Number.MAX_VALUE;\n\t\t\t\tlet maxInterval: number = -Number.MAX_VALUE;\n\t\t\t\tlet bestDistance: number = Number.MAX_VALUE;\n\t\t\t\tfor (const pin of this._cursor.curNote.pins) {\n\t\t\t\t\tif (minInterval > pin.interval) minInterval = pin.interval;\n\t\t\t\t\tif (maxInterval < pin.interval) maxInterval = pin.interval;\n\t\t\t\t\tconst pinDistance: number = Math.abs(this._cursor.curNote.start + pin.time - this._mouseX / this._partWidth);\n\t\t\t\t\tif (bestDistance > pinDistance) {\n\t\t\t\t\t\tbestDistance = pinDistance;\n\t\t\t\t\t\tthis._cursor.nearPinIndex = this._cursor.curNote.pins.indexOf(pin);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tmousePitch -= interval;\n\t\t\t\tthis._cursor.pitch = this._snapToPitch(mousePitch, -minInterval, (this._doc.song.getChannelIsDrum(this._doc.channel) ? Config.drumCount - 1 : Config.maxPitch) - maxInterval);\n\t\t\t\t\n\t\t\t\t// Snap to nearby existing note if present.\n\t\t\t\t// @TODO: Do this for all channels? ModBox excludes the 4th\n\t\t\t\t// channel for some unknown reason.\n\t\t\t\tif (this._doc.channel != 3/*!this._doc.song.getChannelIsDrum(this._doc.channel)*/) {\n\t\t\t\t\tlet nearest: number = error;\n\t\t\t\t\tfor (let i: number = 0; i < this._cursor.curNote.pitches.length; i++) {\n\t\t\t\t\t\tconst distance: number = Math.abs(this._cursor.curNote.pitches[i] - mousePitch + 0.5);\n\t\t\t\t\t\tif (distance > nearest) continue;\n\t\t\t\t\t\tnearest = distance;\n\t\t\t\t\t\tthis._cursor.pitch = this._cursor.curNote.pitches[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfor (let i: number = 0; i < this._cursor.curNote.pitches.length; i++) {\n\t\t\t\t\tif (this._cursor.curNote.pitches[i] == this._cursor.pitch) {\n\t\t\t\t\t\tthis._cursor.pitchIndex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._cursor.pitch = this._snapToPitch(mousePitch, 0, Config.maxPitch);\n\t\t\t\tconst defaultLength: number = this._copiedPins[this._copiedPins.length-1].time;\n\t\t\t\tconst fullBeats: number = Math.floor(this._cursor.part / this._doc.song.partsPerBeat);\n\t\t\t\tconst maxDivision: number = this._getMaxDivision();\n\t\t\t\tconst modMouse: number = this._cursor.part % this._doc.song.partsPerBeat;\n\t\t\t\tif (defaultLength == 1) {\n\t\t\t\t\tthis._cursor.start = this._cursor.part;\n\t\t\t\t} else if (defaultLength > this._doc.song.partsPerBeat) {\n\t\t\t\t\tthis._cursor.start = fullBeats * this._doc.song.partsPerBeat;\n\t\t\t\t} else if (defaultLength == this._doc.song.partsPerBeat) {\n\t\t\t\t\tthis._cursor.start = fullBeats * this._doc.song.partsPerBeat;\n\t\t\t\t\tif (maxDivision < this._doc.song.partsPerBeat && modMouse > maxDivision) {\n\t\t\t\t\t\tthis._cursor.start += Math.floor(modMouse / maxDivision) * maxDivision;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._cursor.start = fullBeats * this._doc.song.partsPerBeat;\n\t\t\t\t\tlet division = this._doc.song.partsPerBeat % defaultLength == 0 ? defaultLength : Math.min(defaultLength, maxDivision);\n\t\t\t\t\twhile (division < maxDivision && this._doc.song.partsPerBeat % division != 0) {\n\t\t\t\t\t\tdivision++;\n\t\t\t\t\t}\n\t\t\t\t\tthis._cursor.start += Math.floor(modMouse / division) * division;\n\t\t\t\t}\n\t\t\t\tthis._cursor.end = this._cursor.start + defaultLength;\n\t\t\t\tlet forceStart: number = 0;\n\t\t\t\tlet forceEnd: number = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\n\t\t\t\tif (this._cursor.prevNote != null) {\n\t\t\t\t\tforceStart = this._cursor.prevNote.end;\n\t\t\t\t}\n\t\t\t\tif (this._cursor.nextNote != null) {\n\t\t\t\t\tforceEnd   = this._cursor.nextNote.start;\n\t\t\t\t}\n\t\t\t\tif (this._cursor.start < forceStart) {\n\t\t\t\t\tthis._cursor.start = forceStart;\n\t\t\t\t\tthis._cursor.end = this._cursor.start + defaultLength;\n\t\t\t\t\tif (this._cursor.end > forceEnd) {\n\t\t\t\t\t\tthis._cursor.end = forceEnd;\n\t\t\t\t\t}\n\t\t\t\t} else if (this._cursor.end > forceEnd) {\n\t\t\t\t\tthis._cursor.end = forceEnd;\n\t\t\t\t\tthis._cursor.start = this._cursor.end - defaultLength;\n\t\t\t\t\tif (this._cursor.start < forceStart) {\n\t\t\t\t\t\tthis._cursor.start = forceStart;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (this._cursor.end - this._cursor.start == defaultLength) {\n\t\t\t\t\tthis._cursor.pins = this._copiedPins;\n\t\t\t\t} else {\n\t\t\t\t\tthis._cursor.pins = [];\n\t\t\t\t\tfor (const oldPin of this._copiedPins) {\n\t\t\t\t\t\tif (oldPin.time <= this._cursor.end - this._cursor.start) {\n\t\t\t\t\t\t\tthis._cursor.pins.push(makeNotePin(0, oldPin.time, oldPin.volume));\n\t\t\t\t\t\t\tif (oldPin.time == this._cursor.end - this._cursor.start) break;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._cursor.pins.push(makeNotePin(0, this._cursor.end - this._cursor.start, oldPin.volume));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis._cursor.valid = true;\n\t\t}\n\t\t\n\t\tprivate _findMousePitch(pixelY: number): number {\n\t\t\treturn Math.max(0, Math.min(this._pitchCount - 1, this._pitchCount - (pixelY / this._pitchHeight))) + this._octaveOffset;\n\t\t}\n\t\t\n\t\tprivate _snapToPitch(guess: number, min: number, max: number): number {\n\t\t\tif (guess < min) guess = min;\n\t\t\tif (guess > max) guess = max;\n\t\t\tconst scale: ReadonlyArray<boolean> = Config.scaleFlags[this._doc.song.scale];\n\t\t\tif (scale[Math.floor(guess) % 12] || this._doc.song.getChannelIsDrum(this._doc.channel)) {\n\t\t\t\treturn Math.floor(guess);\n\t\t\t} else {\n\t\t\t\tlet topPitch: number = Math.floor(guess) + 1;\n\t\t\t\tlet bottomPitch: number = Math.floor(guess) - 1;\n\t\t\t\twhile (!scale[topPitch % 12]) {\n\t\t\t\t\ttopPitch++;\n\t\t\t\t}\n\t\t\t\twhile (!scale[(bottomPitch) % 12]) {\n\t\t\t\t\tbottomPitch--;\n\t\t\t\t}\n\t\t\t\tif (topPitch > max) {\n\t\t\t\t\tif (bottomPitch < min) {\n\t\t\t\t\t\treturn min;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn bottomPitch;\n\t\t\t\t\t}\n\t\t\t\t} else if (bottomPitch < min) {\n\t\t\t\t\treturn topPitch;\n\t\t\t\t}\n\t\t\t\tlet topRange: number = topPitch;\n\t\t\t\tlet bottomRange: number = bottomPitch + 1;\n\t\t\t\tif (topPitch % 12 == 0 || topPitch % 12 == 7) {\n\t\t\t\t\ttopRange -= 0.5;\n\t\t\t\t}\n\t\t\t\tif (bottomPitch % 12 == 0 || bottomPitch % 12 == 7) {\n\t\t\t\t\tbottomRange += 0.5;\n\t\t\t\t}\n\t\t\t\treturn guess - bottomRange > topRange - guess ? topPitch : bottomPitch;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _copyPins(note: Note): void {\n\t\t\tthis._copiedPins = [];\n\t\t\tfor (const oldPin of note.pins) {\n\t\t\t\tthis._copiedPins.push(makeNotePin(0, oldPin.time, oldPin.volume));\n\t\t\t}\n\t\t\tfor (let i: number = 1; i < this._copiedPins.length - 1; ) {\n\t\t\t\tif (this._copiedPins[i-1].volume == this._copiedPins[i].volume && \n\t\t\t\t    this._copiedPins[i].volume == this._copiedPins[i+1].volume)\n\t\t\t\t{\n\t\t\t\t\tthis._copiedPins.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._copiedPinChannels[this._doc.channel] = this._copiedPins;\n\t\t}\n\t\t\n\t\tpublic resetCopiedPins = (): void => {\n\t\t\tconst maxDivision: number = this._getMaxDivision();\n\t\t\tthis._copiedPinChannels.length = this._doc.song.getChannelCount();\n\t\t\tfor (let i: number = 0; i < this._doc.song.pitchChannelCount; i++) {\n\t\t\t\tthis._copiedPinChannels[i] = [makeNotePin(0, 0, 3), makeNotePin(0, maxDivision, 3)];\n\t\t\t}\n\t\t\tfor (let i: number = this._doc.song.pitchChannelCount; i < this._doc.song.getChannelCount(); i++) {\n\t\t\t\tthis._copiedPinChannels[i] = [makeNotePin(0, 0, 3), makeNotePin(0, maxDivision, 0)];\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _animatePlayhead = (timestamp: number): void => {\n\t\t\tconst playheadBar: number = Math.floor(this._doc.synth.playhead);\n\t\t\tif (this._doc.synth.playing && ((this._pattern != null && this._doc.song.getPattern(this._doc.channel, Math.floor(this._doc.synth.playhead)) == this._pattern) || Math.floor(this._doc.synth.playhead) == this._doc.bar)) {\n\t\t\t\tthis._svgPlayhead.setAttribute(\"visibility\", \"visible\");\n\t\t\t\tconst modPlayhead: number = this._doc.synth.playhead - playheadBar;\n\t\t\t\tif (Math.abs(modPlayhead - this._playheadX) > 0.1) {\n\t\t\t\t\tthis._playheadX = modPlayhead;\n\t\t\t\t} else {\n\t\t\t\t\tthis._playheadX += (modPlayhead - this._playheadX) * 0.2;\n\t\t\t\t}\n\t\t\t\tthis._svgPlayhead.setAttribute(\"x\", \"\" + prettyNumber(this._playheadX * this._editorWidth - 2));\n\t\t\t} else {\n\t\t\t\tthis._svgPlayhead.setAttribute(\"visibility\", \"hidden\"); \n\t\t\t}\n\t\t\t\n\t\t\tif (this._doc.synth.playing && this._doc.autoFollow && this._followPlayheadBar != playheadBar) {\n\t\t\t\tnew ChangeChannelBar(this._doc, this._doc.channel, playheadBar);\n\t\t\t\tthis._doc.notifier.notifyWatchers();\n\t\t\t}\n\t\t\tthis._followPlayheadBar = playheadBar;\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\n\t\t}\n\t\t\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\n\t\t\tif (this._mouseOver) return;\n\t\t\tthis._mouseOver = true;\n\t\t\tthis._usingTouch = false;\n\t\t}\n\t\t\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\n\t\t\tif (!this._mouseOver) return;\n\t\t\tthis._mouseOver = false;\n\t\t}\n\t\t\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = ((event.clientX || event.pageX) - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t\tthis._usingTouch = false;\n\t\t\tthis._whenCursorPressed();\n\t\t}\n\t\t\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n\t\t\tthis._mouseX = (event.touches[0].clientX - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t\tthis._usingTouch = true;\n\t\t\tthis._whenCursorPressed();\n\t\t}\n\t\t\n\t\tprivate _whenCursorPressed(): void {\n\t\t\tthis._mouseDown = true;\n\t\t\tthis._mouseXStart = this._mouseX;\n\t\t\tthis._mouseYStart = this._mouseY;\n\t\t\tthis._mouseXPrev = this._mouseX;\n\t\t\tthis._mouseYPrev = this._mouseY;\n\t\t\tthis._updateCursorStatus();\n\t\t\tthis._updatePreview();\n\t\t\tthis._dragChange = new ChangeSequence();\n\t\t\tthis._doc.setProspectiveChange(this._dragChange);\n\t\t}\n\t\t\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = ((event.clientX || event.pageX) - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t\tthis._usingTouch = false;\n\t\t    this._whenCursorMoved();\n\t\t}\n\t\t\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\n\t\t\tif (!this._mouseDown) return;\n\t\t\tevent.preventDefault();\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n\t\t\tthis._mouseX = (event.touches[0].clientX - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t    this._whenCursorMoved();\n\t\t}\n\t\t\n\t\tprivate _whenCursorMoved(): void {\n\t\t\tlet start: number;\n\t\t\tlet end: number;\n\t\t\t\n\t\t\t// HACK: Undoable pattern changes rely on persistent instance\n\t\t\t// references. Loading song from hash via undo/redo breaks that,\n\t\t\t// so changes are no longer undoable and the cursor status may be\n\t\t\t// invalid. Abort further drag changes until the mouse is released.\n\t\t\tconst continuousState: boolean = this._doc.lastChangeWas(this._dragChange);\n\t\t\t\n\t\t\tif (this._mouseDown && this._cursor.valid && continuousState) {\n\t\t\t\tif (!this._mouseDragging) {\n\t\t\t\t\tconst dx: number = this._mouseX - this._mouseXStart;\n\t\t\t\t\tconst dy: number = this._mouseY - this._mouseYStart;\n\t\t\t\t\tif (Math.sqrt(dx * dx + dy * dy) > 5) {\n\t\t\t\t\t\tthis._mouseDragging = true;\n\t\t\t\t\t\tthis._mouseHorizontal = Math.abs(dx) >= Math.abs(dy);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (this._mouseDragging) {\n\t\t\t\t\tif (this._dragChange != null) {\n\t\t\t\t\t\tthis._dragChange.undo();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst currentPart: number = Math.floor(this._mouseX / this._partWidth);\n\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\n\t\t\t\t\tthis._dragChange = sequence;\n\t\t\t\t\tthis._doc.setProspectiveChange(this._dragChange);\n\t\t\t\t\t\n\t\t\t\t\tif (this._cursor.curNote == null) {\n\t\t\t\t\t\tlet backwards: boolean;\n\t\t\t\t\t\tlet directLength: number;\n\t\t\t\t\t\tif (currentPart < this._cursor.start) {\n\t\t\t\t\t\t\tbackwards = true;\n\t\t\t\t\t\t\tdirectLength = this._cursor.start - currentPart;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbackwards = false;\n\t\t\t\t\t\t\tdirectLength = currentPart - this._cursor.start + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet defaultLength: number = 1;\n\t\t\t\t\t\tfor (let i: number = 0; i <= this._doc.song.beatsPerBar * this._doc.song.partsPerBeat; i++) {\n\t\t\t\t\t\t\tif (i >= 5 &&\n\t\t\t\t\t\t\t    i % this._doc.song.partsPerBeat != 0 &&\n\t\t\t\t\t\t\t    i != this._doc.song.partsPerBeat * 3.0 / 2.0 &&\n\t\t\t\t\t\t\t    i != this._doc.song.partsPerBeat * 4.0 / 3.0 &&\n\t\t\t\t\t\t\t    i != this._doc.song.partsPerBeat * 5.0 / 3.0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst blessedLength: number = i;\n\t\t\t\t\t\t\tif (blessedLength == directLength) {\n\t\t\t\t\t\t\t\tdefaultLength = blessedLength;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (blessedLength < directLength) {\n\t\t\t\t\t\t\t\tdefaultLength = blessedLength;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (blessedLength > directLength) {\n\t\t\t\t\t\t\t\tif (defaultLength < directLength - 1) {\n\t\t\t\t\t\t\t\t\tdefaultLength = blessedLength;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t/*\n\t\t\t\t\t\tif (defaultLength < directLength) {\n\t\t\t\t\t\t\t// See if I can find a better match by snapping to an existing note...\n\t\t\t\t\t\t\t// E.G. in another channel\n\t\t\t\t\t\t}\n\t\t\t\t\t\t*/\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (backwards) {\n\t\t\t\t\t\t\tend = this._cursor.start;\n\t\t\t\t\t\t\tstart = end - defaultLength;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstart = this._cursor.start;\n\t\t\t\t\t\t\tend = start + defaultLength;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (start < 0) start = 0;\n\t\t\t\t\t\tif (end > this._doc.song.beatsPerBar * this._doc.song.partsPerBeat) end = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\n\t\t\t\t\t\tif (start < end) {\n\t\t\t\t\t\t\tsequence.append(new ChangeEnsurePatternExists(this._doc));\n\t\t\t\t\t\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\n\t\t\t\t\t\t\t\tif (pattern == null) throw new Error();\n\t\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, pattern, start, end));\n\t\t\t\t\t\t\tlet i: number;\n\t\t\t\t\t\t\tfor (i = 0; i < pattern.notes.length; i++) {\n\t\t\t\t\t\t\t\tif (pattern.notes[i].start >= end) break;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst theNote: Note = makeNote(this._cursor.pitch, start, end, 3, this._doc.song.getChannelIsDrum(this._doc.channel));\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteAdded(this._doc, pattern, theNote, i));\n\t\t\t\t\t\t\tthis._copyPins(theNote);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tthis._dragTime = backwards ? start : end;\n\t\t\t\t\t\t\tthis._dragPitch = this._cursor.pitch;\n\t\t\t\t\t\t\tthis._dragVolume = theNote.pins[backwards ? 0 : 1].volume;\n\t\t\t\t\t\t\tthis._dragVisible = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._pattern = this._doc.getCurrentPattern();\n\t\t\t\t\t} else if (this._mouseHorizontal) {\n\t\t\t\t\t\tconst shift: number = Math.round((this._mouseX - this._mouseXStart) / this._partWidth);\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst shiftedPin: NotePin = this._cursor.curNote.pins[this._cursor.nearPinIndex];\n\t\t\t\t\t\tlet shiftedTime: number = this._cursor.curNote.start + shiftedPin.time + shift;\n\t\t\t\t\t\tif (shiftedTime < 0) shiftedTime = 0;\n\t\t\t\t\t\tif (shiftedTime > this._doc.song.beatsPerBar * this._doc.song.partsPerBeat) shiftedTime = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (this._pattern == null) throw new Error();\n\n\t\t\t\t\t\tif (shiftedTime <= this._cursor.curNote.start && this._cursor.nearPinIndex == this._cursor.curNote.pins.length - 1 ||\n\t\t\t\t\t\t    shiftedTime >= this._cursor.curNote.end   && this._cursor.nearPinIndex == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteAdded(this._doc, this._pattern, this._cursor.curNote, this._cursor.curIndex, true));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tthis._dragVisible = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstart = Math.min(this._cursor.curNote.start, shiftedTime);\n\t\t\t\t\t\t\tend   = Math.max(this._cursor.curNote.end,   shiftedTime);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tthis._dragTime = shiftedTime;\n\t\t\t\t\t\t\tthis._dragPitch = this._cursor.curNote.pitches[this._cursor.pitchIndex == -1 ? 0 : this._cursor.pitchIndex] + this._cursor.curNote.pins[this._cursor.nearPinIndex].interval;\n\t\t\t\t\t\t\tthis._dragVolume = this._cursor.curNote.pins[this._cursor.nearPinIndex].volume;\n\t\t\t\t\t\t\tthis._dragVisible = true;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (this._pattern == null) throw new Error();\n\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, this._pattern, start, end, this._cursor.curNote));\n\t\t\t\t\t\t\tsequence.append(new ChangePinTime(this._doc, this._cursor.curNote, this._cursor.nearPinIndex, shiftedTime));\n\t\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (this._cursor.pitchIndex == -1) {\n\t\t\t\t\t\tconst bendPart: number = Math.round(Math.max(this._cursor.curNote.start, Math.min(this._cursor.curNote.end, this._mouseX / this._partWidth))) - this._cursor.curNote.start;\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet prevPin: NotePin;\n\t\t\t\t\t\tlet nextPin: NotePin = this._cursor.curNote.pins[0];\n\t\t\t\t\t\tlet bendVolume: number = 0;\n\t\t\t\t\t\tlet bendInterval: number = 0;\n\t\t\t\t\t\tfor (let i: number = 1; i < this._cursor.curNote.pins.length; i++) {\n\t\t\t\t\t\t\tprevPin = nextPin;\n\t\t\t\t\t\t\tnextPin = this._cursor.curNote.pins[i];\n\t\t\t\t\t\t\tif (bendPart > nextPin.time) continue;\n\t\t\t\t\t\t\tif (bendPart < prevPin.time) throw new Error();\n\t\t\t\t\t\t\tconst volumeRatio: number = (bendPart - prevPin.time) / (nextPin.time - prevPin.time);\n\t\t\t\t\t\t\tbendVolume = Math.round(prevPin.volume * (1.0 - volumeRatio) + nextPin.volume * volumeRatio + ((this._mouseYStart - this._mouseY) / 20.0/*25.0*/));\n\t\t\t\t\t\t\tif (bendVolume < 0) bendVolume = 0;\n\t\t\t\t\t\t\tif (bendVolume > 3) bendVolume = 3;\n\t\t\t\t\t\t\tbendInterval = this._snapToPitch(prevPin.interval * (1.0 - volumeRatio) + nextPin.interval * volumeRatio + this._cursor.curNote.pitches[0], 0, Config.maxPitch) - this._cursor.curNote.pitches[0];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis._dragTime = this._cursor.curNote.start + bendPart;\n\t\t\t\t\t\tthis._dragPitch = this._cursor.curNote.pitches[this._cursor.pitchIndex == -1 ? 0 : this._cursor.pitchIndex] + bendInterval;\n\t\t\t\t\t\tthis._dragVolume = bendVolume;\n\t\t\t\t\t\tthis._dragVisible = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\tsequence.append(new ChangeVolumeBend(this._doc, this._cursor.curNote, bendPart, bendVolume, bendInterval));\n\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._dragVolume = this._cursor.curNote.pins[this._cursor.nearPinIndex].volume;\n\n\t\t\t\t\t\tif (this._pattern == null) throw new Error();\n\n\t\t\t\t\t\tlet bendStart: number;\n\t\t\t\t\t\tlet bendEnd: number;\n\t\t\t\t\t\tif (this._mouseX >= this._mouseXStart) {\n\t\t\t\t\t\t\tbendStart = this._cursor.part;\n\t\t\t\t\t\t\tbendEnd   = currentPart + 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbendStart = this._cursor.part + 1;\n\t\t\t\t\t\t\tbendEnd   = currentPart;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (bendEnd < 0) bendEnd = 0;\n\t\t\t\t\t\tif (bendEnd > this._doc.song.beatsPerBar * this._doc.song.partsPerBeat) bendEnd = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\n\t\t\t\t\t\tif (bendEnd > this._cursor.curNote.end) {\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, this._pattern, this._cursor.curNote.start, bendEnd, this._cursor.curNote));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (bendEnd < this._cursor.curNote.start) {\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, this._pattern, bendEnd, this._cursor.curNote.end, this._cursor.curNote));\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet minPitch: number = Number.MAX_VALUE;\n\t\t\t\t\t\tlet maxPitch: number = -Number.MAX_VALUE;\n\t\t\t\t\t\tfor (const pitch of this._cursor.curNote.pitches) {\n\t\t\t\t\t\t\tif (minPitch > pitch) minPitch = pitch;\n\t\t\t\t\t\t\tif (maxPitch < pitch) maxPitch = pitch;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tminPitch -= this._cursor.curNote.pitches[this._cursor.pitchIndex];\n\t\t\t\t\t\tmaxPitch -= this._cursor.curNote.pitches[this._cursor.pitchIndex];\n\t\t\t\t\t\tconst bendTo: number = this._snapToPitch(this._findMousePitch(this._mouseY), -minPitch, (this._doc.song.getChannelIsDrum(this._doc.channel) ? Config.drumCount-1 : Config.maxPitch) - maxPitch);\n\t\t\t\t\t\tsequence.append(new ChangePitchBend(this._doc, this._cursor.curNote, bendStart, bendEnd, bendTo, this._cursor.pitchIndex));\n\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis._dragTime = bendEnd;\n\t\t\t\t\t\tthis._dragPitch = bendTo;\n\t\t\t\t\t\tthis._dragVisible = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._mouseXPrev = this._mouseX;\n\t\t\t\tthis._mouseYPrev = this._mouseY;\n\t\t\t} else {\n\t\t\t\tthis._updateCursorStatus();\n\t\t\t\tthis._updatePreview();\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenCursorReleased = (event: Event): void => {\n\t\t\tif (!this._cursor.valid) return;\n\t\t\tconst continuousState: boolean = this._doc.lastChangeWas(this._dragChange);\n\t\t\tif (this._mouseDragging && continuousState) {\n\t\t\t\tif (this._dragChange != null) {\n\t\t\t\t\tthis._doc.record(this._dragChange);\n\t\t\t\t\tthis._dragChange = null;\n\t\t\t\t}\n\t\t\t} else if (this._mouseDown && continuousState) {\n\t\t\t\tif (this._cursor.curNote == null) {\n\t\t\t\t\tconst note: Note = makeNote(this._cursor.pitch, this._cursor.start, this._cursor.end, 3, this._doc.song.getChannelIsDrum(this._doc.channel));\n\t\t\t\t\tnote.pins = [];\n\t\t\t\t\tfor (const oldPin of this._cursor.pins) {\n\t\t\t\t\t\tnote.pins.push(makeNotePin(0, oldPin.time, oldPin.volume));\n\t\t\t\t\t}\n\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\n\t\t\t\t\tsequence.append(new ChangeEnsurePatternExists(this._doc));\n\t\t\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\n\t\t\t\t\tif (pattern == null) throw new Error();\n\t\t\t\t\tsequence.append(new ChangeNoteAdded(this._doc, pattern, note, this._cursor.curIndex));\n\t\t\t\t\tthis._doc.record(sequence);\n\t\t\t\t} else {\n\t\t\t\t\tif (this._pattern == null) throw new Error();\n\t\t\t\t\tif (this._cursor.pitchIndex == -1) {\n\t\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\n\t\t\t\t\t\tif (this._cursor.curNote.pitches.length == 4) {\n\t\t\t\t\t\t\tsequence.append(new ChangePitchAdded(this._doc, this._cursor.curNote, this._cursor.curNote.pitches[0], 0, true));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsequence.append(new ChangePitchAdded(this._doc, this._cursor.curNote, this._cursor.pitch, this._cursor.curNote.pitches.length));\n\t\t\t\t\t\tthis._doc.record(sequence);\n\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (this._cursor.curNote.pitches.length == 1) {\n\t\t\t\t\t\t\tthis._doc.record(new ChangeNoteAdded(this._doc, this._pattern, this._cursor.curNote, this._cursor.curIndex, true));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._doc.record(new ChangePitchAdded(this._doc, this._cursor.curNote, this._cursor.pitch, this._cursor.curNote.pitches.indexOf(this._cursor.pitch), true));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis._mouseDown = false;\n\t\t\tthis._mouseDragging = false;\n\t\t\tthis._updateCursorStatus();\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _updatePreview(): void {\n\t\t\tif (this._usingTouch) {\n\t\t\t\tif (!this._mouseDown || !this._cursor.valid  || !this._mouseDragging || !this._dragVisible) {\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"hidden\");\n\t\t\t\t} else {\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"visible\");\n\t\t\t\t\t\n\t\t\t\t\tconst x: number = this._partWidth * this._dragTime;\n\t\t\t\t\tconst y: number = this._pitchToPixelHeight(this._dragPitch - this._octaveOffset);\n\t\t\t\t\tconst radius: number = this._pitchHeight / 2;\n\t\t\t\t\tconst width: number = 80;\n\t\t\t\t\tconst height: number = 60;\n\t\t\t\t\t//this._drawNote(this._svgPreview, this._cursor.pitch, this._cursor.start, this._cursor.pins, this._pitchHeight / 2 + 1, true, this._octaveOffset);\n\t\t\t\t\t\n\t\t\t\t\tlet pathString: string = \"\";\n\t\t\t\t\t\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0) - height) + \" \";\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0) + height) + \" \";\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x + width) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x + width) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x - width) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x - width) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\n\t\t\t\t\t\n\t\t\t\t\tthis._svgPreview.setAttribute(\"d\", pathString);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!this._mouseOver || this._mouseDown || !this._cursor.valid) {\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"hidden\");\n\t\t\t\t} else {\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"visible\");\n\t\t\t\t\tthis._drawNote(this._svgPreview, this._cursor.pitch, this._cursor.start, this._cursor.pins, this._pitchHeight / 2 + 1, true, this._octaveOffset);\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\t\n\t\tprivate _documentChanged = (): void => {\n\t\t\tthis._editorWidth = this._doc.showLetters ? (this._doc.showScrollBar ? 460 : 480) : (this._doc.showScrollBar ? 492 : 512);\n\t\t\tthis._pattern = this._doc.getCurrentPattern();\n\t\t\tthis._partWidth = this._editorWidth / (this._doc.song.beatsPerBar * this._doc.song.partsPerBeat);\n\t\t\tthis._pitchHeight = this._doc.song.getChannelIsDrum(this._doc.channel) ? this._defaultDrumHeight : this._defaultPitchHeight;\n\t\t\tthis._pitchCount = this._doc.song.getChannelIsDrum(this._doc.channel) ? Config.drumCount : Config.pitchCount;\n\t\t\tthis._octaveOffset = this._doc.song.channels[this._doc.channel].octave * 12;\n\t\t\t\n\t\t\tif (this._renderedPartsPerBeat != this._doc.song.partsPerBeat || \n\t\t\t\tthis._renderedPitchChannelCount != this._doc.song.pitchChannelCount || \n\t\t\t\tthis._renderedDrumChannelCount != this._doc.song.drumChannelCount)\n\t\t\t{\n\t\t\t\tthis._renderedPartsPerBeat = this._doc.song.partsPerBeat;\n\t\t\t\tthis._renderedPitchChannelCount = this._doc.song.pitchChannelCount;\n\t\t\t\tthis._renderedDrumChannelCount = this._doc.song.drumChannelCount;\n\t\t\t\tthis.resetCopiedPins();\n\t\t\t}\n\t\t\t\n\n\n\t\t\tthis._copiedPins = this._copiedPinChannels[this._doc.channel];\n\t\t\t\n\t\t\tif (this._renderedWidth != this._editorWidth) {\n\t\t\t\tthis._renderedWidth = this._editorWidth;\n\t\t\t\t//this._svg.setAttribute(\"width\", \"\" + this._editorWidth);\n\t\t\t\tthis._svg.setAttribute(\"viewBox\", \"0 0 \" + this._editorWidth + \" 481\");\n\t\t\t\tthis._svgBackground.setAttribute(\"width\", \"\" + this._editorWidth);\n\t\t\t}\n\t\t\t\n\t\t\tconst beatWidth = this._editorWidth / this._doc.song.beatsPerBar;\n\t\t\tif (this._renderedBeatWidth != beatWidth) {\n\t\t\t\tthis._renderedBeatWidth = beatWidth;\n\t\t\t\tthis._svgNoteBackground.setAttribute(\"width\", \"\" + beatWidth);\n\t\t\t\tthis._svgDrumBackground.setAttribute(\"width\", \"\" + beatWidth);\n\t\t\t\tthis._backgroundDrumRow.setAttribute(\"width\", \"\" + (beatWidth - 2));\n\t\t\t\tfor (let j: number = 0; j < 12; j++) {\n\t\t\t\t\tthis._backgroundPitchRows[j].setAttribute(\"width\", \"\" + (beatWidth - 2));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (!this._mouseDown) this._updateCursorStatus();\n\t\t\t\n\t\t\tthis._svgNoteContainer = <SVGSVGElement> makeEmptyReplacementElement(this._svgNoteContainer);\n\t\t\t\n\t\t\tthis._updatePreview();\n\t\t\n\t\t\tfor (let j: number = 0; j < 12; j++) {\n\t\t\t\tthis._backgroundPitchRows[j].style.visibility = Config.scaleFlags[this._doc.song.scale][j] ? \"visible\" : \"hidden\";\n\t\t\t}\n\t\t\t\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) {\n\t\t\t\tif (!this._renderedDrums) {\n\t\t\t\t\tthis._renderedDrums = true;\n\t\t\t\t\tthis._svgBackground.setAttribute(\"fill\", \"url(#patternEditorDrumBackground)\");\n\t\t\t\t\tthis._svgBackground.setAttribute(\"height\", \"\" + (this._defaultDrumHeight * Config.drumCount));\n\t\t\t\t\t//this._svg.setAttribute(\"height\", \"\" + (this._defaultDrumHeight * Config.drumCount));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._renderedDrums) {\n\t\t\t\t\tthis._renderedDrums = false;\n\t\t\t\t\tthis._svgBackground.setAttribute(\"fill\", \"url(#patternEditorNoteBackground)\");\n\t\t\t\t\tthis._svgBackground.setAttribute(\"height\", \"\" + this._editorHeight);\n\t\t\t\t\t//this._svg.setAttribute(\"height\", \"\" + this._editorHeight);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (this._doc.showChannels) {\n\t\t\t\tfor (let channel: number = this._doc.song.getChannelCount() - 1; channel >= 0; channel--) {\n\t\t\t\t\tif (channel == this._doc.channel) continue;\n\t\t\t\t\tif (this._doc.song.getChannelIsDrum(channel) != this._doc.song.getChannelIsDrum(this._doc.channel)) continue;\n\t\t\t\t\t\n\t\t\t\t\tconst pattern2: Pattern | null = this._doc.song.getPattern(channel, this._doc.bar);\n\t\t\t\t\tif (pattern2 == null) continue;\n\t\t\t\t\tfor (const note of pattern2.notes) {\n\t\t\t\t\t\tfor (const pitch of note.pitches) {\n\t\t\t\t\t\t\tconst notePath: SVGPathElement = <SVGPathElement> SVG.path();\n\t\t\t\t\t\t\tnotePath.setAttribute(\"fill\", ColorConfig.getChannelColor(this._doc.song, channel).secondaryNote);\n\t\t\t\t\t\t\tnotePath.setAttribute(\"pointer-events\", \"none\");\n\t\t\t\t\t\t\tthis._drawNote(notePath, pitch, note.start, note.pins, this._pitchHeight * 0.19, false, this._doc.song.channels[channel].octave * 12);\n\t\t\t\t\t\t\tthis._svgNoteContainer.appendChild(notePath);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (this._pattern != null) {\n\t\t\t\tfor (const note of this._pattern.notes) {\n\t\t\t\t\tfor (let i: number = 0; i < note.pitches.length; i++) {\n\t\t\t\t\t\tconst pitch: number = note.pitches[i];\n\t\t\t\t\t\tlet notePath = <SVGPathElement> SVG.path();\n\t\t\t\t\t\tnotePath.setAttribute(\"fill\", ColorConfig.getChannelColor(this._doc.song, this._doc.channel).secondaryChannel);\n\t\t\t\t\t\tnotePath.setAttribute(\"pointer-events\", \"none\");\n\t\t\t\t\t\tthis._drawNote(notePath, pitch, note.start, note.pins, this._pitchHeight / 2 + 1, false, this._octaveOffset);\n\t\t\t\t\t\tthis._svgNoteContainer.appendChild(notePath);\n\t\t\t\t\t\tnotePath = <SVGPathElement> SVG.path();\n\t\t\t\t\t\tnotePath.setAttribute(\"fill\", ColorConfig.getChannelColor(this._doc.song, this._doc.channel).primaryNote);\n\t\t\t\t\t\tnotePath.setAttribute(\"pointer-events\", \"none\");\n\t\t\t\t\t\tthis._drawNote(notePath, pitch, note.start, note.pins, this._pitchHeight / 2 + 1, true, this._octaveOffset);\n\t\t\t\t\t\tthis._svgNoteContainer.appendChild(notePath);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (note.pitches.length > 1/* && !this._doc.song.getChannelIsDrum(this._doc.channel)*/) {\n\t\t\t\t\t\t\t// const instrumentType: InstrumentType = this._doc.song.channels[this._doc.channel].instruments[this._doc.getCurrentInstrument()].type;\n\t\t\t\t\t\t\t// if (instrumentType == InstrumentType.fm) {\n\t\t\t\t\t\t\t\tlet oscillatorLabel = <SVGTextElement> SVG.text();\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"x\", \"\" + prettyNumber(this._partWidth * note.start + 2));\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"y\", \"\" + prettyNumber(this._pitchToPixelHeight(pitch - this._octaveOffset)));\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"width\", \"30\");\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"fill\", \"black\");\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"text-anchor\", \"start\");\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"dominant-baseline\", \"central\");\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"pointer-events\", \"none\");\n\t\t\t\t\t\t\t\toscillatorLabel.textContent = \"\" + (i + 1);\n\t\t\t\t\t\t\t\tthis._svgNoteContainer.appendChild(oscillatorLabel);\n\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t}\n\t\n\tpublic render(): void {\n\n\t\tif (this._renderedFifths != this._doc.showFifth) {\n\t\t\tif (this._renderedACS == false) {\n\t\t\tthis._renderedFifths = this._doc.showFifth;\n\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.showFifth ? ColorConfig.fifthNote : ColorConfig.pitchBackground);\n\t\t\t\t}\n\t\t}\n\n\t\t\tif (this._doc.showMore == false) {\n\n\t\t\t\tif (this._renderedPiano == true) {\n\t\t\t\t\tthis._renderedPiano = false;\n\t\t\t\t}\n\t\t\tif (this._renderedACS == false) {\n\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.tonic : ColorConfig.tonic);\n\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch1Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch2Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch3Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch4Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch5Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch6Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.fifthNote : ColorConfig.fifthNote);\n\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch8Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch9Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch10Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch11Background : ColorConfig.pitchBackground);\n\t\t\t\tthis._renderedACS = true;\n\t\t\t\tconsole.log(\"this._renderedACS (acs disabled): \"+this._renderedACS);\n\t\t\t}\n\t\t\tthis._setKey = -1;\n\t\t} else {\n\t\t\tif (ColorConfig.usesPianoScheme == false) {\n\t\t\t\tif (this._renderedACS != this._doc.showMore) {\n\t\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.tonic : ColorConfig.tonic);\n\t\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch1Background :  ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch2Background :  ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch3Background :  ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch4Background :  ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch5Background :  ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch6Background :  ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.showFifth ? ColorConfig.fifthNote : ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch8Background : ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch9Background : ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch10Background : ColorConfig.pitchBackground);\n\t\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.showMore ? ColorConfig.pitch11Background : ColorConfig.pitchBackground);\n\t\t\t\t\tthis._renderedACS = this._doc.showMore;\n\t\t\t\t\tconsole.log(\"this._renderedACS (acs enabled): \"+this._renderedACS);\n\t\t\t\t} \n\t\t\t\tif (this._renderedPiano == true) {\n\t\t\t\t\tthis._renderedPiano = false;\n\t\t\t\t\tthis._setKey = -1;\n\t\t\t\t\tconsole.log(\"this._renderedACS (disabiling piano): \"+this._renderedACS);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._setKey != this._doc.song.key) {\n\t\t\t\t\t\tthis._setKey = this._doc.song.key;\n\t\t\t\t\t\tthis._renderedPiano = true;\n\t\t\t\t\t\tconsole.log(\"piano key\"+this._setKey);\n\t\t\t\t\t\tif ( (this._setKey == 0 ) || (this._setKey == 2 ) || (this._setKey == 4 ) || (this._setKey == 6 ) || (this._setKey == 7 ) || (this._setKey == 9 ) || (this._setKey == 11 )) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.showMore ? \"var(--white-tonic, var(--pitch-white-key, var(--pitch-background)))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.showMore ? \"var(--black-tonic, var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 0 ) || (this._setKey == 1 ) || (this._setKey == 3 ) || (this._setKey == 5 )|| (this._setKey == 7 ) ||(this._setKey == 8 ) || (this._setKey == 10)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 1 )||(this._setKey == 2 )||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 9 )||(this._setKey == 11)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 0 ) ||(this._setKey == 2 )||(this._setKey == 3 )||(this._setKey == 5 )||(this._setKey == 7 )||(this._setKey == 9 )||(this._setKey == 10)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 1) ||(this._setKey == 3 )||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 10 )||(this._setKey == 11)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.showMore ? \" var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.showMore ? \" var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 0 )||(this._setKey == 2 )||(this._setKey == 4 )||(this._setKey == 5 )||(this._setKey == 7 )||(this._setKey == 9 )||(this._setKey == 11)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 0 ) ||(this._setKey == 1 )||(this._setKey == 3 )||(this._setKey == 5 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 10)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 1) ||(this._setKey == 2) ||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 7 )||(this._setKey == 9 )||(this._setKey == 11)) {\n\t\t\t\t\t\t\tif (this._doc.showFifth == true) {\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.showMore ? \"var(--white-fifth-note, var(--pitch-white-key, var(--pitch-background)))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.showMore ? \" var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (this._doc.showFifth == true) {\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.showMore ? \"var(--black-fifth-note, var(--pitch-black-key, var(--pitch-background)))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 0 ) || (this._setKey == 2 ) || (this._setKey == 3 ) || (this._setKey == 5) || (this._setKey == 7) || (this._setKey == 8) || (this._setKey == 10)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 1 )|| (this._setKey ==3 )||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 9 )||(this._setKey == 11)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((this._setKey == 0) ||(this._setKey == 2 )||(this._setKey == 4 )||(this._setKey == 5 )||(this._setKey == 7 )||(this._setKey == 9) ||(this._setKey == 10)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ((this._setKey == 1 )||(this._setKey == 3 )||(this._setKey == 5 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 10 )||(this._setKey == 11)) {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\n\t\t\t\t\t\t}\n\t\t\t\t\tif (this._renderedACS == true) {\n\t\t\t\t\tthis._renderedACS = false;\n\t\t\t\t\tconsole.log(\"this._renderedACS (in piano): \"+this._renderedACS);\n\t\t\t\t\t}\n\t\t\t\t} \n\t\t\t}\n\t\t}\n\t}\n\n\t\tprivate _drawNote(svgElement: SVGPathElement, pitch: number, start: number, pins: NotePin[], radius: number, showVolume: boolean, offset: number): void {\n\t\t\tlet nextPin: NotePin = pins[0];\n\t\t\tlet pathString: string = \"M \" + prettyNumber(this._partWidth * (start + nextPin.time) + 1) + \" \" + prettyNumber(this._pitchToPixelHeight(pitch - offset) + radius * (showVolume ? nextPin.volume / 3.0 : 1.0)) + \" \";\n\t\t\tfor (let i: number = 1; i < pins.length; i++) {\n\t\t\t\tlet prevPin: NotePin = nextPin;\n\t\t\t\tnextPin = pins[i];\n\t\t\t\tlet prevSide: number = this._partWidth * (start + prevPin.time) + (i == 1 ? 1 : 0);\n\t\t\t\tlet nextSide: number = this._partWidth * (start + nextPin.time) - (i == pins.length - 1 ? 1 : 0);\n\t\t\t\tlet prevHeight: number = this._pitchToPixelHeight(pitch + prevPin.interval - offset);\n\t\t\t\tlet nextHeight: number = this._pitchToPixelHeight(pitch + nextPin.interval - offset);\n\t\t\t\tlet prevVolume: number = showVolume ? prevPin.volume / 3.0 : 1.0;\n\t\t\t\tlet nextVolume: number = showVolume ? nextPin.volume / 3.0 : 1.0;\n\t\t\t\tpathString += \"L \" + prettyNumber(prevSide) + \" \" + prettyNumber(prevHeight - radius * prevVolume) + \" \";\n\t\t\t\tif (prevPin.interval > nextPin.interval) pathString += \"L \" + prettyNumber(prevSide + 1) + \" \" + prettyNumber(prevHeight - radius * prevVolume) + \" \";\n\t\t\t\tif (prevPin.interval < nextPin.interval) pathString += \"L \" + prettyNumber(nextSide - 1) + \" \" + prettyNumber(nextHeight - radius * nextVolume) + \" \";\n\t\t\t\tpathString += \"L \" + prettyNumber(nextSide) + \" \" + prettyNumber(nextHeight - radius * nextVolume) + \" \";\n\t\t\t}\n\t\t\tfor (let i: number = pins.length - 2; i >= 0; i--) {\n\t\t\t\tlet prevPin: NotePin = nextPin;\n\t\t\t\tnextPin = pins[i];\n\t\t\t\tlet prevSide: number = this._partWidth * (start + prevPin.time) - (i == pins.length - 2 ? 1 : 0);\n\t\t\t\tlet nextSide: number = this._partWidth * (start + nextPin.time) + (i == 0 ? 1 : 0);\n\t\t\t\tlet prevHeight: number = this._pitchToPixelHeight(pitch + prevPin.interval - offset);\n\t\t\t\tlet nextHeight: number = this._pitchToPixelHeight(pitch + nextPin.interval - offset);\n\t\t\t\tlet prevVolume: number = showVolume ? prevPin.volume / 3.0 : 1.0;\n\t\t\t\tlet nextVolume: number = showVolume ? nextPin.volume / 3.0 : 1.0;\n\t\t\t\tpathString += \"L \" + prettyNumber(prevSide) + \" \" + prettyNumber(prevHeight + radius * prevVolume) + \" \";\n\t\t\t\tif (prevPin.interval < nextPin.interval) pathString += \"L \" + prettyNumber(prevSide - 1) + \" \" + prettyNumber(prevHeight + radius * prevVolume) + \" \";\n\t\t\t\tif (prevPin.interval > nextPin.interval) pathString += \"L \" + prettyNumber(nextSide + 1) + \" \" + prettyNumber(nextHeight + radius * nextVolume) + \" \";\n\t\t\t\tpathString += \"L \" + prettyNumber(nextSide) + \" \" + prettyNumber(nextHeight + radius * nextVolume) + \" \";\n\t\t\t}\n\t\t\tpathString += \"z\";\n\t\t\t\n\t\t\tsvgElement.setAttribute(\"d\", pathString);\n\t\t}\n\t\t\n\t\tprivate _pitchToPixelHeight(pitch: number): number {\n\t\t\treturn this._pitchHeight * (this._pitchCount - (pitch) - 0.5);\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Pattern } from \"../synth/synth\";\nimport { ChangePattern, ChangeChannelBar } from \"./changes\";\nimport { ColorConfig } from \"./ColorConfig\";\n\tconst {select, div, option} = HTML;\n\n\tclass Box {\n\t\tprivate readonly _label: SVGTextElement = SVG.text( {x: 16, y: 23, \"font-family\": \"sans-serif\", \"font-size\": 20, \"text-anchor\": \"middle\", \"font-weight\": \"bold\", fill: ColorConfig.invertedText}, \"1\");\n\t\tprivate readonly _rect = <SVGRectElement> SVG.rect( {width: 30, height: 27, x: 1, y: 1});\n\t\tprivate readonly _vol1 = <SVGRectElement> SVG.rect( {width: 6, height: 3, x: 24, y: 5});\n\t\tprivate readonly _volb = <SVGRectElement> SVG.rect( {width: 6, height: 18, x: 24, y: 5});\n\t\tpublic readonly container = <SVGSVGElement> SVG.svg(this._rect, this._volb, this._vol1, this._label);\n\t\tprivate _renderedIndex: number = 1;\n\t\tprivate _renderedDim: boolean = true;\n\t\t//private _renderedMute: boolean = true;\n\t\tprivate _renderedSelected: boolean = false;\n\t\tprivate _renderedColor: string = \"\";\n\t\tconstructor(channel: number, x: number, y: number, color: string, showVolume: boolean) {\n\t\t\tthis.container.setAttribute(\"x\", \"\" + (x * 32));\n\t\t\tthis.container.setAttribute(\"y\", \"\" + (y * 32));\n\t\t\tthis._rect.setAttribute(\"fill\", \"#444444\");\n\t\t\tthis._vol1.setAttribute(\"fill\", \"#444444\");\n\t\t\tthis._volb.setAttribute(\"fill\", \"#444444\");\n\t\t\tthis._label.setAttribute(\"fill\", color);\n\t\t}\n\t\t\n\t\tpublic setSquashed(squashed: boolean, y: number): void {\n\t\t\tif (squashed) {\n\t\t\t\tthis.container.setAttribute(\"y\", \"\" + (y * 27));\n\t\t\t\tthis._rect.setAttribute(\"height\", \"\" + 25);\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + 2.7);\n\t\t\t\tthis._volb.setAttribute(\"height\", \"\" + 18);\n\t\t\t\tthis._label.setAttribute(\"y\", \"\" + 21);\n\t\t\t} else {\n\t\t\t\tthis.container.setAttribute(\"y\", \"\" + (y * 32));\n\t\t\t\tthis._rect.setAttribute(\"height\", \"\" + 30);\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + 3);\n\t\t\t\tthis._volb.setAttribute(\"height\", \"\" + 18);\n\t\t\t\tthis._label.setAttribute(\"y\", \"\" + 23);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic setIndex(index: number, dim: boolean, selected: boolean, y: number, color: string, volume: number, colorB: string, showVolume: boolean, mix: number): void {\n\t\t\tif (mix == 2) {\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + (18 - volume * 2));\n\t\t\t\tthis._vol1.setAttribute(\"y\", \"\" + (5 + volume * 2));\n\t\t\t} else {\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + (18 - volume * 3.6));\n\t\t\t\tthis._vol1.setAttribute(\"y\", \"\" + (5 + volume * 3.6));\n\t\t\t}\n\t\t\tif (this._renderedIndex != index) {\n\t\t\t\tif (!this._renderedSelected && ((index == 0) != (this._renderedIndex == 0))) {\n\t\t\t\t\tthis._rect.setAttribute(\"fill\", (index == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\n\t\t\t\t\tthis._vol1.setAttribute(\"fill\", (index == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\n\t\t\t\t\tthis._volb.setAttribute(\"fill\", (index == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\n\t\t\t\t}\n\t\t\t\n\t\t\t\tthis._renderedIndex = index;\n\t\t\t\tthis._label.innerHTML = String(index);\n\t\t\t}\n\t\t\t\n\t\t\tif (this._renderedDim != dim || this._renderedColor != color) {\n\t\t\t\tthis._renderedDim = dim;\n\t\t\t\tif (selected) {\n\t\t\t\t\tthis._label.setAttribute(\"fill\", ColorConfig.invertedText);\n\t\t\t\t} else {\n\t\t\t\t\tthis._label.setAttribute(\"fill\", color);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (this._renderedSelected != selected || this._renderedColor != color) {\n\t\t\t\tthis._renderedSelected = selected;\n\t\t\t\tif (selected) {\n\t\t\t\t\tthis._rect.setAttribute(\"fill\", color);\n\t\t\t\t\tthis._vol1.setAttribute(\"fill\", color);\n\t\t\t\t\tthis._volb.setAttribute(\"fill\", color);\n\t\t\t\t\tthis._label.setAttribute(\"fill\", ColorConfig.invertedText);\n\t\t\t\t} else {\n\t\t\t\t\tthis._rect.setAttribute(\"fill\", (this._renderedIndex == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\n\t\t\t\t\tthis._vol1.setAttribute(\"fill\", (this._renderedIndex == 0) ? ColorConfig.editorBackground : color);\n\t\t\t\t\tthis._volb.setAttribute(\"fill\", (this._renderedIndex == 0) ? ColorConfig.editorBackground : colorB);\n\t\t\t\t\tthis._label.setAttribute(\"fill\", color);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (showVolume) {\n\t\t\t\tthis._label.setAttribute(\"x\", \"12\");\n\t\t\t\tthis._vol1.style.visibility = \"visible\";\n\t\t\t\tthis._volb.style.visibility = \"visible\";\n\t\t\t} else {\n\t\t\t\tthis._label.setAttribute(\"x\", \"16\");\n\t\t\t\tthis._vol1.style.visibility = \"hidden\";\n\t\t\t\tthis._volb.style.visibility = \"hidden\";\n\t\t\t}\n\t\t\t\n\t\t\tthis._renderedColor = color;\n\t\t}\n\t}\n\t\n\texport class TrackEditor {\n\t\tprivate readonly _barWidth: number = 32;\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"position: absolute;\", height: 128});\n\t\tprivate readonly _select: HTMLSelectElement = select({class: \"trackSelectBox\", style: \"width: 32px; height: 32px; background: none; border: none; appearance: none; color: transparent; position: absolute;\"});\n\t\tpublic readonly container: HTMLElement = div({style: \"height: 128px; position: relative; overflow:hidden;\"}, [this._svg, this._select]);\n\t\t\n\t\tprivate readonly _boxContainer = <SVGGElement> SVG.g();\n\t\tprivate readonly _playhead = <SVGRectElement> SVG.rect( {fill: \"white\", x: 0, y: 0, width: 4, height: 128});\n\t\tprivate readonly _boxHighlight = <SVGRectElement> SVG.rect( {fill: \"none\", stroke: \"white\", \"stroke-width\": 2, \"pointer-events\": \"none\", x: 1, y: 1, width: 30, height: 30});\n\t\tprivate readonly _upHighlight = <SVGPathElement> SVG.path( {fill: \"black\", stroke: \"black\", \"stroke-width\": 1, \"pointer-events\": \"none\"});\n\t\tprivate readonly _downHighlight = <SVGPathElement> SVG.path( {fill: \"black\", stroke: \"black\", \"stroke-width\": 1, \"pointer-events\": \"none\"});\n\t\t\n\t\tprivate readonly _grid: Box[][] = [];\n\t\tprivate _mouseX: number = 0;\n\t\tprivate _mouseY: number = 0;\n\t\tpublic _pattern: Pattern | null = null;\n\t\tprivate _mouseOver: boolean = false;\n\t\tpublic _digits: string = \"\";\n\t\tprivate _editorHeight: number = 128;\n\t\tprivate _channelHeight: number = 32;\n\t\tprivate _renderedChannelCount: number = 0;\n\t\tprivate _renderedBarCount: number = 0;\n\t\tprivate _renderedPatternCount: number = 0;\n\t\tprivate _renderedPlayhead: number = -1;\n\t\tprivate _renderedSquashed: boolean = false;\n\t\tprivate _changePattern: ChangePattern | null = null;\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._svg.appendChild(this._boxContainer);\n\t\t\tthis._svg.appendChild(this._boxHighlight);\n\t\t\tthis._svg.appendChild(this._upHighlight);\n\t\t\tthis._svg.appendChild(this._downHighlight);\n\t\t\tthis._svg.appendChild(this._playhead);\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\n\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\n\t\t\tthis._svg.addEventListener(\"mousedown\", this._whenMousePressed);\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenMouseReleased);\n\t\t\tthis._svg.addEventListener(\"mouseover\", this._whenMouseOver);\n\t\t\tthis._svg.addEventListener(\"mouseout\", this._whenMouseOut);\n\t\t\t\n\t\t\tthis._select.addEventListener(\"change\", this._whenSelectChanged);\n\t\t}\n\t\t\n\t\tprivate _whenSelectChanged = (): void => {\n\t\t\tthis._setPattern(this._select.selectedIndex);\n\t\t}\n\t\t\n\t\tprivate _animatePlayhead = (timestamp: number): void => {\n\t\t\tconst playhead = (this._barWidth * this._doc.synth.playhead - 2);\n\t\t\tif (this._renderedPlayhead != playhead) {\n\t\t\t\tthis._renderedPlayhead = playhead;\n\t\t\t\tthis._playhead.setAttribute(\"x\", \"\" + playhead);\n\t\t\t}\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\n\t\t}\n\t\t\n\t\tpublic _setChannelBar(channel: number, bar: number): void {\n\t\t\tnew ChangeChannelBar(this._doc, channel, bar);\n\t\t\tthis._digits = \"\";\n\t\t\tthis._doc.forgetLastChange();\n\t\t}\n\t\t\n\t\tprivate _setPattern(pattern: number): void {\n\t\t\tconst currentValue: number = this._doc.song.channels[this._doc.channel].bars[this._doc.bar];\n\t\t\tconst canReplaceLastChange: boolean = this._doc.lastChangeWas(this._changePattern);\n\t\t\tconst oldValue: number = canReplaceLastChange ? this._changePattern!.oldValue : currentValue;\n\t\t\tif (pattern != currentValue) {\n\t\t\t\tthis._changePattern = new ChangePattern(this._doc, oldValue, pattern);\n\t\t\t\tthis._doc.record(this._changePattern, canReplaceLastChange);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic _nextDigit(digit: string): void {\n\t\t\tthis._digits += digit;\n\t\t\tlet parsed: number = parseInt(this._digits);\n\t\t\tif (parsed <= this._doc.song.patternsPerChannel) {\n\t\t\t\tthis._setPattern(parsed);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\t\n\t\t\tthis._digits = digit;\n\t\t\tparsed = parseInt(this._digits);\n\t\t\tif (parsed <= this._doc.song.patternsPerChannel) {\n\t\t\t\tthis._setPattern(parsed);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tthis._digits = \"\";\n\t\t}\n\t\t\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\n\t\t\tif (this._mouseOver) return;\n\t\t\tthis._mouseOver = true;\n\t\t}\n\t\t\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\n\t\t\tif (!this._mouseOver) return;\n\t\t\tthis._mouseOver = false;\n\t\t}\n\t\t\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\n\t\t\tconst channel: number = Math.floor(Math.min(this._doc.song.getChannelCount() - 1, Math.max(0, this._mouseY / this._channelHeight)));\n\t\t\tconst bar: number = Math.floor(Math.min(this._doc.song.barCount - 1, Math.max(0, this._mouseX / this._barWidth)));\n\t\t\tif (this._doc.channel == channel && this._doc.bar == bar) {\n\t\t\t\tconst up: boolean = (this._mouseY % this._channelHeight) < this._channelHeight / 2;\n\t\t\t\tconst patternCount: number = this._doc.song.patternsPerChannel;\n\t\t\t\tthis._setPattern((this._doc.song.channels[channel].bars[bar] + (up ? 1 : patternCount)) % (patternCount + 1));\n\t\t\t} else {\n\t\t\t\tthis._setChannelBar(channel, bar);\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMouseReleased = (event: MouseEvent): void => {\n\t\t}\n\t\t\n\t\tprivate _updatePreview(): void {\n\t\t\tlet channel: number = Math.floor(Math.min(this._doc.song.getChannelCount() - 1, Math.max(0, this._mouseY / this._channelHeight)));\n\t\t\tlet bar: number = Math.floor(Math.min(this._doc.song.barCount - 1, Math.max(0, this._mouseX / this._barWidth)));\n\t\t\t\n\t\t\tconst wideScreen: boolean = window.innerWidth > 700;\n\t\t\tif (!wideScreen) {\n\t\t\t\tbar = this._doc.bar;\n\t\t\t\tchannel = this._doc.channel;\n\t\t\t}\n\t\t\t\n\t\t\tconst selected: boolean = (bar == this._doc.bar && channel == this._doc.channel);\n\t\t\t\n\t\t\tif (this._mouseOver && !selected) {\n\t\t\t\tthis._boxHighlight.setAttribute(\"x\", \"\" + (1 + this._barWidth * bar));\n\t\t\t\tthis._boxHighlight.setAttribute(\"y\", \"\" + (1 + (this._channelHeight * channel)));\n\t\t\t\tthis._boxHighlight.setAttribute(\"height\", \"\" + (this._channelHeight - 2));\n\t\t\t\tthis._boxHighlight.style.visibility = \"visible\";\n\t\t\t} else {\n\t\t\t\tthis._boxHighlight.style.visibility = \"hidden\";\n\t\t\t}\n\t\t\t\n\t\t\tif ((this._mouseOver || !wideScreen) && selected) {\n\t\t\t\tconst up: boolean = (this._mouseY % this._channelHeight) < this._channelHeight / 2;\n\t\t\t\tconst center: number = this._barWidth * (bar + 0.8);\n\t\t\t\tconst middle: number = this._channelHeight * (channel + 0.5);\n\t\t\t\tconst base: number = this._channelHeight * 0.1;\n\t\t\t\tconst tip: number = this._channelHeight * 0.4;\n\t\t\t\tconst width: number = this._channelHeight * 0.175;\n\t\t\t\t\n\t\t\t\tthis._upHighlight.setAttribute(\"fill\", up && wideScreen ? \"#fff\" : \"#000\");\n\t\t\t\tthis._downHighlight.setAttribute(\"fill\", !up && wideScreen ? \"#fff\" : \"#000\");\n\t\t\t\t\n\t\t\t\tthis._upHighlight.setAttribute(\"d\", `M ${center} ${middle - tip} L ${center + width} ${middle - base} L ${center - width} ${middle - base} z`);\n\t\t\t\tthis._downHighlight.setAttribute(\"d\", `M ${center} ${middle + tip} L ${center + width} ${middle + base} L ${center - width} ${middle + base} z`);\n\t\t\t\t\n\t\t\t\tthis._upHighlight.style.visibility = \"visible\";\n\t\t\t\tthis._downHighlight.style.visibility = \"visible\";\n\t\t\t} else {\n\t\t\t\tthis._upHighlight.style.visibility = \"hidden\";\n\t\t\t\tthis._downHighlight.style.visibility = \"hidden\";\n\t\t\t}\n\t\t\t\n\t\t\tthis._select.style.left = (this._barWidth * this._doc.bar) + \"px\";\n\t\t\tthis._select.style.top = (this._channelHeight * this._doc.channel) + \"px\";\n\t\t\tthis._select.style.height = this._channelHeight + \"px\";\n\t\t\t\n\t\t\tconst patternCount: number = this._doc.song.patternsPerChannel;\n\t\t\tfor (let i: number = this._renderedPatternCount; i < patternCount; i++) {\n\t\t\t\tthis._select.appendChild(option({value:i}, i));\n\t\t\t}\n\t\t\tfor (let i: number = patternCount; i < this._renderedPatternCount; i++) {\n\t\t\t\tthis._select.removeChild(<Node> this._select.lastChild);\n\t\t\t}\n\t\t\tthis._renderedPatternCount = patternCount;\n\t\t\tconst selectedPattern: number = this._doc.song.channels[this._doc.channel].bars[this._doc.bar];\n\t\t\tif (this._select.selectedIndex != selectedPattern) this._select.selectedIndex = selectedPattern;\n\t\t}\n\t\t\n\t\tpublic render(): void {\n\t\t\tthis._pattern = this._doc.getCurrentPattern();\n\t\t\t\n\t\t\tconst wideScreen: boolean = window.innerWidth > 700;\n\t\t\tconst squashed: boolean = !wideScreen || this._doc.song.getChannelCount() > 5/*4*/ || (this._doc.song.barCount > this._doc.trackVisibleBars && this._doc.song.getChannelCount() > 3);\n\t\t\tthis._channelHeight = squashed ? 27 : 32;\n\t\t\t\n\t\t\tif (this._renderedChannelCount != this._doc.song.getChannelCount()) {\n\t\t\t\tfor (let y: number = this._renderedChannelCount; y < this._doc.song.getChannelCount(); y++) {\n\t\t\t\t\tthis._grid[y] = [];\n\t\t\t\t\tfor (let x: number = 0; x < this._renderedBarCount; x++) {\n\t\t\t\t\t\t//const box: Box = new Box(y, x, y, this._doc.song.getChannelColorDim(y), this._doc.showVolumeBar);\n\t\t\t\t\t\tconst box: Box = new Box(y, x, y, ColorConfig.getChannelColor(this._doc.song, y).secondaryChannel, this._doc.showVolumeBar);\n\t\t\t\t\t\tbox.setSquashed(squashed, y);\n\t\t\t\t\t\tthis._boxContainer.appendChild(box.container);\n\t\t\t\t\t\tthis._grid[y][x] = box;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfor (let y: number = this._doc.song.getChannelCount(); y < this._renderedChannelCount; y++) {\n\t\t\t\t\tfor (let x: number = 0; x < this._renderedBarCount; x++) {\n\t\t\t\t\t\tthis._boxContainer.removeChild(this._grid[y][x].container);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis._grid.length = this._doc.song.getChannelCount();\n\t\t\t}\n\t\t\t\n\t\t\tif (this._renderedBarCount < this._doc.song.barCount) {\n\t\t\t\tfor (let y: number = 0; y < this._doc.song.getChannelCount(); y++) {\n\t\t\t\t\tfor (let x: number = this._renderedBarCount; x < this._doc.song.barCount; x++) {\n\t\t\t\t\t\tconst box: Box = new Box(y, x, y, ColorConfig.getChannelColor(this._doc.song, y).secondaryChannel, this._doc.showVolumeBar);\n\t\t\t\t\t\tbox.setSquashed(squashed, y);\n\t\t\t\t\t\tthis._boxContainer.appendChild(box.container);\n\t\t\t\t\t\tthis._grid[y][x] = box;\n\t\t\t\t\t\t//SVG.text( {x: 16, y: 23, \"font-family\": \"sans-serif\", \"font-size\": 20, \"text-anchor\": \"middle\", \"font-weight\": \"bold\", fill: \"red\"});\n\t\t\t\t\t}\n\t\t\t\t\tfor (let x: number = this._doc.song.barCount; x < this._renderedBarCount; x++) {\n\t\t\t\t\t\tthis._boxContainer.removeChild(this._grid[y][x].container);\n\t\t\t\t\t}\n\t\t\t\t\tthis._grid[y].length = this._doc.song.barCount;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis._renderedBarCount = this._doc.song.barCount;\n\t\t\t\tconst editorWidth = 32 * this._doc.song.barCount;\n\t\t\t\tthis.container.style.width = editorWidth + \"px\";\n\t\t\t\tthis._svg.setAttribute(\"width\", editorWidth + \"\");\n\t\t\t}\n\t\t\t\n\t\t\tif (this._renderedSquashed != squashed) {\n\t\t\t\tfor (let y: number = 0; y < this._doc.song.getChannelCount(); y++) {\n\t\t\t\t\tfor (let x: number = 0; x < this._renderedBarCount; x++) {\n\t\t\t\t\t\tthis._grid[y][x].setSquashed(squashed, y);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (this._renderedSquashed != squashed || this._renderedChannelCount != this._doc.song.getChannelCount()) {\n\t\t\t\tthis._renderedSquashed = squashed;\n\t\t\t\tthis._renderedChannelCount = this._doc.song.getChannelCount();\n\t\t\t\tthis._editorHeight = this._doc.song.getChannelCount() * this._channelHeight;\n\t\t\t\tthis._svg.setAttribute(\"height\", \"\" + this._editorHeight);\n\t\t\t\tthis._playhead.setAttribute(\"height\", \"\" + this._editorHeight);\n\t\t\t\tthis.container.style.height = this._editorHeight + \"px\";\n\t\t\t}\n\t\t\t\n\t\t\tfor (let j: number = 0; j < this._doc.song.getChannelCount(); j++) {\n\t\t\t\tfor (let i: number = 0; i < this._renderedBarCount; i++) {\n\t\t\t\t\tconst pattern: Pattern | null = this._doc.song.getPattern(j, i);\n\t\t\t\t\tconst patternMute: number = this._doc.song.getPatternInstrumentMute(j, i);\n\t\t\t\t\tconst patternVolume: number = this._doc.song.getPatternInstrumentVolume(j, i);\n\t\t\t\t\tconst selected: boolean = (i == this._doc.bar && j == this._doc.channel);\n\t\t\t\t\tconst dim: boolean = (pattern == null || pattern.notes.length == 0);\n\t\t\t\t\tconst mute: boolean = patternMute == 1;\n\t\t\t\t\tconst volume: number = patternVolume;\n\t\t\t\t\tconst box: Box = this._grid[j][i];\n\t\t\t\t\tif (i < this._doc.song.barCount) {\n\t\t\t\t\t\tbox.setIndex(\n\t\t\t\t\t\t\tthis._doc.song.channels[j].bars[i],\n\t\t\t\t\t\t\tdim,\n\t\t\t\t\t\t\tselected,\n\t\t\t\t\t\t\tj,\n\t\t\t\t\t\t\tdim && !selected && !mute ? ColorConfig.getChannelColor(this._doc.song, j).secondaryChannel : mute && !selected ? \"#161616\" : ColorConfig.getChannelColor(this._doc.song, j).primaryChannel,\n\t\t\t\t\t\t\tvolume,\n\t\t\t\t\t\t\tdim && !selected && !mute ? ColorConfig.getChannelColor(this._doc.song, j).secondaryChannel : mute && !selected ? \"#9b9b9b\" : ColorConfig.getChannelColor(this._doc.song, j).secondaryChannel,\n\t\t\t\t\t\t\tthis._doc.showVolumeBar,\n\t\t\t\t\t\t\tthis._doc.song.mix\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbox.container.style.visibility = \"visible\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbox.container.style.visibility = \"hidden\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis._updatePreview();\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { ChangeLoop } from \"./changes\";\nimport { ColorConfig } from \"./ColorConfig\";\n\tconst {div} = HTML;\n\n\n\tinterface Cursor {\n\t\tstartBar: number;\n\t\tmode: number;\n\t}\n\t\n\tinterface Endpoints {\n\t\tstart: number;\n\t\tlength: number;\n\t}\n\t\n\texport class LoopEditor {\n\t\tprivate readonly _barWidth: number = 32;\n\t\tprivate readonly _editorHeight: number = 20;\n\t\tprivate readonly _startMode:   number = 0;\n\t\tprivate readonly _endMode:     number = 1;\n\t\tprivate readonly _bothMode:    number = 2;\n\t\t\n\t\tprivate readonly _loop = <SVGPathElement> SVG.path( {fill: \"none\", stroke: ColorConfig.loopAccent, \"stroke-width\": 4});\n\t\tprivate readonly _highlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\n\t\t\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"touch-action: pan-y; position: absolute;\", height: this._editorHeight}, [\n\t\t\tthis._loop,\n\t\t\tthis._highlight,\n\t\t]);\n\t\t\n\t\tpublic readonly container: HTMLElement = div({style: \"height: 20px; position: relative; margin: 5px 0;\"}, [this._svg]);\n\t\t\n\t\tprivate _change: ChangeLoop | null = null;\n\t\tprivate _cursor: Cursor = {startBar: -1, mode: -1};\n\t\tprivate _mouseX: number = 0;\n\t\tpublic _mouseY: number = 0;\n\t\tprivate _clientStartX: number = 0;\n\t\tprivate _clientStartY: number = 0;\n\t\tprivate _startedScrolling: boolean = false;\n\t\tprivate _draggingHorizontally: boolean = false;\n\t\tprivate _mouseDown: boolean = false;\n\t\tprivate _mouseOver: boolean = false;\n\t\tprivate _renderedLoopStart: number = -1;\n\t\tprivate _renderedLoopStop: number = -1;\n\t\tprivate _renderedBarCount: number = 0;\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._updateCursorStatus();\n\t\t\tthis._render();\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\n\t\t\t\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\n\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\n\t\t\t\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenTouchReleased);\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenTouchReleased);\n\t\t}\n\t\t\n\t\tprivate _updateCursorStatus(): void {\n\t\t\tconst bar: number = this._mouseX / this._barWidth;\n\t\t\tthis._cursor.startBar = bar;\n\t\t\t\n\t\t\tif (bar > this._doc.song.loopStart - 0.25 && bar < this._doc.song.loopStart + this._doc.song.loopLength + 0.25) {\n\t\t\t\tif (bar - this._doc.song.loopStart < this._doc.song.loopLength * 0.5) {\n\t\t\t\t\tthis._cursor.mode = this._startMode;\n\t\t\t\t} else {\n\t\t\t\t\tthis._cursor.mode = this._endMode;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._cursor.mode = this._bothMode;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _findEndPoints(middle: number): Endpoints {\n\t\t\tlet start: number = Math.round(middle - this._doc.song.loopLength / 2);\n\t\t\tlet end: number = start + this._doc.song.loopLength;\n\t\t\tif (start < 0) {\n\t\t\t\tend -= start;\n\t\t\t\tstart = 0;\n\t\t\t}\n\t\t\tif (end > this._doc.song.barCount) {\n\t\t\t\tstart -= end - this._doc.song.barCount;\n\t\t\t\tend = this._doc.song.barCount;\n\t\t\t}\n\t\t\treturn {start: start, length: end - start};\n\t\t}\n\t\t\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\n\t\t\tif (this._mouseOver) return;\n\t\t\tthis._mouseOver = true;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\n\t\t\tif (!this._mouseOver) return;\n\t\t\tthis._mouseOver = false;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tthis._mouseDown = true;\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\n\t\t\tthis._updateCursorStatus();\n\t\t\tthis._updatePreview();\n\t\t\tthis._whenMouseMoved(event);\n\t\t}\n\t\t\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\n\t\t\t//event.preventDefault();\n\t\t\tthis._mouseDown = true;\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\n\t\t\tthis._updateCursorStatus();\n\t\t\tthis._updatePreview();\n\t\t\t//this._whenTouchMoved(event);\n\t\t\tthis._clientStartX = event.touches[0].clientX;\n\t\t\tthis._clientStartY = event.touches[0].clientY;\n\t\t\tthis._draggingHorizontally = false;\n\t\t\tthis._startedScrolling = false;\n\t\t}\n\t\t\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\n\t\t    this._whenCursorMoved();\n\t\t}\n\t\t\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\n\t\t\tif (!this._mouseDown) return;\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\n\t\t\t\n\t\t\tif (!this._draggingHorizontally && !this._startedScrolling) {\n\t\t\t\tif (Math.abs(event.touches[0].clientY - this._clientStartY) > 10) {\n\t\t\t\t\tthis._startedScrolling = true;\n\t\t\t\t} else if (Math.abs(event.touches[0].clientX - this._clientStartX) > 10) {\n\t\t\t\t\tthis._draggingHorizontally = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t    if (this._draggingHorizontally) {\n\t\t\t\tthis._whenCursorMoved();\n\t\t\t\tevent.preventDefault();\n\t\t    }\n\t\t}\n\t\t\n\t\tprivate _whenCursorMoved(): void {\n\t\t\tif (this._mouseDown) {\n\t\t\t\tlet oldStart: number = this._doc.song.loopStart;\n\t\t\t\tlet oldEnd: number = this._doc.song.loopStart + this._doc.song.loopLength;\n\t\t\t\tif (this._change != null && this._doc.lastChangeWas(this._change)) {\n\t\t\t\t\toldStart = this._change.oldStart;\n\t\t\t\t\toldEnd = oldStart + this._change.oldLength;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst bar: number = this._mouseX / this._barWidth;\n\t\t\t\tlet start: number;\n\t\t\t\tlet end: number;\n\t\t\t\tlet temp: number;\n\t\t\t\tif (this._cursor.mode == this._startMode) {\n\t\t\t\t\tstart = oldStart + Math.round(bar - this._cursor.startBar);\n\t\t\t\t\tend = oldEnd;\n\t\t\t\t\t// @TODO: clamp before ChangeLoop like ModBox?\n\t\t\t\t\tif (start < 0) start = 0;\n\t\t\t\t\tif (start >= this._doc.song.barCount) start = this._doc.song.barCount;\n\t\t\t\t\tif (start == end) {\n\t\t\t\t\t\tstart = end - 1;\n\t\t\t\t\t} else if (start > end) {\n\t\t\t\t\t\ttemp = start;\n\t\t\t\t\t\tstart = end;\n\t\t\t\t\t\tend = temp;\n\t\t\t\t\t}\n\t\t\t\t\tthis._change = new ChangeLoop(this._doc, oldStart, oldEnd - oldStart, start, end - start);\n\t\t\t\t} else if (this._cursor.mode == this._endMode) {\n\t\t\t\t\tstart = oldStart;\n\t\t\t\t\tend = oldEnd + Math.round(bar - this._cursor.startBar);\n\t\t\t\t\t// @TODO: clamp before ChangeLoop like ModBox?\n\t\t\t\t\tif (end < 0) end = 0;\n\t\t\t\t\tif (end >= this._doc.song.barCount) end = this._doc.song.barCount;\n\t\t\t\t\tif (end == start) {\n\t\t\t\t\t\tend = start + 1;\n\t\t\t\t\t} else if (end < start) {\n\t\t\t\t\t\ttemp = start;\n\t\t\t\t\t\tstart = end;\n\t\t\t\t\t\tend = temp;\n\t\t\t\t\t}\n\t\t\t\t\tthis._change = new ChangeLoop(this._doc, oldStart, oldEnd - oldStart, start, end - start);\n\t\t\t\t} else if (this._cursor.mode == this._bothMode) {\n\t\t\t\t\tconst endPoints: Endpoints = this._findEndPoints(bar);\n\t\t\t\t\tthis._change = new ChangeLoop(this._doc, oldStart, oldEnd - oldStart, endPoints.start, endPoints.length);\n\t\t\t\t}\n\t\t\t\tthis._doc.setProspectiveChange(this._change);\n\t\t\t} else {\n\t\t\t\tthis._updateCursorStatus();\n\t\t\t\tthis._updatePreview();\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenTouchReleased = (event: TouchEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t    if (!this._startedScrolling) {\n\t\t\t\tthis._whenCursorMoved();\n\t\t\t\tthis._mouseOver = false;\n\t\t\t\tthis._whenCursorReleased(event);\n\t\t\t\tthis._updatePreview();\n\t\t    }\n\t\t}\n\t\t\n\t\tprivate _whenCursorReleased = (event: Event): void => {\n\t\t\tif (this._change != null) this._doc.record(this._change);\n\t\t\tthis._change = null;\n\t\t\tthis._mouseDown = false;\n\t\t\tthis._updateCursorStatus();\n\t\t\tthis._render();\n\t\t}\n\t\t\n\t\tprivate _updatePreview(): void {\n\t\t\tconst showHighlight: boolean = this._mouseOver && !this._mouseDown;\n\t\t\tthis._highlight.style.visibility = showHighlight ? \"visible\" : \"hidden\";\n\t\t\t\n\t\t\tif (showHighlight) {\n\t\t\t\tconst radius: number = this._editorHeight / 2;\n\t\t\t\t\n\t\t\t\tlet highlightStart: number = (this._doc.song.loopStart) * this._barWidth;\n\t\t\t\tlet highlightStop: number = (this._doc.song.loopStart + this._doc.song.loopLength) * this._barWidth;\n\t\t\t\tif (this._cursor.mode == this._startMode) {\n\t\t\t\t\thighlightStop = (this._doc.song.loopStart) * this._barWidth + radius * 2;\n\t\t\t\t} else if (this._cursor.mode == this._endMode) {\n\t\t\t\t\thighlightStart = (this._doc.song.loopStart + this._doc.song.loopLength) * this._barWidth - radius * 2;\n\t\t\t\t} else {\n\t\t\t\t\tconst endPoints: Endpoints = this._findEndPoints(this._cursor.startBar);\n\t\t\t\t\thighlightStart = (endPoints.start) * this._barWidth;\n\t\t\t\t\thighlightStop = (endPoints.start + endPoints.length) * this._barWidth;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis._highlight.setAttribute(\"d\",\n\t\t\t\t\t`M ${highlightStart + radius} ${4} ` +\n\t\t\t\t\t`L ${highlightStop - radius} ${4} ` +\n\t\t\t\t\t`A ${radius - 4} ${radius - 4} ${0} ${0} ${1} ${highlightStop - radius} ${this._editorHeight - 4} ` +\n\t\t\t\t\t`L ${highlightStart + radius} ${this._editorHeight - 4} ` +\n\t\t\t\t\t`A ${radius - 4} ${radius - 4} ${0} ${0} ${1} ${highlightStart + radius} ${4} ` +\n\t\t\t\t\t`z`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _documentChanged = (): void => {\n\t\t\tthis._render();\n\t\t}\n\t\t\n\t\tprivate _render(): void {\n\t\t\tconst radius: number = this._editorHeight / 2;\n\t\t\tconst loopStart: number = (this._doc.song.loopStart) * this._barWidth;\n\t\t\tconst loopStop: number = (this._doc.song.loopStart + this._doc.song.loopLength) * this._barWidth;\n\t\t\t\n\t\t\tif (this._renderedBarCount != this._doc.song.barCount) {\n\t\t\t\tthis._renderedBarCount = this._doc.song.barCount;\n\t\t\t\tconst editorWidth = 32 * this._doc.song.barCount;\n\t\t\t\tthis.container.style.width = editorWidth + \"px\";\n\t\t\t\tthis._svg.setAttribute(\"width\", editorWidth + \"\");\n\t\t\t}\n\n\t\t\tif (this._renderedLoopStart != loopStart || this._renderedLoopStop != loopStop) {\n\t\t\t\tthis._renderedLoopStart = loopStart;\n\t\t\t\tthis._renderedLoopStop = loopStop;\n\t\t\t\tthis._loop.setAttribute(\"d\",\n\t\t\t\t\t`M ${loopStart + radius} ${2} ` +\n\t\t\t\t\t`L ${loopStop - radius} ${2} ` +\n\t\t\t\t\t`A ${radius - 2} ${radius - 2} ${0} ${0} ${1} ${loopStop - radius} ${this._editorHeight - 2} ` +\n\t\t\t\t\t`L ${loopStart + radius} ${this._editorHeight - 2} ` +\n\t\t\t\t\t`A ${radius - 2} ${radius - 2} ${0} ${0} ${1} ${loopStart + radius} ${2} ` +\n\t\t\t\t\t`z`\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\tthis._updatePreview();\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nconst {div} = HTML;\n\n\texport class BarScrollBar {\n\t\tprivate readonly _editorWidth: number = 512;\n\t\tprivate readonly _editorHeight: number = 20;\n\t\t\n\t\tprivate readonly _notches = <SVGSVGElement> SVG.svg( {\"pointer-events\": \"none\"});\n\t\tprivate readonly _handle = <SVGRectElement> SVG.rect( {fill: \"#444444\", x: 0, y: 2, width: 10, height: this._editorHeight - 4});\n\t\tprivate readonly _handleHighlight = <SVGRectElement> SVG.rect( {fill: \"none\", stroke: \"white\", \"stroke-width\": 2, \"pointer-events\": \"none\", x: 0, y: 1, width: 10, height: this._editorHeight - 2});\n\t\tprivate readonly _leftHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\n\t\tprivate readonly _rightHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\n\t\t\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"background-color: #000000; touch-action: pan-y; position: absolute;\", width: this._editorWidth, height: this._editorHeight}, [\n\t\t\tthis._notches,\n\t\t\tthis._handle,\n\t\t\tthis._handleHighlight,\n\t\t\tthis._leftHighlight,\n\t\t\tthis._rightHighlight,\n\t\t]);\n\t\t\n\t\tpublic readonly container: HTMLElement = div({class: \"barScrollBar\", style: \"width: 512px; height: 20px; overflow: hidden; position: relative;\"}, [this._svg]);\n\t\t\n\t\tprivate _mouseX: number = 0;\n\t\tpublic _mouseY: number = 0;\n\t\tprivate _mouseDown: boolean = false;\n\t\tprivate _mouseOver: boolean = false;\n\t\tprivate _dragging: boolean = false;\n\t\tprivate _dragStart: number;\n\t\tprivate _barWidth: number;\n\t\tprivate _renderedNotchCount: number = -1;\n\t\tprivate _renderedBarPos: number = -1;\n\t\t\n\t\tconstructor(private _doc: SongDocument, private _trackContainer: HTMLDivElement) {\n\t\t\tconst center: number = this._editorHeight * 0.5;\n\t\t\tconst base: number = 20;\n\t\t\tconst tip: number = 9;\n\t\t\tconst arrowHeight: number = 6;\n\t\t\tthis._leftHighlight.setAttribute(\"d\", `M ${tip} ${center} L ${base} ${center + arrowHeight} L ${base} ${center - arrowHeight} z`);\n\t\t\tthis._rightHighlight.setAttribute(\"d\", `M ${this._editorWidth - tip} ${center} L ${this._editorWidth - base} ${center + arrowHeight} L ${this._editorWidth - base} ${center - arrowHeight} z`);\n\t\t\t\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\n\t\t\t\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenCursorReleased);\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenCursorReleased);\n\t\t\t\n\t\t\t// Sorry, bypassing typescript type safety on this function because I want to use the new \"passive\" option.\n\t\t\t//this._trackContainer.addEventListener(\"scroll\", this._onScroll, {capture: false, passive: true});\n\t\t\t(<Function>this._trackContainer.addEventListener)(\"scroll\", this._onScroll, {capture: false, passive: true});\n\t\t}\n\t\t\n\t\tprivate _onScroll = (event: Event): void => {\n\t\t\tthis._doc.barScrollPos = (this._trackContainer.scrollLeft / 32);\n\t\t}\n\t\t\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\n\t\t\tif (this._mouseOver) return;\n\t\t\tthis._mouseOver = true;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\n\t\t\tif (!this._mouseOver) return;\n\t\t\tthis._mouseOver = false;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tthis._mouseDown = true;\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\n\t\t\tthis._updatePreview();\n\t\t\tif (this._mouseX >= this._doc.barScrollPos * this._barWidth && this._mouseX <= (this._doc.barScrollPos + this._doc.trackVisibleBars) * this._barWidth) {\n\t\t\t\tthis._dragging = true;\n\t\t\t\tthis._dragStart = this._mouseX;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tthis._mouseDown = true;\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\n\t\t\tthis._updatePreview();\n\t\t\tif (this._mouseX >= this._doc.barScrollPos * this._barWidth && this._mouseX <= (this._doc.barScrollPos + this._doc.trackVisibleBars) * this._barWidth) {\n\t\t\t\tthis._dragging = true;\n\t\t\t\tthis._dragStart = this._mouseX;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\n\t\t    this._whenCursorMoved();\n\t\t}\n\t\t\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\n\t\t\tif (!this._mouseDown) return;\n\t\t\tevent.preventDefault();\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\n\t\t    this._whenCursorMoved();\n\t\t}\n\t\t\n\t\tprivate _whenCursorMoved(): void {\n\t\t\tif (this._dragging) {\n\t\t\t\twhile (this._mouseX - this._dragStart < -this._barWidth * 0.5) {\n\t\t\t\t\tif (this._doc.barScrollPos > 0) {\n\t\t\t\t\t\tthis._doc.barScrollPos--;\n\t\t\t\t\t\tthis._dragStart -= this._barWidth;\n\t\t\t\t\t\tthis._doc.notifier.changed();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twhile (this._mouseX - this._dragStart > this._barWidth * 0.5) {\n\t\t\t\t\tif (this._doc.barScrollPos < this._doc.song.barCount - this._doc.trackVisibleBars) {\n\t\t\t\t\t\tthis._doc.barScrollPos++;\n\t\t\t\t\t\tthis._dragStart += this._barWidth;\n\t\t\t\t\t\tthis._doc.notifier.changed();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._mouseOver) this._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenCursorReleased = (event: Event): void => {\n\t\t\tif (!this._dragging && this._mouseDown) {\n\t\t\t\tif (this._mouseX < (this._doc.barScrollPos + 8) * this._barWidth) {\n\t\t\t\t\tif (this._doc.barScrollPos > 0) this._doc.barScrollPos--;\n\t\t\t\t\tthis._doc.notifier.changed();\n\t\t\t\t} else {\n\t\t\t\t\tif (this._doc.barScrollPos < this._doc.song.barCount - this._doc.trackVisibleBars) this._doc.barScrollPos++;\n\t\t\t\t\tthis._doc.notifier.changed();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._mouseDown = false;\n\t\t\tthis._dragging = false;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _updatePreview(): void {\n\t\t\tconst showHighlight: boolean = this._mouseOver && !this._mouseDown;\n\t\t\tlet showleftHighlight: boolean = false;\n\t\t\tlet showRightHighlight: boolean = false;\n\t\t\tlet showHandleHighlight: boolean = false;\n\t\t\t\n\t\t\tif (showHighlight) {\n\t\t\t\tif (this._mouseX < this._doc.barScrollPos * this._barWidth) {\n\t\t\t\t\tshowleftHighlight = true;\n\t\t\t\t} else if (this._mouseX > (this._doc.barScrollPos + this._doc.trackVisibleBars) * this._barWidth) {\n\t\t\t\t\tshowRightHighlight = true;\n\t\t\t\t} else {\n\t\t\t\t\tshowHandleHighlight = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis._leftHighlight.style.visibility = showleftHighlight ? \"visible\" : \"hidden\";\n\t\t\tthis._rightHighlight.style.visibility = showRightHighlight ? \"visible\" : \"hidden\";\n\t\t\tthis._handleHighlight.style.visibility = showHandleHighlight ? \"visible\" : \"hidden\";\n\t\t}\n\t\t\n\t\tpublic render(): void {\n\t\t\tthis._barWidth = (this._editorWidth-1) / Math.max(this._doc.trackVisibleBars, this._doc.song.barCount);\n\t\t\t\n\t\t\tconst resized: boolean = this._renderedNotchCount != this._doc.song.barCount;\n\t\t\tif (resized) {\n\t\t\t\tthis._renderedNotchCount = this._doc.song.barCount;\n\t\t\t\t\n\t\t\t\twhile (this._notches.firstChild) this._notches.removeChild(this._notches.firstChild);\n\t\t\t\t\n\t\t\t\tfor (let i: number = 0; i <= this._doc.song.barCount; i++) {\n\t\t\t\t\tconst lineHeight: number = (i % 16 == 0) ? 0 : ((i % 4 == 0) ? this._editorHeight / 8 : this._editorHeight / 3);\n\t\t\t\t\tthis._notches.appendChild(SVG.rect( {fill: \"#444444\", x: i * this._barWidth - 1, y: lineHeight, width: 2, height: this._editorHeight - lineHeight * 2}));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (resized || this._renderedBarPos != this._doc.barScrollPos) {\n\t\t\t\tthis._renderedBarPos = this._doc.barScrollPos;\n\t\t\t\tthis._handle.setAttribute(\"x\", \"\" + (this._barWidth * this._doc.barScrollPos));\n\t\t\t\tthis._handle.setAttribute(\"width\", \"\" + (this._barWidth * this._doc.trackVisibleBars));\n\t\t\t\tthis._handleHighlight.setAttribute(\"x\", \"\" + (this._barWidth * this._doc.barScrollPos));\n\t\t\t\tthis._handleHighlight.setAttribute(\"width\", \"\" + (this._barWidth * this._doc.trackVisibleBars));\n\t\t\t}\n\t\t\t\n\t\t\tthis._updatePreview();\n\t\t\t\n\t\t\tthis._trackContainer.scrollLeft = this._doc.barScrollPos * 32;\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { ChangeOctave } from \"./changes\";\nimport { ColorConfig } from \"./ColorConfig\";\n\tconst {div} = HTML;\n\n\texport class OctaveScrollBar {\n\t\tprivate readonly _editorWidth: number = 20;\n\t\tprivate readonly _editorHeight: number = 481;\n\t\tprivate readonly _notchHeight: number = 4.0;\n\t\tprivate readonly _octaveCount: number = 7;\n\t\tprivate readonly _octaveHeight: number = (this._editorHeight - this._notchHeight) / this._octaveCount;\n\t\tprivate readonly _barHeight: number = (this._octaveHeight * 3 + this._notchHeight);\n\t\t\n\t\tprivate readonly _handle = <SVGRectElement> SVG.rect( {fill: ColorConfig.octaveScrollbar, x: 2, y: 0, width: this._editorWidth - 4, height: this._barHeight});\n\t\tprivate readonly _handleHighlight = <SVGRectElement> SVG.rect( {fill: \"none\", stroke: \"white\", \"stroke-width\": 2, \"pointer-events\": \"none\", x: 1, y: 0, width: this._editorWidth - 2, height: this._barHeight});\n\t\tprivate readonly _upHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\n\t\tprivate readonly _downHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\n\t\t\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"touch-action: pan-x; position: absolute;\", width: this._editorWidth, height: \"100%\", viewBox: \"0 0 20 481\", preserveAspectRatio: \"none\"});\n\t\tpublic readonly container: HTMLDivElement = div({id: \"octaveScrollBarContainer\", style: \"width: 20px; height: 100%; overflow: hidden; position: relative; flex-shrink: 0;\"}, [this._svg]);\n\t\t\n\t\tpublic _mouseX: number = 0;\n\t\tprivate _mouseY: number = 0;\n\t\tprivate _mouseDown: boolean = false;\n\t\tprivate _mouseOver: boolean = false;\n\t\tprivate _dragging: boolean = false;\n\t\tprivate _dragStart: number;\n\t\tprivate _barBottom: number;\n\t\tprivate _renderedBarBottom: number = -1;\n\t\tprivate _change: ChangeOctave | null = null;\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\n\t\t\tthis._documentChanged();\n\t\t\t\n\t\t\tthis._svg.appendChild(this._handle);\n\t\t\t\n\t\t\t// notches:\n\t\t\tfor (let i: number = 0; i <= this._octaveCount; i++) {\n\t\t\t\tthis._svg.appendChild(SVG.rect( {fill: ColorConfig.scrollbarOctave, x: 0, y: i * this._octaveHeight, width: this._editorWidth, height: this._notchHeight}));\n\t\t\t}\n\t\t\t\n\t\t\tthis._svg.appendChild(this._handleHighlight);\n\t\t\tthis._svg.appendChild(this._upHighlight);\n\t\t\tthis._svg.appendChild(this._downHighlight);\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\n\t\t\t\n\t\t\tconst center: number = this._editorWidth * 0.5;\n\t\t\tconst base: number = 20;\n\t\t\tconst tip: number = 9;\n\t\t\tconst arrowWidth: number = 6;\n\t\t\tthis._upHighlight.setAttribute(\"d\", `M ${center} ${tip} L ${center + arrowWidth} ${base} L ${center - arrowWidth} ${base} z`);\n\t\t\tthis._downHighlight.setAttribute(\"d\", `M ${center} ${this._editorHeight - tip} L ${center + arrowWidth} ${this._editorHeight - base} L ${center - arrowWidth} ${this._editorHeight - base} z`);\n\t\t\t\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\n\t\t\t\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenCursorReleased);\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenCursorReleased);\n\t\t}\n\t\t\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\n\t\t\tif (this._mouseOver) return;\n\t\t\tthis._mouseOver = true;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\n\t\t\tif (!this._mouseOver) return;\n\t\t\tthis._mouseOver = false;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tthis._mouseDown = true;\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) return;\n\t\t\tthis._updatePreview();\n\t\t\t\n\t\t\tif (this._mouseY >= this._barBottom - this._barHeight && this._mouseY <= this._barBottom) {\n\t\t\t\tthis._dragging = true;\n\t\t\t\tthis._change = null;\n\t\t\t\tthis._dragStart = this._mouseY;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tthis._mouseDown = true;\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) return;\n\t\t\tthis._updatePreview();\n\t\t\t\n\t\t\tif (this._mouseY >= this._barBottom - this._barHeight && this._mouseY <= this._barBottom) {\n\t\t\t\tthis._dragging = true;\n\t\t\t\tthis._change = null;\n\t\t\t\tthis._dragStart = this._mouseY;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t    this._whenCursorMoved();\n\t\t}\n\t\t\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\n\t\t\tif (!this._mouseDown) return;\n\t\t\tevent.preventDefault();\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t    this._whenCursorMoved();\n\t\t}\n\t\t\n\t\tprivate _whenCursorMoved(): void {\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) return;\n\t\t\tif (this._dragging) {\n\t\t\t\tconst currentOctave: number = this._doc.song.channels[this._doc.channel].octave;\n\t\t\t\tconst continuingProspectiveChange: boolean = this._doc.lastChangeWas(this._change);\n\t\t\t\tconst oldValue: number = continuingProspectiveChange ? this._change!.oldValue : currentOctave;\n\t\t\t\t\n\t\t\t\tlet octave: number = currentOctave;\n\t\t\t\twhile (this._mouseY - this._dragStart < -this._octaveHeight * 0.5) {\n\t\t\t\t\tif (octave < 4) {\n\t\t\t\t\t\toctave++;\n\t\t\t\t\t\tthis._dragStart -= this._octaveHeight;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twhile (this._mouseY - this._dragStart > this._octaveHeight * 0.5) {\n\t\t\t\t\tif (octave > 0) {\n\t\t\t\t\t\toctave--;\n\t\t\t\t\t\tthis._dragStart += this._octaveHeight;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis._change = new ChangeOctave(this._doc, oldValue, octave);\n\t\t\t\tthis._doc.setProspectiveChange(this._change);\n\t\t\t}\n\t\t\t\n\t\t\tif (this._mouseOver) this._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenCursorReleased = (event: Event): void => {\n\t\t\tif (!this._doc.song.getChannelIsDrum(this._doc.channel) && this._mouseDown) {\n\t\t\t\tif (this._dragging) {\n\t\t\t\t\tif (this._change != null) this._doc.record(this._change);\n\t\t\t\t} else {\n\t\t\t\t\tconst canReplaceLastChange: boolean = this._doc.lastChangeWas(this._change);\n\t\t\t\t\tconst oldValue: number = canReplaceLastChange ? this._change!.oldValue : this._doc.song.channels[this._doc.channel].octave;\n\t\t\t\t\tconst currentOctave: number = this._doc.song.channels[this._doc.channel].octave;\n\t\t\t\t\n\t\t\t\t\tif (this._mouseY < this._barBottom - this._barHeight * 0.5) {\n\t\t\t\t\t\tif (currentOctave < 4) {\n\t\t\t\t\t\t\tthis._change = new ChangeOctave(this._doc, oldValue, currentOctave + 1);\n\t\t\t\t\t\t\tthis._doc.record(this._change, canReplaceLastChange);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (currentOctave > 0) {\n\t\t\t\t\t\t\tthis._change = new ChangeOctave(this._doc, oldValue, currentOctave - 1);\n\t\t\t\t\t\t\tthis._doc.record(this._change, canReplaceLastChange);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._mouseDown = false;\n\t\t\tthis._dragging = false;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _updatePreview(): void {\n\t\t\tconst showHighlight: boolean = this._mouseOver && !this._mouseDown;\n\t\t\tlet showUpHighlight: boolean = false;\n\t\t\tlet showDownHighlight: boolean = false;\n\t\t\tlet showHandleHighlight: boolean = false;\n\t\t\t\n\t\t\tif (showHighlight) {\n\t\t\t\tif (this._mouseY < this._barBottom - this._barHeight) {\n\t\t\t\t\tshowUpHighlight = true;\n\t\t\t\t} else if (this._mouseY > this._barBottom) {\n\t\t\t\t\tshowDownHighlight = true;\n\t\t\t\t} else {\n\t\t\t\t\tshowHandleHighlight = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis._upHighlight.style.visibility = showUpHighlight ? \"inherit\" : \"hidden\";\n\t\t\tthis._downHighlight.style.visibility = showDownHighlight ? \"inherit\" : \"hidden\";\n\t\t\tthis._handleHighlight.style.visibility = showHandleHighlight ? \"inherit\" : \"hidden\";\n\t\t}\n\t\t\n\t\tprivate _documentChanged = (): void => {\n\t\t\tthis._barBottom = this._editorHeight - (this._octaveHeight * this._doc.song.channels[this._doc.channel].octave);\n\t\t\tthis._render();\n\t\t}\n\t\t\n\t\tprivate _render(): void {\n\t\t\tthis._svg.style.visibility = (this._doc.song.getChannelIsDrum(this._doc.channel)) ? \"hidden\" : \"visible\";\n\t\t\tif (this._renderedBarBottom != this._barBottom) {\n\t\t\t\tthis._renderedBarBottom = this._barBottom;\n\t\t\t\tthis._handle.setAttribute(\"y\", \"\" + (this._barBottom - this._barHeight));\n\t\t\t\tthis._handleHighlight.setAttribute(\"y\", \"\" + (this._barBottom - this._barHeight));\n\t\t\t}\n\t\t\tthis._updatePreview();\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Config } from \"../synth/SynthConfig\";\n\tconst {canvas, div} = HTML;\n\n\t//let loadedCount: number = 0;\n\tlet finishedLoadingImages: boolean = false;\n\tfunction onLoaded(): void {\n\t\t//loadedCount++;\n\t\tfinishedLoadingImages = true;\n\t}\n\t\n\tconst BlackKey: HTMLImageElement = document.createElement(\"img\");\n\tBlackKey.onload = onLoaded;\n\tBlackKey.src = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NEU3RTM2RTg0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NEU3RTM2RTk0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3RDQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3RTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PomGIaQAAABgSURBVHjaYpSWlmZhYWFmZgaSTExMQAYTGGAyIICRkRFIMhANWISFhdlggAUHANrBysoKNBfuCGKMvnjx4r59+xhp5wOg6UCSBM+SB0YtGLVgCFgAzDeMeOSGgAUAAQYAGgwJrOg8pdQAAAAASUVORK5CYII=\";\n\tconst BlackKeyDisabled: HTMLImageElement = document.createElement(\"img\");\n\tBlackKeyDisabled.onload = onLoaded;\n\tBlackKeyDisabled.src = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NEU3RTM2RUM0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NEU3RTM2RUQ0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0RTdFMzZFQTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo0RTdFMzZFQjQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhURscAAAAB1SURBVHja7NPBCoAgDAZgnaMX8Oj7P2KKldXPhiR4CwwCv4PInPvxoA0hMLNzDisRYUPCCiMucVallJzzJnaBih5pp2mw936puKEZ2qQ3MeUQmLiKGGNKCZ1IQr2fDnb0C8gMNgNmwA8Cnt/0Tv91vw64BRgALUuP70jrlrwAAAAASUVORK5CYII=\";\n\tconst WhiteKey: HTMLImageElement = document.createElement(\"img\");\n\tWhiteKey.onload = onLoaded;\n\tWhiteKey.src = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzM2MTdFNzc0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzM2MTdFNzg0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3NTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3NjQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgBmMXoAAACTSURBVHja7JQ7CgMhGIT3920M2Hko7+RJPYWViE0myi5sEXAhKQL7FcP8PmawkWKMjx2llNb60MNIKY0xnPPphRDbMsJ7/xw458wAodZa6PRQ5GIF0RjlYCU655xSEqWU3ntrrdb63RcgHcq2H3MX3AV/UEAhBL7DBkTEzmAFuzSY44UC/BDHtU+8z539esFLgAEAkZ4XCDjZXPEAAAAASUVORK5CYII=\";\n\tconst WhiteKeyDisabled: HTMLImageElement = document.createElement(\"img\");\n\tWhiteKeyDisabled.onload = onLoaded;\n\tWhiteKeyDisabled.src = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzM2MTdFN0I0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzM2MTdFN0M0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3OTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3QTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PlZjoH4AAADHSURBVHja7JTNDoMgEIRBGq21iTcfyvd/DeNvJBYBp7uFEE+99NDE70AMMDPLYZRt2z4CeZ4XRcFrRkgphRD7vnvvX8RGdF03DEPf99M0LcuitcamMcZa6wkRuNV1/SSqqroTcC/LEu5KKQ6AEhq21oRzDl5bAME8DUjd3wHjOELPyu9fgNnneV7XNQ6OyNPsTCZ+zBVwBfxBgGyaRgViuWIt+ZIPuAAaZwh00BKxaKeuSfwhUsfI55g+WOMT2DEl3jm94BBgAAtY6T6d3wTNAAAAAElFTkSuQmCC\";\n\tconst Drum: HTMLImageElement = document.createElement(\"img\");\n\tDrum.onload = onLoaded;\n\tDrum.src = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAArCAIAAACW3x1gAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOUJCOEEzOUJCMkI3MTdFNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5NzVEOTA1QzQ5MjMxMUUxOTM3RDhDNEI4QkIxQkFCNSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5NzVEOTA1QjQ5MjMxMUUxOTM3RDhDNEI4QkIxQkFCNSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAxODAxMTc0MDcyMDY4MTE5QkI4QTM5QkIyQjcxN0U0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAxODAxMTc0MDcyMDY4MTE5QkI4QTM5QkIyQjcxN0U0Ii8+IDwvcmRmOkRlc2NyaXB0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\";\n\t\n\texport class Piano {\n\t\tprivate readonly _canvas: HTMLCanvasElement = canvas({width: \"32\", height: \"481\", style: \"width: 100%; height: 100%;\"});\n\t\tprivate readonly _preview: HTMLCanvasElement = canvas({width: \"32\", height: \"40\"});\n\t\tpublic readonly container: HTMLDivElement = div({style: \"width: 32px; height: 100%; overflow:hidden; position: relative; flex-shrink: 0; touch-action: none;\"}, [\n\t\t\tthis._canvas,\n\t\t\tthis._preview,\n\t\t]);\n\t\tprivate readonly _graphics: CanvasRenderingContext2D = this._canvas.getContext(\"2d\")!;\n\t\tprivate readonly _previewGraphics: CanvasRenderingContext2D = this._preview.getContext(\"2d\")!;\n\t\tprivate readonly _editorWidth: number = 32;\n\t\tprivate readonly _editorHeight: number = 481;\n\t\t\n\t\tprivate _pitchHeight: number;\n\t\tprivate _pitchCount: number;\n\t\tpublic _mouseX: number = 0;\n\t\tprivate _mouseY: number = 0;\n\t\tprivate _mouseDown: boolean = false;\n\t\tprivate _mouseOver: boolean = false;\n\t\tprivate _cursorPitch: number;\n\t\tprivate _renderedScale: number = -1;\n\t\tprivate _renderedDrums: boolean = false;\n\t\tprivate _renderedKey: number = -1;\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\n\t\t\tthis._documentChanged();\n\t\t\t\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenMouseReleased);\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\n\t\t\t\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenTouchReleased);\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenTouchReleased);\n\t\t}\n\t\t\n\t\tprivate _updateCursorPitch(): void {\n\t\t\tconst scale: ReadonlyArray<boolean> = Config.scaleFlags[this._doc.song.scale];\n\t\t\tconst mousePitch: number = Math.max(0, Math.min(this._pitchCount-1, this._pitchCount - (this._mouseY / this._pitchHeight)));\n\t\t\tif (scale[Math.floor(mousePitch) % 12] || this._doc.song.getChannelIsDrum(this._doc.channel)) {\n\t\t\t\tthis._cursorPitch = Math.floor(mousePitch);\n\t\t\t} else {\n\t\t\t\tlet topPitch: number = Math.floor(mousePitch) + 1;\n\t\t\t\tlet bottomPitch: number = Math.floor(mousePitch) - 1;\n\t\t\t\twhile (!scale[topPitch % 12]) {\n\t\t\t\t\ttopPitch++;\n\t\t\t\t}\n\t\t\t\twhile (!scale[(bottomPitch) % 12]) {\n\t\t\t\t\tbottomPitch--;\n\t\t\t\t}\n\t\t\t\tlet topRange: number = topPitch;\n\t\t\t\tlet bottomRange: number = bottomPitch + 1;\n\t\t\t\tif (topPitch % 12 == 0 || topPitch % 12 == 7) {\n\t\t\t\t\ttopRange -= 0.5;\n\t\t\t\t}\n\t\t\t\tif (bottomPitch % 12 == 0 || bottomPitch % 12 == 7) {\n\t\t\t\t\tbottomRange += 0.5;\n\t\t\t\t}\n\t\t\t\tthis._cursorPitch = mousePitch - bottomRange > topRange - mousePitch ? topPitch : bottomPitch;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\n\t\t\tif (this._mouseOver) return;\n\t\t\tthis._mouseOver = true;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\n\t\t\tif (!this._mouseOver) return;\n\t\t\tthis._mouseOver = false;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tthis._mouseDown = true;\n\t\t\tconst boundingRect: ClientRect = this._canvas.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t\tthis._doc.synth.pianoPressed = true;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\n\t\t\tconst boundingRect: ClientRect = this._canvas.getBoundingClientRect();\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t\tthis._updateCursorPitch();\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenMouseReleased = (event: MouseEvent): void => {\n\t\t\tthis._mouseDown = false;\n\t\t\tthis._doc.synth.pianoPressed = false;\n\t\t\tthis._updatePreview();\n\t\t}\n\t\t\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tthis._mouseDown = true;\n\t\t\tconst boundingRect: ClientRect = this._canvas.getBoundingClientRect();\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t\tthis._updateCursorPitch();\n\t\t\tthis._doc.synth.pianoPressed = true;\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\n\t\t}\n\t\t\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tconst boundingRect: ClientRect = this._canvas.getBoundingClientRect();\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\n\t\t\tthis._updateCursorPitch();\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\n\t\t}\n\t\t\n\t\tprivate _whenTouchReleased = (event: TouchEvent): void => {\n\t\t\tevent.preventDefault();\n\t\t\tthis._doc.synth.pianoPressed = false;\n\t\t}\n\t\t\n\t\tprivate _updatePreview(): void {\n\t\t\tthis._preview.style.visibility = (!this._mouseOver || this._mouseDown) ? \"hidden\" : \"visible\";\n\t\t\tif (!this._mouseOver || this._mouseDown) return;\n\t\t\tthis._previewGraphics.clearRect(0, 0, 32, 40);\n\t\t\tthis._preview.style.left = \"0px\";\n\t\t\tthis._preview.style.top = this._pitchHeight * (this._pitchCount - this._cursorPitch - 1) + \"px\";\n\t\t\tthis._previewGraphics.lineWidth = 2;\n\t\t\tthis._previewGraphics.strokeStyle = \"#ff7200\";\n\t\t\tthis._previewGraphics.strokeRect(1, 1, this._editorWidth - 2, this._pitchHeight - 2);\n\t\t}\n\t\t\n\t\tprivate _documentChanged = (): void => {\n\t\t\tconst isDrum: boolean = this._doc.song.getChannelIsDrum(this._doc.channel);\n\t\t\tthis._pitchHeight = isDrum ? 40 : 13;\n\t\t\tthis._pitchCount = isDrum ? Config.drumCount : Config.pitchCount;\n\t\t\tthis._updateCursorPitch();\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\n\t\t\tthis._doc.synth.pianoChannel = this._doc.channel;\n\t\t\tthis._render();\n\t\t}\n\t\t\n\t\tprivate _render = (): void => {\n\t\t\tif (!finishedLoadingImages) {\n\t\t\t\twindow.requestAnimationFrame(this._render);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif (!this._doc.showLetters) return;\n\t\t\t\n\t\t\tconst isDrum = this._doc.song.getChannelIsDrum(this._doc.channel);\n\t\t\tif (this._renderedScale == this._doc.song.scale && this._renderedKey == this._doc.song.key && this._renderedDrums == isDrum) return;\n\t\t\tthis._renderedScale = this._doc.song.scale;\n\t\t\tthis._renderedKey = this._doc.song.key;\n\t\t\tthis._renderedDrums = isDrum;\n\t\t\t\n\t\t\tthis._graphics.clearRect(0, 0, this._editorWidth, this._editorHeight);\n\t\t\t\n\t\t\tlet key: HTMLImageElement;\n\t\t\tfor (let j: number = 0; j < this._pitchCount; j++) {\n\t\t\t\tconst pitchNameIndex: number = (j + Config.keyTransposes[this._doc.song.key]) % 12;\n\t\t\t\tif (isDrum) {\n\t\t\t\t\tkey = Drum;\n\t\t\t\t\tconst scale: number = 1.0 - ( j / this._pitchCount ) * 0.35;\n\t\t\t\t\tconst offset: number = (1.0 - scale) * 0.5;\n\t\t\t\t\tconst x: number = key.width * offset;\n\t\t\t\t\tconst y: number = key.height * offset + this._pitchHeight * (this._pitchCount - j - 1);\n\t\t\t\t\tconst w: number = key.width * scale;\n\t\t\t\t\tconst h: number = key.height * scale;\n\t\t\t\t    this._graphics.drawImage(key, x, y, w, h);\n\t\t\t\t    \n\t\t\t\t\tconst brightness: number = 1.0 + ((j - this._pitchCount / 2.0) / this._pitchCount) * 0.5;\n\t\t\t\t\tconst imageData: ImageData = this._graphics.getImageData(x, y, w, h);\n\t\t\t\t\tconst data: Uint8ClampedArray = imageData.data;\n\t\t\t\t\tfor(let i = 0; i < data.length; i += 4) {\n\t\t\t\t\t\tdata[i + 0] *= brightness;\n\t\t\t\t\t\tdata[i + 1] *= brightness;\n\t\t\t\t\t\tdata[i + 2] *= brightness;\n\t\t\t\t\t}\n\t\t\t\t\tthis._graphics.putImageData(imageData, x, y);\n\t\t\t\t} else if (!Config.scaleFlags[this._doc.song.scale][j%12]) {\n\t\t\t\t\tkey = Config.pianoScaleFlags[pitchNameIndex] ? WhiteKeyDisabled : BlackKeyDisabled;\n\t\t\t\t    this._graphics.drawImage(key, 0, this._pitchHeight * (this._pitchCount - j - 1));\n\t\t\t\t} else {\n\t\t\t\t\tlet text: string | null = Config.pitchNames[pitchNameIndex];\n\t\t\t\t\t\n\t\t\t\t\tif (text == null) {\n\t\t\t\t\t\tconst shiftDir: number = Config.blackKeyNameParents[j%12];\n\t\t\t\t\t\ttext = Config.pitchNames[(pitchNameIndex + 12 + shiftDir) % 12]!;\n\t\t\t\t\t\tif (shiftDir == 1) {\n\t\t\t\t\t\t\ttext += \"♭\";\n\t\t\t\t\t\t} else if (shiftDir == -1) {\n\t\t\t\t\t\t\ttext += \"♯\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst textColor: string = Config.pianoScaleFlags[pitchNameIndex] ? \"#000\" : \"#fff\";\n\t\t\t\t\tkey = Config.pianoScaleFlags[pitchNameIndex] ? WhiteKey : BlackKey;\n\t\t\t\t    this._graphics.drawImage(key, 0, this._pitchHeight * (this._pitchCount - j - 1));\n\t\t\t\t\tthis._graphics.font = \"bold 11px sans-serif\";\n\t\t\t\t    this._graphics.fillStyle = textColor;\n\t\t\t\t    this._graphics.fillText(text, 15, this._pitchHeight * (this._pitchCount - j) - 3);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._updatePreview();\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { Prompt } from \"./Prompt\";\nimport { SongDocument } from \"./SongDocument\";\n\tconst {button, div} = HTML;\n\n\t\texport class MixPrompt implements Prompt {\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 300px;\"}, [\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Mixing Styles\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"Mixing styles are a way how changing how loud or soft different sounds are and can change the way different sounds blend and mix together. Using different mixing styles can drastically change your song.\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"Type A Mixing is akin to mixing in vanilla Beepbox, Sandbox, and most other beepbox mods. In this mixing type, the drums are about twice as loud as in Type B mixing and the sound is generally a bit sharper and blends together differently.\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"Type B Mixing is regular Modbox mixing.\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"Type C Mixing is like Type B, save for a few upgrades. There are more volume options in Type C mixing, certain waves (acoustic bass, lyre, ramp pulse, and piccolo) are a bit quieter, the flatline wave is a bit louder, and blending works slightly differently.\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"Type D Mixing includes slightly quieter drums from Type B, but also includes sharper sounds for regular notes in pitch channels.\")]),\n\t\t\tthis._cancelButton,\n\t\t]);\t\n\t\t\tconstructor(private _doc: SongDocument) {\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\n\t\t\t}\n\n\t\t\tprivate _close = (): void => { \n\t\t\t\tthis._doc.undo();\n\t\t\t}\n\t\t\t\t\n\t\t\tpublic cleanUp = (): void => { \n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\n\t\t\t};\n\t\t}\n\t","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { Prompt } from \"./Prompt\";\nimport { SongDocument } from \"./SongDocument\";\n\tconst {button, div} = HTML;\n\n\texport class ChorusPrompt implements Prompt {\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\n\t\t\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, [\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Custom Harmony\")]),\n\t\t\tdiv({style: \"text-align: left;\"}, [div(\n\t\t\t\t'BeepBox \"chip\" instruments play two waves at once, each with their own pitch.')]),\n\t\t\tdiv({style: \"text-align: left;\" }, [div('By placing two notes one above another it will play two indivdual sounds. ' +\n\t\t\t'This replaces the \"arpeggio/trill\" effect, and gives you greater control over your harmony. ')]),\n\t\t\tdiv({ style: \"text-align: left;\" }, [\n\t\t\t\tdiv('In older versions of Modbox, union would not allow notes to harmonize properly and needed a special harmonic chorus in order to work. This has been patched in Modbox 3.1.0. '\n\t\t\t\t)]),\n\t\t\tthis._cancelButton,\n\t\t]);\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\n\t\t}\n\t\t\n\t\tprivate _close = (): void => { \n\t\t\tthis._doc.undo();\n\t\t}\n\t\t\n\t\tpublic cleanUp = (): void => { \n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML} from \"imperative-html/dist/esm/elements-strict\";\nimport { Prompt } from \"./Prompt\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Synth } from \"../synth/synth\";\n\tconst {button, div, input} = HTML;\n\n\t// function lerp(low: number, high: number, t: number): number {\n\t// \treturn low + t * (high - low);\n\t// }\n\t\n\tfunction save(blob: Blob, name: string): void {\n\t\tif ((<any>navigator).msSaveOrOpenBlob) {\n\t\t\t(<any>navigator).msSaveOrOpenBlob(blob, name);\n\t\t\treturn;\n\t\t}\n\t\n\t\tconst anchor: HTMLAnchorElement = document.createElement(\"a\");\n\t\tif (anchor.download != undefined) {\n\t\t\tconst url: string = URL.createObjectURL(blob);\n\t\t\tsetTimeout(function() { URL.revokeObjectURL(url); }, 60000);\n\t\t\tanchor.href = url;\n\t\t\tanchor.download = name;\n\t\t\t// Chrome bug regression: We need to delay dispatching the click\n\t\t\t// event. Seems to be related to going back in the browser history.\n\t\t\t// https://bugs.chromium.org/p/chromium/issues/detail?id=825100\n\t\t\tsetTimeout(function() { anchor.dispatchEvent(new MouseEvent(\"click\")); }, 0);\n\t\t} else {\n\t\t\tconst url: string = URL.createObjectURL(blob);\n\t\t\tsetTimeout(function() { URL.revokeObjectURL(url); }, 60000);\n\t\t\tif (!window.open(url, \"_blank\")) window.location.href = url;\n\t\t}\n\t}\n\n\texport class ExportPrompt implements Prompt {\n\t\tprivate readonly _fileName: HTMLInputElement = input({type: \"text\", style: \"width: 10em;\", value: \"Modbox-Song\", maxlength: 250});\n\t\tprivate readonly _enableIntro: HTMLInputElement = input({type: \"checkbox\"});\n\t\tprivate readonly _loopDropDown: HTMLInputElement = input({style:\"width: 2em;\", type: \"number\", min: \"1\", max: \"4\", step: \"1\"});\n\t\tprivate readonly _enableOutro: HTMLInputElement = input({type: \"checkbox\"});\n\t\tprivate readonly _exportWavButton: HTMLButtonElement = button({}, [div(\"Export to .wav file\")]);\n\t\tprivate readonly _exportJsonButton: HTMLButtonElement = button({}, [div(\"Export to .json file\")]);\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Cancel\")]);\n\t\t\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Export Options\")]),\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; justify-content: space-between;\"}, [\n\t\t\t\tdiv(\"File name:\"),\n\t\t\t\tthis._fileName,\n\t\t\t]),\n\t\t\tdiv({style: \"display: table; width: 100%;\"}, [\n\t\t\t\tdiv({style: \"display: table-row;\"}, [\n\t\t\t\t\tdiv({style: \"display: table-cell;\"}, [div(\"Intro:\")]),\n\t\t\t\t\tdiv({style: \"display: table-cell;\"}, [div(\"Loop Count:\")]),\n\t\t\t\t\tdiv({style: \"display: table-cell;\"}, [div(\"Outro:\")]),\n\t\t\t\t]),\n\t\t\t\tdiv({style: \"display: table-row;\"}, [\n\t\t\t\t\tdiv({style: \"display: table-cell; vertical-align: middle;\"}, [this._enableIntro]),\n\t\t\t\t\tdiv({style: \"display: table-cell; vertical-align: middle;\"}, [this._loopDropDown]),\n\t\t\t\t\tdiv({style: \"display: table-cell; vertical-align: middle;\"}, [this._enableOutro]),\n\t\t\t\t]),\n\t\t\t]),\n\t\t\tthis._exportWavButton,\n\t\t\tthis._exportJsonButton,\n\t\t\tthis._cancelButton,\n\t\t]);\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._loopDropDown.value = \"1\";\n\t\t\t\n\t\t\tif (this._doc.song.loopStart == 0) {\n\t\t\t\tthis._enableIntro.checked = false;\n\t\t\t\tthis._enableIntro.disabled = true;\n\t\t\t} else {\n\t\t\t\tthis._enableIntro.checked = true;\n\t\t\t\tthis._enableIntro.disabled = false;\n\t\t\t}\n\t\t\tif (this._doc.song.loopStart + this._doc.song.loopLength == this._doc.song.barCount) {\n\t\t\t\tthis._enableOutro.checked = false;\n\t\t\t\tthis._enableOutro.disabled = true;\n\t\t\t} else {\n\t\t\t\tthis._enableOutro.checked = true;\n\t\t\t\tthis._enableOutro.disabled = false;\n\t\t\t}\n\t\t\t\n\t\t\tthis._fileName.addEventListener(\"input\", ExportPrompt._validateFileName);\n\t\t\tthis._loopDropDown.addEventListener(\"blur\", ExportPrompt._validateNumber);\n\t\t\tthis._exportWavButton.addEventListener(\"click\", this._whenExportToWav);\n\t\t\tthis._exportJsonButton.addEventListener(\"click\", this._whenExportToJson);\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\n\t\t}\n\t\t\n\t\tprivate _close = (): void => { \n\t\t\tthis._doc.undo();\n\t\t}\n\t\t\n\t\tpublic cleanUp = (): void => { \n\t\t\tthis._fileName.removeEventListener(\"input\", ExportPrompt._validateFileName);\n\t\t\tthis._loopDropDown.removeEventListener(\"blur\", ExportPrompt._validateNumber);\n\t\t\tthis._exportWavButton.removeEventListener(\"click\", this._whenExportToWav);\n\t\t\tthis._exportJsonButton.removeEventListener(\"click\", this._whenExportToJson);\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\n\t\t}\n\t\t\n\t\tprivate static _validateFileName(event: Event): void {\n\t\t\tconst input: HTMLInputElement = <HTMLInputElement>event.target;\n\t\t\tconst deleteChars = /[\\+\\*\\$\\?\\|\\{\\}\\\\\\/<>#%!`&'\"=:@]/gi;\n\t\t\tif (deleteChars.test(input.value)) {\n\t\t\t\tlet cursorPos: number = <number>input.selectionStart;\n\t\t\t\tinput.value = input.value.replace(deleteChars, \"\");\n\t\t\t\tcursorPos--;\n\t\t\t\tinput.setSelectionRange(cursorPos, cursorPos);\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate static _validateNumber(event: Event): void {\n\t\t\tconst input: HTMLInputElement = <HTMLInputElement>event.target;\n\t\t\tinput.value = Math.floor(Math.max(Number(input.min), Math.min(Number(input.max), Number(input.value)))) + \"\";\n\t\t}\n\t\t\n\t\tprivate _whenExportToWav = (): void => {\n\t\t\t\n\t\t\tconst synth: Synth = new Synth(this._doc.song)\n\t\t\tsynth.enableIntro = this._enableIntro.checked;\n\t\t\tsynth.enableOutro = this._enableOutro.checked;\n\t\t\tsynth.loopCount = Number(this._loopDropDown.value);\n\t\t\tif (!synth.enableIntro) {\n\t\t\t\tfor (let introIter: number = 0; introIter < this._doc.song.loopStart; introIter++) {\n\t\t\t\t\tsynth.nextBar();\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst sampleFrames: number = synth.totalSamples;\n\t\t\tconst recordedSamplesLeft: Float32Array = new Float32Array(sampleFrames);\n\t\t\tconst recordedSamplesRight: Float32Array = new Float32Array(sampleFrames);\n\t\t\t//const timer: number = performance.now();\n\t\t\tsynth.synthesize(recordedSamplesLeft, recordedSamplesRight, sampleFrames);\n\t\t\t//console.log(\"export timer\", (performance.now() - timer) / 1000.0);\n\t\t\t\n\t\t\tconst srcChannelCount: number = 2;\n\t\t\tconst wavChannelCount: number = 2;\n\t\t\t// const sampleRate: number = 44100;\n\t\t\tconst sampleRate: number = synth.samplesPerSecond;\n\t\t\tconst bytesPerSample: number = 2;\n\t\t\tconst bitsPerSample: number = 8 * bytesPerSample;\n\t\t\tconst sampleCount: number = wavChannelCount * sampleFrames;\n\t\t\t\n\t\t\tconst totalFileSize: number = 44 + sampleCount * bytesPerSample;\n\t\t\t\n\t\t\tlet index: number = 0;\n\t\t\tconst arrayBuffer: ArrayBuffer = new ArrayBuffer(totalFileSize);\n\t\t\tconst data: DataView = new DataView(arrayBuffer);\n\t\t\tdata.setUint32(index, 0x52494646, false); index += 4;\n\t\t\tdata.setUint32(index, 36 + sampleCount * bytesPerSample, true); index += 4; // size of remaining file\n\t\t\tdata.setUint32(index, 0x57415645, false); index += 4;\n\t\t\tdata.setUint32(index, 0x666D7420, false); index += 4;\n\t\t\tdata.setUint32(index, 0x00000010, true); index += 4; // size of following header\n\t\t\tdata.setUint16(index, 0x0001, true); index += 2; // not compressed\n\t\t\tdata.setUint16(index, wavChannelCount, true); index += 2; // channel count\n\t\t\tdata.setUint32(index, sampleRate, true); index += 4; // sample rate\n\t\t\tdata.setUint32(index, sampleRate * bytesPerSample * wavChannelCount, true); index += 4; // bytes per second\n\t\t\tdata.setUint16(index, bytesPerSample, true); index += 2; // sample rate\n\t\t\tdata.setUint16(index, bitsPerSample, true); index += 2; // sample rate\n\t\t\tdata.setUint32(index, 0x64617461, false); index += 4;\n\t\t\tdata.setUint32(index, sampleCount * bytesPerSample, true); index += 4;\n\t\t\tlet stride: number;\n\t\t\tlet repeat: number;\n\t\t\tif (srcChannelCount == wavChannelCount) {\n\t\t\t\tstride = 1;\n\t\t\t\trepeat = 1;\n\t\t\t} else {\n\t\t\t\tstride = srcChannelCount;\n\t\t\t\trepeat = wavChannelCount;\n\t\t\t}\n\t\t\t\n\t\t\tlet valLeft: number;\n\t\t\tlet valRight: number;\n\t\t\tif (bytesPerSample > 1) {\n\t\t\t\t// usually samples are signed. \n\t\t\t\tfor (let i: number = 0; i < sampleFrames; i++) {\n\t\t\t\t\tvalLeft = Math.floor(recordedSamplesLeft[i * stride] * ((1 << (bitsPerSample - 1)) - 1));\n\t\t\t\t\tvalRight = Math.floor(recordedSamplesRight[i * stride] * ((1 << (bitsPerSample - 1)) - 1));\n\t\t\t\t\tfor (let k: number = 0; k < repeat; k++) {\n\t\t\t\t\t\tif (bytesPerSample == 2) {\n\t\t\t\t\t\t\tdata.setInt16(index, valLeft, true); index += 2;\n\t\t\t\t\t\t\tdata.setInt16(index, valRight, true); index += 2;\n\t\t\t\t\t\t} else if (bytesPerSample == 4) {\n\t\t\t\t\t\t\tdata.setInt32(index, valLeft, true); index += 4;\n\t\t\t\t\t\t\tdata.setInt32(index, valRight, true); index += 4;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"unsupported sample size\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// 8 bit samples are a special case: they are unsigned.\n\t\t\t\tfor (let i: number = 0; i < sampleFrames; i++) {\n\t\t\t\t\tvalLeft = Math.floor(recordedSamplesLeft[i*stride] * 127 + 128);\n\t\t\t\t\tvalRight = Math.floor(recordedSamplesRight[i*stride] * 127 + 128);\n\t\t\t\t\tfor (let k: number = 0; k < repeat; k++) {\n\t\t\t\t\t\tdata.setUint8(index, valLeft > 255 ? 255 : (valLeft < 0 ? 0 : valLeft)); index++;\n\t\t\t\t\t\tdata.setUint8(index, valRight > 255 ? 255 : (valRight < 0 ? 0 : valRight)); index++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tconst blob = new Blob([arrayBuffer], {type: \"audio/wav\"});\n\t\t\tsave(blob, this._fileName.value.trim() + \".wav\");\n\t\t\t\n\t\t\tthis._close();\n\t\t}\n\t\t\n\t\tprivate _whenExportToJson = (): void => {\n\t\t\tconst jsonObject: Object = this._doc.song.toJsonObject(this._enableIntro.checked, Number(this._loopDropDown.value), this._enableOutro.checked);\n\t\t\tconst jsonString: string = JSON.stringify(jsonObject, null, '\\t');\n\t\t\tconst blob = new Blob([jsonString], {type: \"application/json\"});\n\t\t\tsave(blob, this._fileName.value.trim() + \".json\");\n\t\t\tthis._close();\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { Prompt } from \"./Prompt\";\nimport { SongDocument } from \"./SongDocument\";\nimport { ChangeSong } from \"./changes\";\n\tconst {button, div, input} = HTML;\n\n\n\texport class ImportPrompt implements Prompt {\n\t\tprivate readonly _fileInput: HTMLInputElement = input({type: \"file\", accept: \".json,application/json\"});\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Cancel\")]);\n\t\t\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Import\")]),\n\t\t\tdiv({style: \"text-align: left;\"}, [div(\"BeepBox songs can be exported and re-imported as .json files. You could also use other means to make .json files for BeepBox as long as they follow the same structure.\")]),\n\t\t\tthis._fileInput,\n\t\t\tthis._cancelButton,\n\t\t]);\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._fileInput.addEventListener(\"change\", this._whenFileSelected);\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\n\t\t}\n\t\t\n\t\tprivate _close = (): void => { \n\t\t\tthis._doc.undo();\n\t\t}\n\t\t\n\t\tpublic cleanUp = (): void => { \n\t\t\tthis._fileInput.removeEventListener(\"change\", this._whenFileSelected);\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\n\t\t}\n\t\t\n\t\tprivate _whenFileSelected = (): void => {\n\t\t\tconst file: File = this._fileInput.files![0];\n\t\t\tif (!file) return;\n\t\t\t\n\t\t\tconst reader: FileReader = new FileReader();\n\t\t\treader.addEventListener(\"load\", (event: Event): void => {\n\t\t\t\tthis._doc.prompt = null;\n\t\t\t\tthis._doc.record(new ChangeSong(this._doc, <string>reader.result), true);\n\t\t\t});\n\t\t\treader.readAsText(file);\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { Prompt } from \"./Prompt\";\nimport { SongDocument } from \"./SongDocument\";\n\n\tconst {button, div, a} = HTML;\n\texport class ArchivePrompt implements Prompt {\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, div(\"No thanks!\"));\n\t\t\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, \n\t\t\tdiv({ style: \"font-size: 2em\" }, div(\"Archives\")),\n\t\t\tdiv({ style: \"text-align: center;\" }, div('These are the Archives. Below are previous versions of Modded Beepbox/Sandbox that you are able to play around with, changelog included. Go nuts!')),\n\t\t\tdiv({ style: \"text-align: center;\" }, \n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/1.3.0.htm\" }, div(\"MB 1.3.0\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/1.6.0.htm\" }, div(\"MB 1.6.0\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/1.9.1.htm\" }, div(\"MB 1.9.1\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/2.0.0.htm\" }, div(\"MB v2.0.0\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/2.3.0.htm\" }, div(\"MB v2.2.2\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/2.3.html\" }, div(\"MB v2.3.0\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/3.0.html\" }, div(\"MB v3.0.3\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/1.2.1.htm\" }, div(\"SB v1.2.1\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/1.3.0.htm\" }, div(\"SB v1.3.0\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/1.4.0.htm\" }, div(\"SB v1.4.0\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/2.0.6.1.htm\" }, div(\"SB v2.0.6.1\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/2.1.3.htm\" }, div(\"SB v2.1.3\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/3.0.0.htm\" }, div(\"SB v3.0.0\")), div(\" | \"),\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/changelogs/mbchangelog.html\" }, div(\"Changelog\")),\n\t\t\t),\n\t\t\tthis._cancelButton,\n\t\t);\n\n\t\t\tconstructor(private _doc: SongDocument) {\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\n\t\t\t}\n\t\t\tprivate _close = (): void => { \n\t\t\t\tthis._doc.undo();\n\t\t\t}\n\t\t\t\n\t\t\tpublic cleanUp = (): void => { \n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\n            };\n    }\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Prompt } from \"./Prompt\";\nimport { SongEditor } from \"./SongEditor\";\nimport { ChangeTheme } from \"./changes\";\n\tconst {button, div} = HTML;\n\n\texport class RefreshPrompt implements Prompt {\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\n\t\tprivate readonly _refreshButton: HTMLButtonElement = button({}, [div(\"Refresh\")]);\n\t\t\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\n\t\t\tdiv({style: \"font-size: 1em\"}, [div(\"Refresh?\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"In order for the theme to change the song must refresh. If you refresh on your own after canceling your theme will not update.\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"If you use a browser that does not support automatic refreshing, like Microsoft Edge, you will have to refresh manually.\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"Would you like to refresh now?\")]),\n            this._refreshButton,\n\t\t\tthis._cancelButton,\n         ]);\n\n\t\t\tconstructor(private _doc: SongDocument, private _songEditor: SongEditor, private _newThemeValue: number) {\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._saveChanges);\n\t\t\t\tthis._refreshButton.addEventListener(\"click\", this._saveChangesAndRefresh);\n\t\t\t}\n\n\t\t\tprivate _saveChanges = (): void => {\n\t\t\t\tthis._doc.prompt = null;\n\t\t\t\tthis._doc.record(new ChangeTheme(this._doc, this._newThemeValue), true);\n\t\t\t}\n\n\t\t\tprivate _saveChangesAndRefresh = (): void => {\n\t\t\t\tthis._saveChanges();\n\t\t\t\tthis._songEditor.refreshNow();\n\t\t\t}\n\t\t\t\n\t\t\tpublic cleanUp = (): void => { \n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._saveChanges);\n\t\t\t\tthis._refreshButton.removeEventListener(\"click\", this._saveChangesAndRefresh);\n            };\n    }\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Prompt } from \"./Prompt\";\n\tconst {button, div} = HTML;\n\n\texport class SongDataPrompt implements Prompt {\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\n\t\t\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, [\n                div({ style: \"font-size: 2em\" }, [div(\"Song Data\")]),\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('You are on update Modbox 3.3.0-B_1.')]),\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your song is ' + this._doc.synth.totalSeconds + ' seconds long.')]),\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your song runs at ' + this._doc.song.getBeatsPerMinute() + ' beats per minute.')]),\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('There are currently ' + this._doc.song.getChannelUnusedCount() + ' unused channels in your song out of 16.')]),\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your are using the ' + this._doc.song.getThemeName() + ' theme.')]),\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your time signuature is ' + this._doc.song.getTimeSig())]),\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your scale is ' + this._doc.song.getScaleNKey() + '.')]),\n\t\t\tthis._cancelButton,\n         ]);\n\n\t\t\tconstructor(private _doc: SongDocument) {\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\n\t\t\t}\n\t\t\tprivate _close = (): void => { \n\t\t\t\tthis._doc.undo();\n\t\t\t}\n\t\t\t\n\t\t\tpublic cleanUp = (): void => { \n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\n            };\n    }\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Prompt } from \"./Prompt\";\nimport { SongEditor } from \"./SongEditor\";\nimport { ChangeKey } from \"./changes\";\n\tconst {button, div} = HTML;\n\texport class RefreshKeyPrompt implements Prompt {\n\t\tprivate readonly _refreshButton: HTMLButtonElement = button({}, [div(\"Refresh\")]);\n\t\t\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\n\t\t\tdiv({style: \"font-size: 1em\"}, [div(\"Refresh\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"Due to you using the Piano theme, you will need to refresh to display the change in key colors.\")]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\n\t\t\t\tdiv(\"You must refresh to continue.\")]),\n            this._refreshButton,\n         ]);\n\n\t\t\tconstructor(private _doc: SongDocument, private _songEditor: SongEditor, private _newKeyValue: number) {\n\t\t\t\tthis._refreshButton.addEventListener(\"click\", this._saveChangesAndRefresh);\n\t\t\t}\n\n\t\t\tprivate _saveChangesAndRefresh = (): void => {\n\t\t\t\tthis._doc.prompt = null;\n\t\t\t\tthis._doc.record(new ChangeKey(this._doc, this._newKeyValue));\n\t\t\t\tthis._songEditor.refreshNow();\n\t\t\t}\n\t\t\t\n\t\t\tpublic cleanUp = (): void => { \n\t\t\t\tthis._refreshButton.addEventListener(\"click\", this._saveChangesAndRefresh);\n            };\n    }\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Prompt } from \"./Prompt\";\nimport { Config } from \"../synth/SynthConfig\";\nimport { ChangeGroup } from \"./Change\";\nimport { ChangeBeatsPerBar, ChangeBarCount, ChangePatternsPerChannel, ChangeInstrumentsPerChannel, ChangeChannelCount } from \"./changes\";\n\tconst {button, div, input, span} = HTML;\n\t\n\texport class SongDurationPrompt implements Prompt {\n\t\tprivate readonly _beatsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\n\t\tprivate readonly _barsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\n\t\tprivate readonly _patternsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\n\t\tprivate readonly _instrumentsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\n\t\tprivate readonly _pitchChannelStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\n\t\tprivate readonly _drumChannelStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\n\t\tprivate readonly _okayButton: HTMLButtonElement = button({style: \"width:45%;\"}, [div(\"Okay\")]);\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({style: \"width:45%;\"}, [div(\"Cancel\")]);\n\t\t\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, [\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Custom Song Size\")]),\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\n\t\t\t\tdiv({style: \"text-align: right;\"}, [\n\t\t\t\t\tdiv(\"Beats per bar:\"),\n\t\t\t\t\tspan({style: \"font-size: smaller; color: #888888;\"}, [div(\"(Multiples of 3 or 4 are recommended)\")]),\n\t\t\t\t]),\n\t\t\t\tthis._beatsStepper,\n\t\t\t]),\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\n\t\t\t\tdiv({style: \"display: inline-block; text-align: right;\"}, [\n\t\t\t\t\tdiv(\"Bars per song:\"),\n\t\t\t\t\tspan({style: \"font-size: smaller; color: #888888;\"}, [div(\"(Multiples of 2 or 4 are recommended)\")]),\n\t\t\t\t]),\n\t\t\t\tthis._barsStepper,\n\t\t\t]),\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\n\t\t\t\tdiv(\"Patterns per channel:\"),\n\t\t\t\tthis._patternsStepper,\n\t\t\t]),\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\n\t\t\t\tdiv(\"Instruments per channel:\"),\n\t\t\t\tthis._instrumentsStepper,\n\t\t\t]),\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\n\t\t\t\tdiv(\"Number of pitch channels:\"),\n\t\t\t\tthis._pitchChannelStepper,\n\t\t\t]),\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\n\t\t\t\tdiv(\"Number of drum channels:\"),\n\t\t\t\tthis._drumChannelStepper,\n\t\t\t]),\n\t\t\tdiv({style: \"display: flex; flex-direction: row; justify-content: space-between;\"}, [\n\t\t\t\tthis._okayButton,\n\t\t\t\tthis._cancelButton,\n\t\t\t]),\n\t\t]);\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._beatsStepper.value = this._doc.song.beatsPerBar + \"\";\n\t\t\tthis._beatsStepper.min = Config.beatsPerBarMin + \"\";\n\t\t\tthis._beatsStepper.max = Config.beatsPerBarMax + \"\";\n\t\t\t\n\t\t\tthis._barsStepper.value = this._doc.song.barCount + \"\";\n\t\t\tthis._barsStepper.min = Config.barCountMin + \"\";\n\t\t\tthis._barsStepper.max = Config.barCountMax + \"\";\n\t\t\t\n\t\t\tthis._patternsStepper.value = this._doc.song.patternsPerChannel + \"\";\n\t\t\tthis._patternsStepper.min = Config.patternsPerChannelMin + \"\";\n\t\t\tthis._patternsStepper.max = Config.patternsPerChannelMax + \"\";\n\t\t\t\n\t\t\tthis._instrumentsStepper.value = this._doc.song.instrumentsPerChannel + \"\";\n\t\t\tthis._instrumentsStepper.min = Config.instrumentsPerChannelMin + \"\";\n\t\t\tthis._instrumentsStepper.max = Config.instrumentsPerChannelMax + \"\";\n\t\t\t\n\t\t\tthis._pitchChannelStepper.value = this._doc.song.pitchChannelCount + \"\";\n\t\t\tthis._pitchChannelStepper.min = Config.pitchChannelCountMin + \"\";\n\t\t\tthis._pitchChannelStepper.max = Config.pitchChannelCountMax + \"\";\n\t\t\t\n\t\t\tthis._drumChannelStepper.value = this._doc.song.drumChannelCount + \"\";\n\t\t\tthis._drumChannelStepper.min = Config.drumChannelCountMin + \"\";\n\t\t\tthis._drumChannelStepper.max = Config.drumChannelCountMax + \"\";\n\t\t\t\n\t\t\tthis._okayButton.addEventListener(\"click\", this._saveChanges);\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\n\t\t\tthis._beatsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._barsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._patternsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._instrumentsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._pitchChannelStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._drumChannelStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._beatsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._barsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._patternsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._instrumentsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._pitchChannelStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._drumChannelStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t}\n\t\t\n\t\tprivate _close = (): void => { \n\t\t\tthis._doc.undo();\n\t\t}\n\t\t\n\t\tpublic cleanUp = (): void => { \n\t\t\tthis._okayButton.removeEventListener(\"click\", this._saveChanges);\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\n\t\t\tthis._beatsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._barsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._patternsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._instrumentsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._pitchChannelStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._drumChannelStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\n\t\t\tthis._beatsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._barsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._patternsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._instrumentsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._pitchChannelStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t\tthis._drumChannelStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\n\t\t}\n\t\t\n\t\tprivate static _validateKey(event: KeyboardEvent): boolean {\n\t\t\tconst charCode = (event.which) ? event.which : event.keyCode;\n\t\t\tif (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tprivate static _validateNumber(event: Event): void {\n\t\t\tconst input: HTMLInputElement = <HTMLInputElement>event.target;\n\t\t\tinput.value = Math.floor(Math.max(Number(input.min), Math.min(Number(input.max), Number(input.value)))) + \"\";\n\t\t}\n\t\t\n\t\tprivate static _validate(input: HTMLInputElement): number {\n\t\t\treturn Math.floor(Number(input.value));\n\t\t}\n\t\t\n\t\tprivate _saveChanges = (): void => {\n\t\t\tconst group: ChangeGroup = new ChangeGroup();\n\t\t\tgroup.append(new ChangeBeatsPerBar(this._doc, SongDurationPrompt._validate(this._beatsStepper)));\n\t\t\tgroup.append(new ChangeBarCount(this._doc, SongDurationPrompt._validate(this._barsStepper)));\n\t\t\tgroup.append(new ChangePatternsPerChannel(this._doc, SongDurationPrompt._validate(this._patternsStepper)));\n\t\t\tgroup.append(new ChangeInstrumentsPerChannel(this._doc, SongDurationPrompt._validate(this._instrumentsStepper)));\n\t\t\tgroup.append(new ChangeChannelCount(this._doc, SongDurationPrompt._validate(this._pitchChannelStepper), SongDurationPrompt._validate(this._drumChannelStepper)));\n\t\t\tthis._doc.prompt = null;\n\t\t\tthis._doc.record(group, true);\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML} from \"imperative-html/dist/esm/elements-strict\";\nimport { Prompt } from \"./Prompt\";\nimport { SongDocument } from \"./SongDocument\";\n\tconst {button, div, a} = HTML;\n\n\texport class InstrumentTypePrompt implements Prompt {\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\n\t\t\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 300px;\"}, [\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"FM Synthesis\")]),\n\t\t\tdiv({ style: \"text-align: left; margin: 0.5em 0;\" }, [\n\t\t\t\tdiv('Popularized by the Sega Genesis and Yamaha keyboards, FM Synthesis is a mysterious but powerful technique for crafting sounds. It may seem confusing, but just play around with the options until you get a feel for it, check out some examples in '),\n\t\t\t\ta( { target: \"_blank\", href: \"#6n10s0kbl00e07t5m0a7g07j7i7r1o2T1d2c0A0F1B0V1Q0200Pff00E0411T1d1c0A0F0B0V1Q2800Pf700E0711T1d2c0A0F1B4VaQ0200Pfb00E0911T1d1c2A0F9B3V1Q1000Pfbc0E0191T1d2c0AcF8B5V1Q0259PffffE0000T1d3c1AcF4B5V4Q2600Pff00E0011T1d1c0AbF0B0V1Q2580PfffaE2226T1d1c0A1F0B0V1Q520dPff4dEd41eb4zhmu0p21h5dfxd7ij7XrjfiAjPudUTtUSRsTzudTudJvdUTztTzrpPudUTtUSSYTzudTudJTdUTztTzrvPudUTtUSQ\" }, [div(\"this demo\")]),\n\t\t\t\tdiv(\", or find some instruments to use in the Beepbox Discord's FM sheet \"),\n\t\t\t\ta( { target: \"_blank\", href: \"https://docs.google.com/spreadsheets/d/1ddbXnrP7yvv5X4oUur9boi3AxcI-Xxz1XIHIAo-wi0s/edit#gid=230623845\" }, [div(\"right here\")]),\n\t\t\t\tdiv(\".\")\n\t\t\t]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\n\t\t\t\t'This FM instrument uses up to four waves, numbered 1, 2, 3, and 4. ' +\n\t\t\t\t'Each wave may have its own frequency, volume, and volume envelope to control its effect over time. '\n\t\t\t)]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\n\t\t\t\t'There are two kinds of waves: \"carrier\" waves play a tone out loud, but \"modulator\" waves distort other waves instead. ' +\n\t\t\t\t'Wave 1 is always a carrier and plays a tone, but other waves may distort it. ' +\n\t\t\t\t'The \"Algorithm\" setting determines which waves are modulators, and which other waves those modulators distort. '\n\t\t\t)]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\n\t\t\t\t'Modulators distort in one direction (like 1←2), but you can also use \"Feedback\" to make any wave distort in the opposite direction (1→2), in both directions (1🗘2), or even itself (1⟲). '\n\t\t\t)]),\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\n\t\t\t\t'You can set the pitch of each wave independently by adding simultaneous notes, one above another. This often sounds harsh or dissonant, but can make cool sound effects! '\n\t\t\t)]),\n\t\t\tthis._cancelButton,\n\t\t]);\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\n\t\t}\n\t\t\n\t\tprivate _close = (): void => { \n\t\t\tthis._doc.undo();\n\t\t}\n\t\t\n\t\tpublic cleanUp = (): void => { \n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Prompt } from \"./Prompt\";\n\tconst {button, div, p, a } = HTML;\n\n\texport class ManualPrompt implements Prompt {\n\t\tprivate readonly _nextButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Next\");\n\t\tprivate readonly _backButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Close\");\n\t\tprivate page: number = 0;\n\n\t\tprivate readonly introContainer: HTMLDivElement = div({style:\"display:flex; flex-direction: column; gap: 16px; text-align: left; font-size: 16px; overflow-y: scroll;\"},\n\t\t\tdiv({ style: \"font-size: 1.5em\" }, div(\"Introduction\")),\n\t\t\tdiv({},\n\t\t\t\"BeepBox is an online tool for sketching and sharing chiptune melodies. ModBox expands the world of BeepBox into a whole new realm! We are on the frontier of exploaration with this beta!\"\n\t\t\t),\n\t\t\tdiv({},\n\t\t\t\t\"This is a specialized manual explaining the basics of using ModBox\",\n\t\t\t),\n\t\t\tdiv({},\n\t\t\t\t\"All song data is packaged into the URL at the top of your browser. When you make changes to the song, the URL is updated \",\n\t\t\t\t\"to reflect your changes. When you are satisfied with your song, just copy and paste the URL to save and share your song!\"\n\t\t\t),\n\t\t\t\n\t\t);\n\n\t\tprivate readonly instructionsContainer: HTMLDivElement = div({style:\"display:none;  flex-direction: column; gap: 16px; text-align: left; font-size: 16px; overflow-y: scroll;\"},\n\t\t\tdiv({ style: \"font-size: 1.5em\" }, div(\"Instructions\")),\n\t\t\tdiv({},\n\t\t\tp({},\" You can add or remove notes by clicking on the gray rows at the top. BeepBox automatically plays the notes out loud for you. Try it!\",),\n\t\t\tp({},\"Notes go into patterns, and you can edit one pattern at a time. Those numbered boxes at the bottom of the editor are the different patterns you can edit. Click the other boxes to move to a different part of the song, or click the arrows on the currently selected box to swap which pattern is played during that part of the song.\",),\n\t\t\tp({},\"There are four rows of patterns that BeepBox can play simultaneously, and each row has its own set of patterns. The first three rows can play melodies and the bottom row is for drums.\",),\n\t\t\tp({},\"The purple loop underneath the numbered boxes controls which part of the song is currently repeating. Move the loop to listen to a different part of the song, or drag the ends to expand the loop to include the whole song.\",),\n\t\t\t),\n\t\t\tdiv({},\n\t\t\t\tp({},\"When BeepBox has focus (click on its interface above), you can use these keyboard shortcuts:\",),\n\t\t\t\tp({},\t\"Spacebar: Pause or Resume\",),\n\t\t\t\tp({},\t\"Z: Undo\",),\n\t\t\t\tp({},\t\"Y or Shift Z: Redo\",),\n\t\t\t\tp({},\t\"C: Copy the current pattern\",),\n\t\t\t\tp({},\t\"V: Paste the current pattern\",),\n\t\t\t\tp({},\t\"Q: Go to Custom Song Settings\",),\n\t\t\t\tp({},\t\"[ ]: Move the playhead backward and forward\",),\n\t\t\t\tp({},\t\"Arrow Keys: Change which bar is selected\",),\n\t\t\t\tp({},\t\"1-8: Reassign a pattern to the currently selected bar\",),\n\t\t\t\tp({},\t\"In the pattern editor, you can click and drag horizontally on a note to adjust its duration. You can also click above or below an existing note to enable a rapid arpeggio/trill effect, oscillating between two or more simultaneous notes.\",),\n\n\t\t\t\tp({},\"AVDANCED: Drag vertically from an existing note to bend its pitch, or drag vertically from above or below the note to adjust its volume.\",),\n\n\t\t\t\tp({},\"ModBox has many more features. Enabling Advanced Settings via the Prefernces Menu unlocks much more of Modbox's features! \",),\n\t\t\t\tp({},\"to reflect your changes. When you are satisfied with your song, just copy and paste the URL to save and share your song!\",),\n\t\t\t),\n\t\t);\n\n\t\tprivate readonly aboutContainer: HTMLDivElement = div({style:\"display:none;  flex-direction: column; gap: 16px; text-align: left; font-size: 16px; overflow-y: scroll;\"},\n\t\t\tdiv({ style: \"font-size: 1.5em\" }, div(\"About\")),\n\t\t\tdiv({},\n\t\t\t\tp({},\"BeepBox is developed by John Nesky, also known as shaktool. Modded Beepbox is developed by Quirby64, Theepicosity, Fillygroove, and DARE. \"),\n\t\t\t),\n\t\t\tdiv({},\n\t\t\t\tp({},\"BeepBox and Modded Beepbox do not claim ownership over songs created with it, so original songs belong to their authors. \",),\n\t\t\t),\n\t\t\tdiv({},\n\t\t\t\tp({},\"Neither John Nesky, BeepBox, nor the Modded BeepBox Dev Team assume responsibility for any copyrighted material played on BeepBox. No songs are ever received, recorded, or distributed by BeepBox or Moded Beepbox's servers. The Modbox Dev Team is not liable for any problems that may occur when your song gets updated in this beta and this beta alone. All song data is contained in the URL after the hash (#) mark, and BeepBox running inside your browser converts that data into sound waves. \",),\n\t\t\t\tp({},\"You can download and use the\",a({ href: \"https://github.com/ModdedBeepbox/beta\" }, \"source code\"),  \"under the MIT license.\"),\n\t\t\t),\n\t\t\t\n\t\t);\n\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 400px; max-height: 600px;\"}, [\n                div({ style: \"font-size: 2em\" }, div(\"Manual\")),\n\t\t\t\tthis.introContainer,\n\t\t\t\tthis.instructionsContainer,\n\t\t\t\tthis.aboutContainer,\n\t\t\t\tdiv({style:\"display:flex; flex-direction:row; justify-content:space-between; width:100%; gap: 16px;\"},\n\t\t\tthis._backButton, this._nextButton),\n         ]);\n\n\t\t\tconstructor(private _doc: SongDocument) {\n\t\t\t\tthis._backButton.addEventListener(\"click\", this._backPage);\n\t\t\t\tthis._nextButton.addEventListener(\"click\", this._nextPage);\n\t\t\t}\n\n\t\t\tprivate _backPage = (): void => {\n\t\t\t\tif (this.page > 0) {\n\t\t\t\tthis.page--;\n\t\t\t\tthis._changePage();\n\t\t\t\t} else {\n\t\t\t\t\tthis._close();\n\t\t\t\t\tthis.cleanUp();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprivate _nextPage = (): void => {\n\t\t\t\tif (this.page < 2) {\n\t\t\t\t\tthis.page++;\n\t\t\t\t\tthis._changePage();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprivate _changePage = (): void => { \n\t\t\t\tif (this.page == 0) {\n\t\t\t\t\tthis.introContainer.style.display = \"flex\";\n\t\t\t\t\tthis.instructionsContainer.style.display = \"none\";\n\t\t\t\t\tthis.aboutContainer.style.display = \"none\";\n\t\t\t\t\tthis._backButton.innerHTML = \"Close\";\n\t\t\t\t}\n\t\t\t\tif (this.page == 1) {\n\t\t\t\t\tthis.introContainer.style.display = \"none\";\n\t\t\t\t\tthis.instructionsContainer.style.display = \"flex\";\n\t\t\t\t\tthis.aboutContainer.style.display = \"none\";\n\t\t\t\t\tthis._backButton.innerHTML = \"Back\";\n\t\t\t\t\tthis._nextButton.style.display = \"\";\n\t\t\t\t} \n\t\t\t\tif (this.page == 2) {\n\t\t\t\t\tthis.introContainer.style.display = \"none\";\n\t\t\t\t\tthis.instructionsContainer.style.display = \"none\";\n\t\t\t\t\tthis.aboutContainer.style.display = \"flex\";\n\t\t\t\t\tthis._nextButton.style.display = \"none\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tprivate _close = (): void => { \n\t\t\t\tthis._doc.undo();\n\t\t\t}\n\t\t\t\n\t\t\tpublic cleanUp = (): void => { \n\t\t\t\tthis._backButton.removeEventListener(\"click\", this._backPage);\n\t\t\t\tthis._nextButton.removeEventListener(\"click\", this._nextPage);\n            };\n    }\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\nimport { SongDocument } from \"./SongDocument\";\nimport { Prompt } from \"./Prompt\";\nimport { ColorConfig } from \"./ColorConfig\"; \n\tconst {button, div, form, label, input } = HTML;\n\n\texport class ThemePrompt implements Prompt {\n\t\tpublic hasChanged = false;\n\t\tprivate readonly _closeButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Close\");\n\t\tprivate readonly _previewButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Preview\");\n\t\tprivate readonly _previewText: HTMLDivElement = div({style:\"opacity: 0; position:absolute; left: 8px; top: 24px; font-size: 32px; font-weight:bold;\"},\"Previewing...\")\n\t\tpublic readonly previewExit: HTMLDivElement = div({style: \"width: 100vw; height: 100vh; position: fixed; left: 0; top: -2vh; display: flex; pointer-events: none;\"},this._previewText);\n\t\t\n\t\tprivate _form: HTMLFormElement = form({style: \"display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; max-height:265px; overflow-y: scroll; overflow-x: hidden;\"},\n\t\t\tlabel({title:\"Default\", class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"default\", style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #606060; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Default\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"NepBox\", class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"nepbox\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #9150ff; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"NepBox\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"ModBox 2.0\", class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"modbox2\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #c4ffa3; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"ModBox 2.0\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Artic\", class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"artic\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #a5eeff; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Artic\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Cinnamon Roll [!]\", class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Cinnamon Roll\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #f5bb00; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"CinnaBun [!]\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Ocean\", class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Ocean\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #4449a3; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Ocean\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Rainbow [!]\", class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"rainbow\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #faa, #ffceaa, #ffdfaa, #fff5aa, #e8ffaa, #bfffb2, #b2ffc8, #b2ffe4, #b2b3ff, #e0b2ff, #ffafe9); border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Rainbow [!]\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Float\", class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"float\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #fff, #282828); border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Float [!]\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({ title:\"Windows\", class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"windows\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #295294; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Windows\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Grassland\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"grassland\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #74bc21; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Grassland\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Dessert\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"dessert\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fffc5b; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Dessert\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Kahootiest\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"kahootiest\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #864cbf; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Kahoot\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Beam to the Bit [!]\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"beambit\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fa0103; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Beambit [!]\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Pretty Egg\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"egg\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffb1f4; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Pretty Egg\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Poniryoshka\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Poniryoshka\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #dabbe6; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Poni\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Gameboy [!]\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"gameboy\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #306230; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Gameboy [!]\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Woodkid\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"woodkid\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #41323b; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Woodkid\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Midnight\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"midnight\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #445566; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Midnight\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Snedbox\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"snedbox\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #10997e; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Snedbox\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"unnamed\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"unnamed\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffffa0; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"unnamed\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Piano\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"piano\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #bfbfbf; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Piano [!]\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"Halloween\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"halloween\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #914300; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Halloween\"),\n\t\t\t\t),\n\t\t\t),\n\t\t\tlabel({title:\"FrozenOver❄️\",class: \"theme-option\"},\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"frozen\",style:\"display:none;\"}),\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #99c8ef; border-radius: 35px;\"}),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Frozen\"),\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\t\n\t\t\n\t\tpublic readonly themeContainer: HTMLDivElement = div({class: \"prompt\", style: \"width: 330px; max-height: 600px;\"}, \n                div({ style: \"font-size: 2em\" }, div(\"Themes\")),\n\t\t\t\tthis._form,\n\t\t\t\tdiv({style:\"display:flex; flex-direction:row; width:100%; gap: 16px;\"},\n\t\t\tthis._previewButton,\n\t\t\tthis._closeButton),\n        );\n\t\tpublic readonly container: HTMLDivElement = div({}, \n\t\t\tthis.themeContainer,\n\t\t\tthis.previewExit,\n        );\n\n\t\t\tconstructor(private _doc: SongDocument) {\n\t\t\t\tthis._closeButton.addEventListener(\"click\", this._close);\n\t\t\t\tthis._previewButton.addEventListener(\"click\", this._previewTheme);\n\t\t\t\tthis.previewExit.addEventListener(\"click\", this._exitPreview);\n\t\t\t\tthis._form.addEventListener(\"change\", this._themeChange);\n\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\") != null) {\n\t\t\t\t\t(<any> this._form.elements)[\"theme\"].value = window.localStorage.getItem(\"modboxTheme\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprivate _close = (): void => { \n\t\t\t\tif (this.hasChanged == false) {\n\t\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\")){\n\t\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tColorConfig.setTheme(\"default\");\n\t\t\t\t\t}\n\t\t\t\t\tthis._doc.prompt = null;\n\t\t\t\t\tthis._doc.undo(); \n\t\t\t\t} else {\n\t\t\t\t\twindow.localStorage.setItem(\"modboxTheme\", (<any> this._form.elements)[\"theme\"].value);\n\t\t\t\t\tthis._doc.prompt = null;\n\t\t\t\t\tthis._doc.undo();\t\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprivate _themeChange = (): void => {\n\t\t\t\tColorConfig.setTheme((<any> this._form.elements)[\"theme\"].value);\n\t\t\t\t\n\t\t\t\tif ((<any> this._form.elements)[\"theme\"].value != window.localStorage.getItem(\"modboxTheme\")) {\n\t\t\t\tthis.hasChanged = true;\n\t\t\t\tthis._closeButton.innerHTML = \"Save\"; \n\t\t\t} else {\n\t\t\t\tthis.hasChanged = false;\n\t\t\t\tthis._closeButton.innerHTML = \"Cancel\"; \n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprivate _previewTheme = (): void => { \n\t\t\t\tthis.themeContainer.style.opacity = \"0\";\n\t\t\t\tthis.previewExit.style.pointerEvents = \"\";\n\t\t\t\tthis._previewText.style.opacity = \"1\";\n\t\t\t}\n\n\t\t\tprivate _exitPreview = (): void => { \n\t\t\t\tthis.themeContainer.style.opacity = \"1\";\n\t\t\t\tthis.previewExit.style.pointerEvents = \"none\";\n\t\t\t\tthis._previewText.style.opacity = \"0\";\n\t\t\t}\n\t\t\t\n\t\t\tpublic cleanUp = (): void => { \n\t\t\t\tthis._closeButton.removeEventListener(\"click\", this._close);\n            };\n    }\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport {Prompt} from \"./Prompt\";\nimport { SongDocument } from \"./SongDocument\";\nimport {Change} from \"./Change\";\nimport {PatternEditor} from \"./PatternEditor\";\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\nimport { Note, Channel, Pattern, Instrument } from \"../synth/synth\";\nimport { InstrumentType, Config } from \"../synth/SynthConfig\";\nimport { TrackEditor } from \"./TrackEditor\";\nimport { LoopEditor } from \"./LoopEditor\";\nimport { BarScrollBar } from \"./BarScrollBar\";\nimport { OctaveScrollBar } from \"./OctaveScrollBar\";\nimport { Piano } from \"./Piano\";\nimport { ChangeInsertBars, ChangeTransition, ChangeAlgorithm, ChangeBlend, ChangeChannelBar, ChangeChorus, ChangeDetune, ChangeEffect,ChangeFMChorus, ChangeFeedbackAmplitude, ChangeFeedbackEnvelope, ChangeFeedbackType, ChangeFilter, ChangeHarm, ChangeImute, ChangeInstrumentType, ChangeIpan, ChangeKey,  ChangeMix, ChangeMuff, ChangeOctoff, ChangeOperatorAmplitude, ChangeOperatorEnvelope, ChangeOperatorFrequency, ChangePartsPerBeat, ChangePaste, ChangePatternInstrument, ChangeReverb, ChangeRiff, ChangeSampleRate, ChangeScale, ChangeSong, ChangeTempo, ChangeTranspose, ChangeVolume, ChangeWave, ChangeDeleteBars, ChangeRemoveChannel, ChangeAddChannel, ChangeEnsurePatternExists } from \"./changes\";\nimport { MixPrompt} from \"./MixPrompt\";\nimport { ChorusPrompt } from \"./ChorusPrompt\";\nimport { ExportPrompt } from \"./ExportPrompt\";\nimport { ImportPrompt } from \"./ImportPrompt\";\nimport { ArchivePrompt } from \"./ArchivePrompt\";\nimport { RefreshPrompt } from \"./RefreshPrompt\";\nimport { SongDataPrompt } from \"./SongDataPrompt\";\nimport { RefreshKeyPrompt } from \"./RefreshKeyPrompt\";\nimport { SongDurationPrompt } from \"./SongDurationPrompt\";\nimport { InstrumentTypePrompt } from \"./InstrumentTypePrompt\";\nimport { ManualPrompt } from \"./ManualPrompt\";\nimport { ThemePrompt } from \"./ThemePrompt\";\nimport { ColorConfig } from \"./ColorConfig\"; \n\nconst {button, div, span, select, option, input, a} = HTML;\n\t\n\texport const isMobile: boolean = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent);\n\t\n\tfunction buildOptions(menu: HTMLSelectElement, items: ReadonlyArray<string | number>): HTMLSelectElement {\n\t\tfor (let index: number = 0; index < items.length; index++) {\n\t\t\tmenu.appendChild(option({value: index}, items[index]));\n\t\t}\n\t\treturn menu;\n\t}\n\t\n\tfunction buildOptionsWithSpecificValues(menu: HTMLSelectElement, items: ReadonlyArray<string | number>, values: ReadonlyArray<string | number>): HTMLSelectElement {\n\t\tif (items.length != values.length) {\n\t\t\tthrow new Error(\"items and values don't have the same length\");\n\t\t}\n\t\tfor (let i: number = 0; i < items.length; i++) {\n\t\t\tconst item: string | number = items[i];\n\t\t\tconst value: string | number = values[i];\n\t\t\tmenu.appendChild(option({value:value}, item));\n\t\t}\n\t\treturn menu;\n\t}\n\t\n\tfunction setSelectedIndex(menu: HTMLSelectElement, index: number): void {\n\t\tif (menu.selectedIndex != index) menu.selectedIndex = index;\n\t}\n\t\n\tinterface PatternCopy {\n\t\tnotes: Note[];\n\t\tbeatsPerBar: number;\n\t\tpartsPerBeat: number;\n\t\tdrums: boolean;\n\t}\n\t\n\tclass Slider {\n\t\tprivate _change: Change | null = null;\n\t\tprivate _value: number = 0;\n\t\tprivate _oldValue: number = 0;\n\t\t\n\t\tconstructor(public readonly input: HTMLInputElement, private readonly _doc: SongDocument, private readonly _getChange: (oldValue: number, newValue: number)=>Change) {\n\t\t\tinput.addEventListener(\"input\", this._whenInput);\n\t\t\tinput.addEventListener(\"change\", this._whenChange);\n\t\t}\n\t\t\n\t\tpublic updateValue(value: number): void {\n\t\t\tthis._value = value;\n\t\t\tthis.input.value = String(value);\n\t\t}\n\t\t\n\t\tprivate _whenInput = (): void => {\n\t\t\tconst continuingProspectiveChange: boolean = this._doc.lastChangeWas(this._change);\n\t\t\tif (!continuingProspectiveChange) this._oldValue = this._value;\n\t\t\tthis._change = this._getChange(this._oldValue, parseInt(this.input.value));\n\t\t\tthis._doc.setProspectiveChange(this._change);\n\t\t};\n\t\t\n\t\tprivate _whenChange = (): void => {\n\t\t\tthis._doc.record(this._change!);\n\t\t\tthis._change = null;\n\t\t};\n\t}\n\t\n\texport class SongEditor {\n\t\tpublic prompt: Prompt | null = null;\n\t\t\n\t\tprivate readonly _patternEditor: PatternEditor = new PatternEditor(this._doc);\n\t\tprivate readonly _trackEditor: TrackEditor = new TrackEditor(this._doc);\n\t\tprivate readonly _loopEditor: LoopEditor = new LoopEditor(this._doc);\n\t\tprivate readonly _trackContainer: HTMLDivElement = div({class: \"trackContainer\"}, \n\t\t\tthis._trackEditor.container,\n\t\t\tthis._loopEditor.container,\n\t\t);\n\t\tprivate readonly _barScrollBar: BarScrollBar = new BarScrollBar(this._doc, this._trackContainer);\n\t\tprivate readonly _octaveScrollBar: OctaveScrollBar = new OctaveScrollBar(this._doc);\n\t\tprivate readonly _piano: Piano = new Piano(this._doc);\n\t\tprivate readonly _editorBox: HTMLDivElement = div({}, \n\t\t\tdiv({class: \"editorBox\", style: \"height: 481px; display: flex; flex-direction: row; margin-bottom: 6px;\"}, \n\t\t\t\tthis._piano.container,\n\t\t\t\tthis._patternEditor.container,\n\t\t\t\tthis._octaveScrollBar.container,\n\t\t\t),\n\t\t\tthis._trackContainer,\n\t\t\tthis._barScrollBar.container,\n\t\t);\n\t\tprivate readonly _playButton: HTMLButtonElement = button({style: \"width:0; flex:2;\", type: \"button\"});\n\t\tprivate readonly _prevBarButton: HTMLButtonElement = button({class: \"prevBarButton\", style: \"width: 0; margin: 0px; flex:1; margin-left: 0px;\", type: \"button\", title: \"Prev Bar (left bracket)\"});\n\t\tprivate readonly _nextBarButton: HTMLButtonElement = button({class: \"nextBarButton\", style: \"width: 0; margin: 0px; flex:1; margin-left: 0px;\", type: \"button\", title: \"Next Bar (right bracket)\"});\n\t\tprivate readonly _volumeSlider: HTMLInputElement = input({title: \"main volume\", style: \"flex:1; margin: 0px;\", type: \"range\", min: \"0\", max: \"100\", value: \"50\", step: \"1\"});\n\t\tprivate readonly _fileMenu: HTMLSelectElement = select({style: \"width: 100%;\"}, \n\t\t\toption({selected: true, disabled: true, hidden: false}, \"File Menu\"),\n\t\t\toption({value: \"cleanS\"}, \"New Song\"),\n\t\t\toption({value: \"import\"}, \"Import JSON\"),\n\t\t\toption({value: \"export\"}, \"Export Song\"),\n\t\t\toption({value: \"songdata\"}, \"Song Data\"),\n\t\t\toption({value: \"manual\"}, \"Open Manual\"),\n\t\t);\n\t\tprivate readonly _editMenu: HTMLSelectElement = select({style: \"width: 100%;\"}, \n\t\t\toption({selected: true, disabled: true, hidden: false}, \"Edit Menu\"),\n\t\t\toption({value: \"undo\"}, \"Undo (Z)\"),\n\t\t\toption({value: \"redo\"}, \"Redo (Y)\"),\n\t\t\toption({value: \"copy\"}, \"Copy Pattern (C)\"),\n\t\t\toption({value: \"cut\"}, \"Cut Pattern (X)\"),\n\t\t\toption({value: \"paste\"}, \"Paste Pattern (V)\"),\n\t\t\toption({value: \"transposeUp\"}, \"Shift Notes Up (+)\"),\n\t\t\toption({value: \"transposeDown\"}, \"Shift Notes Down (-)\"),\n\t\t\toption({value: \"duration\"}, \"Custom Song Size (Q)\"),\n\t\t);\n\t\tprivate readonly _optionsMenu: HTMLSelectElement = select({style: \"width: 100%;\"}, \n\t\t\toption({selected: true, disabled: true, hidden: false}, \"Preferences Menu\"),\n\t\t\toption({value: \"autoPlay\"}, \"Auto Play On Load\"),\n\t\t\toption({value: \"autoFollow\"}, \"Auto Follow Track\"),\n\t\t\toption({value: \"showLetters\"}, \"Show Piano\"),\n\t\t\toption({value: \"showFifth\"}, \"Highlight 'Fifth' Notes\"),\n\t\t\toption({value: \"showMore\"}, \"Advanced Color Scheme\"),\n\t\t\toption({value: \"showChannels\"},\"Show All Channels\"),\n\t\t\toption({value: \"showScrollBar\"}, \"Octave Scroll Bar\"),\n\t\t\toption({value: \"showVolumeBar\"}, \"Show Channel Volume\"),\n\t\t\toption({value: \"advancedSettings\"}, \"Enable Advanced Settings\"),\n\t\t\toption({value: \"themes\"}, \"Set Theme...\"),\n\t\t);\n\t\tprivate readonly _newSongButton: HTMLButtonElement = button({type: \"button\"}, \n\t\t\tdiv({},\"New\"),\n\t\t\tspan({class: \"fullWidthOnly\"}, div({},\" Song\")),\n\t\t\t// Page icon:\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \n\t\t\t\tSVG.path({d: \"M 2 0 L 2 -16 L 10 -16 L 14 -12 L 14 0 z M 3 -1 L 13 -1 L 13 -11 L 9 -11 L 9 -15 L 3 -15 z\", fill: \"currentColor\"}),\n\t\t\t),\n\t\t);\n\t\tprivate readonly _songDataButton: HTMLButtonElement = button({type: \"button\"}, \n\t\t\tdiv({},\"Song Data\"),\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \n\t\t\t\tSVG.path({d: \"M 0 0 L 16 0 L 16 -13 L 10 -13 L 8 -16 L 0 -16 L 0 -13 z\", fill: \"currentColor\"}),\n\t\t\t),\n\t\t);\n\t\tprivate readonly _customizeButton: HTMLButtonElement = button({type: \"button\"}, \n\t\t\tspan({ class: \"center\" }, div({},\"Custom Song Size\")),\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \n\t\t\t\tSVG.path({d: \"M -8 2 L -2 2 L -2 8 L 2 8 L 2 2 L 8 2 L 8 -2 L 2 -2 L 2 -8 L -2 -8 L -2 -2 L -8 -2 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z M -8 -8 L 8 -8 L 8 -9 L -8 -9 L -8 -8 z\", fill: \"currentColor\"}),\n\t\t\t),\n\t\t);\n\t\tprivate readonly _archiveButton: HTMLButtonElement = button({type: \"button\"}, \n\t\t\tspan({ class: \"center\" }, div({},\"Load Mods...\")),\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \n\t\t\t\tSVG.path({d: \"M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z\", fill: \"currentColor\"}),\n\t\t\t),\n\t\t);\n\t\tprivate readonly _undoButton: HTMLButtonElement = button({type: \"button\", style: \"width: 45%; margin: 0px; margin-top: -2px;\"}, div({},\"Undo\"));\n\t\tprivate readonly _redoButton: HTMLButtonElement = button({type: \"button\", style: \"width: 45%; margin: 0px; margin-top: -2px;\"}, div({},\"Redo\"));\n\t\tprivate readonly _exportButton: HTMLButtonElement = button({type: \"button\"}, \n\t\t\tdiv({},\"Export\"),\n\t\t\t// Download icon:\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \n\t\t\t\tSVG.path({d: \"M -8 3 L -8 8 L 8 8 L 8 3 L 6 3 L 6 6 L -6 6 L -6 3 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z\", fill: \"currentColor\"}),\n\t\t\t),\n\t\t);\n\t\tprivate readonly _scaleSelect: HTMLSelectElement = buildOptions(select({}), Config.scaleNames);\n\t\tprivate readonly _mixSelect: HTMLSelectElement = buildOptions(select({}), Config.mixNames);\n\t\tprivate readonly _sampleRateSelect: HTMLSelectElement = buildOptions(select({}), Config.sampleRateNames);\n\t\tprivate readonly _mixHint: HTMLAnchorElement = <HTMLAnchorElement> a({ class: \"hintButton\" }, div({},\"?\"));\n\t\tprivate readonly _archiveHint: HTMLAnchorElement = <HTMLAnchorElement> a({ class: \"hintButton\" }, div({},\"?\"));\n\t\tprivate readonly _mixSelectRow: HTMLDivElement = div({class: \"selectRow\"}, this._mixHint, this._mixSelect);\n\t\t// private readonly _chipHint: HTMLAnchorElement = <HTMLAnchorElement> a( { class: \"hintButton\" }, div({},\"?\"));\n\t\tprivate readonly _instrumentTypeHint: HTMLAnchorElement = <HTMLAnchorElement> a( { class: \"hintButton\" }, div({},\"?\"));\n\t\tprivate readonly _keySelect: HTMLSelectElement = buildOptions(select({}), Config.keyNames);\n\t\tprivate readonly _themeSelect: HTMLSelectElement = buildOptions(select({}), Config.themeNames);\n\t\tprivate readonly _tempoSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: \"0\", max: Config.tempoSteps - 1, value: \"7\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeTempo(this._doc, oldValue, newValue));\n\t\tprivate readonly _reverbSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: \"0\", max: Config.reverbRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeReverb(this._doc, oldValue, newValue));\n\t\tprivate readonly _blendSlider: Slider = new Slider(input({style: \"width: 9em; margin: 0px;\", type: \"range\", min: \"0\", max: Config.blendRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeBlend(this._doc, oldValue, newValue));\n\t\tprivate readonly _riffSlider: Slider = new Slider(input({style: \"width: 9em; margin: 0px;\", type: \"range\", min: \"0\", max: Config.riffRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeRiff(this._doc, oldValue, newValue));\n\t\tprivate readonly _detuneSlider: Slider = new Slider(input({style: \"width: 9em; margin: 0px;\", type: \"range\", min: \"0\", max: Config.detuneRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeDetune(this._doc, oldValue, newValue));\n\t\tprivate readonly _muffSlider: Slider = new Slider(input({style: \"width: 9em; margin: 0px;\", type: \"range\", min: \"0\", max: Config.muffRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeMuff(this._doc, oldValue, newValue));\n\t\tprivate readonly _imuteButton: HTMLButtonElement = button({ style: \"width: 27px;\", type: \"button\" });\n\t\tprivate readonly _iMmuteButton: HTMLButtonElement = button({ style: \"width: 27px;\", type: \"button\" });\n\t\tprivate readonly _partSelect: HTMLSelectElement = buildOptions(select({}), Config.partNames);\n\t\tprivate readonly _instrumentTypeSelect: HTMLSelectElement = buildOptionsWithSpecificValues(select({}), Config.pitchChannelTypeNames, Config.pitchChannelTypeValues);\n\t\tprivate readonly _instrumentTypeSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Type: \")), this._instrumentTypeHint, div({class: \"selectContainer\"}, this._instrumentTypeSelect));\n\t\tprivate readonly _algorithmSelect: HTMLSelectElement = buildOptions(select({}), Config.operatorAlgorithmNames);\n\t\tprivate readonly _algorithmSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Algorithm: \")), div({class: \"selectContainer\"}, this._algorithmSelect));\n\t\tprivate readonly _instrumentSelect: HTMLSelectElement = select({});\n\t\tprivate readonly _instrumentSelectRow: HTMLDivElement = div({class: \"selectRow\", style: \"display: none;\"}, span({}, div({},\"Instrument: \")), div({class: \"selectContainer\"}, this._instrumentSelect));\n\t\tprivate readonly _instrumentVolumeSlider: Slider = new Slider(input({style: \"margin: 8px; width: 60px;\", type: \"range\", min: \"-9\", max: \"0\", value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeVolume(this._doc, oldValue, -newValue));\n\t\tprivate readonly _instrumentMVolumeSlider: Slider = new Slider(input({style: \"margin: 8px; width: 60px;\", type: \"range\", min: \"-5\", max: \"0\", value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeVolume(this._doc, oldValue, -newValue));\n\t\tprivate readonly _instrumentVolumeSliderRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Volume: \")), this._instrumentVolumeSlider.input, this._imuteButton);\n\t\tprivate readonly _instrumentMVolumeSliderRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Volume: \")), this._instrumentMVolumeSlider.input, this._iMmuteButton);\n\t\tprivate readonly _instrumentSettingsLabel: HTMLDivElement = div({ style: \"margin: 3px 0; text-align: center;\" }, div({},\"Instrument Settings\"));\n\t\tprivate readonly _advancedInstrumentSettingsLabel: HTMLDivElement = div({ style: \"margin: 3px 0; text-align: center;\" }, div({},\"Advanced Instrument Settings\"));\n\t\tprivate readonly _waveSelect: HTMLSelectElement = buildOptions(select({}), Config.waveNames);\n\t\tprivate readonly _drumSelect: HTMLSelectElement = buildOptions(select({}), Config.drumNames);\n\t\tprivate readonly _pwmwaveSelect: HTMLSelectElement = buildOptions(select({}), Config.pwmwaveNames);\n\t\tprivate readonly _waveSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Wave: \")), div({class: \"selectContainer\"}, this._waveSelect, this._pwmwaveSelect, this._drumSelect));\n\t\tprivate readonly _transitionSelect: HTMLSelectElement = buildOptions(select({}), Config.transitionNames);\n\t\tprivate readonly _filterSelect: HTMLSelectElement = buildOptions(select({}), Config.filterNames);\n\t\tprivate readonly _filterSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Filter: \")), div({class: \"selectContainer\"}, this._filterSelect));\n\t\tprivate readonly _chorusSelect: HTMLSelectElement = buildOptions(select({}), Config.chorusNames);\n\t\tprivate readonly _chorusHint = <HTMLAnchorElement> a( {class: \"hintButton\"}, div({},\"?\"));\n\t\tprivate readonly _chorusSelectRow: HTMLElement = div({class: \"selectRow\"}, span({}, div({},\"Chorus: \")), div({class: \"selectContainer\"}, this._chorusSelect));\n\t\tprivate readonly _effectSelect: HTMLSelectElement = buildOptions(select({}), Config.effectNames);\n\t\tprivate readonly _effectSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Effect: \")), div({class: \"selectContainer\"}, this._effectSelect));\n\t\tprivate readonly _harmSelect: HTMLSelectElement = buildOptions(select({}), Config.harmDisplay);\n\t\tprivate readonly _harmSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Chord: \")), this._chorusHint, div({class: \"selectContainer\"}, this._harmSelect));\n\t\tprivate readonly _octoffSelect: HTMLSelectElement = buildOptions(select({}), Config.octoffNames);\n\t\tprivate readonly _octoffSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Octave Offset: \")), div({class: \"selectContainer\"}, this._octoffSelect));\n\t\tprivate readonly _fmChorusSelect: HTMLSelectElement = buildOptions(select({}), Config.fmChorusDisplay);\n\t\tprivate readonly _fmChorusSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"FM Chorus: \")), div({class: \"selectContainer\"}, this._fmChorusSelect));\n\t\tprivate readonly _ipanSlider: Slider = new Slider(input({style: \"margin: 8px; width: 100px;\", type: \"range\", min: \"-8\", max: \"0\", value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeIpan(this._doc, oldValue, -newValue));\n\t\tprivate readonly _ipanSliderRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Panning: \")), span({}, div({},\"L\")), this._ipanSlider.input, span({}, div({},\"R\")));\n\t\tprivate readonly _phaseModGroup: HTMLElement = div({style: \"display: flex; flex-direction: column; display: none;\"}, );\n\t\tprivate readonly _feedbackTypeSelect: HTMLSelectElement = buildOptions(select({}), Config.operatorFeedbackNames);\n\t\tprivate readonly _feedbackRow1: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Feedback:\")), div({class: \"selectContainer\"}, this._feedbackTypeSelect));\n\t\t\n\t\tprivate readonly _feedbackAmplitudeSlider: Slider = new Slider(input({style: \"margin: 0px; width: 4em;\", type: \"range\", min: \"0\", max: Config.operatorAmplitudeMax, value: \"0\", step: \"1\", title: \"Feedback Amplitude\"}), this._doc, (oldValue: number, newValue: number) => new ChangeFeedbackAmplitude(this._doc, oldValue, newValue));\n\t\tprivate readonly _feedbackEnvelopeSelect: HTMLSelectElement = buildOptions(select({style: \"width: 100%;\", title: \"Feedback Envelope\"}), Config.operatorEnvelopeNames);\n\t\tprivate readonly _feedbackRow2: HTMLDivElement = div({class: \"operatorRow\"}, \n\t\t\tdiv({style: \"margin-right: .1em; visibility: hidden;\"}, div({},1 + \".\")),\n\t\t\tdiv({style: \"width: 3em; margin-right: .3em;\"}),\n\t\t\tthis._feedbackAmplitudeSlider.input,\n\t\t\tdiv({class: \"selectContainer\", style: \"width: 5em; margin-left: .3em;\"}, this._feedbackEnvelopeSelect),\n\t\t);\n\t\tprivate readonly _instrumentSettingsGroup: HTMLDivElement = div({}, \n\t\t\tthis._instrumentSettingsLabel,\n\t\t\tthis._instrumentSelectRow,\n\t\t\tthis._instrumentTypeSelectRow,\n\t\t\tthis._instrumentMVolumeSliderRow,\n\t\t\tthis._instrumentVolumeSliderRow,\n\t\t\tthis._waveSelectRow,\n\t\t\tdiv({class: \"selectRow\"}, \n\t\t\t\tspan({}, div({},\"Transitions: \")),\n\t\t\t\tdiv({class: \"selectContainer\"}, this._transitionSelect),\n\t\t\t),\n\t\t\tthis._filterSelectRow,\n\t\t\tthis._chorusSelectRow,\n\t\t\tthis._effectSelectRow,\n\t\t\tthis._algorithmSelectRow,\n\t\t\tthis._phaseModGroup,\n\t\t\tthis._feedbackRow1,\n\t\t\tthis._feedbackRow2,\n\t\t);\n\t\tprivate readonly _advancedInstrumentSettingsGroup: HTMLDivElement = div({}, \n\t\t\tthis._advancedInstrumentSettingsLabel,\n\t\t\tthis._ipanSliderRow,\n\t\t\tthis._harmSelectRow,\n\t\t\tthis._octoffSelectRow,\n\t\t\tthis._fmChorusSelectRow,\n\t\t);\n\t\tprivate readonly _promptContainer: HTMLDivElement = div({class: \"promptContainer\", id: \"promptContainer\", style: \"display: none;\"});\n\t\tprivate readonly _advancedSongSettings: HTMLDivElement = div({ class: \"editor-song-settings\", style: \"margin: 0px 5px;\" }, \n\t\t\tdiv({ style: \"margin: 3px 0; text-align: center;\" }, div({},\"Advanced Song Settings\")),\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Mix: \")), div({ class: \"selectContainer\" }, this._mixSelectRow)),\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Sample Rate: \")), div({ class: \"selectContainer\" }, this._sampleRateSelect)),\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Blending: \")), this._blendSlider.input),\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Riff: \")), this._riffSlider.input),\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Detune: \")), this._detuneSlider.input),\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Muff: \")), this._muffSlider.input),\n\t\t);\n\t\tprivate readonly _advancedSettingsContainer: HTMLDivElement = div({ class: \"editor-right-widget-column\", style: \"margin: 0px 5px;\" }, \n\t\t\tdiv({ class: \"editor-widgets\" }, \n\t\t\t\tdiv({ style: \"text-align: center;\" }, div({},\"Advanced Settings\")),\n\t\t\t\tdiv({ style: \"margin: 2px 0; display: flex; flex-direction: row; align-items: center;\" }, ),\n\t\t\t\tdiv({ class: \"editor-menus\" }, \n\t\t\t\t\tdiv({ style: \"margin: 5px 0; display: flex; flex-direction: row; justify-content: space-between;\" }, \n\t\t\t\t\t\tthis._prevBarButton,\n\t\t\t\t\t\tthis._undoButton,\n\t\t\t\t\t\tthis._redoButton,\n\t\t\t\t\t\tthis._nextBarButton,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t\tdiv({ class: \"editor-settings\" }, \n\t\t\t\t\tthis._advancedSongSettings,\n\t\t\t\t\tdiv({ class: \"editor-instrument-settings\" }, \n\t\t\t\t\t\tthis._advancedInstrumentSettingsGroup,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tpublic readonly mainLayer: HTMLDivElement = div({class: \"beepboxEditor\", tabIndex: \"0\"}, \n\t\t\tthis._editorBox,\n\t\t\tdiv({class: \"editor-widget-column\"}, \n\t\t\t\tdiv({ style: \"align-items: center; display: flex; justify-content: center;\" }, div({},\"NepBox 2.0\"), this._archiveHint),\n\t\t\t\tdiv({ style: \"margin: 5px 0; gap: 3px; display: flex; flex-direction: column; align-items: center;\" }, \n\t\t\t\t\tdiv({ style: \"display:flex; flex-direction:row;\" },\n\t\t\t\t\t\tSVG.svg( { width: \"2em\", height: \"2em\", viewBox: \"0 0 26 26\" }, \n\t\t\t\t\t\t\tSVG.path({ d: \"M 4 17 L 4 9 L 8 9 L 12 5 L 12 21 L 8 17 z\", fill: ColorConfig.volumeIcon}),\n\t\t\t\t\t\t\tSVG.path({ d: \"M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z\", fill: ColorConfig.volumeIcon }),\n\t\t\t\t\t\t\tSVG.path({ d: \"M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z\", fill: ColorConfig.volumeIcon }),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tthis._volumeSlider,\n\t\t\t\t\t),\n\t\t\t\t\tdiv({ style: \"display: flex; flex-direction: row; align-items: center; width:100%; gap: 3px;\" }, \n\t\t\t\t\t\tthis._playButton,\n\t\t\t\t\t\tthis._prevBarButton,\n\t\t\t\t\t\tthis._nextBarButton,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t\tdiv({ class: \"editor-widgets\" }, \n\t\t\t\t\tdiv({ class: \"editor-menus\" }, \n\t\t\t\t\t\tdiv({class: \"selectContainer menu\"}, \n\t\t\t\t\t\t\tthis._fileMenu,\n\t\t\t\t\t\t\t// File icon:\n\t\t\t\t\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \n\t\t\t\t\t\t\t\tSVG.path({d: \"M 0 0 L 16 0 L 16 -13 L 10 -13 L 8 -16 L 0 -16 L 0 -13 z\", fill: \"currentColor\"}),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tdiv({class: \"selectContainer menu\"}, \n\t\t\t\t\t\t\tthis._editMenu,\n\t\t\t\t\t\t\t// Edit icon:\n\t\t\t\t\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \n\t\t\t\t\t\t\t\tSVG.path({d: \"M 0 0 L 1 -4 L 4 -1 z M 2 -5 L 10 -13 L 13 -10 L 5 -2 zM 11 -14 L 13 -16 L 14 -16 L 16 -14 L 16 -13 L 14 -11 z\", fill: \"currentColor\"}),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tdiv({class: \"selectContainer menu\"}, \n\t\t\t\t\t\t\tthis._optionsMenu,\n\t\t\t\t\t\t\t// Gear icon:\n\t\t\t\t\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \n\t\t\t\t\t\t\t\tSVG.path({d: \"M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z\", fill: \"currentColor\"}),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\tdiv({ class: \"editor-settings\" }, \n\t\t\t\t\t\tdiv({ class: \"editor-song-settings\" }, \n\t\t\t\t\t\t\tdiv({style: \"margin: 3px 0; text-align: center; color: #999;\"}, \n\t\t\t\t\t\t\t\tdiv({},\"Song Settings\")\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Scale: \")), div({ class: \"selectContainer\", style: \"margin: 3px 0; text-align: center; color: #ccc;\" }, this._scaleSelect)),\n\t\t\t\t\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Key: \")), div({ class: \"selectContainer\", style: \"margin: 3px 0; text-align: center; color: #ccc;\" }, this._keySelect)),\n\t\t\t\t\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Tempo: \")), this._tempoSlider.input),\n\t\t\t\t\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Reverb: \")), this._reverbSlider.input),\n\t\t\t\t\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Rhythm: \")), div({ class: \"selectContainer\", style: \"margin: 3px 0; text-align: center; color: #ccc;\" }, this._partSelect)),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tdiv({class: \"editor-instrument-settings\"}, \n\t\t\t\t\t\t\tthis._instrumentSettingsGroup,\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t),\n\t\t\tthis._advancedSettingsContainer,\n\t\t\tthis._promptContainer,\n\t\t);\n\t\t\n\t\tprivate _wasPlaying: boolean;\n\t\tprivate _changeTranspose: ChangeTranspose | null = null;\n\t\tprivate readonly _operatorRows: HTMLDivElement[] = []\n\t\tprivate readonly _operatorAmplitudeSliders: Slider[] = []\n\t\tprivate readonly _operatorEnvelopeSelects: HTMLSelectElement[] = []\n\t\tprivate readonly _operatorFrequencySelects: HTMLSelectElement[] = []\n\t\t\n\t\tconstructor(private _doc: SongDocument) {\n\t\t\tthis._doc.notifier.watch(this.whenUpdated);\n\t\t\t\n\t\t\tthis._phaseModGroup.appendChild(div({class: \"operatorRow\", style: \"height: 1em; margin-top: 0.5em;\"}, \n\t\t\t\tdiv({style: \"margin-right: .1em; visibility: hidden;\"}, div({},1 + \".\")),\n\t\t\t\tdiv({style: \"width: 3em; margin-right: .3em;\"}, div({},\"Freq:\")),\n\t\t\t\tdiv({style: \"width: 4em; margin: 0;\"}, div({},\"Volume:\")),\n\t\t\t\tdiv({style: \"width: 5em; margin-left: .3em;\"}, div({},\"Envelope:\")),\n\t\t\t));\n\t\t\tfor (let i = 0; i < Config.operatorCount; i++) {\n\t\t\t\tconst operatorIndex: number = i;\n\t\t\t\tconst operatorNumber: HTMLDivElement = div({style: \"margin-right: .1em; color: #999;\"}, div({},i + 1 + \".\"));\n\t\t\t\tconst frequencySelect: HTMLSelectElement = buildOptions(select({style: \"width: 100%;\", title: \"Frequency\"}), Config.operatorFrequencyNames);\n\t\t\t\tconst amplitudeSlider: Slider = new Slider(input({style: \"margin: 0; width: 4em;\", type: \"range\", min: \"0\", max: Config.operatorAmplitudeMax, value: \"0\", step: \"1\", title: \"Volume\"}), this._doc, (oldValue: number, newValue: number) => new ChangeOperatorAmplitude(this._doc, operatorIndex, oldValue, newValue));\n\t\t\t\tconst envelopeSelect: HTMLSelectElement = buildOptions(select({style: \"width: 100%;\", title: \"Envelope\"}), Config.operatorEnvelopeNames);\n\t\t\t\tconst row = div({class: \"operatorRow\"}, \n\t\t\t\t\toperatorNumber,\n\t\t\t\t\tdiv({class: \"selectContainer\", style: \"width: 3em; margin-right: .3em;\"}, frequencySelect),\n\t\t\t\t\tamplitudeSlider.input,\n\t\t\t\t\tdiv({class: \"selectContainer\", style: \"width: 5em; margin-left: .3em;\"}, envelopeSelect),\n\t\t\t\t);\n\t\t\t\tthis._phaseModGroup.appendChild(row);\n\t\t\t\tthis._operatorRows[i] = row;\n\t\t\t\tthis._operatorAmplitudeSliders[i] = amplitudeSlider;\n\t\t\t\tthis._operatorEnvelopeSelects[i] = envelopeSelect;\n\t\t\t\tthis._operatorFrequencySelects[i] = frequencySelect;\n\t\t\t\t\n\t\t\t\tenvelopeSelect.addEventListener(\"change\", () => {\n\t\t\t\t\tthis._doc.record(new ChangeOperatorEnvelope(this._doc, operatorIndex, envelopeSelect.selectedIndex));\n\t\t\t\t});\n\t\t\t\tfrequencySelect.addEventListener(\"change\", () => {\n\t\t\t\t\tthis._doc.record(new ChangeOperatorFrequency(this._doc, operatorIndex, frequencySelect.selectedIndex));\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tthis._fileMenu.addEventListener(\"change\", this._fileMenuHandler);\n\t\t\tthis._editMenu.addEventListener(\"change\", this._editMenuHandler);\n\t\t\tthis._optionsMenu.addEventListener(\"change\", this._optionsMenuHandler);\n\t\t\tthis._themeSelect.addEventListener(\"change\", this._whenSetTheme);\n\t\t\tthis._scaleSelect.addEventListener(\"change\", this._whenSetScale);\n\t\t\tthis._mixSelect.addEventListener(\"change\", this._whenSetMix);\n\t\t\tthis._sampleRateSelect.addEventListener(\"change\", this._whenSetSampleRate);\n\t\t\tthis._keySelect.addEventListener(\"change\", this._whenSetKey);\n\t\t\tthis._partSelect.addEventListener(\"change\", this._whenSetPartsPerBeat);\n\t\t\tthis._instrumentTypeSelect.addEventListener(\"change\", this._whenSetInstrumentType);\n\t\t\tthis._algorithmSelect.addEventListener(\"change\", this._whenSetAlgorithm);\n\t\t\tthis._instrumentSelect.addEventListener(\"change\", this._whenSetInstrument);\n\t\t\tthis._feedbackTypeSelect.addEventListener(\"change\", this._whenSetFeedbackType);\n\t\t\tthis._feedbackEnvelopeSelect.addEventListener(\"change\", this._whenSetFeedbackEnvelope);\n\t\t\tthis._waveSelect.addEventListener(\"change\", this._whenSetWave);\n\t\t\tthis._drumSelect.addEventListener(\"change\", this._whenSetDrum);\n\t\t\tthis._pwmwaveSelect.addEventListener(\"change\", this._whenSetPWMWave);\n\t\t\tthis._transitionSelect.addEventListener(\"change\", this._whenSetTransition);\n\t\t\tthis._filterSelect.addEventListener(\"change\", this._whenSetFilter);\n\t\t\tthis._chorusSelect.addEventListener(\"change\", this._whenSetChorus);\n\t\t\tthis._effectSelect.addEventListener(\"change\", this._whenSetEffect);\n\t\t\tthis._harmSelect.addEventListener(\"change\", this._whenSetHarm);\n\t\t\tthis._octoffSelect.addEventListener(\"change\", this._whenSetOctoff);\n\t\t\tthis._fmChorusSelect.addEventListener(\"change\", this._whenSetFMChorus);\n\t\t\tthis._imuteButton.addEventListener(\"click\", this._muteInstrument);\n\t\t\tthis._iMmuteButton.addEventListener(\"click\", this._muteInstrument);\n\t\t\tthis._playButton.addEventListener(\"click\", this._togglePlay);\n\t\t\tthis._prevBarButton.addEventListener(\"click\", this._whenPrevBarPressed);\n\t\t\tthis._nextBarButton.addEventListener(\"click\", this._whenNextBarPressed);\n\t\t\tthis._newSongButton.addEventListener(\"click\", this._whenNewSongPressed);\n\t\t\tthis._songDataButton.addEventListener(\"click\", this._openSongDataPrompt);\n\t\t\tthis._customizeButton.addEventListener(\"click\", this._whenCustomizePressed);\n\t\t\tthis._undoButton.addEventListener(\"click\", this._advancedUndo);\n\t\t\tthis._redoButton.addEventListener(\"click\", this._advancedRedo);\n\t\t\tthis._exportButton.addEventListener(\"click\", this._openExportPrompt);\n\t\t\tthis._archiveButton.addEventListener(\"click\", this._openArchivePrompt);\n\t\t\tthis._volumeSlider.addEventListener(\"input\", this._setVolumeSlider);\n\t\t\t// this._chipHint.addEventListener(\"click\", this._openChipPrompt);\n\t\t\tthis._instrumentTypeHint.addEventListener(\"click\", this._openInstrumentTypePrompt);\n\t\t\tthis._mixHint.addEventListener(\"click\", this._openMixPrompt);\n\t\t\tthis._chorusHint.addEventListener(\"click\", this._openChorusPrompt);\n\t\t\tthis._archiveHint.addEventListener(\"click\", this._openArchivePrompt);\n\t\t\t\n\t\t\tthis._editorBox.addEventListener(\"mousedown\", this._refocusStage);\n\t\t\tthis.mainLayer.addEventListener(\"keydown\", this._whenKeyPressed);\n\t\t\t\n\t\t\tif (isMobile) (<HTMLOptionElement> this._optionsMenu.children[1]).disabled = true;\n\t\t}\n\t\t\n\t\tprivate _openPrompt(promptName: string): void {\n\t\t\tthis._doc.openPrompt(promptName);\n\t\t\tthis._setPrompt(promptName);\n\t\t}\n\t\t\n\t\tprivate _setPrompt(promptName: string | null): void {\n\t\t\tif (this.prompt) {\n\t\t\t\tif (this._wasPlaying) this._play();\n\t\t\t\tthis._wasPlaying = false;\n\t\t\t\tthis._promptContainer.style.display = \"none\";\n\t\t\t\tthis._promptContainer.removeChild(this.prompt.container);\n\t\t\t\tthis.prompt.cleanUp();\n\t\t\t\tthis.prompt = null;\n\t\t\t\tthis.mainLayer.focus();\n\t\t\t}\n\t\t\t\n\t\t\tif (promptName) {\n\t\t\t\tswitch (promptName) {\n\t\t\t\t\tcase \"export\":\n\t\t\t\t\t\tthis.prompt = new ExportPrompt(this._doc);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"import\":\n\t\t\t\t\t\tthis.prompt = new ImportPrompt(this._doc);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"duration\":\n\t\t\t\t\t\tthis.prompt = new SongDurationPrompt(this._doc);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"archive\":\n\t\t\t\t\t\tthis.prompt = new ArchivePrompt(this._doc);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"instrumentType\":\n\t\t\t\t\t\tthis.prompt = new InstrumentTypePrompt(this._doc);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t// case \"chipPrompt\":\n\t\t\t\t\t// \tthis.prompt = new ChipPrompt(this._doc, this);\n\t\t\t\t\t// \tbreak;\n\t\t\t\t\tcase \"mix\":\n\t\t\t\t\t\tthis.prompt = new MixPrompt(this._doc);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"chorus\":\n\t\t\t\t\t\tthis.prompt = new ChorusPrompt(this._doc);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"songdata\":\n\t\t\t\t\t\tthis.prompt = new SongDataPrompt(this._doc);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"refresh\":\n\t\t\t\t\t\tthis.prompt = new RefreshPrompt(this._doc, this, this._themeSelect.selectedIndex);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"refresh key\":\n\t\t\t\t\t\tthis.prompt = new RefreshKeyPrompt(this._doc, this, this._keySelect.selectedIndex);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"archive\":\n\t\t\t\t\t\tthis.prompt = new ArchivePrompt(this._doc);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"manual\":\n\t\t\t\t\t\tthis.prompt = new ManualPrompt(this._doc);\n\t\t\t\t\t\tbreak;\t\n\t\t\t\t\tcase \"themes\":\n\t\t\t\t\t\tthis.prompt = new ThemePrompt(this._doc);\n\t\t\t\t\t\tbreak;\t\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error(\"Unrecognized prompt type.\");\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (this.prompt) {\n\t\t\t\t\tthis._wasPlaying = this._doc.synth.playing;\n\t\t\t\t\tthis._pause();\n\t\t\t\t\tthis._promptContainer.style.display = \"\";\n\t\t\t\t\tthis._promptContainer.appendChild(this.prompt.container);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _refocusStage = (): void => {\n\t\t\tthis.mainLayer.focus();\n\t\t}\n\t\t\n\t\tpublic whenUpdated = (): void => {\n\t\t\tconst trackBounds = this._trackContainer.getBoundingClientRect();\n\t\t\tthis._doc.trackVisibleBars = Math.floor((trackBounds.right - trackBounds.left) / 32);\n\t\t\tthis._barScrollBar.render();\n\t\t\tthis._trackEditor.render();\n\t\t\tthis._patternEditor.render();\n\n\t\t\tconst optionCommands: ReadonlyArray<string> = [\n\t\t\t\t(this._doc.autoPlay ? \"✓ \" : \"✗ \") + \"Auto Play On Load\",\n\t\t\t\t(this._doc.autoFollow ? \"✓ \" : \"✗ \") + \"Auto Follow Track\",\n\t\t\t\t(this._doc.showLetters ? \"✓ \" : \"✗ \") + \"Show Piano\",\n\t\t\t\t(this._doc.showFifth ? \"✓ \" : \"✗ \") + \"Highlight 'Fifth' Notes\",\n\t\t\t\t(this._doc.showMore ? \"✓ \" : \"✗ \") + \"Advanced Color Scheme\",\n\t\t\t\t(this._doc.showChannels ? \"✓ \" : \"✗ \") + \"Show All Channels\",\n\t\t\t\t(this._doc.showScrollBar ? \"✓ \" : \"✗ \") + \"Octave Scroll Bar\",\n\t\t\t\t(this._doc.showVolumeBar ? \"✓ \" : \"✗ \") + \"Show Channel Volume\",\n\t\t\t\t(this._doc.advancedSettings ? \"✓ \" : \"✗ \") + \"Enable Advanced Settings\",\n\t\t\t\t\"  Set Theme...\",\n\t\t\t]\n\t\t\tfor (let i: number = 0; i < optionCommands.length; i++) {\n\t\t\t\tconst option: HTMLOptionElement = <HTMLOptionElement> this._optionsMenu.children[i + 1];\n\t\t\t\tif (option.innerText != optionCommands[i]) option.innerText = optionCommands[i];\n\t\t\t}\n\t\t\t\n\t\t\tconst channel: Channel = this._doc.song.channels[this._doc.channel];\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\n\t\t\tconst instrumentIndex: number = this._doc.getCurrentInstrument();\n\t\t\tconst instrument: Instrument = channel.instruments[instrumentIndex];\n\t\t\tconst wasActive: boolean = this.mainLayer.contains(document.activeElement);\n\t\t\tlet activeElement: Element = document.activeElement ? document.activeElement : document.activeElement!;\n\n\t\t\t\n\t\t\tsetSelectedIndex(this._themeSelect, this._doc.song.theme);\n\t\t\tsetSelectedIndex(this._scaleSelect, this._doc.song.scale);\n\t\t\tsetSelectedIndex(this._mixSelect, this._doc.song.mix);\n\t\t\tsetSelectedIndex(this._sampleRateSelect, this._doc.song.sampleRate);\n\t\t\tsetSelectedIndex(this._keySelect, this._doc.song.key);\n\t\t\tthis._tempoSlider.updateValue(this._doc.song.tempo);\n\t\t\tthis._tempoSlider.input.title = this._doc.song.getBeatsPerMinute() + \" beats per minute\";\n\t\t\tthis._reverbSlider.updateValue(this._doc.song.reverb);\n\t\t\tthis._advancedSettingsContainer.style.display = this._doc.advancedSettings ? \"\" : \"none\";\n\t\t\tthis._blendSlider.updateValue(this._doc.song.blend);\n\t\t\tthis._riffSlider.updateValue(this._doc.song.riff);\n\t\t\tthis._detuneSlider.updateValue(this._doc.song.detune);\n\t\t\tthis._muffSlider.updateValue(this._doc.song.muff);\n\t\t\tsetSelectedIndex(this._partSelect, Config.partCounts.indexOf(this._doc.song.partsPerBeat));\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) {\n\t\t\t\tif (this._doc.song.mix == 2) {\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"\";\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"none\";\n\t\t\t\t} else {\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"none\";\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"\";\n\t\t\t\t}\n\t\t\t\tthis._drumSelect.style.display = \"\";\n\t\t\t\tthis._waveSelectRow.style.display = \"\";\n\t\t\t\tthis._instrumentTypeSelectRow.style.display = \"none\";\n\t\t\t\tthis._instrumentTypeSelect.style.display = \"none\";\n\t\t\t\tthis._algorithmSelectRow.style.display = \"none\";\n\t\t\t\tthis._phaseModGroup.style.display = \"none\";\n\t\t\t\tthis._feedbackRow1.style.display = \"none\";\n\t\t\t\tthis._feedbackRow2.style.display = \"none\";\n\t\t\t\tthis._waveSelect.style.display = \"none\";\n\t\t\t\tthis._pwmwaveSelect.style.display = \"none\";\n\t\t\t\tthis._filterSelectRow.style.display = \"none\";\n\t\t\t\tthis._chorusSelectRow.style.display = \"none\";\n\t\t\t\tthis._effectSelectRow.style.display = \"none\";\n\t\t\t\tthis._ipanSliderRow.style.display = \"\";\n\t\t\t\tthis._harmSelectRow.style.display = \"\";\n\t\t\t\tthis._octoffSelectRow.style.display = \"\";\n\t\t\t\tthis._fmChorusSelectRow.style.display = \"none\";\n\t\t\t} else {\n\t\t\t\tthis._instrumentTypeSelectRow.style.display = \"\";\n\t\t\t\tthis._instrumentTypeSelect.style.display = \"\";\n\t\t\t\tthis._effectSelectRow.style.display = \"\";\n\t\t\t\tif (this._doc.song.mix == 2) {\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"\";\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"none\";\n\t\t\t\t} else {\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"none\";\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"\";\n\t\t\t\t}\n\t\t\t\tthis._drumSelect.style.display = \"none\";\n\t\t\t\t\n\t\t\t\tif (instrument.type == InstrumentType.chip) {\n\t\t\t\t\tthis._waveSelect.style.display = \"\";\n\t\t\t\t\tthis._pwmwaveSelect.style.display = \"none\";\n\t\t\t\t\tthis._waveSelectRow.style.display = \"\";\n\t\t\t\t\tthis._filterSelectRow.style.display = \"\";\n\t\t\t\t\tthis._chorusSelectRow.style.display = \"\";\n\t\t\t\t\tthis._harmSelectRow.style.display = \"\";\n\t\t\t\t\tthis._algorithmSelectRow.style.display = \"none\";\n\t\t\t\t\tthis._phaseModGroup.style.display = \"none\";\n\t\t\t\t\tthis._feedbackRow1.style.display = \"none\";\n\t\t\t\t\tthis._feedbackRow2.style.display = \"none\";\n\t\t\t\t\tthis._ipanSliderRow.style.display = \"\";\n\t\t\t\t\tthis._octoffSelectRow.style.display = \"\";\n\t\t\t\t\tthis._fmChorusSelectRow.style.display = \"none\";\n\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\n\t\t\t\t\tthis._waveSelect.style.display = \"none\";\n\t\t\t\t\tthis._pwmwaveSelect.style.display = \"\";\n\t\t\t\t\tthis._waveSelectRow.style.display = \"\";\n\t\t\t\t\tthis._filterSelectRow.style.display = \"none\"; // @TODO: Unhide?\n\t\t\t\t\tthis._chorusSelectRow.style.display = \"none\"; // @TODO: Unhide?\n\t\t\t\t\tthis._harmSelectRow.style.display = \"none\";\n\t\t\t\t\tthis._algorithmSelectRow.style.display = \"none\";\n\t\t\t\t\tthis._phaseModGroup.style.display = \"none\";\n\t\t\t\t\tthis._feedbackRow1.style.display = \"none\";\n\t\t\t\t\tthis._feedbackRow2.style.display = \"none\";\n\t\t\t\t\tthis._ipanSliderRow.style.display = \"\";\n\t\t\t\t\tthis._octoffSelectRow.style.display = \"\";\n\t\t\t\t\tthis._fmChorusSelectRow.style.display = \"none\";\n\t\t\t\t} else {\n\t\t\t\t\tthis._algorithmSelectRow.style.display = \"\";\n\t\t\t\t\tthis._phaseModGroup.style.display = \"\";\n\t\t\t\t\tthis._feedbackRow1.style.display = \"\";\n\t\t\t\t\tthis._feedbackRow2.style.display = \"\";\n\t\t\t\t\tthis._harmSelectRow.style.display = \"none\";\n\t\t\t\t\tthis._waveSelectRow.style.display = \"none\";\n\t\t\t\t\tthis._filterSelectRow.style.display = \"none\";\n\t\t\t\t\tthis._chorusSelectRow.style.display = \"none\";\n\t\t\t\t\tthis._ipanSliderRow.style.display = \"\";\n\t\t\t\t\tthis._octoffSelectRow.style.display = \"\";\n\t\t\t\t\tthis._fmChorusSelectRow.style.display = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis._instrumentTypeSelect.value = instrument.type + \"\";\n\t\t\tsetSelectedIndex(this._algorithmSelect, instrument.algorithm);\n\t\t\t\n\t\t\tthis._instrumentSelectRow.style.display = (this._doc.song.instrumentsPerChannel > 1) ? \"\" : \"none\";\n\t\t\tthis._instrumentSelectRow.style.visibility = (pattern == null) ? \"hidden\" : \"\";\n\t\t\tif (this._instrumentSelect.children.length != this._doc.song.instrumentsPerChannel) {\n\t\t\t\twhile (this._instrumentSelect.firstChild) this._instrumentSelect.removeChild(this._instrumentSelect.firstChild);\n\t\t\t\tconst instrumentList: number[] = [];\n\t\t\t\tfor (let i: number = 0; i < this._doc.song.instrumentsPerChannel; i++) {\n\t\t\t\t\tinstrumentList.push(i + 1);\n\t\t\t\t}\n\t\t\t\tbuildOptions(this._instrumentSelect, instrumentList);\n\t\t\t}\n\t\t\t\n\t\t\tif (instrument.imute == 0) {\n\t\t\t\tthis._instrumentSettingsGroup.style.color = this._doc.song.getNoteColorBright(this._doc.channel);\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = this._doc.song.getNoteColorDim(this._doc.channel);\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\n\t\t\t\tthis._imuteButton.innerText = \"◉\";\n\t\t\t\tthis._iMmuteButton.innerText = \"◉\";\n\t\t\t} else {\n\t\t\t\tthis._instrumentSettingsGroup.style.color = \"#cccccc\";\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = \"#aaaaaa\";\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\n\t\t\t\tthis._imuteButton.innerText = \"◎\";\n\t\t\t\tthis._iMmuteButton.innerText = \"◎\";\n\t\t\t}\n\t\t\t\n\t\t\tsetSelectedIndex(this._waveSelect, instrument.wave);\n\t\t\tsetSelectedIndex(this._drumSelect, instrument.wave);\n\t\t\tsetSelectedIndex(this._pwmwaveSelect, instrument.wave);\n\t\t\tsetSelectedIndex(this._filterSelect, instrument.filter);\n\t\t\tsetSelectedIndex(this._transitionSelect, instrument.transition);\n\t\t\tsetSelectedIndex(this._effectSelect, instrument.effect);\n\t\t\tsetSelectedIndex(this._chorusSelect, instrument.chorus);\n\t\t\tsetSelectedIndex(this._harmSelect, instrument.harm);\n\t\t\tsetSelectedIndex(this._octoffSelect, instrument.octoff);\n\t\t\tsetSelectedIndex(this._fmChorusSelect, instrument.fmChorus);\n\t\t\tsetSelectedIndex(this._feedbackTypeSelect, instrument.feedbackType);\n\t\t\tthis._feedbackAmplitudeSlider.updateValue(instrument.feedbackAmplitude);\n\t\t\tsetSelectedIndex(this._feedbackEnvelopeSelect, instrument.feedbackEnvelope);\n\t\t\tthis._feedbackEnvelopeSelect.parentElement!.style.color = (instrument.feedbackAmplitude > 0) ? \"\" : \"#999\";\n\t\t\tthis._instrumentVolumeSlider.updateValue(-instrument.volume);\n\t\t\tthis._instrumentMVolumeSlider.updateValue(-instrument.volume);\n\t\t\tthis._ipanSlider.updateValue(-instrument.ipan);\n\t\t\tsetSelectedIndex(this._instrumentSelect, instrumentIndex);\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\n\t\t\t\tconst isCarrier: boolean = (i < Config.operatorCarrierCounts[instrument.algorithm]);\n\t\t\t\tthis._operatorRows[i].style.color = isCarrier ? \"white\" : \"\";\n\t\t\t\tsetSelectedIndex(this._operatorFrequencySelects[i], instrument.operators[i].frequency);\n\t\t\t\tthis._operatorAmplitudeSliders[i].updateValue(instrument.operators[i].amplitude);\n\t\t\t\tsetSelectedIndex(this._operatorEnvelopeSelects[i], instrument.operators[i].envelope);\n\t\t\t\tconst operatorName: string = (isCarrier ? \"Voice \" : \"Modulator \") + (i + 1);\n\t\t\t\tthis._operatorFrequencySelects[i].title = operatorName + \" Frequency\";\n\t\t\t\tthis._operatorAmplitudeSliders[i].input.title = operatorName + (isCarrier ? \" Volume\" : \" Amplitude\");\n\t\t\t\tthis._operatorEnvelopeSelects[i].title = operatorName + \" Envelope\";\n\t\t\t\tthis._operatorEnvelopeSelects[i].parentElement!.style.color = (instrument.operators[i].amplitude > 0) ? \"\" : \"#999\";\n\t\t\t}\n\t\t\t\n\t\t\tthis._piano.container.style.display = this._doc.showLetters ? \"\" : \"none\";\n\t\t\tthis._octaveScrollBar.container.style.display = this._doc.showScrollBar ? \"\" : \"none\";\n\t\t\tthis._barScrollBar.container.style.display = this._doc.song.barCount > this._doc.trackVisibleBars ? \"\" : \"none\";\n\t\t\t// this._chipHint.style.display = (instrument.type == InstrumentType.fm) ? \"none\" : \"\";\n\t\t\tthis._instrumentTypeHint.style.display = (instrument.type == InstrumentType.fm) ? \"\" : \"none\";\n\t\t\tthis._mixHint.style.display = (this._doc.song.mix != 1) ? \"\" : \"none\";\n\t\t\tthis._chorusHint.style.display = (Config.harmNames[instrument.harm]) ? \"\" : \"none\";\n\t\t\t\n\t\t\tlet patternWidth: number = 512;\n\t\t\tif (this._doc.showLetters) patternWidth -= 32;\n\t\t\tif (this._doc.showScrollBar) patternWidth -= 20;\n\t\t\tthis._patternEditor.container.style.width = String(patternWidth) + \"px\";\n\t\t\t\n\t\t\tthis._volumeSlider.value = String(this._doc.volume);\n\t\t\t\n\t\t\t// If an interface element was selected, but becomes invisible (e.g. an instrument\n\t\t\t// select menu) just select the editor container so keyboard commands still work.\n\t\t\tif (wasActive && (activeElement.clientWidth == 0)) {\n\t\t\t\tthis._refocusStage();\n\t\t\t}\n\t\t\t\n\t\t\tthis._setPrompt(this._doc.prompt);\n\t\t\t\n\t\t\tif (this._doc.autoFollow && !this._doc.synth.playing) {\n\t\t\t\tthis._doc.synth.snapToBar(this._doc.bar);\n\t\t\t}\n\t\t}\n\n\t\tprivate _muteInstrument = (): void => {\n\t\t\tconst channel: Channel = this._doc.song.channels[this._doc.channel];\n\t\t\tconst instrumentIndex: number = this._doc.getCurrentInstrument();\n\t\t\tconst instrument: Instrument = channel.instruments[instrumentIndex];\n\t\t\tconst oldValue: number = instrument.imute;\n\t\t\tconst isMuted: boolean = oldValue == 1;\n\t\t\tconst newValue: number = isMuted ? 0 : 1;\n\t\t\tthis._doc.record(new ChangeImute(this._doc, newValue));\n\t\t\tif (instrument.imute == 0) {\n\t\t\t\tthis._instrumentSettingsGroup.style.color = this._doc.song.getNoteColorBright(this._doc.channel);\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = this._doc.song.getNoteColorDim(this._doc.channel);\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\n\t\t\t\tthis._imuteButton.innerText = \"◉\";\n\t\t\t\tthis._iMmuteButton.innerText = \"◉\";\n\t\t\t} else {\n\t\t\t\tthis._instrumentSettingsGroup.style.color = \"#cccccc\";\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = \"#aaaaaa\";\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\n\t\t\t\tthis._imuteButton.innerText = \"◎\";\n\t\t\t\tthis._iMmuteButton.innerText = \"◎\";\n\t\t\t}\n\t\t\tthis.whenUpdated();\n\t\t}\n\t\t\n\t\tpublic updatePlayButton(): void {\n\t\t\tif (this._doc.synth.playing) {\n\t\t\t\tthis._playButton.classList.remove(\"playButton\");\n\t\t\t\tthis._playButton.classList.add(\"pauseButton\");\n\t\t\t\tthis._playButton.title = \"Pause (Space)\";\n\t\t\t\tthis._playButton.innerText = \"Pause\";\n\t\t\t} else {\n\t\t\t\tthis._playButton.classList.remove(\"pauseButton\");\n\t\t\t\tthis._playButton.classList.add(\"playButton\");\n\t\t\t\tthis._playButton.title = \"Play (Space)\";\n\t\t\t\tthis._playButton.innerText = \"Play\";\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenKeyPressed = (event: KeyboardEvent): void => {\n\t\t\tif (this.prompt) {\n\t\t\t\tif (event.keyCode == 27) { // ESC key\n\t\t\t\t\t// close prompt.\n\t\t\t\t\twindow.history.back();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//if (event.ctrlKey)\n\t\t\t//trace(event.keyCode)\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 8:\n\t\t\t\t\tif (event.ctrlKey) {\n\t\t\t\t\t\tthis._doc.record(new ChangeRemoveChannel(this._doc, this._doc.channel, this._doc.channel));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._doc.record(new ChangeDeleteBars(this._doc, this._doc.bar, 1));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 13: // enter\n\t\t\t\t\tif (event.ctrlKey) {\n\t\t\t\t\t\tthis._doc.record(new ChangeAddChannel(this._doc, this._doc.channel+1, this._doc.song.getChannelIsDrum(this._doc.channel)));\n\t\t\t\t\t\tthis._doc.channel = this._doc.channel + 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._doc.record(new ChangeInsertBars(this._doc, this._doc.bar+1, 1)); }\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 38: // up\n\t\t\t\t\tthis._trackEditor._setChannelBar((this._doc.channel - 1 + this._doc.song.getChannelCount()) % this._doc.song.getChannelCount(), this._doc.bar);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 40: // down\n\t\t\t\tthis._trackEditor._setChannelBar((this._doc.channel + 1) % this._doc.song.getChannelCount(), this._doc.bar);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 37: // left\n\t\t\t\tthis._trackEditor._setChannelBar(this._doc.channel, (this._doc.bar + this._doc.song.barCount - 1) % this._doc.song.barCount);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 39: // right\n\t\t\t\tthis._trackEditor._setChannelBar(this._doc.channel, (this._doc.bar + 1) % this._doc.song.barCount);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 48: // 0\n\t\t\t\tthis._trackEditor._nextDigit(\"0\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 49: // 1\n\t\t\t\tthis._trackEditor._nextDigit(\"1\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 50: // 2\n\t\t\t\tthis._trackEditor._nextDigit(\"2\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 51: // 3\n\t\t\t\tthis._trackEditor._nextDigit(\"3\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 52: // 4\n\t\t\t\tthis._trackEditor._nextDigit(\"4\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 53: // 5\n\t\t\t\tthis._trackEditor._nextDigit(\"5\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 54: // 6\n\t\t\t\tthis._trackEditor._nextDigit(\"6\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 55: // 7\n\t\t\t\tthis._trackEditor._nextDigit(\"7\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 56: // 8\n\t\t\t\tthis._trackEditor._nextDigit(\"8\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 57: // 9\n\t\t\t\tthis._trackEditor._nextDigit(\"9\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\tthis._trackEditor._digits = \"\";\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 77: // m\n\t\t\t\t\tthis._muteInstrument();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 32: // space\n\t\t\t\t\t//stage.focus = stage;\n\t\t\t\t\tthis._togglePlay();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 90: // z\n\t\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\t\tthis._doc.redo();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._doc.undo();\n\t\t\t\t\t}\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 89: // y\n\t\t\t\t\tthis._doc.redo();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 88: // x\n\t\t\t\t\tthis._cut();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 67: // c\n\t\t\t\t\tthis._copy();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 70: // f\n\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\tthis._doc.synth.snapToBar(this._doc.song.loopStart);\n\t\t\t\t} else {\n\t\t\t\t\tthis._doc.synth.snapToStart();\n\t\t\t\t}\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 86: // v\n\t\t\t\t\tthis._paste();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 219: // left brace\n\t\t\t\t\tthis._doc.synth.prevBar();\n\t\t\t\t\tif (this._doc.autoFollow) {\n\t\t\t\t\t\tnew ChangeChannelBar(this._doc, this._doc.channel, Math.floor(this._doc.synth.playhead));\n\t\t\t\t\t}\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 221: // right brace\n\t\t\t\t\tthis._doc.synth.nextBar();\n\t\t\t\t\tif (this._doc.autoFollow) {\n\t\t\t\t\t\tnew ChangeChannelBar(this._doc, this._doc.channel, Math.floor(this._doc.synth.playhead));\n\t\t\t\t\t}\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 189: // -\n\t\t\t\tcase 173: // Firefox -\n\t\t\t\t\tthis._transpose(false);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 187: // +\n\t\t\t\tcase 61: // Firefox +\n\t\t\t\t\tthis._transpose(true);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 81: // q\n\t\t\t\t\tthis._openPrompt(\"duration\");\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenPrevBarPressed = (): void => {\n\t\t\tthis._doc.synth.prevBar();\n\t\t}\n\t\t\n\t\tprivate _whenNextBarPressed = (): void => {\n\t\t\tthis._doc.synth.nextBar();\n\t\t}\n\t\t\n\t\tprivate _togglePlay = (): void => {\n\t\t\tif (this._doc.synth.playing) {\n\t\t\t\tthis._pause();\n\t\t\t} else {\n\t\t\t\tthis._play();\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _play(): void {\n\t\t\tthis._doc.synth.play();\n\t\t\tthis.updatePlayButton();\n\t\t}\n\t\t\n\t\tprivate _pause(): void {\n\t\t\tthis._doc.synth.pause();\n\t\t\tif (this._doc.autoFollow) {\n\t\t\t\tthis._doc.synth.snapToBar(this._doc.bar);\n\t\t\t} else {\n\t\t\t\tthis._doc.synth.snapToBar();\n\t\t\t}\n\t\t\tthis.updatePlayButton();\n\t\t}\n\t\t\n\t\tprivate _setVolumeSlider = (): void => {\n\t\t\tthis._doc.setVolume(Number(this._volumeSlider.value));\n\t\t\tthis._trackEditor.render();\n\t\t}\n\n\t\tprivate _cut(): void {\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\n\t\t\tif (pattern == null) return;\n\t\t\twindow.localStorage.setItem(\"patternCopy\", JSON.stringify({\n\t\t\t\tnotes: pattern.notes,\n\t\t\t\tbeatsPerBar: this._doc.song.beatsPerBar,\n\t\t\t\tpartsPerBeat: this._doc.song.partsPerBeat,\n\t\t\t\tdrums: this._doc.song.getChannelIsDrum(this._doc.channel),\n\t\t\t}));\n\t\t\tthis._doc.record(new ChangePaste(this._doc, pattern, [], this._doc.song.beatsPerBar, this._doc.song.partsPerBeat));\n\t\t}\n\t\t\n\t\tprivate _copy(): void {\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\n\t\t\tlet notes: Note[] = [];\n\t\t\tif (pattern != null) notes = pattern.notes;\n\t\t\t\n\t\t\tconst patternCopy: PatternCopy = {\n\t\t\t\tnotes: notes,\n\t\t\t\tbeatsPerBar: this._doc.song.beatsPerBar,\n\t\t\t\tpartsPerBeat: this._doc.song.partsPerBeat,\n\t\t\t\tdrums: this._doc.song.getChannelIsDrum(this._doc.channel),\n\t\t\t};\n\t\t\t\n\t\t\twindow.localStorage.setItem(\"patternCopy\", JSON.stringify(patternCopy));\n\t\t}\n\t\t\n\t\tprivate _paste(): void {\n\t\t\tconst patternCopy: PatternCopy | null = JSON.parse(String(window.localStorage.getItem(\"patternCopy\")));\n\t\t\tif (patternCopy != null && patternCopy.drums == this._doc.song.getChannelIsDrum(this._doc.channel)) {\n\t\t\t\tnew ChangeEnsurePatternExists(this._doc);\n\t\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\n\t\t\t\tif (pattern == null) throw new Error();\n\t\t\t\tthis._doc.record(new ChangePaste(this._doc, pattern, patternCopy.notes, patternCopy.beatsPerBar, patternCopy.partsPerBeat));\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _transpose(upward: boolean): void {\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\n\t\t\tif (pattern == null) return;\n\t\t\t\n\t\t\tconst canReplaceLastChange: boolean = this._doc.lastChangeWas(this._changeTranspose);\n\t\t\tthis._changeTranspose = new ChangeTranspose(this._doc, pattern, upward);\n\t\t\tthis._doc.record(this._changeTranspose, canReplaceLastChange);\n\t\t}\n\t\t\n\t\tprivate _whenNewSongPressed = (): void => {\n\t\t\tthis._doc.record(new ChangeSong(this._doc, \"\"));\n\t\t\tthis._patternEditor.resetCopiedPins();\n\t\t}\n\n\t\tprivate _whenCustomizePressed = (): void => {\n\t\t\tthis._openPrompt(\"duration\");\n\t\t}\n\n\t\tprivate _advancedUndo = (): void => {\n\t\t\tthis._doc.undo();\n\t\t}\n\n\t\tprivate _advancedRedo = (): void => {\n\t\t\tthis._doc.redo();\n\t\t}\n\t\t\n\t\tprivate _openExportPrompt = (): void => {\n\t\t\tthis._openPrompt(\"export\");\n\t\t}\n\t\t\n\t\tprivate _openSongDataPrompt = (): void => {\n\t\t\tthis._openPrompt(\"songdata\");\n\t\t}\n\t\t\n\t\tprivate _openInstrumentTypePrompt = (): void => {\n\t\t\tthis._openPrompt(\"instrumentType\");\n\t\t}\n\t\t\n\t\t// private _openChipPrompt = (): void => {\n\t\t// \tthis._openPrompt(\"chipPrompt\");\n\t\t// }\n\t\t\n\t\tprivate _openMixPrompt = (): void => {\n\t\t\tthis._openPrompt(\"mix\");\n\t\t}\n\t\t\n\t\tprivate _openChorusPrompt = (): void => {\n\t\t\tthis._openPrompt(\"chorus\");\n\t\t}\n\t\t\n\t\tprivate _openArchivePrompt = (): void => {\n\t\t\tthis._openPrompt(\"archive\");\n\t\t}\n\n\t\tpublic refreshNow = (): void => {\n\t\t\tsetTimeout(() => { // Prompts seem to get stuck if reloading is done too quickly.\n\t\t\t\tlocation.reload();\n\t\t\t}, 500);\n\t\t}\n\t\t\n\t\tprivate _whenSetTheme = (): void => {\n\t\t\tthis._openPrompt(\"refresh\");\n\t\t}\n\t\t\n\t\tprivate _whenSetScale = (): void => {\n\t\t\tthis._doc.record(new ChangeScale(this._doc, this._scaleSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetMix = (): void => {\n\t\t\tthis._doc.record(new ChangeMix(this._doc, this._mixSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetSampleRate = (): void => {\n\t\t\tthis._doc.record(new ChangeSampleRate(this._doc, this._sampleRateSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetKey = (): void => {\n\t\t\tif (this._doc.song.theme == 19) {\n\t\t\t\tthis._openPrompt(\"refresh key\");\n\t\t\t} else {\n\t\t\t\tthis._doc.record(new ChangeKey(this._doc, this._keySelect.selectedIndex));\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenSetPartsPerBeat = (): void => {\n\t\t\tthis._doc.record(new ChangePartsPerBeat(this._doc, Config.partCounts[this._partSelect.selectedIndex]));\n\t\t}\n\t\t\n\t\tprivate _whenSetInstrumentType = (): void => {\n\t\t\tthis._doc.record(new ChangeInstrumentType(this._doc, +this._instrumentTypeSelect.value));\n\t\t}\n\t\t\n\t\tprivate _whenSetFeedbackType = (): void => {\n\t\t\tthis._doc.record(new ChangeFeedbackType(this._doc, this._feedbackTypeSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetFeedbackEnvelope = (): void => {\n\t\t\tthis._doc.record(new ChangeFeedbackEnvelope(this._doc, this._feedbackEnvelopeSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetAlgorithm = (): void => {\n\t\t\tthis._doc.record(new ChangeAlgorithm(this._doc, this._algorithmSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetInstrument = (): void => {\n\t\t\tconst pattern : Pattern | null = this._doc.getCurrentPattern();\n\t\t\tif (pattern == null) return;\n\t\t\tthis._doc.record(new ChangePatternInstrument(this._doc, this._instrumentSelect.selectedIndex, pattern));\n\t\t}\n\t\t\n\t\tprivate _whenSetWave = (): void => {\n\t\t\tthis._doc.record(new ChangeWave(this._doc, this._waveSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetDrum = (): void => {\n\t\t\tthis._doc.record(new ChangeWave(this._doc, this._drumSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetPWMWave = (): void => {\n\t\t\tthis._doc.record(new ChangeWave(this._doc, this._pwmwaveSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetFilter = (): void => {\n\t\t\tthis._doc.record(new ChangeFilter(this._doc, this._filterSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetTransition = (): void => {\n\t\t\tthis._doc.record(new ChangeTransition(this._doc, this._transitionSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetEffect = (): void => {\n\t\t\tthis._doc.record(new ChangeEffect(this._doc, this._effectSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetHarm = (): void => {\n\t\t\tthis._doc.record(new ChangeHarm(this._doc, this._harmSelect.selectedIndex));\n\t\t}\n\n\t\tprivate _whenSetFMChorus = (): void => {\n\t\t\tthis._doc.record(new ChangeFMChorus(this._doc, this._fmChorusSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetOctoff = (): void => {\n\t\t\tthis._doc.record(new ChangeOctoff(this._doc, this._octoffSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _whenSetChorus = (): void => {\n\t\t\tthis._doc.record(new ChangeChorus(this._doc, this._chorusSelect.selectedIndex));\n\t\t}\n\t\t\n\t\tprivate _fileMenuHandler = (event:Event): void => {\n\t\t\tswitch (this._fileMenu.value) {\n\t\t\t\tcase \"import\":\n\t\t\t\t\tthis._openPrompt(\"import\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"export\":\n\t\t\t\t\tthis._openPrompt(\"export\");\n\t\t\t\t\tbreak;\t\n\t\t\t\tcase \"cleanS\":\n\t\t\t\t\tthis._whenNewSongPressed();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"songdata\":\n\t\t\t\t\tthis._openPrompt(\"songdata\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"manual\":\n\t\t\t\t\tthis._openPrompt(\"manual\");\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis._fileMenu.selectedIndex = 0;\n\t\t}\n\n\t\tprivate _editMenuHandler = (event:Event): void => {\n\t\t\tswitch (this._editMenu.value) {\n\t\t\t\tcase \"undo\":\n\t\t\t\t\tthis._doc.undo();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"redo\":\n\t\t\t\t\tthis._doc.redo();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"cut\":\n\t\t\t\t\tthis._cut();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"copy\":\n\t\t\t\t\tthis._copy();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"paste\":\n\t\t\t\t\tthis._paste();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"transposeUp\":\n\t\t\t\t\tthis._transpose(true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"transposeDown\":\n\t\t\t\t\tthis._transpose(false);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"duration\":\n\t\t\t\t\tthis._openPrompt(\"duration\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"archive\":\n\t\t\t\t\tthis._openPrompt(\"archive\");\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis._editMenu.selectedIndex = 0;\n\t\t}\n\t\t\n\t\tprivate _optionsMenuHandler = (event:Event): void => {\n\t\t\tswitch (this._optionsMenu.value) {\n\t\t\t\tcase \"autoPlay\":\n\t\t\t\t\tthis._doc.autoPlay = !this._doc.autoPlay;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"autoFollow\":\n\t\t\t\t\tthis._doc.autoFollow = !this._doc.autoFollow;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"showLetters\":\n\t\t\t\t\tthis._doc.showLetters = !this._doc.showLetters;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"showFifth\":\n\t\t\t\t\tthis._doc.showFifth = !this._doc.showFifth;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"showMore\":\n\t\t\t\t\tthis._doc.showMore = !this._doc.showMore;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"showChannels\":\n\t\t\t\t\tthis._doc.showChannels = !this._doc.showChannels;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"showScrollBar\":\n\t\t\t\t\tthis._doc.showScrollBar = !this._doc.showScrollBar;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"showVolumeBar\":\n\t\t\t\t\tthis._doc.showVolumeBar = !this._doc.showVolumeBar;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"advancedSettings\":\n\t\t\t\t\tthis._doc.advancedSettings = !this._doc.advancedSettings;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"themes\":\n\t\t\t\t\tthis._openPrompt(\"themes\");\n\t\t\t\t\tbreak;\t\n\t\t\t}\n\t\t\tthis._optionsMenu.selectedIndex = 0;\n\t\t\tthis._doc.notifier.changed();\n\t\t\tthis._doc.savePreferences();\n\t\t}\n\t}\n\t\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\n\n\texport class ChangeNotifier {\n\t\tprivate _watchers: (()=>void)[] = [];\n\t\tprivate _dirty: boolean = false;\n\t\t\n\t\tpublic watch(watcher: ()=>void): void {\n\t\t\tif (this._watchers.indexOf(watcher) == -1) {\n\t\t\t\tthis._watchers.push(watcher);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic unwatch(watcher: ()=>void): void {\n\t\t\tconst index: number = this._watchers.indexOf(watcher);\n\t\t\tif (index != -1) {\n\t\t\t\tthis._watchers.splice(index, 1);\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic changed(): void {\n\t\t\tthis._dirty = true;\n\t\t}\n\t\t\n\t\tpublic notifyWatchers(): void {\n\t\t\tif (!this._dirty) return;\n\t\t\tthis._dirty = false;\n\t\t\tfor (const watcher of this._watchers.concat()) {\n\t\t\t\twatcher();\n\t\t\t}\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport { Song, Synth, Pattern } from \"../synth/synth\";\nimport { ChangeNotifier } from \"./ChangeNotifier\";\nimport { Change } from \"./Change\";\nimport { ChangeSong } from \"./changes\";\nimport { ColorConfig } from \"./ColorConfig\"; \n\n\tinterface HistoryState {\n\t\tcanUndo: boolean;\n\t\tsequenceNumber: number;\n\t\tbar: number;\n\t\tchannel: number;\n\t\tprompt: string | null;\n\t}\n\t\n\texport class SongDocument {\n\t\tpublic static _latestVersion: number = 2;\n\t\t\n\t\tpublic song: Song;\n\t\tpublic synth: Synth;\n\t\tpublic notifier: ChangeNotifier = new ChangeNotifier();\n\t\tpublic channel: number = 0;\n\t\tpublic bar: number = 0;\n\t\tpublic autoPlay: boolean;\n\t\tpublic autoFollow: boolean;\n\t\tpublic showFifth: boolean;\n\t\tpublic showMore: boolean;\n\t\tpublic showLetters: boolean;\n\t\tpublic showChannels: boolean;\n\t\tpublic showScrollBar: boolean;\n\t\tpublic showVolumeBar: boolean;\n\t\tpublic advancedSettings: boolean;\n\t\tpublic volume: number = 75;\n\t\tpublic trackVisibleBars: number = 16;\n\t\tpublic barScrollPos: number = 0;\n\t\tpublic prompt: string | null = null;\n\t\t\n\t\tprivate _recentChange: Change | null = null;\n\t\tprivate _sequenceNumber: number = 0;\n\t\tprivate _barFromCurrentState: number = 0;\n\t\tprivate _channelFromCurrentState: number = 0;\n\t\tprivate _shouldPushState: boolean = false;\n\t\tprivate _waitingToUpdateState: boolean = false;\n\t\t\n\t\tconstructor(string?: string) {\n\t\t\tthis.song = new Song(string);\n\t\t\tthis.synth = new Synth(this.song);\n\t\t\t\n\t\t\tthis.autoPlay = localStorage.getItem(\"autoPlay\") == \"true\";\n\t\t\tthis.autoFollow = localStorage.getItem(\"autoFollow\") == \"true\";\n\t\t\tthis.showFifth = localStorage.getItem(\"showFifth\") == \"true\";\n\t\t\tthis.showMore = localStorage.getItem(\"showMore\") == \"true\";\n\t\t\tthis.showLetters = localStorage.getItem(\"showLetters\") == \"true\";\n\t\t\tthis.showChannels = localStorage.getItem(\"showChannels\") == \"true\";\n\t\t\tthis.showScrollBar = localStorage.getItem(\"showScrollBar\") == \"true\";\n\t\t\tthis.showVolumeBar = localStorage.getItem(\"showVolumeBar\") == \"true\";\n\t\t\tthis.advancedSettings = localStorage.getItem(\"advancedSettings\") != \"false\";\n\t\t\tif (localStorage.getItem(\"volume\") != null) this.volume = Number(localStorage.getItem(\"volume\"));\n\t\t\t\n\t\t\tthis.synth.volume = this._calcVolume();\n\t\t\t\n\t\t\tif (window.localStorage.getItem(\"modboxTheme\") != null) {\n\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\n\t\t\t} else {\n\t\t\t\twindow.localStorage.setItem(\"modboxTheme\", \"default\");\n\t\t\t\tColorConfig.setTheme(\"default\");\n\t\t\t}\n\n\t\t\tlet state: HistoryState | null = window.history.state;\n\t\t\tif (state == null) {\n\t\t\t\t// When the page is first loaded, indicate that undo is NOT possible.\n\t\t\t\tstate = {canUndo: false, sequenceNumber: 0, bar: 0, channel: 0, prompt: null};\n\t\t\t\twindow.history.replaceState(state, \"\", \"#\" + this.song.toBase64String());\n\t\t\t}\n\t\t\twindow.addEventListener(\"hashchange\", this._whenHistoryStateChanged);\n\t\t\twindow.addEventListener(\"popstate\", this._whenHistoryStateChanged);\n\t\t\t\n\t\t\tthis.bar = state.bar;\n\t\t\tthis.channel = state.channel;\n\t\t\tthis._barFromCurrentState = state.bar;\n\t\t\tthis._channelFromCurrentState = state.channel;\n\t\t\tthis.barScrollPos = Math.max(0, this.bar - (this.trackVisibleBars - 6));\n\t\t\tthis.prompt = state.prompt;\n\t\t\t\n\t\t\t// For all input events, catch them when they are about to finish bubbling,\n\t\t\t// presumably after all handlers are done updating the model and update the\n\t\t\t// view before the screen renders. mouseenter and mouseleave do not bubble,\n\t\t\t// but they are immediately followed by mousemove which does. \n\t\t\tfor (const eventName of [\"input\", \"change\", \"click\", \"keyup\", \"keydown\", \"mousedown\", \"mousemove\", \"mouseup\", \"touchstart\", \"touchmove\", \"touchend\", \"touchcancel\"]) {\n\t\t\t\twindow.addEventListener(eventName, this._cleanDocument);\n\t\t\t}\n\t\t}\n\t\t\n\t\tprivate _whenHistoryStateChanged = (): void => {\n\t\t\tlet state: HistoryState | null = window.history.state;\n\t\t\t\n\t\t\t// We're listening for both hashchanged and popstate, which often fire together.\n\t\t\t// Abort if we've already handled the current state. \n\t\t\tif (state && state.sequenceNumber == this._sequenceNumber) return;\n\t\t\t\n\t\t\tif (state == null) {\n\t\t\t\t// The user changed the hash directly.\n\t\t\t\tthis._sequenceNumber++;\n\t\t\t\tstate = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\n\t\t\t\tnew ChangeSong(this, location.hash);\n\t\t\t\twindow.history.replaceState(state, \"\", \"#\" + this.song.toBase64String());\n\t\t\t} else {\n\t\t\t\tif (state.sequenceNumber == this._sequenceNumber - 1) {\n\t\t\t\t\t// undo:\n\t\t\t\t\tthis.bar = this._barFromCurrentState;\n\t\t\t\t\tthis.channel = this._channelFromCurrentState;\n\t\t\t\t} else if (state.sequenceNumber != this._sequenceNumber) {\n\t\t\t\t\t// redo, or jump multiple steps in history:\n\t\t\t\t\tthis.bar = state.bar;\n\t\t\t\t\tthis.channel = state.channel;\n\t\t\t\t}\n\t\t\t\tthis._sequenceNumber = state.sequenceNumber;\n\t\t\t\tthis.prompt = state.prompt;\n\t\t\t\tnew ChangeSong(this, location.hash);\n\t\t\t}\n\t\t\t\n\t\t\tthis._barFromCurrentState = state.bar;\n\t\t\tthis._channelFromCurrentState = state.channel;\n\t\t\t\n\t\t\t//this.barScrollPos = Math.min(this.bar, Math.max(this.bar - (this.trackVisibleBars - 1), this.barScrollPos));\n\t\t\t\n\t\t\tthis.forgetLastChange();\n\t\t\tthis.notifier.notifyWatchers();\n\t\t}\n\t\t\n\t\tprivate _cleanDocument = (): void => {\n\t\t\tthis.notifier.notifyWatchers();\n\t\t}\n\t\t\n\t\tprivate _updateHistoryState = (): void => {\n\t\t\tthis._waitingToUpdateState = false;\n\t\t\tconst hash: string = \"#\" + this.song.toBase64String();\n\t\t\tlet state: HistoryState;\n\t\t\tif (this._shouldPushState) {\n\t\t\t\tthis._sequenceNumber++;\n\t\t\t\tstate = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\n\t\t\t\twindow.history.pushState(state, \"\", hash);\n\t\t\t} else {\n\t\t\t\tstate = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\n\t\t\t\twindow.history.replaceState(state, \"\", hash);\n\t\t\t}\n\t\t\tthis._barFromCurrentState = state.bar;\n\t\t\tthis._channelFromCurrentState = state.channel;\n\t\t\tthis._shouldPushState = false;\n\t\t}\n\t\t\n\t\tpublic record(change: Change, replaceState: boolean = false): void {\n\t\t\tif (change.isNoop()) {\n\t\t\t\tthis._recentChange = null;\n\t\t\t\tif (replaceState) {\n\t\t\t\t\twindow.history.back();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._recentChange = change;\n\t\t\t\tif (!replaceState) {\n\t\t\t\t\tthis._shouldPushState = true;\n\t\t\t\t}\n\t\t\t\tif (!this._waitingToUpdateState) {\n\t\t\t\t\twindow.requestAnimationFrame(this._updateHistoryState);\n\t\t\t\t\tthis._waitingToUpdateState = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tpublic openPrompt(prompt: string): void {\n\t\t\tthis.prompt = prompt;\n\t\t\tconst hash: string = \"#\" + this.song.toBase64String();\n\t\t\tthis._sequenceNumber++;\n\t\t\tconst state = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\n\t\t\twindow.history.pushState(state, \"\", hash);\n\t\t}\n\t\t\n\t\tpublic undo(): void {\n\t\t\tconst state: HistoryState = window.history.state;\n\t\t\tif (state.canUndo) window.history.back();\n\t\t}\n\t\t\n\t\tpublic redo(): void {\n\t\t\twindow.history.forward();\n\t\t}\n\t\t\n\t\tpublic setProspectiveChange(change: Change | null): void {\n\t\t\tthis._recentChange = change;\n\t\t}\n\t\t\n\t\tpublic forgetLastChange(): void {\n\t\t\tthis._recentChange = null;\n\t\t}\n\t\t\n\t\tpublic lastChangeWas(change: Change | null): boolean {\n\t\t\treturn change != null && change == this._recentChange;\n\t\t}\n\t\t\n\t\tpublic savePreferences(): void {\n\t\t\tlocalStorage.setItem(\"autoPlay\", this.autoPlay ? \"true\" : \"false\");\n\t\t\tlocalStorage.setItem(\"autoFollow\", this.autoFollow ? \"true\" : \"false\");\n\t\t\tlocalStorage.setItem(\"showFifth\", this.showFifth ? \"true\" : \"false\");\n\t\t\tlocalStorage.setItem(\"showMore\", this.showMore ? \"true\" : \"false\");\n\t\t\tlocalStorage.setItem(\"showLetters\", this.showLetters ? \"true\" : \"false\");\n\t\t\tlocalStorage.setItem(\"showChannels\", this.showChannels ? \"true\" : \"false\");\n\t\t\tlocalStorage.setItem(\"showScrollBar\", this.showScrollBar ? \"true\" : \"false\");\n\t\t\tlocalStorage.setItem(\"showVolumeBar\", this.showVolumeBar ? \"true\" : \"false\");\n\t\t\tlocalStorage.setItem(\"advancedSettings\", this.advancedSettings ? \"true\" : \"false\");\n\t\t\tlocalStorage.setItem(\"volume\", String(this.volume));\n\t\t}\n\t\t\n\t\tpublic setVolume(val: number): void {\n\t\t\tthis.volume = val;\n\t\t\tthis.savePreferences();\n\t\t\tthis.synth.volume = this._calcVolume();\n\t\t}\n\t\t\n\t\tprivate _calcVolume(): number {\n\t\t\treturn Math.min(1.0, Math.pow(this.volume / 50.0, 0.5)) * Math.pow(2.0, (this.volume - 75.0) / 25.0);\n\t\t}\n\t\t\n\t\tpublic getCurrentPattern(): Pattern | null {\n\t\t\treturn this.song.getPattern(this.channel, this.bar);\n\t\t}\n\t\t\n\t\tpublic getCurrentInstrument(): number {\n\t\t\tconst pattern: Pattern | null = this.getCurrentPattern();\n\t\t\treturn pattern == null ? 0 : pattern.instrument;\n\t\t}\n\t}\n\n","/*\nCopyright (C) 2018 John Nesky\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of \nthis software and associated documentation files (the \"Software\"), to deal in \nthe Software without restriction, including without limitation the rights to \nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \nof the Software, and to permit persons to whom the Software is furnished to do \nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all \ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \nSOFTWARE.\n*/\n\nimport {HTML} from \"imperative-html/dist/esm/elements-strict\";\nimport { ColorConfig } from \"./ColorConfig\";\n\ndocument.head.appendChild(HTML.style({ type: \"text/css\" }, `\nhtml {\nbackground: ${ColorConfig.pageMargin};\n}\n\n.beepboxEditor {\n\tdisplay: flex;\n\t-webkit-touch-callout: none;\n\t-webkit-user-select: none;\n\t-khtml-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n\tposition: relative;\n\ttouch-action: manipulation;\n\tcursor: default;\n\tfont-size: small;\n\tbackground: ${ColorConfig.editorBackground};\n}\n\n.beepboxEditor .theme-option input:checked ~ * {\n\tcolor: #fff;\n}\n\n.beepboxEditor .theme-option {\n\tcolor: #999;\n}\n\n\n.hintButton {\n\twidth: 0.5em; \n\tdisplay: flex; \n\talign-items: center;\n}\n\n.beepboxEditor div {\n\tmargin: 0;\n\tpadding: 0;\n}\n\n.beepboxEditor .promptContainer {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\t/*background: rgba(0,0,0,0.5);*/\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.beepboxEditor .prompt {\n\tmargin: auto;\n\ttext-align: center;\n\tbackground: ${ColorConfig.editorBackground};\n\tborder-radius: 15px;\n\tborder: 4px solid #444;\n\tcolor: #fff;\n\tpadding: 20px;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .prompt > *:not(:first-child) {\n\tmargin-top: 1.5em;\n}\n\n/* Use psuedo-elements to add cross-browser up & down arrows to select elements: */\n.beepboxEditor .selectContainer {\n\tposition: relative;\n}\n.beepboxEditor .selectContainer:not(.menu)::before {\n\tcontent: \"\";\n\tposition: absolute;\n\tright: 0.3em;\n\ttop: 0.4em;\n\tborder-bottom: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor .selectContainer:not(.menu)::after {\n\tcontent: \"\";\n\tposition: absolute;\n\tright: 0.3em;\n\tbottom: 0.4em;\n\tborder-top: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor .selectContainer.menu::after {\n\tcontent: \"\";\n\tposition: absolute;\n\tright: 0.7em;\n\tmargin: auto;\n\ttop: 0;\n\tbottom: 0;\n\theight: 0;\n\tborder-top: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor select {\n\tmargin: 0;\n\tpadding: 0 0.3em;\n\tdisplay: block;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: ${ColorConfig.uiWidgetBackground};\n\tcolor: inherit;\n\tfont-size: inherit;\n\tcursor: pointer;\n\tfont-family: inherit;\n\n\t-webkit-appearance:none;\n\t-moz-appearance: none;\n\tappearance: none;\n}\n.beepboxEditor .menu select {\n\tpadding: 0 2em;\n}\n.beepboxEditor select:focus {\n\tbackground: ${ColorConfig.uiWidgetFocus};\n\toutline: none;\n}\n.beepboxEditor .menu select {\n\ttext-align: center;\n\ttext-align-last: center;\n}\n\n/* This makes it look better in firefox on my computer... What about others?\n@-moz-document url-prefix() {\n\t.beepboxEditor select { padding: 0 2px; }\n}\n*/\n.beepboxEditor button {\n\tmargin: 0;\n\tposition: relative;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: ${ColorConfig.uiWidgetBackground};\n\tcolor: inherit;\n\tfont-size: inherit;\n\tfont-family: inherit;\n\tcursor: pointer;\n}\n.beepboxEditor button:focus {\n\tbackground: ${ColorConfig.uiWidgetFocus};\n\toutline: none;\n}\n.beepboxEditor button.playButton, .beepboxEditor button.pauseButton {\n\tpadding-left: 2em;\n}\n.beepboxEditor button.playButton::before {\n\tcontent: \"\";\n\tposition: absolute;\n\tleft: 0.7em;\n\ttop: 50%;\n\tmargin-top: -0.65em;\n\tborder-left: 1em solid currentColor;\n\tborder-top: 0.65em solid transparent;\n\tborder-bottom: 0.65em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor button.pauseButton::before {\n\tcontent: \"\";\n\tposition: absolute;\n\tleft: 0.7em;\n\ttop: 50%;\n\tmargin-top: -0.65em;\n\twidth: 0.3em;\n\theight: 1.3em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n.beepboxEditor button.pauseButton::after {\n\tcontent: \"\";\n\tposition: absolute;\n\tleft: 1.4em;\n\ttop: 50%;\n\tmargin-top: -0.65em;\n\twidth: 0.3em;\n\theight: 1.3em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n\n.beepboxEditor button.prevBarButton::before {\n\tcontent: \"\";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -0.5em;\n\tmargin-top: -0.5em;\n\twidth: 0.2em;\n\theight: 1em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n.beepboxEditor button.prevBarButton::after {\n\tcontent: \"\";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -0.3em;\n\tmargin-top: -0.5em;\n\tborder-right: 0.8em solid currentColor;\n\tborder-top: 0.5em solid transparent;\n\tborder-bottom: 0.5em solid transparent;\n\tpointer-events: none;\n}\n\n.beepboxEditor button.nextBarButton::before {\n\tcontent: \"\";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -0.5em;\n\tmargin-top: -0.5em;\n\tborder-left: 0.8em solid currentColor;\n\tborder-top: 0.5em solid transparent;\n\tborder-bottom: 0.5em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor button.nextBarButton::after {\n\tcontent: \"\";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: 0.3em;\n\tmargin-top: -0.5em;\n\twidth: 0.2em;\n\theight: 1em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n\n.beepboxEditor canvas {\n\toverflow: hidden;\n\tposition: absolute;\n\tdisplay: block;\n}\n\n.beepboxEditor .trackContainer {\n\toverflow-x: hidden;\n}\n\n.beepboxEditor .selectRow {\n\tmargin: 0;\n\theight: 2.5em;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n.beepboxEditor .selectRow > span {\n\tcolor: ${ColorConfig.secondaryText};\n}\n\n.beepboxEditor .operatorRow {\n\tmargin: 0;\n\theight: 2.5em;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n}\n\n.beepboxEditor .operatorRow > * {\n\tflex-grow: 1;\n\tflex-shrink: 1;\n}\n\n.beepboxEditor .editor-widget-column {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-widgets {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-menus {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-song-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-instrument-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n.beepboxEditor .editor-right-widget-column {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-menus {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-song-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-instrument-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-side-top > *, .beepboxEditor .editor-right-side-bottom > * {\n\tflex-shrink: 0;\n}\n\n.beepboxEditor input[type=text], .beepboxEditor input[type=number] {\n\tfont-size: inherit;\n\tbackground: transparent;\n\tborder: 1px solid #777;\n\tcolor: white;\n}\n\n.beepboxEditor input[type=checkbox] {\n  transform: scale(1.5);\n}\n\n.beepboxEditor input[type=range] {\n\t-webkit-appearance: none;\n\tcolor: inherit;\n\twidth: 100%;\n\theight: 2em;\n\tfont-size: inherit;\n\tmargin: 0;\n\tcursor: pointer;\n\tbackground-color: ${ColorConfig.editorBackground};\n\ttouch-action: pan-y;\n}\n.beepboxEditor input[type=range]:focus {\n\toutline: none;\n}\n.beepboxEditor input[type=range]::-webkit-slider-runnable-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: ${ColorConfig.uiWidgetBackground};\n}\n.beepboxEditor input[type=range]::-webkit-slider-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tbackground: currentColor;\n\tcursor: pointer;\n\t-webkit-appearance: none;\n\tmargin-top: -0.75em;\n}\n.beepboxEditor input[type=range]:focus::-webkit-slider-runnable-track {\n\tbackground: ${ColorConfig.uiWidgetFocus};\n}\n.beepboxEditor input[type=range]::-moz-range-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: ${ColorConfig.uiWidgetBackground};\n}\n.beepboxEditor input[type=range]:focus::-moz-range-track {\n\tbackground: ${ColorConfig.uiWidgetFocus};\n}\n.beepboxEditor input[type=range]::-moz-range-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tborder: none;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n.beepboxEditor input[type=range]::-ms-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: ${ColorConfig.uiWidgetBackground};\n\tborder-color: transparent;\n}\n.beepboxEditor input[type=range]:focus::-ms-track {\n\tbackground: ${ColorConfig.uiWidgetFocus};\n}\n.beepboxEditor input[type=range]::-ms-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n.beepboxEditor .hintButton {\n\tborder: 1px solid currentColor;\n\tborder-radius: 50%;\n\ttext-decoration: none;\n\theight: 1em;\n\ttext-align: center;\n\tmargin-right: .4em;\n\tcursor: pointer;\n}\n\n/* wide screen */\n@media (min-width: 501px) {\n\t#beepboxEditorContainer {\n\t\tdisplay: table;\n\t}\n\t.beepboxEditor {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: 3px solid #555;\n\t}\n\t.beepboxEditor .trackContainer {\n\t\twidth: 512px;\n\t}\n\t.beepboxEditor .trackSelectBox {\n\t\tdisplay: none;\n\t}\n\t.beepboxEditor .playback-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: .2em 0;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: .2em 0;\n\t\talign-items: center;\n\t}\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\n\t\tflex-grow: 1;\n\t\tmargin-left: 10px;\n\t}\n\t.beepboxEditor .editor-widget-column {\n\t\tmargin-left: 6px;\n\t\twidth: 14em;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .editor-right-widget-column {\n\t\tmargin-left: 6px;\n\t\twidth: 14em;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .editor-widgets {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .editor-right-widgets {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .editor-settings input, .beepboxEditor .editor-settings select {\n\t\twidth: 8.6em;\n\t}\n\t.beepboxEditor .editor-right-settings input, .beepboxEditor .editor-right-settings select {\n\t\twidth: 8.6em;\n\t}\n\t.beepboxEditor .editor-menus > * {\n\t\tflex-grow: 1;\n\t\tmargin: .2em 0;\n\t}\n\t.beepboxEditor .editor-right-menus > * {\n\t\tflex-grow: 1;\n\t\tmargin: .2em 0;\n\t}\n\t.beepboxEditor .editor-menus > button {\n\t\tpadding: 0 2em;\n\t\twhite-space: nowrap;\n\t}\n\t.beepboxEditor .editor-right-menus > button {\n\t\tpadding: 0 2em;\n\t\twhite-space: nowrap;\n\t}\n}\n\n/* narrow screen */\n@media (max-width: 500px) {\n\t.beepboxEditor {\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: none;\n\t}\n\t.beepboxEditor .editorBox {\n\t\tmax-height: 75vh;\n\t}\n\t.beepboxEditor .editor-menus {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor .editor-right-menus {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor .editor-menus > * {\n\t\tflex-grow: 1;\n\t\tmargin: .10em;\n\t}\n\t.beepboxEditor .editor-right-menus > * {\n\t\tflex-grow: 1;\n\t\tmargin: .2em;\n\t}\n\t.beepboxEditor .editor-menus > button {\n\t\tpadding-left: 2em;\n\t\twhite-space: nowrap;\n\t}\n\t.beepboxEditor .editor-right-menus > button {\n\t\tpadding-left: 2em;\n\t\twhite-space: nowrap;\n\t}\n\t.beepboxEditor .trackContainer {\n\t\toverflow-x: auto;\n\t}\n\t.beepboxEditor .barScrollBar {\n\t\tdisplay: none;\n\t}\n\t.beepboxEditor .playback-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: .2em 0;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tflex-grow: 1;\n\t\tmargin: 0 .2em;\n\t}\n\t.beepboxEditor .editor-widget-column {\n\t\tflex-direction: column-reverse;\n\t}\n\t.beepboxEditor .editor-settings {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor .editor-right-widget-column {\n\t\tflex-direction: column-reverse;\n\t}\n\t.beepboxEditor .editor-right-settings {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton,\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\n\t\tflex-grow: 1;\n\t\tmargin: 0 .2em;\n\t}\n\t.beepboxEditor .editor-song-settings, .beepboxEditor .editor-instrument-settings {\n\t\tflex-grow: 1;\n\t\tmargin: 0 .2em;\n\t}\n\t.beepboxEditor .editor-right-song-settings, .beepboxEditor .editor-right-instrument-settings {\n\t\tflex-grow: 1;\n\t\tmargin: 0 .2em;\n\t}\n\t.beepboxEditor .editor-settings input, .beepboxEditor .editor-settings .selectContainer {\n\t\twidth: 60%;\n\t}\n\t.beepboxEditor .editor-right-settings input, .beepboxEditor .editor-right-settings .selectContainer {\n\t\twidth: 60%;\n\t}\n\t.beepboxEditor .editor-settings select {\n\t\twidth: 100%;\n\t}\n\t.beepboxEditor .editor-right-settings select {\n\t\twidth: 100%;\n\t}\n\t.fullWidthOnly {\n\t\tdisplay: none;\n\t}\n\tp {\n\t\tmargin: 1em 0.5em;\n\t}\n}\n`));\n\t\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport {InstrumentType, Config} from \"../synth/SynthConfig\";\r\nimport {isMobile, SongEditor} from \"./SongEditor\";\r\nimport {NotePin, Note, Pattern, Instrument, Channel, Song, Synth} from \"../synth/synth\";\r\nimport {SongDocument} from \"./SongDocument\";\r\nimport {ExportPrompt} from \"./ExportPrompt\";\r\nimport \"./style\"; // Import for the side effects, there's no exports.\r\n\r\nconst doc: SongDocument = new SongDocument(location.hash);\r\nconst editor: SongEditor = new SongEditor(doc);\r\nconst beepboxEditorContainer: HTMLElement = document.getElementById(\"beepboxEditorContainer\")!;\r\nbeepboxEditorContainer.appendChild(editor.mainLayer);\r\neditor.whenUpdated();\r\neditor.mainLayer.focus();\r\n\r\nif (!isMobile && doc.autoPlay) {\r\n\tfunction autoplay(): void {\r\n\t\tif (!document.hidden) {\r\n\t\t\tdoc.synth.play();\r\n\t\t\teditor.updatePlayButton();\r\n\t\t\twindow.removeEventListener(\"visibilitychange\", autoplay);\r\n\t\t}\r\n\t}\r\n\tif (document.hidden) {\r\n\t\t// Wait until the tab is visible to autoplay:\r\n\t\twindow.addEventListener(\"visibilitychange\", autoplay);\r\n\t} else {\r\n\t\tautoplay();\r\n\t}\r\n}\r\n\r\n// BeepBox uses browser history state as its own undo history. Browsers typically\r\n// remember scroll position for each history state, but BeepBox users would prefer not \r\n// auto scrolling when undoing. Sadly this tweak doesn't work on Edge or IE.\r\nif (\"scrollRestoration\" in history) history.scrollRestoration = \"manual\";\r\n\r\neditor.updatePlayButton();\r\n\r\nif (\"serviceWorker\" in navigator) {\r\n\tnavigator.serviceWorker.register(\"/service_worker.js\", {updateViaCache: \"all\", scope: \"/\"}).catch(() => {});\r\n}\r\n\r\n// When compiling synth.ts as a standalone module named \"beepbox\", expose these classes as members to JavaScript:\r\nexport {InstrumentType, Config, NotePin, Note, Pattern, Instrument, Channel, Song, Synth, SongDocument, SongEditor, ExportPrompt};\r\n"],"mappings":"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","ignoreList":[]}